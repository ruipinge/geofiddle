{"version":3,"file":"format-detection-Ich9T_gi.js","sources":["../../src/lib/utils/format-detection.ts"],"sourcesContent":["import type { FormatType, ProjectionType } from '@/types';\nimport { detectFormat as detectParserFormat } from '@/lib/parsers';\n\n/**\n * Auto-detects the format of geometry input\n */\nexport function detectFormat(input: string): FormatType | null {\n    const trimmed = input.trim();\n\n    if (!trimmed) {\n        return null;\n    }\n\n    // Use parser-based detection\n    const parserFormat = detectParserFormat(trimmed);\n    if (parserFormat) {\n        return parserFormat;\n    }\n\n    // Additional heuristic-based detection for formats not yet implemented\n    // WKT detection\n    if (isWKTLike(trimmed)) {\n        return 'wkt';\n    }\n\n    // EWKT detection (has SRID prefix)\n    if (trimmed.toUpperCase().startsWith('SRID=')) {\n        return 'ewkt';\n    }\n\n    // CSV/DSV detection (contains comma or semicolon separated numbers)\n    if (isDSVLike(trimmed)) {\n        return 'csv';\n    }\n\n    // KML detection\n    if (trimmed.includes('<kml') || trimmed.includes('<Placemark')) {\n        return 'kml';\n    }\n\n    // GPX detection\n    if (trimmed.includes('<gpx') || trimmed.includes('<trkpt')) {\n        return 'gpx';\n    }\n\n    // Polyline detection (encoded string)\n    if (isPolylineLike(trimmed)) {\n        return 'polyline5'; // Default to precision 5\n    }\n\n    return null;\n}\n\n/**\n * Auto-detects projection from EWKT SRID or coordinate ranges\n */\nexport function detectProjection(\n    input: string,\n    format?: FormatType | null\n): ProjectionType | null {\n    const trimmed = input.trim().toUpperCase();\n\n    // EWKT SRID detection\n    if (format === 'ewkt' || trimmed.startsWith('SRID=')) {\n        const sridMatch = /SRID=(\\d+)/i.exec(trimmed);\n        if (sridMatch?.[1]) {\n            const srid = parseInt(sridMatch[1], 10);\n            switch (srid) {\n                case 4326:\n                    return 'EPSG:4326';\n                case 3857:\n                    return 'EPSG:3857';\n                case 27700:\n                    return 'EPSG:27700';\n            }\n        }\n    }\n\n    // Heuristic: Try to detect from coordinate values\n    // BNG (UK) typically has coordinates in range: E 0-700000, N 0-1300000\n    // WGS84 lat/lon: lat -90 to 90, lon -180 to 180\n\n    return null; // Default to null (auto)\n}\n\n/**\n * Checks if input looks like WKT\n */\nfunction isWKTLike(input: string): boolean {\n    const wktTypes = [\n        'POINT',\n        'LINESTRING',\n        'POLYGON',\n        'MULTIPOINT',\n        'MULTILINESTRING',\n        'MULTIPOLYGON',\n        'GEOMETRYCOLLECTION',\n    ];\n\n    const upper = input.toUpperCase();\n    return wktTypes.some((type) => upper.startsWith(type));\n}\n\n/**\n * Checks if input looks like DSV (comma/semicolon/space separated numbers)\n */\nfunction isDSVLike(input: string): boolean {\n    // Should be mostly numbers and delimiters\n    const cleaned = input.replace(/[\\s,;|]/g, '');\n    const numericPattern = /^-?\\d+\\.?\\d*(-?\\d+\\.?\\d*)*$/;\n    return numericPattern.test(cleaned);\n}\n\n/**\n * Checks if input looks like an encoded polyline\n */\nfunction isPolylineLike(input: string): boolean {\n    // Encoded polylines use characters in ASCII range 63-126\n    // They typically don't contain spaces or common punctuation\n    if (input.includes(' ') || input.includes(',')) {\n        return false;\n    }\n\n    // Check if all characters are in the valid polyline encoding range\n    return /^[A-Za-z0-9_~\\\\`@?>=<;:]+$/.test(input);\n}\n"],"names":["detectFormat","input","trimmed","parserFormat","detectParserFormat","isWKTLike","isDSVLike","isPolylineLike","detectProjection","format","sridMatch","wktTypes","upper","type","cleaned"],"mappings":";;uEAMO,SAASA,EAAaC,EAAkC,CAC3D,MAAMC,EAAUD,EAAM,KAAA,EAEtB,GAAI,CAACC,EACD,OAAO,KAIX,MAAMC,EAAeC,EAAmBF,CAAO,EAC/C,OAAIC,IAMAE,EAAUH,CAAO,EACV,MAIPA,EAAQ,YAAA,EAAc,WAAW,OAAO,EACjC,OAIPI,EAAUJ,CAAO,EACV,MAIPA,EAAQ,SAAS,MAAM,GAAKA,EAAQ,SAAS,YAAY,EAClD,MAIPA,EAAQ,SAAS,MAAM,GAAKA,EAAQ,SAAS,QAAQ,EAC9C,MAIPK,EAAeL,CAAO,EACf,YAGJ,KACX,CAKO,SAASM,EACZP,EACAQ,EACqB,CACrB,MAAMP,EAAUD,EAAM,KAAA,EAAO,YAAA,EAG7B,GAAIQ,IAAW,QAAUP,EAAQ,WAAW,OAAO,EAAG,CAClD,MAAMQ,EAAY,cAAc,KAAKR,CAAO,EAC5C,GAAIQ,GAAA,MAAAA,EAAY,GAEZ,OADa,SAASA,EAAU,CAAC,EAAG,EAAE,EAC9B,CACJ,IAAK,MACD,MAAO,YACX,IAAK,MACD,MAAO,YACX,IAAK,OACD,MAAO,YAAA,CAGvB,CAMA,OAAO,IACX,CAKA,SAASL,EAAUJ,EAAwB,CACvC,MAAMU,EAAW,CACb,QACA,aACA,UACA,aACA,kBACA,eACA,oBAAA,EAGEC,EAAQX,EAAM,YAAA,EACpB,OAAOU,EAAS,KAAME,GAASD,EAAM,WAAWC,CAAI,CAAC,CACzD,CAKA,SAASP,EAAUL,EAAwB,CAEvC,MAAMa,EAAUb,EAAM,QAAQ,WAAY,EAAE,EAE5C,MADuB,8BACD,KAAKa,CAAO,CACtC,CAKA,SAASP,EAAeN,EAAwB,CAG5C,OAAIA,EAAM,SAAS,GAAG,GAAKA,EAAM,SAAS,GAAG,EAClC,GAIJ,6BAA6B,KAAKA,CAAK,CAClD","debug_id":"33922616-97a9-51f3-96a9-362d19a97f75"}