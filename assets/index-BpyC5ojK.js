import{r,j as d}from"./index-BX0X2oGC.js";let O=null,C=null;function w(){return typeof google<"u"&&typeof google.maps<"u"}async function v(){return C&&w()?C:O||(O=(async()=>{const t=await fetch("/PRIVATE.json");if(!t.ok)throw new Error("Failed to load Google Maps configuration. Make sure PRIVATE.json exists.");const n=await t.json();if(!n.apiKey)throw new Error("Google Maps API key not found in PRIVATE.json");return w()?(C=n,n):(await new Promise((i,h)=>{const c=document.createElement("script");c.src=`https://maps.googleapis.com/maps/api/js?key=${n.apiKey}&libraries=geometry&v=weekly`,c.async=!0,c.defer=!0,c.onload=()=>{i()},c.onerror=()=>{h(new Error("Failed to load Google Maps script"))},document.head.appendChild(c)}),C=n,n)})(),O)}function T(){const[t,n]=r.useState({isLoaded:!!C&&w(),error:null,config:C});return r.useEffect(()=>{t.isLoaded||v().then(i=>{n({isLoaded:!0,error:null,config:i})}).catch(i=>{n({isLoaded:!1,error:i instanceof Error?i.message:"Failed to load Google Maps",config:null})})},[t.isLoaded]),t}const u={base:{fill:"#3b82f6",stroke:"#2563eb",fillOpacity:.2},hover:{fill:"#8b5cf6",stroke:"#7c3aed",fillOpacity:.3},selected:{fill:"#f97316",stroke:"#ea580c",fillOpacity:.4},drawing:{fill:"#f97316",stroke:"#f97316",fillOpacity:.2},envelope:{fill:"#10b981",stroke:"#059669",fillOpacity:.1}};function A({map:t,features:n,selectedFeatureId:i,hoveredFeatureId:h,isEnvelopeHovered:c,envelope:E,drawingPreview:x}){const R=r.useRef(null),k=r.useRef(null),M=r.useRef(null);return r.useEffect(()=>{if(!t)return;const e=new google.maps.Data;e.setMap(t),R.current=e;const s=new google.maps.Data;s.setMap(t),k.current=s;const o=new google.maps.Data;return o.setMap(t),M.current=o,()=>{e.setMap(null),s.setMap(null),o.setMap(null),R.current=null,k.current=null,M.current=null}},[t]),r.useEffect(()=>{const e=R.current;if(!e||(e.forEach(o=>{e.remove(o)}),n.length===0))return;const s={type:"FeatureCollection",features:n.map(o=>({...o,properties:{...o.properties,_featureId:o.id}}))};try{e.addGeoJson(s)}catch{}},[n]),r.useEffect(()=>{const e=R.current;e&&e.setStyle(s=>{const o=s.getProperty("_featureId");let l=u.base,f=2,p=1;return o===i?(l=u.selected,f=4,p=3):o===h&&(l=u.hover,f=3,p=2),{fillColor:l.fill,fillOpacity:l.fillOpacity,strokeColor:l.stroke,strokeWeight:f,zIndex:p,icon:{path:google.maps.SymbolPath.CIRCLE,fillColor:l.stroke,fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2,scale:o===i?10:o===h?8:6}}})},[i,h]),r.useEffect(()=>{const e=k.current;if(e&&(e.forEach(s=>{e.remove(s)}),!(!x||x.features.length===0))){try{e.addGeoJson(x)}catch{}e.setStyle({fillColor:u.drawing.fill,fillOpacity:u.drawing.fillOpacity,strokeColor:u.drawing.stroke,strokeWeight:2,strokeOpacity:.8,icon:{path:google.maps.SymbolPath.CIRCLE,fillColor:u.drawing.fill,fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2,scale:6},zIndex:10})}},[x]),r.useEffect(()=>{const e=M.current;if(!e||(e.forEach(g=>{e.remove(g)}),!c||!E))return;const[s,o,l,f]=E,b={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[s,o],[l,o],[l,f],[s,f],[s,o]]]},properties:{}}]};try{e.addGeoJson(b)}catch{}e.setStyle({fillColor:u.envelope.fill,fillOpacity:u.envelope.fillOpacity,strokeColor:u.envelope.stroke,strokeWeight:2,strokeOpacity:.8,zIndex:0})},[c,E]),null}function W({viewState:t,onViewStateChange:n,basemap:i,features:h,selectedFeatureId:c,hoveredFeatureId:E,isEnvelopeHovered:x,envelope:R,isDrawing:k,drawingPreview:M,onMapClick:e,children:s}){const o=r.useRef(null),l=r.useRef(null),f=r.useRef(!1),{isLoaded:p,error:b,config:g}=T(),[L,G]=r.useState(!1),I=r.useRef(n),z=r.useRef(e),N=r.useRef(t);return r.useEffect(()=>{I.current=n},[n]),r.useEffect(()=>{z.current=e},[e]),r.useEffect(()=>{if(!p||!o.current||l.current)return;const a=N.current,j={center:{lat:a.latitude,lng:a.longitude},zoom:a.zoom,mapId:g==null?void 0:g.mapId,disableDefaultUI:!1,zoomControl:!0,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,gestureHandling:"greedy"},m=new google.maps.Map(o.current,j);return l.current=m,m.addListener("idle",()=>{if(f.current)return;const y=m.getCenter(),P=m.getZoom();y&&P!==void 0&&I.current({latitude:y.lat(),longitude:y.lng(),zoom:P})}),m.addListener("click",y=>{y.latLng&&z.current({lng:y.latLng.lng(),lat:y.latLng.lat()})}),G(!0),()=>{l.current=null,G(!1)}},[p,g==null?void 0:g.mapId]),r.useEffect(()=>{const a=l.current;if(!a||!L)return;const j=a.getCenter(),m=a.getZoom();if(!j||m===void 0)return;(Math.abs(j.lat()-t.latitude)>1e-4||Math.abs(j.lng()-t.longitude)>1e-4||Math.abs(m-t.zoom)>.1)&&(f.current=!0,a.setCenter({lat:t.latitude,lng:t.longitude}),a.setZoom(t.zoom),setTimeout(()=>{f.current=!1},100))},[t.latitude,t.longitude,t.zoom,L]),r.useEffect(()=>{const a=l.current;!a||!L||a.setOptions({draggableCursor:k?"crosshair":void 0})},[k,L]),r.useEffect(()=>{const a=l.current;!a||!L||a.setMapTypeId(i==="satellite"?"hybrid":"roadmap")},[i,L]),b?d.jsx("div",{className:"flex h-full w-full items-center justify-center bg-neutral-100",children:d.jsxs("div",{className:"max-w-md rounded-lg bg-white p-6 shadow-lg",children:[d.jsx("h3",{className:"mb-2 text-lg font-semibold text-red-600",children:"Failed to load Google Maps"}),d.jsx("p",{className:"text-sm text-neutral-600",children:b})]})}):p?d.jsxs("div",{className:"relative h-full w-full",children:[d.jsx("div",{ref:o,className:"h-full w-full"}),s,L&&l.current&&d.jsx(A,{map:l.current,features:h,selectedFeatureId:c,hoveredFeatureId:E,isEnvelopeHovered:x,envelope:R,drawingPreview:M})]}):d.jsx("div",{className:"flex h-full w-full items-center justify-center bg-neutral-100",children:d.jsx("div",{className:"text-neutral-600",children:"Loading Google Maps..."})})}export{A as GoogleGeometryLayer,W as GoogleMap,T as useGoogleMapsLoader};
//# sourceMappingURL=index-BpyC5ojK.js.map
