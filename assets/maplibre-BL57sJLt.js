function cf(G){return G&&G.__esModule&&Object.prototype.hasOwnProperty.call(G,"default")?G.default:G}function Gf(G){if(Object.prototype.hasOwnProperty.call(G,"__esModule"))return G;var Y=G.default;if(typeof Y=="function"){var Z=function pe(){return this instanceof pe?Reflect.construct(Y,arguments,this.constructor):Y.apply(this,arguments)};Z.prototype=Y.prototype}else Z={};return Object.defineProperty(Z,"__esModule",{value:!0}),Object.keys(G).forEach(function(pe){var me=Object.getOwnPropertyDescriptor(G,pe);Object.defineProperty(Z,pe,me.get?me:{enumerable:!0,get:function(){return G[pe]}})}),Z}var sp={exports:{}},ir={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kp;function hf(){if(kp)return ir;kp=1;var G=Symbol.for("react.element"),Y=Symbol.for("react.portal"),Z=Symbol.for("react.fragment"),pe=Symbol.for("react.strict_mode"),me=Symbol.for("react.profiler"),Ie=Symbol.for("react.provider"),A=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),qe=Symbol.for("react.suspense"),Ke=Symbol.for("react.memo"),st=Symbol.for("react.lazy"),ke=Symbol.iterator;function ge(de){return de===null||typeof de!="object"?null:(de=ke&&de[ke]||de["@@iterator"],typeof de=="function"?de:null)}var xr={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ot=Object.assign,Rt={};function Nt(de,Me,zt){this.props=de,this.context=Me,this.refs=Rt,this.updater=zt||xr}Nt.prototype.isReactComponent={},Nt.prototype.setState=function(de,Me){if(typeof de!="object"&&typeof de!="function"&&de!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,de,Me,"setState")},Nt.prototype.forceUpdate=function(de){this.updater.enqueueForceUpdate(this,de,"forceUpdate")};function Mr(){}Mr.prototype=Nt.prototype;function Rr(de,Me,zt){this.props=de,this.context=Me,this.refs=Rt,this.updater=zt||xr}var Xt=Rr.prototype=new Mr;Xt.constructor=Rr,Ot(Xt,Nt.prototype),Xt.isPureReactComponent=!0;var tr=Array.isArray,hr=Object.prototype.hasOwnProperty,Fr={current:null},zr={key:!0,ref:!0,__self:!0,__source:!0};function Mi(de,Me,zt){var At,Vt={},Gt=null,qt=null;if(Me!=null)for(At in Me.ref!==void 0&&(qt=Me.ref),Me.key!==void 0&&(Gt=""+Me.key),Me)hr.call(Me,At)&&!zr.hasOwnProperty(At)&&(Vt[At]=Me[At]);var $t=arguments.length-2;if($t===1)Vt.children=zt;else if(1<$t){for(var dr=Array($t),ri=0;ri<$t;ri++)dr[ri]=arguments[ri+2];Vt.children=dr}if(de&&de.defaultProps)for(At in $t=de.defaultProps,$t)Vt[At]===void 0&&(Vt[At]=$t[At]);return{$$typeof:G,type:de,key:Gt,ref:qt,props:Vt,_owner:Fr.current}}function gi(de,Me){return{$$typeof:G,type:de.type,key:Me,ref:de.ref,props:de.props,_owner:de._owner}}function nn(de){return typeof de=="object"&&de!==null&&de.$$typeof===G}function Kt(de){var Me={"=":"=0",":":"=2"};return"$"+de.replace(/[=:]/g,function(zt){return Me[zt]})}var sn=/\/+/g;function mr(de,Me){return typeof de=="object"&&de!==null&&de.key!=null?Kt(""+de.key):Me.toString(36)}function Ar(de,Me,zt,At,Vt){var Gt=typeof de;(Gt==="undefined"||Gt==="boolean")&&(de=null);var qt=!1;if(de===null)qt=!0;else switch(Gt){case"string":case"number":qt=!0;break;case"object":switch(de.$$typeof){case G:case Y:qt=!0}}if(qt)return qt=de,Vt=Vt(qt),de=At===""?"."+mr(qt,0):At,tr(Vt)?(zt="",de!=null&&(zt=de.replace(sn,"$&/")+"/"),Ar(Vt,Me,zt,"",function(ri){return ri})):Vt!=null&&(nn(Vt)&&(Vt=gi(Vt,zt+(!Vt.key||qt&&qt.key===Vt.key?"":(""+Vt.key).replace(sn,"$&/")+"/")+de)),Me.push(Vt)),1;if(qt=0,At=At===""?".":At+":",tr(de))for(var $t=0;$t<de.length;$t++){Gt=de[$t];var dr=At+mr(Gt,$t);qt+=Ar(Gt,Me,zt,dr,Vt)}else if(dr=ge(de),typeof dr=="function")for(de=dr.call(de),$t=0;!(Gt=de.next()).done;)Gt=Gt.value,dr=At+mr(Gt,$t++),qt+=Ar(Gt,Me,zt,dr,Vt);else if(Gt==="object")throw Me=String(de),Error("Objects are not valid as a React child (found: "+(Me==="[object Object]"?"object with keys {"+Object.keys(de).join(", ")+"}":Me)+"). If you meant to render a collection of children, use an array instead.");return qt}function ci(de,Me,zt){if(de==null)return de;var At=[],Vt=0;return Ar(de,At,"","",function(Gt){return Me.call(zt,Gt,Vt++)}),At}function ti(de){if(de._status===-1){var Me=de._result;Me=Me(),Me.then(function(zt){(de._status===0||de._status===-1)&&(de._status=1,de._result=zt)},function(zt){(de._status===0||de._status===-1)&&(de._status=2,de._result=zt)}),de._status===-1&&(de._status=0,de._result=Me)}if(de._status===1)return de._result.default;throw de._result}var or={current:null},et={transition:null},vt={ReactCurrentDispatcher:or,ReactCurrentBatchConfig:et,ReactCurrentOwner:Fr};function rt(){throw Error("act(...) is not supported in production builds of React.")}return ir.Children={map:ci,forEach:function(de,Me,zt){ci(de,function(){Me.apply(this,arguments)},zt)},count:function(de){var Me=0;return ci(de,function(){Me++}),Me},toArray:function(de){return ci(de,function(Me){return Me})||[]},only:function(de){if(!nn(de))throw Error("React.Children.only expected to receive a single React element child.");return de}},ir.Component=Nt,ir.Fragment=Z,ir.Profiler=me,ir.PureComponent=Rr,ir.StrictMode=pe,ir.Suspense=qe,ir.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vt,ir.act=rt,ir.cloneElement=function(de,Me,zt){if(de==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+de+".");var At=Ot({},de.props),Vt=de.key,Gt=de.ref,qt=de._owner;if(Me!=null){if(Me.ref!==void 0&&(Gt=Me.ref,qt=Fr.current),Me.key!==void 0&&(Vt=""+Me.key),de.type&&de.type.defaultProps)var $t=de.type.defaultProps;for(dr in Me)hr.call(Me,dr)&&!zr.hasOwnProperty(dr)&&(At[dr]=Me[dr]===void 0&&$t!==void 0?$t[dr]:Me[dr])}var dr=arguments.length-2;if(dr===1)At.children=zt;else if(1<dr){$t=Array(dr);for(var ri=0;ri<dr;ri++)$t[ri]=arguments[ri+2];At.children=$t}return{$$typeof:G,type:de.type,key:Vt,ref:Gt,props:At,_owner:qt}},ir.createContext=function(de){return de={$$typeof:A,_currentValue:de,_currentValue2:de,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},de.Provider={$$typeof:Ie,_context:de},de.Consumer=de},ir.createElement=Mi,ir.createFactory=function(de){var Me=Mi.bind(null,de);return Me.type=de,Me},ir.createRef=function(){return{current:null}},ir.forwardRef=function(de){return{$$typeof:g,render:de}},ir.isValidElement=nn,ir.lazy=function(de){return{$$typeof:st,_payload:{_status:-1,_result:de},_init:ti}},ir.memo=function(de,Me){return{$$typeof:Ke,type:de,compare:Me===void 0?null:Me}},ir.startTransition=function(de){var Me=et.transition;et.transition={};try{de()}finally{et.transition=Me}},ir.unstable_act=rt,ir.useCallback=function(de,Me){return or.current.useCallback(de,Me)},ir.useContext=function(de){return or.current.useContext(de)},ir.useDebugValue=function(){},ir.useDeferredValue=function(de){return or.current.useDeferredValue(de)},ir.useEffect=function(de,Me){return or.current.useEffect(de,Me)},ir.useId=function(){return or.current.useId()},ir.useImperativeHandle=function(de,Me,zt){return or.current.useImperativeHandle(de,Me,zt)},ir.useInsertionEffect=function(de,Me){return or.current.useInsertionEffect(de,Me)},ir.useLayoutEffect=function(de,Me){return or.current.useLayoutEffect(de,Me)},ir.useMemo=function(de,Me){return or.current.useMemo(de,Me)},ir.useReducer=function(de,Me,zt){return or.current.useReducer(de,Me,zt)},ir.useRef=function(de){return or.current.useRef(de)},ir.useState=function(de){return or.current.useState(de)},ir.useSyncExternalStore=function(de,Me,zt){return or.current.useSyncExternalStore(de,Me,zt)},ir.useTransition=function(){return or.current.useTransition()},ir.version="18.3.1",ir}var Ip;function Up(){return Ip||(Ip=1,sp.exports=hf()),sp.exports}var gt=Up();const Hf=cf(gt);var op={exports:{}},Ts={},ap={exports:{}},lp={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ep;function df(){return Ep||(Ep=1,(function(G){function Y(et,vt){var rt=et.length;et.push(vt);e:for(;0<rt;){var de=rt-1>>>1,Me=et[de];if(0<me(Me,vt))et[de]=vt,et[rt]=Me,rt=de;else break e}}function Z(et){return et.length===0?null:et[0]}function pe(et){if(et.length===0)return null;var vt=et[0],rt=et.pop();if(rt!==vt){et[0]=rt;e:for(var de=0,Me=et.length,zt=Me>>>1;de<zt;){var At=2*(de+1)-1,Vt=et[At],Gt=At+1,qt=et[Gt];if(0>me(Vt,rt))Gt<Me&&0>me(qt,Vt)?(et[de]=qt,et[Gt]=rt,de=Gt):(et[de]=Vt,et[At]=rt,de=At);else if(Gt<Me&&0>me(qt,rt))et[de]=qt,et[Gt]=rt,de=Gt;else break e}}return vt}function me(et,vt){var rt=et.sortIndex-vt.sortIndex;return rt!==0?rt:et.id-vt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var Ie=performance;G.unstable_now=function(){return Ie.now()}}else{var A=Date,g=A.now();G.unstable_now=function(){return A.now()-g}}var qe=[],Ke=[],st=1,ke=null,ge=3,xr=!1,Ot=!1,Rt=!1,Nt=typeof setTimeout=="function"?setTimeout:null,Mr=typeof clearTimeout=="function"?clearTimeout:null,Rr=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Xt(et){for(var vt=Z(Ke);vt!==null;){if(vt.callback===null)pe(Ke);else if(vt.startTime<=et)pe(Ke),vt.sortIndex=vt.expirationTime,Y(qe,vt);else break;vt=Z(Ke)}}function tr(et){if(Rt=!1,Xt(et),!Ot)if(Z(qe)!==null)Ot=!0,ti(hr);else{var vt=Z(Ke);vt!==null&&or(tr,vt.startTime-et)}}function hr(et,vt){Ot=!1,Rt&&(Rt=!1,Mr(Mi),Mi=-1),xr=!0;var rt=ge;try{for(Xt(vt),ke=Z(qe);ke!==null&&(!(ke.expirationTime>vt)||et&&!Kt());){var de=ke.callback;if(typeof de=="function"){ke.callback=null,ge=ke.priorityLevel;var Me=de(ke.expirationTime<=vt);vt=G.unstable_now(),typeof Me=="function"?ke.callback=Me:ke===Z(qe)&&pe(qe),Xt(vt)}else pe(qe);ke=Z(qe)}if(ke!==null)var zt=!0;else{var At=Z(Ke);At!==null&&or(tr,At.startTime-vt),zt=!1}return zt}finally{ke=null,ge=rt,xr=!1}}var Fr=!1,zr=null,Mi=-1,gi=5,nn=-1;function Kt(){return!(G.unstable_now()-nn<gi)}function sn(){if(zr!==null){var et=G.unstable_now();nn=et;var vt=!0;try{vt=zr(!0,et)}finally{vt?mr():(Fr=!1,zr=null)}}else Fr=!1}var mr;if(typeof Rr=="function")mr=function(){Rr(sn)};else if(typeof MessageChannel<"u"){var Ar=new MessageChannel,ci=Ar.port2;Ar.port1.onmessage=sn,mr=function(){ci.postMessage(null)}}else mr=function(){Nt(sn,0)};function ti(et){zr=et,Fr||(Fr=!0,mr())}function or(et,vt){Mi=Nt(function(){et(G.unstable_now())},vt)}G.unstable_IdlePriority=5,G.unstable_ImmediatePriority=1,G.unstable_LowPriority=4,G.unstable_NormalPriority=3,G.unstable_Profiling=null,G.unstable_UserBlockingPriority=2,G.unstable_cancelCallback=function(et){et.callback=null},G.unstable_continueExecution=function(){Ot||xr||(Ot=!0,ti(hr))},G.unstable_forceFrameRate=function(et){0>et||125<et?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):gi=0<et?Math.floor(1e3/et):5},G.unstable_getCurrentPriorityLevel=function(){return ge},G.unstable_getFirstCallbackNode=function(){return Z(qe)},G.unstable_next=function(et){switch(ge){case 1:case 2:case 3:var vt=3;break;default:vt=ge}var rt=ge;ge=vt;try{return et()}finally{ge=rt}},G.unstable_pauseExecution=function(){},G.unstable_requestPaint=function(){},G.unstable_runWithPriority=function(et,vt){switch(et){case 1:case 2:case 3:case 4:case 5:break;default:et=3}var rt=ge;ge=et;try{return vt()}finally{ge=rt}},G.unstable_scheduleCallback=function(et,vt,rt){var de=G.unstable_now();switch(typeof rt=="object"&&rt!==null?(rt=rt.delay,rt=typeof rt=="number"&&0<rt?de+rt:de):rt=de,et){case 1:var Me=-1;break;case 2:Me=250;break;case 5:Me=1073741823;break;case 4:Me=1e4;break;default:Me=5e3}return Me=rt+Me,et={id:st++,callback:vt,priorityLevel:et,startTime:rt,expirationTime:Me,sortIndex:-1},rt>de?(et.sortIndex=rt,Y(Ke,et),Z(qe)===null&&et===Z(Ke)&&(Rt?(Mr(Mi),Mi=-1):Rt=!0,or(tr,rt-de))):(et.sortIndex=Me,Y(qe,et),Ot||xr||(Ot=!0,ti(hr))),et},G.unstable_shouldYield=Kt,G.unstable_wrapCallback=function(et){var vt=ge;return function(){var rt=ge;ge=vt;try{return et.apply(this,arguments)}finally{ge=rt}}}})(lp)),lp}var Cp;function pf(){return Cp||(Cp=1,ap.exports=df()),ap.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pp;function ff(){if(Pp)return Ts;Pp=1;var G=Up(),Y=pf();function Z(n){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+n,h=1;h<arguments.length;h++)o+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+n+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var pe=new Set,me={};function Ie(n,o){A(n,o),A(n+"Capture",o)}function A(n,o){for(me[n]=o,n=0;n<o.length;n++)pe.add(o[n])}var g=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qe=Object.prototype.hasOwnProperty,Ke=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,st={},ke={};function ge(n){return qe.call(ke,n)?!0:qe.call(st,n)?!1:Ke.test(n)?ke[n]=!0:(st[n]=!0,!1)}function xr(n,o,h,_){if(h!==null&&h.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return _?!1:h!==null?!h.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Ot(n,o,h,_){if(o===null||typeof o>"u"||xr(n,o,h,_))return!0;if(_)return!1;if(h!==null)switch(h.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function Rt(n,o,h,_,b,k,B){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=_,this.attributeNamespace=b,this.mustUseProperty=h,this.propertyName=n,this.type=o,this.sanitizeURL=k,this.removeEmptyString=B}var Nt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Nt[n]=new Rt(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var o=n[0];Nt[o]=new Rt(o,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){Nt[n]=new Rt(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Nt[n]=new Rt(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Nt[n]=new Rt(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){Nt[n]=new Rt(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){Nt[n]=new Rt(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){Nt[n]=new Rt(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){Nt[n]=new Rt(n,5,!1,n.toLowerCase(),null,!1,!1)});var Mr=/[\-:]([a-z])/g;function Rr(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var o=n.replace(Mr,Rr);Nt[o]=new Rt(o,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var o=n.replace(Mr,Rr);Nt[o]=new Rt(o,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var o=n.replace(Mr,Rr);Nt[o]=new Rt(o,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){Nt[n]=new Rt(n,1,!1,n.toLowerCase(),null,!1,!1)}),Nt.xlinkHref=new Rt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){Nt[n]=new Rt(n,1,!1,n.toLowerCase(),null,!0,!0)});function Xt(n,o,h,_){var b=Nt.hasOwnProperty(o)?Nt[o]:null;(b!==null?b.type!==0:_||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(Ot(o,h,b,_)&&(h=null),_||b===null?ge(o)&&(h===null?n.removeAttribute(o):n.setAttribute(o,""+h)):b.mustUseProperty?n[b.propertyName]=h===null?b.type===3?!1:"":h:(o=b.attributeName,_=b.attributeNamespace,h===null?n.removeAttribute(o):(b=b.type,h=b===3||b===4&&h===!0?"":""+h,_?n.setAttributeNS(_,o,h):n.setAttribute(o,h))))}var tr=G.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,hr=Symbol.for("react.element"),Fr=Symbol.for("react.portal"),zr=Symbol.for("react.fragment"),Mi=Symbol.for("react.strict_mode"),gi=Symbol.for("react.profiler"),nn=Symbol.for("react.provider"),Kt=Symbol.for("react.context"),sn=Symbol.for("react.forward_ref"),mr=Symbol.for("react.suspense"),Ar=Symbol.for("react.suspense_list"),ci=Symbol.for("react.memo"),ti=Symbol.for("react.lazy"),or=Symbol.for("react.offscreen"),et=Symbol.iterator;function vt(n){return n===null||typeof n!="object"?null:(n=et&&n[et]||n["@@iterator"],typeof n=="function"?n:null)}var rt=Object.assign,de;function Me(n){if(de===void 0)try{throw Error()}catch(h){var o=h.stack.trim().match(/\n( *(at )?)/);de=o&&o[1]||""}return`
`+de+n}var zt=!1;function At(n,o){if(!n||zt)return"";zt=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(be){var _=be}Reflect.construct(n,[],o)}else{try{o.call()}catch(be){_=be}n.call(o.prototype)}else{try{throw Error()}catch(be){_=be}n()}}catch(be){if(be&&_&&typeof be.stack=="string"){for(var b=be.stack.split(`
`),k=_.stack.split(`
`),B=b.length-1,Q=k.length-1;1<=B&&0<=Q&&b[B]!==k[Q];)Q--;for(;1<=B&&0<=Q;B--,Q--)if(b[B]!==k[Q]){if(B!==1||Q!==1)do if(B--,Q--,0>Q||b[B]!==k[Q]){var se=`
`+b[B].replace(" at new "," at ");return n.displayName&&se.includes("<anonymous>")&&(se=se.replace("<anonymous>",n.displayName)),se}while(1<=B&&0<=Q);break}}}finally{zt=!1,Error.prepareStackTrace=h}return(n=n?n.displayName||n.name:"")?Me(n):""}function Vt(n){switch(n.tag){case 5:return Me(n.type);case 16:return Me("Lazy");case 13:return Me("Suspense");case 19:return Me("SuspenseList");case 0:case 2:case 15:return n=At(n.type,!1),n;case 11:return n=At(n.type.render,!1),n;case 1:return n=At(n.type,!0),n;default:return""}}function Gt(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case zr:return"Fragment";case Fr:return"Portal";case gi:return"Profiler";case Mi:return"StrictMode";case mr:return"Suspense";case Ar:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Kt:return(n.displayName||"Context")+".Consumer";case nn:return(n._context.displayName||"Context")+".Provider";case sn:var o=n.render;return n=n.displayName,n||(n=o.displayName||o.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case ci:return o=n.displayName||null,o!==null?o:Gt(n.type)||"Memo";case ti:o=n._payload,n=n._init;try{return Gt(n(o))}catch{}}return null}function qt(n){var o=n.type;switch(n.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=o.render,n=n.displayName||n.name||"",o.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Gt(o);case 8:return o===Mi?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function $t(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function dr(n){var o=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function ri(n){var o=dr(n)?"checked":"value",h=Object.getOwnPropertyDescriptor(n.constructor.prototype,o),_=""+n[o];if(!n.hasOwnProperty(o)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var b=h.get,k=h.set;return Object.defineProperty(n,o,{configurable:!0,get:function(){return b.call(this)},set:function(B){_=""+B,k.call(this,B)}}),Object.defineProperty(n,o,{enumerable:h.enumerable}),{getValue:function(){return _},setValue:function(B){_=""+B},stopTracking:function(){n._valueTracker=null,delete n[o]}}}}function Ys(n){n._valueTracker||(n._valueTracker=ri(n))}function ls(n){if(!n)return!1;var o=n._valueTracker;if(!o)return!0;var h=o.getValue(),_="";return n&&(_=dr(n)?n.checked?"true":"false":n.value),n=_,n!==h?(o.setValue(n),!0):!1}function Vn(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function us(n,o){var h=o.checked;return rt({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??n._wrapperState.initialChecked})}function wo(n,o){var h=o.defaultValue==null?"":o.defaultValue,_=o.checked!=null?o.checked:o.defaultChecked;h=$t(o.value!=null?o.value:h),n._wrapperState={initialChecked:_,initialValue:h,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function we(n,o){o=o.checked,o!=null&&Xt(n,"checked",o,!1)}function ks(n,o){we(n,o);var h=$t(o.value),_=o.type;if(h!=null)_==="number"?(h===0&&n.value===""||n.value!=h)&&(n.value=""+h):n.value!==""+h&&(n.value=""+h);else if(_==="submit"||_==="reset"){n.removeAttribute("value");return}o.hasOwnProperty("value")?Jt(n,o.type,h):o.hasOwnProperty("defaultValue")&&Jt(n,o.type,$t(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(n.defaultChecked=!!o.defaultChecked)}function Wo(n,o,h){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var _=o.type;if(!(_!=="submit"&&_!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+n._wrapperState.initialValue,h||o===n.value||(n.value=o),n.defaultValue=o}h=n.name,h!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,h!==""&&(n.name=h)}function Jt(n,o,h){(o!=="number"||Vn(n.ownerDocument)!==n)&&(h==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+h&&(n.defaultValue=""+h))}var wr=Array.isArray;function cs(n,o,h,_){if(n=n.options,o){o={};for(var b=0;b<h.length;b++)o["$"+h[b]]=!0;for(h=0;h<n.length;h++)b=o.hasOwnProperty("$"+n[h].value),n[h].selected!==b&&(n[h].selected=b),b&&_&&(n[h].defaultSelected=!0)}else{for(h=""+$t(h),o=null,b=0;b<n.length;b++){if(n[b].value===h){n[b].selected=!0,_&&(n[b].defaultSelected=!0);return}o!==null||n[b].disabled||(o=n[b])}o!==null&&(o.selected=!0)}}function hs(n,o){if(o.dangerouslySetInnerHTML!=null)throw Error(Z(91));return rt({},o,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function ds(n,o){var h=o.value;if(h==null){if(h=o.children,o=o.defaultValue,h!=null){if(o!=null)throw Error(Z(92));if(wr(h)){if(1<h.length)throw Error(Z(93));h=h[0]}o=h}o==null&&(o=""),h=o}n._wrapperState={initialValue:$t(h)}}function bo(n,o){var h=$t(o.value),_=$t(o.defaultValue);h!=null&&(h=""+h,h!==n.value&&(n.value=h),o.defaultValue==null&&n.defaultValue!==h&&(n.defaultValue=h)),_!=null&&(n.defaultValue=""+_)}function on(n){var o=n.textContent;o===n._wrapperState.initialValue&&o!==""&&o!==null&&(n.value=o)}function Xo(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function So(n,o){return n==null||n==="http://www.w3.org/1999/xhtml"?Xo(o):n==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Re,jn=(function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,h,_,b){MSApp.execUnsafeLocalFunction(function(){return n(o,h,_,b)})}:n})(function(n,o){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=o;else{for(Re=Re||document.createElement("div"),Re.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=Re.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;o.firstChild;)n.appendChild(o.firstChild)}});function ii(n,o){if(o){var h=n.firstChild;if(h&&h===n.lastChild&&h.nodeType===3){h.nodeValue=o;return}}n.textContent=o}var Vi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Qs=["Webkit","ms","Moz","O"];Object.keys(Vi).forEach(function(n){Qs.forEach(function(o){o=o+n.charAt(0).toUpperCase()+n.substring(1),Vi[o]=Vi[n]})});function je(n,o,h){return o==null||typeof o=="boolean"||o===""?"":h||typeof o!="number"||o===0||Vi.hasOwnProperty(n)&&Vi[n]?(""+o).trim():o+"px"}function Dt(n,o){n=n.style;for(var h in o)if(o.hasOwnProperty(h)){var _=h.indexOf("--")===0,b=je(h,o[h],_);h==="float"&&(h="cssFloat"),_?n.setProperty(h,b):n[h]=b}}var xt=rt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Si(n,o){if(o){if(xt[n]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(Z(137,n));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(Z(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(Z(61))}if(o.style!=null&&typeof o.style!="object")throw Error(Z(62))}}function an(n,o){if(n.indexOf("-")===-1)return typeof o.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Tt=null;function bn(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Un=null,ln=null,zi=null;function K(n){if(n=Qa(n)){if(typeof Un!="function")throw Error(Z(280));var o=n.stateNode;o&&(o=el(o),Un(n.stateNode,n.type,o))}}function L(n){ln?zi?zi.push(n):zi=[n]:ln=n}function D(){if(ln){var n=ln,o=zi;if(zi=ln=null,K(n),o)for(n=0;n<o.length;n++)K(o[n])}}function V(n,o){return n(o)}function H(){}var ie=!1;function ae(n,o,h){if(ie)return n(o,h);ie=!0;try{return V(n,o,h)}finally{ie=!1,(ln!==null||zi!==null)&&(H(),D())}}function he(n,o){var h=n.stateNode;if(h===null)return null;var _=el(h);if(_===null)return null;h=_[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(n=n.type,_=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!_;break e;default:n=!1}if(n)return null;if(h&&typeof h!="function")throw Error(Z(231,o,typeof h));return h}var te=!1;if(g)try{var Se={};Object.defineProperty(Se,"passive",{get:function(){te=!0}}),window.addEventListener("test",Se,Se),window.removeEventListener("test",Se,Se)}catch{te=!1}function Pe(n,o,h,_,b,k,B,Q,se){var be=Array.prototype.slice.call(arguments,3);try{o.apply(h,be)}catch(De){this.onError(De)}}var ve=!1,Oe=null,ot=!1,dt=null,Yt={onError:function(n){ve=!0,Oe=n}};function Et(n,o,h,_,b,k,B,Q,se){ve=!1,Oe=null,Pe.apply(Yt,arguments)}function Qt(n,o,h,_,b,k,B,Q,se){if(Et.apply(this,arguments),ve){if(ve){var be=Oe;ve=!1,Oe=null}else throw Error(Z(198));ot||(ot=!0,dt=be)}}function Mt(n){var o=n,h=n;if(n.alternate)for(;o.return;)o=o.return;else{n=o;do o=n,(o.flags&4098)!==0&&(h=o.return),n=o.return;while(n)}return o.tag===3?h:null}function Hr(n){if(n.tag===13){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function Br(n){if(Mt(n)!==n)throw Error(Z(188))}function Ft(n){var o=n.alternate;if(!o){if(o=Mt(n),o===null)throw Error(Z(188));return o!==n?null:n}for(var h=n,_=o;;){var b=h.return;if(b===null)break;var k=b.alternate;if(k===null){if(_=b.return,_!==null){h=_;continue}break}if(b.child===k.child){for(k=b.child;k;){if(k===h)return Br(b),n;if(k===_)return Br(b),o;k=k.sibling}throw Error(Z(188))}if(h.return!==_.return)h=b,_=k;else{for(var B=!1,Q=b.child;Q;){if(Q===h){B=!0,h=b,_=k;break}if(Q===_){B=!0,_=b,h=k;break}Q=Q.sibling}if(!B){for(Q=k.child;Q;){if(Q===h){B=!0,h=k,_=b;break}if(Q===_){B=!0,_=k,h=b;break}Q=Q.sibling}if(!B)throw Error(Z(189))}}if(h.alternate!==_)throw Error(Z(190))}if(h.tag!==3)throw Error(Z(188));return h.stateNode.current===h?n:o}function ar(n){return n=Ft(n),n!==null?Ir(n):null}function Ir(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var o=Ir(n);if(o!==null)return o;n=n.sibling}return null}var ni=Y.unstable_scheduleCallback,hi=Y.unstable_cancelCallback,Ai=Y.unstable_shouldYield,Ko=Y.unstable_requestPaint,kt=Y.unstable_now,Ql=Y.unstable_getCurrentPriorityLevel,Ra=Y.unstable_ImmediatePriority,ji=Y.unstable_UserBlockingPriority,Ti=Y.unstable_NormalPriority,ih=Y.unstable_LowPriority,un=Y.unstable_IdlePriority,ki=null,Di=null;function To(n){if(Di&&typeof Di.onCommitFiberRoot=="function")try{Di.onCommitFiberRoot(ki,n,void 0,(n.current.flags&128)===128)}catch{}}var pr=Math.clz32?Math.clz32:Wr,Fa=Math.log,$n=Math.LN2;function Wr(n){return n>>>=0,n===0?32:31-(Fa(n)/$n|0)|0}var ko=64,Ui=4194304;function Io(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function $i(n,o){var h=n.pendingLanes;if(h===0)return 0;var _=0,b=n.suspendedLanes,k=n.pingedLanes,B=h&268435455;if(B!==0){var Q=B&~b;Q!==0?_=Io(Q):(k&=B,k!==0&&(_=Io(k)))}else B=h&~b,B!==0?_=Io(B):k!==0&&(_=Io(k));if(_===0)return 0;if(o!==0&&o!==_&&(o&b)===0&&(b=_&-_,k=o&-o,b>=k||b===16&&(k&4194240)!==0))return o;if((_&4)!==0&&(_|=h&16),o=n.entangledLanes,o!==0)for(n=n.entanglements,o&=_;0<o;)h=31-pr(o),b=1<<h,_|=n[h],o&=~b;return _}function nh(n,o){switch(n){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gl(n,o){for(var h=n.suspendedLanes,_=n.pingedLanes,b=n.expirationTimes,k=n.pendingLanes;0<k;){var B=31-pr(k),Q=1<<B,se=b[B];se===-1?((Q&h)===0||(Q&_)!==0)&&(b[B]=nh(Q,o)):se<=o&&(n.expiredLanes|=Q),k&=~Q}}function Is(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Es(){var n=ko;return ko<<=1,(ko&4194240)===0&&(ko=64),n}function er(n){for(var o=[],h=0;31>h;h++)o.push(n);return o}function Eo(n,o,h){n.pendingLanes|=o,o!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,o=31-pr(o),n[o]=h}function eu(n,o){var h=n.pendingLanes&~o;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=o,n.mutableReadLanes&=o,n.entangledLanes&=o,o=n.entanglements;var _=n.eventTimes;for(n=n.expirationTimes;0<h;){var b=31-pr(h),k=1<<b;o[b]=0,_[b]=-1,n[b]=-1,h&=~k}}function eo(n,o){var h=n.entangledLanes|=o;for(n=n.entanglements;h;){var _=31-pr(h),b=1<<_;b&o|n[_]&o&&(n[_]|=o),h&=~b}}var lr=0;function Ba(n){return n&=-n,1<n?4<n?(n&268435455)!==0?16:536870912:4:1}var Jo,Yo,Co,tu,nc,_l=!1,yl=[],Zi=null,Sn=null,Xr=null,di=new Map,to=new Map,Zn=[],vl="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ru(n,o){switch(n){case"focusin":case"focusout":Zi=null;break;case"dragenter":case"dragleave":Sn=null;break;case"mouseover":case"mouseout":Xr=null;break;case"pointerover":case"pointerout":di.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":to.delete(o.pointerId)}}function ps(n,o,h,_,b,k){return n===null||n.nativeEvent!==k?(n={blockedOn:o,domEventName:h,eventSystemFlags:_,nativeEvent:k,targetContainers:[b]},o!==null&&(o=Qa(o),o!==null&&Yo(o)),n):(n.eventSystemFlags|=_,o=n.targetContainers,b!==null&&o.indexOf(b)===-1&&o.push(b),n)}function sh(n,o,h,_,b){switch(o){case"focusin":return Zi=ps(Zi,n,o,h,_,b),!0;case"dragenter":return Sn=ps(Sn,n,o,h,_,b),!0;case"mouseover":return Xr=ps(Xr,n,o,h,_,b),!0;case"pointerover":var k=b.pointerId;return di.set(k,ps(di.get(k)||null,n,o,h,_,b)),!0;case"gotpointercapture":return k=b.pointerId,to.set(k,ps(to.get(k)||null,n,o,h,_,b)),!0}return!1}function iu(n){var o=Ns(n.target);if(o!==null){var h=Mt(o);if(h!==null){if(o=h.tag,o===13){if(o=Hr(h),o!==null){n.blockedOn=o,nc(n.priority,function(){Co(h)});return}}else if(o===3&&h.stateNode.current.memoizedState.isDehydrated){n.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Oa(n){if(n.blockedOn!==null)return!1;for(var o=n.targetContainers;0<o.length;){var h=Na(n.domEventName,n.eventSystemFlags,o[0],n.nativeEvent);if(h===null){h=n.nativeEvent;var _=new h.constructor(h.type,h);Tt=_,h.target.dispatchEvent(_),Tt=null}else return o=Qa(h),o!==null&&Yo(o),n.blockedOn=h,!1;o.shift()}return!0}function sc(n,o,h){Oa(n)&&h.delete(o)}function oh(){_l=!1,Zi!==null&&Oa(Zi)&&(Zi=null),Sn!==null&&Oa(Sn)&&(Sn=null),Xr!==null&&Oa(Xr)&&(Xr=null),di.forEach(sc),to.forEach(sc)}function Qo(n,o){n.blockedOn===o&&(n.blockedOn=null,_l||(_l=!0,Y.unstable_scheduleCallback(Y.unstable_NormalPriority,oh)))}function Cs(n){function o(b){return Qo(b,n)}if(0<yl.length){Qo(yl[0],n);for(var h=1;h<yl.length;h++){var _=yl[h];_.blockedOn===n&&(_.blockedOn=null)}}for(Zi!==null&&Qo(Zi,n),Sn!==null&&Qo(Sn,n),Xr!==null&&Qo(Xr,n),di.forEach(o),to.forEach(o),h=0;h<Zn.length;h++)_=Zn[h],_.blockedOn===n&&(_.blockedOn=null);for(;0<Zn.length&&(h=Zn[0],h.blockedOn===null);)iu(h),h.blockedOn===null&&Zn.shift()}var ro=tr.ReactCurrentBatchConfig,Po=!0;function nu(n,o,h,_){var b=lr,k=ro.transition;ro.transition=null;try{lr=1,Tn(n,o,h,_)}finally{lr=b,ro.transition=k}}function su(n,o,h,_){var b=lr,k=ro.transition;ro.transition=null;try{lr=4,Tn(n,o,h,_)}finally{lr=b,ro.transition=k}}function Tn(n,o,h,_){if(Po){var b=Na(n,o,h,_);if(b===null)Ya(n,o,_,xl,h),ru(n,_);else if(sh(b,n,o,h,_))_.stopPropagation();else if(ru(n,_),o&4&&-1<vl.indexOf(n)){for(;b!==null;){var k=Qa(b);if(k!==null&&Jo(k),k=Na(n,o,h,_),k===null&&Ya(n,o,_,xl,h),k===b)break;b=k}b!==null&&_.stopPropagation()}else Ya(n,o,_,null,h)}}var xl=null;function Na(n,o,h,_){if(xl=null,n=bn(_),n=Ns(n),n!==null)if(o=Mt(n),o===null)n=null;else if(h=o.tag,h===13){if(n=Hr(o),n!==null)return n;n=null}else if(h===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null);return xl=n,null}function io(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ql()){case Ra:return 1;case ji:return 4;case Ti:case ih:return 16;case un:return 536870912;default:return 16}default:return 16}}var Li=null,rr=null,Mo=null;function oc(){if(Mo)return Mo;var n,o=rr,h=o.length,_,b="value"in Li?Li.value:Li.textContent,k=b.length;for(n=0;n<h&&o[n]===b[n];n++);var B=h-n;for(_=1;_<=B&&o[h-_]===b[k-_];_++);return Mo=b.slice(n,1<_?1-_:void 0)}function Ps(n){var o=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&o===13&&(n=13)):n=o,n===10&&(n=13),32<=n||n===13?n:0}function wl(){return!0}function ou(){return!1}function cn(n){function o(h,_,b,k,B){this._reactName=h,this._targetInst=b,this.type=_,this.nativeEvent=k,this.target=B,this.currentTarget=null;for(var Q in n)n.hasOwnProperty(Q)&&(h=n[Q],this[Q]=h?h(k):k[Q]);return this.isDefaultPrevented=(k.defaultPrevented!=null?k.defaultPrevented:k.returnValue===!1)?wl:ou,this.isPropagationStopped=ou,this}return rt(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=wl)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=wl)},persist:function(){},isPersistent:wl}),o}var zo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Va=cn(zo),ea=rt({},zo,{view:0,detail:0}),ac=cn(ea),bl,Sl,qn,ja=rt({},ea,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$a,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==qn&&(qn&&n.type==="mousemove"?(bl=n.screenX-qn.screenX,Sl=n.screenY-qn.screenY):Sl=bl=0,qn=n),bl)},movementY:function(n){return"movementY"in n?n.movementY:Sl}}),lc=cn(ja),uc=rt({},ja,{dataTransfer:0}),Ua=cn(uc),ah=rt({},ea,{relatedTarget:0}),ta=cn(ah),lh=rt({},zo,{animationName:0,elapsedTime:0,pseudoElement:0}),uh=cn(lh),cc=rt({},zo,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),hc=cn(cc),dc=rt({},zo,{data:0}),Tl=cn(dc),pc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ms={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function au(n){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(n):(n=Ms[n])?!!o[n]:!1}function $a(){return au}var lu=rt({},ea,{key:function(n){if(n.key){var o=pc[n.key]||n.key;if(o!=="Unidentified")return o}return n.type==="keypress"?(n=Ps(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?kl[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$a,charCode:function(n){return n.type==="keypress"?Ps(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Ps(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Il=cn(lu),uu=rt({},ja,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),no=cn(uu),cu=rt({},ea,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$a}),ch=cn(cu),Zr=rt({},zo,{propertyName:0,elapsedTime:0,pseudoElement:0}),hh=cn(Zr),jt=rt({},ja,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),El=cn(jt),br=[9,13,27,32],ur=g&&"CompositionEvent"in window,Gn=null;g&&"documentMode"in document&&(Gn=document.documentMode);var Za=g&&"TextEvent"in window&&!Gn,ra=g&&(!ur||Gn&&8<Gn&&11>=Gn),Cl=" ",so=!1;function Ao(n,o){switch(n){case"keyup":return br.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hn(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var oo=!1;function hu(n,o){switch(n){case"compositionend":return hn(o);case"keypress":return o.which!==32?null:(so=!0,Cl);case"textInput":return n=o.data,n===Cl&&so?null:n;default:return null}}function du(n,o){if(oo)return n==="compositionend"||!ur&&Ao(n,o)?(n=oc(),Mo=rr=Li=null,oo=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return ra&&o.locale!=="ko"?null:o.data;default:return null}}var Do={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ia(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o==="input"?!!Do[n.type]:o==="textarea"}function na(n,o,h,_){L(_),o=ca(o,"onChange"),0<o.length&&(h=new Va("onChange","change",null,h,_),n.push({event:h,listeners:o}))}var fs=null,zs=null;function Pl(n){Ll(n,0)}function As(n){var o=Kn(n);if(ls(o))return n}function sa(n,o){if(n==="change")return o}var pu=!1;if(g){var qa;if(g){var Ht="oninput"in document;if(!Ht){var Ga=document.createElement("div");Ga.setAttribute("oninput","return;"),Ht=typeof Ga.oninput=="function"}qa=Ht}else qa=!1;pu=qa&&(!document.documentMode||9<document.documentMode)}function fc(){fs&&(fs.detachEvent("onpropertychange",fu),zs=fs=null)}function fu(n){if(n.propertyName==="value"&&As(zs)){var o=[];na(o,zs,n,bn(n)),ae(Pl,o)}}function oa(n,o,h){n==="focusin"?(fc(),fs=o,zs=h,fs.attachEvent("onpropertychange",fu)):n==="focusout"&&fc()}function mc(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return As(zs)}function Ml(n,o){if(n==="click")return As(o)}function gc(n,o){if(n==="input"||n==="change")return As(o)}function _c(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var qi=typeof Object.is=="function"?Object.is:_c;function ao(n,o){if(qi(n,o))return!0;if(typeof n!="object"||n===null||typeof o!="object"||o===null)return!1;var h=Object.keys(n),_=Object.keys(o);if(h.length!==_.length)return!1;for(_=0;_<h.length;_++){var b=h[_];if(!qe.call(o,b)||!qi(n[b],o[b]))return!1}return!0}function Lo(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Ro(n,o){var h=Lo(n);n=0;for(var _;h;){if(h.nodeType===3){if(_=n+h.textContent.length,n<=o&&_>=o)return{node:h,offset:o-n};n=_}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=Lo(h)}}function Fo(n,o){return n&&o?n===o?!0:n&&n.nodeType===3?!1:o&&o.nodeType===3?Fo(n,o.parentNode):"contains"in n?n.contains(o):n.compareDocumentPosition?!!(n.compareDocumentPosition(o)&16):!1:!1}function zl(){for(var n=window,o=Vn();o instanceof n.HTMLIFrameElement;){try{var h=typeof o.contentWindow.location.href=="string"}catch{h=!1}if(h)n=o.contentWindow;else break;o=Vn(n.document)}return o}function lo(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o&&(o==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||o==="textarea"||n.contentEditable==="true")}function Ha(n){var o=zl(),h=n.focusedElem,_=n.selectionRange;if(o!==h&&h&&h.ownerDocument&&Fo(h.ownerDocument.documentElement,h)){if(_!==null&&lo(h)){if(o=_.start,n=_.end,n===void 0&&(n=o),"selectionStart"in h)h.selectionStart=o,h.selectionEnd=Math.min(n,h.value.length);else if(n=(o=h.ownerDocument||document)&&o.defaultView||window,n.getSelection){n=n.getSelection();var b=h.textContent.length,k=Math.min(_.start,b);_=_.end===void 0?k:Math.min(_.end,b),!n.extend&&k>_&&(b=_,_=k,k=b),b=Ro(h,k);var B=Ro(h,_);b&&B&&(n.rangeCount!==1||n.anchorNode!==b.node||n.anchorOffset!==b.offset||n.focusNode!==B.node||n.focusOffset!==B.offset)&&(o=o.createRange(),o.setStart(b.node,b.offset),n.removeAllRanges(),k>_?(n.addRange(o),n.extend(B.node,B.offset)):(o.setEnd(B.node,B.offset),n.addRange(o)))}}for(o=[],n=h;n=n.parentNode;)n.nodeType===1&&o.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<o.length;h++)n=o[h],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Al=g&&"documentMode"in document&&11>=document.documentMode,Ds=null,Wa=null,Xa=null,Dl=!1;function Ka(n,o,h){var _=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Dl||Ds==null||Ds!==Vn(_)||(_=Ds,"selectionStart"in _&&lo(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),Xa&&ao(Xa,_)||(Xa=_,_=ca(Wa,"onSelect"),0<_.length&&(o=new Va("onSelect","select",null,o,h),n.push({event:o,listeners:_}),o.target=Ds)))}function aa(n,o){var h={};return h[n.toLowerCase()]=o.toLowerCase(),h["Webkit"+n]="webkit"+o,h["Moz"+n]="moz"+o,h}var ms={animationend:aa("Animation","AnimationEnd"),animationiteration:aa("Animation","AnimationIteration"),animationstart:aa("Animation","AnimationStart"),transitionend:aa("Transition","TransitionEnd")},Bo={},_i={};g&&(_i=document.createElement("div").style,"AnimationEvent"in window||(delete ms.animationend.animation,delete ms.animationiteration.animation,delete ms.animationstart.animation),"TransitionEvent"in window||delete ms.transitionend.transition);function gs(n){if(Bo[n])return Bo[n];if(!ms[n])return n;var o=ms[n],h;for(h in o)if(o.hasOwnProperty(h)&&h in _i)return Bo[n]=o[h];return n}var mu=gs("animationend"),gu=gs("animationiteration"),jr=gs("animationstart"),kn=gs("transitionend"),Gi=new Map,la="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _s(n,o){Gi.set(n,o),Ie(o,[n])}for(var ua=0;ua<la.length;ua++){var uo=la[ua],Ls=uo.toLowerCase(),_u=uo[0].toUpperCase()+uo.slice(1);_s(Ls,"on"+_u)}_s(mu,"onAnimationEnd"),_s(gu,"onAnimationIteration"),_s(jr,"onAnimationStart"),_s("dblclick","onDoubleClick"),_s("focusin","onFocus"),_s("focusout","onBlur"),_s(kn,"onTransitionEnd"),A("onMouseEnter",["mouseout","mouseover"]),A("onMouseLeave",["mouseout","mouseover"]),A("onPointerEnter",["pointerout","pointerover"]),A("onPointerLeave",["pointerout","pointerover"]),Ie("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ie("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ie("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ie("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ie("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ie("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var co="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),yu=new Set("cancel close invalid load scroll toggle".split(" ").concat(co));function Ja(n,o,h){var _=n.type||"unknown-event";n.currentTarget=h,Qt(_,o,void 0,n),n.currentTarget=null}function Ll(n,o){o=(o&4)!==0;for(var h=0;h<n.length;h++){var _=n[h],b=_.event;_=_.listeners;e:{var k=void 0;if(o)for(var B=_.length-1;0<=B;B--){var Q=_[B],se=Q.instance,be=Q.currentTarget;if(Q=Q.listener,se!==k&&b.isPropagationStopped())break e;Ja(b,Q,be),k=se}else for(B=0;B<_.length;B++){if(Q=_[B],se=Q.instance,be=Q.currentTarget,Q=Q.listener,se!==k&&b.isPropagationStopped())break e;Ja(b,Q,be),k=se}}}if(ot)throw n=dt,ot=!1,dt=null,n}function Sr(n,o){var h=o[Ut];h===void 0&&(h=o[Ut]=new Set);var _=n+"__bubble";h.has(_)||(Rl(o,n,2,!1),h.add(_))}function Rs(n,o,h){var _=0;o&&(_|=4),Rl(h,n,_,o)}var Oo="_reactListening"+Math.random().toString(36).slice(2);function Fs(n){if(!n[Oo]){n[Oo]=!0,pe.forEach(function(h){h!=="selectionchange"&&(yu.has(h)||Rs(h,!1,n),Rs(h,!0,n))});var o=n.nodeType===9?n:n.ownerDocument;o===null||o[Oo]||(o[Oo]=!0,Rs("selectionchange",!1,o))}}function Rl(n,o,h,_){switch(io(o)){case 1:var b=nu;break;case 4:b=su;break;default:b=Tn}h=b.bind(null,o,h,n),b=void 0,!te||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(b=!0),_?b!==void 0?n.addEventListener(o,h,{capture:!0,passive:b}):n.addEventListener(o,h,!0):b!==void 0?n.addEventListener(o,h,{passive:b}):n.addEventListener(o,h,!1)}function Ya(n,o,h,_,b){var k=_;if((o&1)===0&&(o&2)===0&&_!==null)e:for(;;){if(_===null)return;var B=_.tag;if(B===3||B===4){var Q=_.stateNode.containerInfo;if(Q===b||Q.nodeType===8&&Q.parentNode===b)break;if(B===4)for(B=_.return;B!==null;){var se=B.tag;if((se===3||se===4)&&(se=B.stateNode.containerInfo,se===b||se.nodeType===8&&se.parentNode===b))return;B=B.return}for(;Q!==null;){if(B=Ns(Q),B===null)return;if(se=B.tag,se===5||se===6){_=k=B;continue e}Q=Q.parentNode}}_=_.return}ae(function(){var be=k,De=bn(h),Fe=[];e:{var Ae=Gi.get(n);if(Ae!==void 0){var We=Va,at=n;switch(n){case"keypress":if(Ps(h)===0)break e;case"keydown":case"keyup":We=Il;break;case"focusin":at="focus",We=ta;break;case"focusout":at="blur",We=ta;break;case"beforeblur":case"afterblur":We=ta;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":We=lc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":We=Ua;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":We=ch;break;case mu:case gu:case jr:We=uh;break;case kn:We=hh;break;case"scroll":We=ac;break;case"wheel":We=El;break;case"copy":case"cut":case"paste":We=hc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":We=no}var pt=(o&4)!==0,Qr=!pt&&n==="scroll",ye=pt?Ae!==null?Ae+"Capture":null:Ae;pt=[];for(var le=be,xe;le!==null;){xe=le;var $e=xe.stateNode;if(xe.tag===5&&$e!==null&&(xe=$e,ye!==null&&($e=he(le,ye),$e!=null&&pt.push(No(le,$e,xe)))),Qr)break;le=le.return}0<pt.length&&(Ae=new We(Ae,at,null,h,De),Fe.push({event:Ae,listeners:pt}))}}if((o&7)===0){e:{if(Ae=n==="mouseover"||n==="pointerover",We=n==="mouseout"||n==="pointerout",Ae&&h!==Tt&&(at=h.relatedTarget||h.fromElement)&&(Ns(at)||at[Xn]))break e;if((We||Ae)&&(Ae=De.window===De?De:(Ae=De.ownerDocument)?Ae.defaultView||Ae.parentWindow:window,We?(at=h.relatedTarget||h.toElement,We=be,at=at?Ns(at):null,at!==null&&(Qr=Mt(at),at!==Qr||at.tag!==5&&at.tag!==6)&&(at=null)):(We=null,at=be),We!==at)){if(pt=lc,$e="onMouseLeave",ye="onMouseEnter",le="mouse",(n==="pointerout"||n==="pointerover")&&(pt=no,$e="onPointerLeave",ye="onPointerEnter",le="pointer"),Qr=We==null?Ae:Kn(We),xe=at==null?Ae:Kn(at),Ae=new pt($e,le+"leave",We,h,De),Ae.target=Qr,Ae.relatedTarget=xe,$e=null,Ns(De)===be&&(pt=new pt(ye,le+"enter",at,h,De),pt.target=xe,pt.relatedTarget=Qr,$e=pt),Qr=$e,We&&at)t:{for(pt=We,ye=at,le=0,xe=pt;xe;xe=Bs(xe))le++;for(xe=0,$e=ye;$e;$e=Bs($e))xe++;for(;0<le-xe;)pt=Bs(pt),le--;for(;0<xe-le;)ye=Bs(ye),xe--;for(;le--;){if(pt===ye||ye!==null&&pt===ye.alternate)break t;pt=Bs(pt),ye=Bs(ye)}pt=null}else pt=null;We!==null&&ha(Fe,Ae,We,pt,!1),at!==null&&Qr!==null&&ha(Fe,Qr,at,pt,!0)}}e:{if(Ae=be?Kn(be):window,We=Ae.nodeName&&Ae.nodeName.toLowerCase(),We==="select"||We==="input"&&Ae.type==="file")var mt=sa;else if(ia(Ae))if(pu)mt=gc;else{mt=mc;var St=oa}else(We=Ae.nodeName)&&We.toLowerCase()==="input"&&(Ae.type==="checkbox"||Ae.type==="radio")&&(mt=Ml);if(mt&&(mt=mt(n,be))){na(Fe,mt,h,De);break e}St&&St(n,Ae,be),n==="focusout"&&(St=Ae._wrapperState)&&St.controlled&&Ae.type==="number"&&Jt(Ae,"number",Ae.value)}switch(St=be?Kn(be):window,n){case"focusin":(ia(St)||St.contentEditable==="true")&&(Ds=St,Wa=be,Xa=null);break;case"focusout":Xa=Wa=Ds=null;break;case"mousedown":Dl=!0;break;case"contextmenu":case"mouseup":case"dragend":Dl=!1,Ka(Fe,h,De);break;case"selectionchange":if(Al)break;case"keydown":case"keyup":Ka(Fe,h,De)}var _t;if(ur)e:{switch(n){case"compositionstart":var Pt="onCompositionStart";break e;case"compositionend":Pt="onCompositionEnd";break e;case"compositionupdate":Pt="onCompositionUpdate";break e}Pt=void 0}else oo?Ao(n,h)&&(Pt="onCompositionEnd"):n==="keydown"&&h.keyCode===229&&(Pt="onCompositionStart");Pt&&(ra&&h.locale!=="ko"&&(oo||Pt!=="onCompositionStart"?Pt==="onCompositionEnd"&&oo&&(_t=oc()):(Li=De,rr="value"in Li?Li.value:Li.textContent,oo=!0)),St=ca(be,Pt),0<St.length&&(Pt=new Tl(Pt,n,null,h,De),Fe.push({event:Pt,listeners:St}),_t?Pt.data=_t:(_t=hn(h),_t!==null&&(Pt.data=_t)))),(_t=Za?hu(n,h):du(n,h))&&(be=ca(be,"onBeforeInput"),0<be.length&&(De=new Tl("onBeforeInput","beforeinput",null,h,De),Fe.push({event:De,listeners:be}),De.data=_t))}Ll(Fe,o)})}function No(n,o,h){return{instance:n,listener:o,currentTarget:h}}function ca(n,o){for(var h=o+"Capture",_=[];n!==null;){var b=n,k=b.stateNode;b.tag===5&&k!==null&&(b=k,k=he(n,h),k!=null&&_.unshift(No(n,k,b)),k=he(n,o),k!=null&&_.push(No(n,k,b))),n=n.return}return _}function Bs(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function ha(n,o,h,_,b){for(var k=o._reactName,B=[];h!==null&&h!==_;){var Q=h,se=Q.alternate,be=Q.stateNode;if(se!==null&&se===_)break;Q.tag===5&&be!==null&&(Q=be,b?(se=he(h,k),se!=null&&B.unshift(No(h,se,Q))):b||(se=he(h,k),se!=null&&B.push(No(h,se,Q)))),h=h.return}B.length!==0&&n.push({event:o,listeners:B})}var yc=/\r\n?/g,In=/\u0000|\uFFFD/g;function Hn(n){return(typeof n=="string"?n:""+n).replace(yc,`
`).replace(In,"")}function da(n,o,h){if(o=Hn(o),Hn(n)!==o&&h)throw Error(Z(425))}function Hi(){}var Os=null,vu=null;function xu(n,o){return n==="textarea"||n==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Fl=typeof setTimeout=="function"?setTimeout:void 0,vc=typeof clearTimeout=="function"?clearTimeout:void 0,Bl=typeof Promise=="function"?Promise:void 0,pa=typeof queueMicrotask=="function"?queueMicrotask:typeof Bl<"u"?function(n){return Bl.resolve(null).then(n).catch(En)}:Fl;function En(n){setTimeout(function(){throw n})}function Ye(n,o){var h=o,_=0;do{var b=h.nextSibling;if(n.removeChild(h),b&&b.nodeType===8)if(h=b.data,h==="/$"){if(_===0){n.removeChild(b),Cs(o);return}_--}else h!=="$"&&h!=="$?"&&h!=="$!"||_++;h=b}while(h);Cs(o)}function Wn(n){for(;n!=null;n=n.nextSibling){var o=n.nodeType;if(o===1||o===3)break;if(o===8){if(o=n.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return n}function Ol(n){n=n.previousSibling;for(var o=0;n;){if(n.nodeType===8){var h=n.data;if(h==="$"||h==="$!"||h==="$?"){if(o===0)return n;o--}else h==="/$"&&o++}n=n.previousSibling}return null}var Vo=Math.random().toString(36).slice(2),Ri="__reactFiber$"+Vo,ys="__reactProps$"+Vo,Xn="__reactContainer$"+Vo,Ut="__reactEvents$"+Vo,wu="__reactListeners$"+Vo,dh="__reactHandles$"+Vo;function Ns(n){var o=n[Ri];if(o)return o;for(var h=n.parentNode;h;){if(o=h[Xn]||h[Ri]){if(h=o.alternate,o.child!==null||h!==null&&h.child!==null)for(n=Ol(n);n!==null;){if(h=n[Ri])return h;n=Ol(n)}return o}n=h,h=n.parentNode}return null}function Qa(n){return n=n[Ri]||n[Xn],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Kn(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Z(33))}function el(n){return n[ys]||null}var tl=[],jo=-1;function ho(n){return{current:n}}function Tr(n){0>jo||(n.current=tl[jo],tl[jo]=null,jo--)}function Er(n,o){jo++,tl[jo]=n.current,n.current=o}var po={},gr=ho(po),Zt=ho(!1),Cn=po;function Vs(n,o){var h=n.type.contextTypes;if(!h)return po;var _=n.stateNode;if(_&&_.__reactInternalMemoizedUnmaskedChildContext===o)return _.__reactInternalMemoizedMaskedChildContext;var b={},k;for(k in h)b[k]=o[k];return _&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=o,n.__reactInternalMemoizedMaskedChildContext=b),b}function yi(n){return n=n.childContextTypes,n!=null}function rl(){Tr(Zt),Tr(gr)}function fa(n,o,h){if(gr.current!==po)throw Error(Z(168));Er(gr,o),Er(Zt,h)}function ma(n,o,h){var _=n.stateNode;if(o=o.childContextTypes,typeof _.getChildContext!="function")return h;_=_.getChildContext();for(var b in _)if(!(b in o))throw Error(Z(108,qt(n)||"Unknown",b));return rt({},h,_)}function dn(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||po,Cn=gr.current,Er(gr,n),Er(Zt,Zt.current),!0}function ga(n,o,h){var _=n.stateNode;if(!_)throw Error(Z(169));h?(n=ma(n,o,Cn),_.__reactInternalMemoizedMergedChildContext=n,Tr(Zt),Tr(gr),Er(gr,n)):Tr(Zt),Er(Zt,h)}var Qe=null,ft=!1,_a=!1;function il(n){Qe===null?Qe=[n]:Qe.push(n)}function bu(n){ft=!0,il(n)}function p(){if(!_a&&Qe!==null){_a=!0;var n=0,o=lr;try{var h=Qe;for(lr=1;n<h.length;n++){var _=h[n];do _=_(!0);while(_!==null)}Qe=null,ft=!1}catch(b){throw Qe!==null&&(Qe=Qe.slice(n+1)),ni(Ra,p),b}finally{lr=o,_a=!1}}return null}var e=[],s=0,l=null,u=0,d=[],v=0,w=null,S=1,I="";function P(n,o){e[s++]=u,e[s++]=l,l=n,u=o}function M(n,o,h){d[v++]=S,d[v++]=I,d[v++]=w,w=n;var _=S;n=I;var b=32-pr(_)-1;_&=~(1<<b),h+=1;var k=32-pr(o)+b;if(30<k){var B=b-b%5;k=(_&(1<<B)-1).toString(32),_>>=B,b-=B,S=1<<32-pr(o)+b|h<<b|_,I=k+n}else S=1<<k|h<<b|_,I=n}function F(n){n.return!==null&&(P(n,1),M(n,1,0))}function N(n){for(;n===l;)l=e[--s],e[s]=null,u=e[--s],e[s]=null;for(;n===w;)w=d[--v],d[v]=null,I=d[--v],d[v]=null,S=d[--v],d[v]=null}var U=null,$=null,W=!1,J=null;function re(n,o){var h=Rn(5,null,null,0);h.elementType="DELETED",h.stateNode=o,h.return=n,o=n.deletions,o===null?(n.deletions=[h],n.flags|=16):o.push(h)}function q(n,o){switch(n.tag){case 5:var h=n.type;return o=o.nodeType!==1||h.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(n.stateNode=o,U=n,$=Wn(o.firstChild),!0):!1;case 6:return o=n.pendingProps===""||o.nodeType!==3?null:o,o!==null?(n.stateNode=o,U=n,$=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(h=w!==null?{id:S,overflow:I}:null,n.memoizedState={dehydrated:o,treeContext:h,retryLane:1073741824},h=Rn(18,null,null,0),h.stateNode=o,h.return=n,n.child=h,U=n,$=null,!0):!1;default:return!1}}function oe(n){return(n.mode&1)!==0&&(n.flags&128)===0}function ue(n){if(W){var o=$;if(o){var h=o;if(!q(n,o)){if(oe(n))throw Error(Z(418));o=Wn(h.nextSibling);var _=U;o&&q(n,o)?re(_,h):(n.flags=n.flags&-4097|2,W=!1,U=n)}}else{if(oe(n))throw Error(Z(418));n.flags=n.flags&-4097|2,W=!1,U=n}}}function _e(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;U=n}function Ce(n){if(n!==U)return!1;if(!W)return _e(n),W=!0,!1;var o;if((o=n.tag!==3)&&!(o=n.tag!==5)&&(o=n.type,o=o!=="head"&&o!=="body"&&!xu(n.type,n.memoizedProps)),o&&(o=$)){if(oe(n))throw Le(),Error(Z(418));for(;o;)re(n,o),o=Wn(o.nextSibling)}if(_e(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Z(317));e:{for(n=n.nextSibling,o=0;n;){if(n.nodeType===8){var h=n.data;if(h==="/$"){if(o===0){$=Wn(n.nextSibling);break e}o--}else h!=="$"&&h!=="$!"&&h!=="$?"||o++}n=n.nextSibling}$=null}}else $=U?Wn(n.stateNode.nextSibling):null;return!0}function Le(){for(var n=$;n;)n=Wn(n.nextSibling)}function Ne(){$=U=null,W=!1}function He(n){J===null?J=[n]:J.push(n)}var Ve=tr.ReactCurrentBatchConfig;function Be(n,o,h){if(n=h.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(Z(309));var _=h.stateNode}if(!_)throw Error(Z(147,n));var b=_,k=""+n;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===k?o.ref:(o=function(B){var Q=b.refs;B===null?delete Q[k]:Q[k]=B},o._stringRef=k,o)}if(typeof n!="string")throw Error(Z(284));if(!h._owner)throw Error(Z(290,n))}return n}function it(n,o){throw n=Object.prototype.toString.call(o),Error(Z(31,n==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":n))}function bt(n){var o=n._init;return o(n._payload)}function Ue(n){function o(ye,le){if(n){var xe=ye.deletions;xe===null?(ye.deletions=[le],ye.flags|=16):xe.push(le)}}function h(ye,le){if(!n)return null;for(;le!==null;)o(ye,le),le=le.sibling;return null}function _(ye,le){for(ye=new Map;le!==null;)le.key!==null?ye.set(le.key,le):ye.set(le.index,le),le=le.sibling;return ye}function b(ye,le){return ye=Pa(ye,le),ye.index=0,ye.sibling=null,ye}function k(ye,le,xe){return ye.index=xe,n?(xe=ye.alternate,xe!==null?(xe=xe.index,xe<le?(ye.flags|=2,le):xe):(ye.flags|=2,le)):(ye.flags|=1048576,le)}function B(ye){return n&&ye.alternate===null&&(ye.flags|=2),ye}function Q(ye,le,xe,$e){return le===null||le.tag!==6?(le=bs(xe,ye.mode,$e),le.return=ye,le):(le=b(le,xe),le.return=ye,le)}function se(ye,le,xe,$e){var mt=xe.type;return mt===zr?De(ye,le,xe.props.children,$e,xe.key):le!==null&&(le.elementType===mt||typeof mt=="object"&&mt!==null&&mt.$$typeof===ti&&bt(mt)===le.type)?($e=b(le,xe.props),$e.ref=Be(ye,le,xe),$e.return=ye,$e):($e=Ku(xe.type,xe.key,xe.props,null,ye.mode,$e),$e.ref=Be(ye,le,xe),$e.return=ye,$e)}function be(ye,le,xe,$e){return le===null||le.tag!==4||le.stateNode.containerInfo!==xe.containerInfo||le.stateNode.implementation!==xe.implementation?(le=yo(xe,ye.mode,$e),le.return=ye,le):(le=b(le,xe.children||[]),le.return=ye,le)}function De(ye,le,xe,$e,mt){return le===null||le.tag!==7?(le=Ma(xe,ye.mode,$e,mt),le.return=ye,le):(le=b(le,xe),le.return=ye,le)}function Fe(ye,le,xe){if(typeof le=="string"&&le!==""||typeof le=="number")return le=bs(""+le,ye.mode,xe),le.return=ye,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case hr:return xe=Ku(le.type,le.key,le.props,null,ye.mode,xe),xe.ref=Be(ye,null,le),xe.return=ye,xe;case Fr:return le=yo(le,ye.mode,xe),le.return=ye,le;case ti:var $e=le._init;return Fe(ye,$e(le._payload),xe)}if(wr(le)||vt(le))return le=Ma(le,ye.mode,xe,null),le.return=ye,le;it(ye,le)}return null}function Ae(ye,le,xe,$e){var mt=le!==null?le.key:null;if(typeof xe=="string"&&xe!==""||typeof xe=="number")return mt!==null?null:Q(ye,le,""+xe,$e);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case hr:return xe.key===mt?se(ye,le,xe,$e):null;case Fr:return xe.key===mt?be(ye,le,xe,$e):null;case ti:return mt=xe._init,Ae(ye,le,mt(xe._payload),$e)}if(wr(xe)||vt(xe))return mt!==null?null:De(ye,le,xe,$e,null);it(ye,xe)}return null}function We(ye,le,xe,$e,mt){if(typeof $e=="string"&&$e!==""||typeof $e=="number")return ye=ye.get(xe)||null,Q(le,ye,""+$e,mt);if(typeof $e=="object"&&$e!==null){switch($e.$$typeof){case hr:return ye=ye.get($e.key===null?xe:$e.key)||null,se(le,ye,$e,mt);case Fr:return ye=ye.get($e.key===null?xe:$e.key)||null,be(le,ye,$e,mt);case ti:var St=$e._init;return We(ye,le,xe,St($e._payload),mt)}if(wr($e)||vt($e))return ye=ye.get(xe)||null,De(le,ye,$e,mt,null);it(le,$e)}return null}function at(ye,le,xe,$e){for(var mt=null,St=null,_t=le,Pt=le=0,bi=null;_t!==null&&Pt<xe.length;Pt++){_t.index>Pt?(bi=_t,_t=null):bi=_t.sibling;var cr=Ae(ye,_t,xe[Pt],$e);if(cr===null){_t===null&&(_t=bi);break}n&&_t&&cr.alternate===null&&o(ye,_t),le=k(cr,le,Pt),St===null?mt=cr:St.sibling=cr,St=cr,_t=bi}if(Pt===xe.length)return h(ye,_t),W&&P(ye,Pt),mt;if(_t===null){for(;Pt<xe.length;Pt++)_t=Fe(ye,xe[Pt],$e),_t!==null&&(le=k(_t,le,Pt),St===null?mt=_t:St.sibling=_t,St=_t);return W&&P(ye,Pt),mt}for(_t=_(ye,_t);Pt<xe.length;Pt++)bi=We(_t,ye,Pt,xe[Pt],$e),bi!==null&&(n&&bi.alternate!==null&&_t.delete(bi.key===null?Pt:bi.key),le=k(bi,le,Pt),St===null?mt=bi:St.sibling=bi,St=bi);return n&&_t.forEach(function(qo){return o(ye,qo)}),W&&P(ye,Pt),mt}function pt(ye,le,xe,$e){var mt=vt(xe);if(typeof mt!="function")throw Error(Z(150));if(xe=mt.call(xe),xe==null)throw Error(Z(151));for(var St=mt=null,_t=le,Pt=le=0,bi=null,cr=xe.next();_t!==null&&!cr.done;Pt++,cr=xe.next()){_t.index>Pt?(bi=_t,_t=null):bi=_t.sibling;var qo=Ae(ye,_t,cr.value,$e);if(qo===null){_t===null&&(_t=bi);break}n&&_t&&qo.alternate===null&&o(ye,_t),le=k(qo,le,Pt),St===null?mt=qo:St.sibling=qo,St=qo,_t=bi}if(cr.done)return h(ye,_t),W&&P(ye,Pt),mt;if(_t===null){for(;!cr.done;Pt++,cr=xe.next())cr=Fe(ye,cr.value,$e),cr!==null&&(le=k(cr,le,Pt),St===null?mt=cr:St.sibling=cr,St=cr);return W&&P(ye,Pt),mt}for(_t=_(ye,_t);!cr.done;Pt++,cr=xe.next())cr=We(_t,ye,Pt,cr.value,$e),cr!==null&&(n&&cr.alternate!==null&&_t.delete(cr.key===null?Pt:cr.key),le=k(cr,le,Pt),St===null?mt=cr:St.sibling=cr,St=cr);return n&&_t.forEach(function(Hd){return o(ye,Hd)}),W&&P(ye,Pt),mt}function Qr(ye,le,xe,$e){if(typeof xe=="object"&&xe!==null&&xe.type===zr&&xe.key===null&&(xe=xe.props.children),typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case hr:e:{for(var mt=xe.key,St=le;St!==null;){if(St.key===mt){if(mt=xe.type,mt===zr){if(St.tag===7){h(ye,St.sibling),le=b(St,xe.props.children),le.return=ye,ye=le;break e}}else if(St.elementType===mt||typeof mt=="object"&&mt!==null&&mt.$$typeof===ti&&bt(mt)===St.type){h(ye,St.sibling),le=b(St,xe.props),le.ref=Be(ye,St,xe),le.return=ye,ye=le;break e}h(ye,St);break}else o(ye,St);St=St.sibling}xe.type===zr?(le=Ma(xe.props.children,ye.mode,$e,xe.key),le.return=ye,ye=le):($e=Ku(xe.type,xe.key,xe.props,null,ye.mode,$e),$e.ref=Be(ye,le,xe),$e.return=ye,ye=$e)}return B(ye);case Fr:e:{for(St=xe.key;le!==null;){if(le.key===St)if(le.tag===4&&le.stateNode.containerInfo===xe.containerInfo&&le.stateNode.implementation===xe.implementation){h(ye,le.sibling),le=b(le,xe.children||[]),le.return=ye,ye=le;break e}else{h(ye,le);break}else o(ye,le);le=le.sibling}le=yo(xe,ye.mode,$e),le.return=ye,ye=le}return B(ye);case ti:return St=xe._init,Qr(ye,le,St(xe._payload),$e)}if(wr(xe))return at(ye,le,xe,$e);if(vt(xe))return pt(ye,le,xe,$e);it(ye,xe)}return typeof xe=="string"&&xe!==""||typeof xe=="number"?(xe=""+xe,le!==null&&le.tag===6?(h(ye,le.sibling),le=b(le,xe),le.return=ye,ye=le):(h(ye,le),le=bs(xe,ye.mode,$e),le.return=ye,ye=le),B(ye)):h(ye,le)}return Qr}var Ze=Ue(!0),wt=Ue(!1),fr=ho(null),Ct=null,Lt=null,_r=null;function pi(){_r=Lt=Ct=null}function pn(n){var o=fr.current;Tr(fr),n._currentValue=o}function yr(n,o,h){for(;n!==null;){var _=n.alternate;if((n.childLanes&o)!==o?(n.childLanes|=o,_!==null&&(_.childLanes|=o)):_!==null&&(_.childLanes&o)!==o&&(_.childLanes|=o),n===h)break;n=n.return}}function si(n,o){Ct=n,_r=Lt=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&o)!==0&&(_n=!0),n.firstContext=null)}function Cr(n){var o=n._currentValue;if(_r!==n)if(n={context:n,memoizedValue:o,next:null},Lt===null){if(Ct===null)throw Error(Z(308));Lt=n,Ct.dependencies={lanes:0,firstContext:n}}else Lt=Lt.next=n;return o}var qr=null;function vi(n){qr===null?qr=[n]:qr.push(n)}function Jn(n,o,h,_){var b=o.interleaved;return b===null?(h.next=h,vi(o)):(h.next=b.next,b.next=h),o.interleaved=h,Wi(n,_)}function Wi(n,o){n.lanes|=o;var h=n.alternate;for(h!==null&&(h.lanes|=o),h=n,n=n.return;n!==null;)n.childLanes|=o,h=n.alternate,h!==null&&(h.childLanes|=o),h=n,n=n.return;return h.tag===3?h.stateNode:null}var Yn=!1;function fo(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fn(n,o){n=n.updateQueue,o.updateQueue===n&&(o.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Pn(n,o){return{eventTime:n,lane:o,tag:0,payload:null,callback:null,next:null}}function vs(n,o,h){var _=n.updateQueue;if(_===null)return null;if(_=_.shared,(nr&2)!==0){var b=_.pending;return b===null?o.next=o:(o.next=b.next,b.next=o),_.pending=o,Wi(n,h)}return b=_.interleaved,b===null?(o.next=o,vi(_)):(o.next=b.next,b.next=o),_.interleaved=o,Wi(n,h)}function Fi(n,o,h){if(o=o.updateQueue,o!==null&&(o=o.shared,(h&4194240)!==0)){var _=o.lanes;_&=n.pendingLanes,h|=_,o.lanes=h,eo(n,h)}}function mn(n,o){var h=n.updateQueue,_=n.alternate;if(_!==null&&(_=_.updateQueue,h===_)){var b=null,k=null;if(h=h.firstBaseUpdate,h!==null){do{var B={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};k===null?b=k=B:k=k.next=B,h=h.next}while(h!==null);k===null?b=k=o:k=k.next=o}else b=k=o;h={baseState:_.baseState,firstBaseUpdate:b,lastBaseUpdate:k,shared:_.shared,effects:_.effects},n.updateQueue=h;return}n=h.lastBaseUpdate,n===null?h.firstBaseUpdate=o:n.next=o,h.lastBaseUpdate=o}function Qn(n,o,h,_){var b=n.updateQueue;Yn=!1;var k=b.firstBaseUpdate,B=b.lastBaseUpdate,Q=b.shared.pending;if(Q!==null){b.shared.pending=null;var se=Q,be=se.next;se.next=null,B===null?k=be:B.next=be,B=se;var De=n.alternate;De!==null&&(De=De.updateQueue,Q=De.lastBaseUpdate,Q!==B&&(Q===null?De.firstBaseUpdate=be:Q.next=be,De.lastBaseUpdate=se))}if(k!==null){var Fe=b.baseState;B=0,De=be=se=null,Q=k;do{var Ae=Q.lane,We=Q.eventTime;if((_&Ae)===Ae){De!==null&&(De=De.next={eventTime:We,lane:0,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null});e:{var at=n,pt=Q;switch(Ae=o,We=h,pt.tag){case 1:if(at=pt.payload,typeof at=="function"){Fe=at.call(We,Fe,Ae);break e}Fe=at;break e;case 3:at.flags=at.flags&-65537|128;case 0:if(at=pt.payload,Ae=typeof at=="function"?at.call(We,Fe,Ae):at,Ae==null)break e;Fe=rt({},Fe,Ae);break e;case 2:Yn=!0}}Q.callback!==null&&Q.lane!==0&&(n.flags|=64,Ae=b.effects,Ae===null?b.effects=[Q]:Ae.push(Q))}else We={eventTime:We,lane:Ae,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},De===null?(be=De=We,se=Fe):De=De.next=We,B|=Ae;if(Q=Q.next,Q===null){if(Q=b.shared.pending,Q===null)break;Ae=Q,Q=Ae.next,Ae.next=null,b.lastBaseUpdate=Ae,b.shared.pending=null}}while(!0);if(De===null&&(se=Fe),b.baseState=se,b.firstBaseUpdate=be,b.lastBaseUpdate=De,o=b.shared.interleaved,o!==null){b=o;do B|=b.lane,b=b.next;while(b!==o)}else k===null&&(b.shared.lanes=0);ul|=B,n.lanes=B,n.memoizedState=Fe}}function Mn(n,o,h){if(n=o.effects,o.effects=null,n!==null)for(o=0;o<n.length;o++){var _=n[o],b=_.callback;if(b!==null){if(_.callback=null,_=h,typeof b!="function")throw Error(Z(191,b));b.call(_)}}}var Kr={},Dr=ho(Kr),xi=ho(Kr),Bt=ho(Kr);function gn(n){if(n===Kr)throw Error(Z(174));return n}function mo(n,o){switch(Er(Bt,o),Er(xi,n),Er(Dr,Kr),n=o.nodeType,n){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:So(null,"");break;default:n=n===8?o.parentNode:o,o=n.namespaceURI||null,n=n.tagName,o=So(o,n)}Tr(Dr),Er(Dr,o)}function es(){Tr(Dr),Tr(xi),Tr(Bt)}function Su(n){gn(Bt.current);var o=gn(Dr.current),h=So(o,n.type);o!==h&&(Er(xi,n),Er(Dr,h))}function Tu(n){xi.current===n&&(Tr(Dr),Tr(xi))}var Or=ho(0);function ts(n){for(var o=n;o!==null;){if(o.tag===13){var h=o.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Nl=[];function ya(){for(var n=0;n<Nl.length;n++)Nl[n]._workInProgressVersionPrimary=null;Nl.length=0}var go=tr.ReactCurrentDispatcher,va=tr.ReactCurrentBatchConfig,xs=0,vr=null,Ur=null,oi=null,ku=!1,Vl=!1,Iu=0,ph=0;function fi(){throw Error(Z(321))}function xa(n,o){if(o===null)return!1;for(var h=0;h<o.length&&h<n.length;h++)if(!qi(n[h],o[h]))return!1;return!0}function js(n,o,h,_,b,k){if(xs=k,vr=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,go.current=n===null||n.memoizedState===null?Ic:Rd,n=h(_,b),Vl){k=0;do{if(Vl=!1,Iu=0,25<=k)throw Error(Z(301));k+=1,oi=Ur=null,o.updateQueue=null,go.current=Hh,n=h(_,b)}while(Vl)}if(go.current=kc,o=Ur!==null&&Ur.next!==null,xs=0,oi=Ur=vr=null,ku=!1,o)throw Error(Z(300));return n}function rs(){var n=Iu!==0;return Iu=0,n}function Bi(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oi===null?vr.memoizedState=oi=n:oi=oi.next=n,oi}function is(){if(Ur===null){var n=vr.alternate;n=n!==null?n.memoizedState:null}else n=Ur.next;var o=oi===null?vr.memoizedState:oi.next;if(o!==null)oi=o,Ur=n;else{if(n===null)throw Error(Z(310));Ur=n,n={memoizedState:Ur.memoizedState,baseState:Ur.baseState,baseQueue:Ur.baseQueue,queue:Ur.queue,next:null},oi===null?vr.memoizedState=oi=n:oi=oi.next=n}return oi}function Us(n,o){return typeof o=="function"?o(n):o}function fh(n){var o=is(),h=o.queue;if(h===null)throw Error(Z(311));h.lastRenderedReducer=n;var _=Ur,b=_.baseQueue,k=h.pending;if(k!==null){if(b!==null){var B=b.next;b.next=k.next,k.next=B}_.baseQueue=b=k,h.pending=null}if(b!==null){k=b.next,_=_.baseState;var Q=B=null,se=null,be=k;do{var De=be.lane;if((xs&De)===De)se!==null&&(se=se.next={lane:0,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null}),_=be.hasEagerState?be.eagerState:n(_,be.action);else{var Fe={lane:De,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null};se===null?(Q=se=Fe,B=_):se=se.next=Fe,vr.lanes|=De,ul|=De}be=be.next}while(be!==null&&be!==k);se===null?B=_:se.next=Q,qi(_,o.memoizedState)||(_n=!0),o.memoizedState=_,o.baseState=B,o.baseQueue=se,h.lastRenderedState=_}if(n=h.interleaved,n!==null){b=n;do k=b.lane,vr.lanes|=k,ul|=k,b=b.next;while(b!==n)}else b===null&&(h.lanes=0);return[o.memoizedState,h.dispatch]}function xc(n){var o=is(),h=o.queue;if(h===null)throw Error(Z(311));h.lastRenderedReducer=n;var _=h.dispatch,b=h.pending,k=o.memoizedState;if(b!==null){h.pending=null;var B=b=b.next;do k=n(k,B.action),B=B.next;while(B!==b);qi(k,o.memoizedState)||(_n=!0),o.memoizedState=k,o.baseQueue===null&&(o.baseState=k),h.lastRenderedState=k}return[k,_]}function Jr(){}function wc(n,o){var h=vr,_=is(),b=o(),k=!qi(_.memoizedState,b);if(k&&(_.memoizedState=b,_n=!0),_=_.queue,Pu(ba.bind(null,h,_,n),[n]),_.getSnapshot!==o||k||oi!==null&&oi.memoizedState.tag&1){if(h.flags|=2048,Cu(9,wa.bind(null,h,_,b,o),void 0,null),wi===null)throw Error(Z(349));(xs&30)!==0||mh(h,o,b)}return b}function mh(n,o,h){n.flags|=16384,n={getSnapshot:o,value:h},o=vr.updateQueue,o===null?(o={lastEffect:null,stores:null},vr.updateQueue=o,o.stores=[n]):(h=o.stores,h===null?o.stores=[n]:h.push(n))}function wa(n,o,h,_){o.value=h,o.getSnapshot=_,Eu(o)&&bc(n)}function ba(n,o,h){return h(function(){Eu(o)&&bc(n)})}function Eu(n){var o=n.getSnapshot;n=n.value;try{var h=o();return!qi(n,h)}catch{return!0}}function bc(n){var o=Wi(n,1);o!==null&&Zs(o,n,1,-1)}function gh(n){var o=Bi();return typeof n=="function"&&(n=n()),o.memoizedState=o.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Us,lastRenderedState:n},o.queue=n,n=n.dispatch=Ul.bind(null,vr,n),[o.memoizedState,n]}function Cu(n,o,h,_){return n={tag:n,create:o,destroy:h,deps:_,next:null},o=vr.updateQueue,o===null?(o={lastEffect:null,stores:null},vr.updateQueue=o,o.lastEffect=n.next=n):(h=o.lastEffect,h===null?o.lastEffect=n.next=n:(_=h.next,h.next=n,n.next=_,o.lastEffect=n)),n}function _h(){return is().memoizedState}function Sc(n,o,h,_){var b=Bi();vr.flags|=n,b.memoizedState=Cu(1|o,h,void 0,_===void 0?null:_)}function jl(n,o,h,_){var b=is();_=_===void 0?null:_;var k=void 0;if(Ur!==null){var B=Ur.memoizedState;if(k=B.destroy,_!==null&&xa(_,B.deps)){b.memoizedState=Cu(o,h,k,_);return}}vr.flags|=n,b.memoizedState=Cu(1|o,h,k,_)}function $h(n,o){return Sc(8390656,8,n,o)}function Pu(n,o){return jl(2048,8,n,o)}function yh(n,o){return jl(4,2,n,o)}function vh(n,o){return jl(4,4,n,o)}function nl(n,o){if(typeof o=="function")return n=n(),o(n),function(){o(null)};if(o!=null)return n=n(),o.current=n,function(){o.current=null}}function Zh(n,o,h){return h=h!=null?h.concat([n]):null,jl(4,4,nl.bind(null,o,n),h)}function sl(){}function Mu(n,o){var h=is();o=o===void 0?null:o;var _=h.memoizedState;return _!==null&&o!==null&&xa(o,_[1])?_[0]:(h.memoizedState=[n,o],n)}function zu(n,o){var h=is();o=o===void 0?null:o;var _=h.memoizedState;return _!==null&&o!==null&&xa(o,_[1])?_[0]:(n=n(),h.memoizedState=[n,o],n)}function xh(n,o,h){return(xs&21)===0?(n.baseState&&(n.baseState=!1,_n=!0),n.memoizedState=h):(qi(h,o)||(h=Es(),vr.lanes|=h,ul|=h,n.baseState=!0),o)}function qh(n,o){var h=lr;lr=h!==0&&4>h?h:4,n(!0);var _=va.transition;va.transition={};try{n(!1),o()}finally{lr=h,va.transition=_}}function Gh(){return is().memoizedState}function Xi(n,o,h){var _=Ca(n);if(h={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null},Tc(n))wh(o,h);else if(h=Jn(n,o,h,_),h!==null){var b=yn();Zs(h,n,_,b),$l(h,o,_)}}function Ul(n,o,h){var _=Ca(n),b={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null};if(Tc(n))wh(o,b);else{var k=n.alternate;if(n.lanes===0&&(k===null||k.lanes===0)&&(k=o.lastRenderedReducer,k!==null))try{var B=o.lastRenderedState,Q=k(B,h);if(b.hasEagerState=!0,b.eagerState=Q,qi(Q,B)){var se=o.interleaved;se===null?(b.next=b,vi(o)):(b.next=se.next,se.next=b),o.interleaved=b;return}}catch{}finally{}h=Jn(n,o,b,_),h!==null&&(b=yn(),Zs(h,n,_,b),$l(h,o,_))}}function Tc(n){var o=n.alternate;return n===vr||o!==null&&o===vr}function wh(n,o){Vl=ku=!0;var h=n.pending;h===null?o.next=o:(o.next=h.next,h.next=o),n.pending=o}function $l(n,o,h){if((h&4194240)!==0){var _=o.lanes;_&=n.pendingLanes,h|=_,o.lanes=h,eo(n,h)}}var kc={readContext:Cr,useCallback:fi,useContext:fi,useEffect:fi,useImperativeHandle:fi,useInsertionEffect:fi,useLayoutEffect:fi,useMemo:fi,useReducer:fi,useRef:fi,useState:fi,useDebugValue:fi,useDeferredValue:fi,useTransition:fi,useMutableSource:fi,useSyncExternalStore:fi,useId:fi,unstable_isNewReconciler:!1},Ic={readContext:Cr,useCallback:function(n,o){return Bi().memoizedState=[n,o===void 0?null:o],n},useContext:Cr,useEffect:$h,useImperativeHandle:function(n,o,h){return h=h!=null?h.concat([n]):null,Sc(4194308,4,nl.bind(null,o,n),h)},useLayoutEffect:function(n,o){return Sc(4194308,4,n,o)},useInsertionEffect:function(n,o){return Sc(4,2,n,o)},useMemo:function(n,o){var h=Bi();return o=o===void 0?null:o,n=n(),h.memoizedState=[n,o],n},useReducer:function(n,o,h){var _=Bi();return o=h!==void 0?h(o):o,_.memoizedState=_.baseState=o,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:o},_.queue=n,n=n.dispatch=Xi.bind(null,vr,n),[_.memoizedState,n]},useRef:function(n){var o=Bi();return n={current:n},o.memoizedState=n},useState:gh,useDebugValue:sl,useDeferredValue:function(n){return Bi().memoizedState=n},useTransition:function(){var n=gh(!1),o=n[0];return n=qh.bind(null,n[1]),Bi().memoizedState=n,[o,n]},useMutableSource:function(){},useSyncExternalStore:function(n,o,h){var _=vr,b=Bi();if(W){if(h===void 0)throw Error(Z(407));h=h()}else{if(h=o(),wi===null)throw Error(Z(349));(xs&30)!==0||mh(_,o,h)}b.memoizedState=h;var k={value:h,getSnapshot:o};return b.queue=k,$h(ba.bind(null,_,k,n),[n]),_.flags|=2048,Cu(9,wa.bind(null,_,k,h,o),void 0,null),h},useId:function(){var n=Bi(),o=wi.identifierPrefix;if(W){var h=I,_=S;h=(_&~(1<<32-pr(_)-1)).toString(32)+h,o=":"+o+"R"+h,h=Iu++,0<h&&(o+="H"+h.toString(32)),o+=":"}else h=ph++,o=":"+o+"r"+h.toString(32)+":";return n.memoizedState=o},unstable_isNewReconciler:!1},Rd={readContext:Cr,useCallback:Mu,useContext:Cr,useEffect:Pu,useImperativeHandle:Zh,useInsertionEffect:yh,useLayoutEffect:vh,useMemo:zu,useReducer:fh,useRef:_h,useState:function(){return fh(Us)},useDebugValue:sl,useDeferredValue:function(n){var o=is();return xh(o,Ur.memoizedState,n)},useTransition:function(){var n=fh(Us)[0],o=is().memoizedState;return[n,o]},useMutableSource:Jr,useSyncExternalStore:wc,useId:Gh,unstable_isNewReconciler:!1},Hh={readContext:Cr,useCallback:Mu,useContext:Cr,useEffect:Pu,useImperativeHandle:Zh,useInsertionEffect:yh,useLayoutEffect:vh,useMemo:zu,useReducer:xc,useRef:_h,useState:function(){return xc(Us)},useDebugValue:sl,useDeferredValue:function(n){var o=is();return Ur===null?o.memoizedState=n:xh(o,Ur.memoizedState,n)},useTransition:function(){var n=xc(Us)[0],o=is().memoizedState;return[n,o]},useMutableSource:Jr,useSyncExternalStore:wc,useId:Gh,unstable_isNewReconciler:!1};function ws(n,o){if(n&&n.defaultProps){o=rt({},o),n=n.defaultProps;for(var h in n)o[h]===void 0&&(o[h]=n[h]);return o}return o}function Ec(n,o,h,_){o=n.memoizedState,h=h(_,o),h=h==null?o:rt({},o,h),n.memoizedState=h,n.lanes===0&&(n.updateQueue.baseState=h)}var Cc={isMounted:function(n){return(n=n._reactInternals)?Mt(n)===n:!1},enqueueSetState:function(n,o,h){n=n._reactInternals;var _=yn(),b=Ca(n),k=Pn(_,b);k.payload=o,h!=null&&(k.callback=h),o=vs(n,k,b),o!==null&&(Zs(o,n,b,_),Fi(o,n,b))},enqueueReplaceState:function(n,o,h){n=n._reactInternals;var _=yn(),b=Ca(n),k=Pn(_,b);k.tag=1,k.payload=o,h!=null&&(k.callback=h),o=vs(n,k,b),o!==null&&(Zs(o,n,b,_),Fi(o,n,b))},enqueueForceUpdate:function(n,o){n=n._reactInternals;var h=yn(),_=Ca(n),b=Pn(h,_);b.tag=2,o!=null&&(b.callback=o),o=vs(n,b,_),o!==null&&(Zs(o,n,_,h),Fi(o,n,_))}};function Pc(n,o,h,_,b,k,B){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(_,k,B):o.prototype&&o.prototype.isPureReactComponent?!ao(h,_)||!ao(b,k):!0}function bh(n,o,h){var _=!1,b=po,k=o.contextType;return typeof k=="object"&&k!==null?k=Cr(k):(b=yi(o)?Cn:gr.current,_=o.contextTypes,k=(_=_!=null)?Vs(n,b):po),o=new o(h,k),n.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Cc,n.stateNode=o,o._reactInternals=n,_&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=b,n.__reactInternalMemoizedMaskedChildContext=k),o}function Mc(n,o,h,_){n=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(h,_),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(h,_),o.state!==n&&Cc.enqueueReplaceState(o,o.state,null)}function ol(n,o,h,_){var b=n.stateNode;b.props=h,b.state=n.memoizedState,b.refs={},fo(n);var k=o.contextType;typeof k=="object"&&k!==null?b.context=Cr(k):(k=yi(o)?Cn:gr.current,b.context=Vs(n,k)),b.state=n.memoizedState,k=o.getDerivedStateFromProps,typeof k=="function"&&(Ec(n,o,k,h),b.state=n.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(o=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),o!==b.state&&Cc.enqueueReplaceState(b,b.state,null),Qn(n,h,b,_),b.state=n.memoizedState),typeof b.componentDidMount=="function"&&(n.flags|=4194308)}function Ii(n,o){try{var h="",_=o;do h+=Vt(_),_=_.return;while(_);var b=h}catch(k){b=`
Error generating stack: `+k.message+`
`+k.stack}return{value:n,source:o,stack:b,digest:null}}function zc(n,o,h){return{value:n,source:null,stack:h??null,digest:o??null}}function Au(n,o){try{console.error(o.value)}catch(h){setTimeout(function(){throw h})}}var Fd=typeof WeakMap=="function"?WeakMap:Map;function Sh(n,o,h){h=Pn(-1,h),h.tag=3,h.payload={element:null};var _=o.value;return h.callback=function(){Uu||(Uu=!0,Uc=_),Au(n,o)},h}function Wh(n,o,h){h=Pn(-1,h),h.tag=3;var _=n.type.getDerivedStateFromError;if(typeof _=="function"){var b=o.value;h.payload=function(){return _(b)},h.callback=function(){Au(n,o)}}var k=n.stateNode;return k!==null&&typeof k.componentDidCatch=="function"&&(h.callback=function(){Au(n,o),typeof _!="function"&&(Wt===null?Wt=new Set([this]):Wt.add(this));var B=o.stack;this.componentDidCatch(o.value,{componentStack:B!==null?B:""})}),h}function Xh(n,o,h){var _=n.pingCache;if(_===null){_=n.pingCache=new Fd;var b=new Set;_.set(o,b)}else b=_.get(o),b===void 0&&(b=new Set,_.set(o,b));b.has(h)||(b.add(h),n=Ud.bind(null,n,o,h),o.then(n,n))}function Kh(n){do{var o;if((o=n.tag===13)&&(o=n.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return n;n=n.return}while(n!==null);return null}function Jh(n,o,h,_,b){return(n.mode&1)===0?(n===o?n.flags|=65536:(n.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(o=Pn(-1,1),o.tag=2,vs(h,o,1))),h.lanes|=1),n):(n.flags|=65536,n.lanes=b,n)}var Yh=tr.ReactCurrentOwner,_n=!1;function ai(n,o,h,_){o.child=n===null?wt(o,null,h,_):Ze(o,n.child,h,_)}function Zl(n,o,h,_,b){h=h.render;var k=o.ref;return si(o,b),_=js(n,o,h,_,k,b),h=rs(),n!==null&&!_n?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~b,ns(n,o,b)):(W&&h&&F(o),o.flags|=1,ai(n,o,_,b),o.child)}function Qh(n,o,h,_,b){if(n===null){var k=h.type;return typeof k=="function"&&!Xu(k)&&k.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(o.tag=15,o.type=k,ed(n,o,k,_,b)):(n=Ku(h.type,null,_,o,o.mode,b),n.ref=o.ref,n.return=o,o.child=n)}if(k=n.child,(n.lanes&b)===0){var B=k.memoizedProps;if(h=h.compare,h=h!==null?h:ao,h(B,_)&&n.ref===o.ref)return ns(n,o,b)}return o.flags|=1,n=Pa(k,_),n.ref=o.ref,n.return=o,o.child=n}function ed(n,o,h,_,b){if(n!==null){var k=n.memoizedProps;if(ao(k,_)&&n.ref===o.ref)if(_n=!1,o.pendingProps=_=k,(n.lanes&b)!==0)(n.flags&131072)!==0&&(_n=!0);else return o.lanes=n.lanes,ns(n,o,b)}return Th(n,o,h,_,b)}function td(n,o,h){var _=o.pendingProps,b=_.children,k=n!==null?n.memoizedState:null;if(_.mode==="hidden")if((o.mode&1)===0)o.memoizedState={baseLanes:0,cachePool:null,transitions:null},Er(Hl,Yi),Yi|=h;else{if((h&1073741824)===0)return n=k!==null?k.baseLanes|h:h,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:n,cachePool:null,transitions:null},o.updateQueue=null,Er(Hl,Yi),Yi|=n,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},_=k!==null?k.baseLanes:h,Er(Hl,Yi),Yi|=_}else k!==null?(_=k.baseLanes|h,o.memoizedState=null):_=h,Er(Hl,Yi),Yi|=_;return ai(n,o,b,h),o.child}function rd(n,o){var h=o.ref;(n===null&&h!==null||n!==null&&n.ref!==h)&&(o.flags|=512,o.flags|=2097152)}function Th(n,o,h,_,b){var k=yi(h)?Cn:gr.current;return k=Vs(o,k),si(o,b),h=js(n,o,h,_,k,b),_=rs(),n!==null&&!_n?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~b,ns(n,o,b)):(W&&_&&F(o),o.flags|=1,ai(n,o,h,b),o.child)}function id(n,o,h,_,b){if(yi(h)){var k=!0;dn(o)}else k=!1;if(si(o,b),o.stateNode===null)Ru(n,o),bh(o,h,_),ol(o,h,_,b),_=!0;else if(n===null){var B=o.stateNode,Q=o.memoizedProps;B.props=Q;var se=B.context,be=h.contextType;typeof be=="object"&&be!==null?be=Cr(be):(be=yi(h)?Cn:gr.current,be=Vs(o,be));var De=h.getDerivedStateFromProps,Fe=typeof De=="function"||typeof B.getSnapshotBeforeUpdate=="function";Fe||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(Q!==_||se!==be)&&Mc(o,B,_,be),Yn=!1;var Ae=o.memoizedState;B.state=Ae,Qn(o,_,B,b),se=o.memoizedState,Q!==_||Ae!==se||Zt.current||Yn?(typeof De=="function"&&(Ec(o,h,De,_),se=o.memoizedState),(Q=Yn||Pc(o,h,Q,_,Ae,se,be))?(Fe||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount()),typeof B.componentDidMount=="function"&&(o.flags|=4194308)):(typeof B.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=_,o.memoizedState=se),B.props=_,B.state=se,B.context=be,_=Q):(typeof B.componentDidMount=="function"&&(o.flags|=4194308),_=!1)}else{B=o.stateNode,fn(n,o),Q=o.memoizedProps,be=o.type===o.elementType?Q:ws(o.type,Q),B.props=be,Fe=o.pendingProps,Ae=B.context,se=h.contextType,typeof se=="object"&&se!==null?se=Cr(se):(se=yi(h)?Cn:gr.current,se=Vs(o,se));var We=h.getDerivedStateFromProps;(De=typeof We=="function"||typeof B.getSnapshotBeforeUpdate=="function")||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(Q!==Fe||Ae!==se)&&Mc(o,B,_,se),Yn=!1,Ae=o.memoizedState,B.state=Ae,Qn(o,_,B,b);var at=o.memoizedState;Q!==Fe||Ae!==at||Zt.current||Yn?(typeof We=="function"&&(Ec(o,h,We,_),at=o.memoizedState),(be=Yn||Pc(o,h,be,_,Ae,at,se)||!1)?(De||typeof B.UNSAFE_componentWillUpdate!="function"&&typeof B.componentWillUpdate!="function"||(typeof B.componentWillUpdate=="function"&&B.componentWillUpdate(_,at,se),typeof B.UNSAFE_componentWillUpdate=="function"&&B.UNSAFE_componentWillUpdate(_,at,se)),typeof B.componentDidUpdate=="function"&&(o.flags|=4),typeof B.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof B.componentDidUpdate!="function"||Q===n.memoizedProps&&Ae===n.memoizedState||(o.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||Q===n.memoizedProps&&Ae===n.memoizedState||(o.flags|=1024),o.memoizedProps=_,o.memoizedState=at),B.props=_,B.state=at,B.context=se,_=be):(typeof B.componentDidUpdate!="function"||Q===n.memoizedProps&&Ae===n.memoizedState||(o.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||Q===n.memoizedProps&&Ae===n.memoizedState||(o.flags|=1024),_=!1)}return kh(n,o,h,_,k,b)}function kh(n,o,h,_,b,k){rd(n,o);var B=(o.flags&128)!==0;if(!_&&!B)return b&&ga(o,h,!1),ns(n,o,k);_=o.stateNode,Yh.current=o;var Q=B&&typeof h.getDerivedStateFromError!="function"?null:_.render();return o.flags|=1,n!==null&&B?(o.child=Ze(o,n.child,null,k),o.child=Ze(o,null,Q,k)):ai(n,o,Q,k),o.memoizedState=_.state,b&&ga(o,h,!0),o.child}function Ac(n){var o=n.stateNode;o.pendingContext?fa(n,o.pendingContext,o.pendingContext!==o.context):o.context&&fa(n,o.context,!1),mo(n,o.containerInfo)}function nd(n,o,h,_,b){return Ne(),He(b),o.flags|=256,ai(n,o,h,_),o.child}var Sa={dehydrated:null,treeContext:null,retryLane:0};function Ih(n){return{baseLanes:n,cachePool:null,transitions:null}}function Gr(n,o,h){var _=o.pendingProps,b=Or.current,k=!1,B=(o.flags&128)!==0,Q;if((Q=B)||(Q=n!==null&&n.memoizedState===null?!1:(b&2)!==0),Q?(k=!0,o.flags&=-129):(n===null||n.memoizedState!==null)&&(b|=1),Er(Or,b&1),n===null)return ue(o),n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?((o.mode&1)===0?o.lanes=1:n.data==="$!"?o.lanes=8:o.lanes=1073741824,null):(B=_.children,n=_.fallback,k?(_=o.mode,k=o.child,B={mode:"hidden",children:B},(_&1)===0&&k!==null?(k.childLanes=0,k.pendingProps=B):k=za(B,_,0,null),n=Ma(n,_,h,null),k.return=o,n.return=o,k.sibling=n,o.child=k,o.child.memoizedState=Ih(h),o.memoizedState=Sa,n):ql(o,B));if(b=n.memoizedState,b!==null&&(Q=b.dehydrated,Q!==null))return Dc(n,o,B,_,Q,b,h);if(k){k=_.fallback,B=o.mode,b=n.child,Q=b.sibling;var se={mode:"hidden",children:_.children};return(B&1)===0&&o.child!==b?(_=o.child,_.childLanes=0,_.pendingProps=se,o.deletions=null):(_=Pa(b,se),_.subtreeFlags=b.subtreeFlags&14680064),Q!==null?k=Pa(Q,k):(k=Ma(k,B,h,null),k.flags|=2),k.return=o,_.return=o,_.sibling=k,o.child=_,_=k,k=o.child,B=n.child.memoizedState,B=B===null?Ih(h):{baseLanes:B.baseLanes|h,cachePool:null,transitions:B.transitions},k.memoizedState=B,k.childLanes=n.childLanes&~h,o.memoizedState=Sa,_}return k=n.child,n=k.sibling,_=Pa(k,{mode:"visible",children:_.children}),(o.mode&1)===0&&(_.lanes=h),_.return=o,_.sibling=null,n!==null&&(h=o.deletions,h===null?(o.deletions=[n],o.flags|=16):h.push(n)),o.child=_,o.memoizedState=null,_}function ql(n,o){return o=za({mode:"visible",children:o},n.mode,0,null),o.return=n,n.child=o}function Du(n,o,h,_){return _!==null&&He(_),Ze(o,n.child,null,h),n=ql(o,o.pendingProps.children),n.flags|=2,o.memoizedState=null,n}function Dc(n,o,h,_,b,k,B){if(h)return o.flags&256?(o.flags&=-257,_=zc(Error(Z(422))),Du(n,o,B,_)):o.memoizedState!==null?(o.child=n.child,o.flags|=128,null):(k=_.fallback,b=o.mode,_=za({mode:"visible",children:_.children},b,0,null),k=Ma(k,b,B,null),k.flags|=2,_.return=o,k.return=o,_.sibling=k,o.child=_,(o.mode&1)!==0&&Ze(o,n.child,null,B),o.child.memoizedState=Ih(B),o.memoizedState=Sa,k);if((o.mode&1)===0)return Du(n,o,B,null);if(b.data==="$!"){if(_=b.nextSibling&&b.nextSibling.dataset,_)var Q=_.dgst;return _=Q,k=Error(Z(419)),_=zc(k,_,void 0),Du(n,o,B,_)}if(Q=(B&n.childLanes)!==0,_n||Q){if(_=wi,_!==null){switch(B&-B){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=(b&(_.suspendedLanes|B))!==0?0:b,b!==0&&b!==k.retryLane&&(k.retryLane=b,Wi(n,b),Zs(_,n,b,-1))}return qc(),_=zc(Error(Z(421))),Du(n,o,B,_)}return b.data==="$?"?(o.flags|=128,o.child=n.child,o=xd.bind(null,n),b._reactRetry=o,null):(n=k.treeContext,$=Wn(b.nextSibling),U=o,W=!0,J=null,n!==null&&(d[v++]=S,d[v++]=I,d[v++]=w,S=n.id,I=n.overflow,w=o),o=ql(o,_.children),o.flags|=4096,o)}function Lu(n,o,h){n.lanes|=o;var _=n.alternate;_!==null&&(_.lanes|=o),yr(n.return,o,h)}function al(n,o,h,_,b){var k=n.memoizedState;k===null?n.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:_,tail:h,tailMode:b}:(k.isBackwards=o,k.rendering=null,k.renderingStartTime=0,k.last=_,k.tail=h,k.tailMode=b)}function Eh(n,o,h){var _=o.pendingProps,b=_.revealOrder,k=_.tail;if(ai(n,o,_.children,h),_=Or.current,(_&2)!==0)_=_&1|2,o.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=o.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Lu(n,h,o);else if(n.tag===19)Lu(n,h,o);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===o)break e;for(;n.sibling===null;){if(n.return===null||n.return===o)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}_&=1}if(Er(Or,_),(o.mode&1)===0)o.memoizedState=null;else switch(b){case"forwards":for(h=o.child,b=null;h!==null;)n=h.alternate,n!==null&&ts(n)===null&&(b=h),h=h.sibling;h=b,h===null?(b=o.child,o.child=null):(b=h.sibling,h.sibling=null),al(o,!1,b,h,k);break;case"backwards":for(h=null,b=o.child,o.child=null;b!==null;){if(n=b.alternate,n!==null&&ts(n)===null){o.child=b;break}n=b.sibling,b.sibling=h,h=b,b=n}al(o,!0,h,null,k);break;case"together":al(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Ru(n,o){(o.mode&1)===0&&n!==null&&(n.alternate=null,o.alternate=null,o.flags|=2)}function ns(n,o,h){if(n!==null&&(o.dependencies=n.dependencies),ul|=o.lanes,(h&o.childLanes)===0)return null;if(n!==null&&o.child!==n.child)throw Error(Z(153));if(o.child!==null){for(n=o.child,h=Pa(n,n.pendingProps),o.child=h,h.return=o;n.sibling!==null;)n=n.sibling,h=h.sibling=Pa(n,n.pendingProps),h.return=o;h.sibling=null}return o.child}function Ch(n,o,h){switch(o.tag){case 3:Ac(o),Ne();break;case 5:Su(o);break;case 1:yi(o.type)&&dn(o);break;case 4:mo(o,o.stateNode.containerInfo);break;case 10:var _=o.type._context,b=o.memoizedProps.value;Er(fr,_._currentValue),_._currentValue=b;break;case 13:if(_=o.memoizedState,_!==null)return _.dehydrated!==null?(Er(Or,Or.current&1),o.flags|=128,null):(h&o.child.childLanes)!==0?Gr(n,o,h):(Er(Or,Or.current&1),n=ns(n,o,h),n!==null?n.sibling:null);Er(Or,Or.current&1);break;case 19:if(_=(h&o.childLanes)!==0,(n.flags&128)!==0){if(_)return Eh(n,o,h);o.flags|=128}if(b=o.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Er(Or,Or.current),_)break;return null;case 22:case 23:return o.lanes=0,td(n,o,h)}return ns(n,o,h)}var Lc,Fu,Rc,Ph;Lc=function(n,o){for(var h=o.child;h!==null;){if(h.tag===5||h.tag===6)n.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===o)break;for(;h.sibling===null;){if(h.return===null||h.return===o)return;h=h.return}h.sibling.return=h.return,h=h.sibling}},Fu=function(){},Rc=function(n,o,h,_){var b=n.memoizedProps;if(b!==_){n=o.stateNode,gn(Dr.current);var k=null;switch(h){case"input":b=us(n,b),_=us(n,_),k=[];break;case"select":b=rt({},b,{value:void 0}),_=rt({},_,{value:void 0}),k=[];break;case"textarea":b=hs(n,b),_=hs(n,_),k=[];break;default:typeof b.onClick!="function"&&typeof _.onClick=="function"&&(n.onclick=Hi)}Si(h,_);var B;h=null;for(be in b)if(!_.hasOwnProperty(be)&&b.hasOwnProperty(be)&&b[be]!=null)if(be==="style"){var Q=b[be];for(B in Q)Q.hasOwnProperty(B)&&(h||(h={}),h[B]="")}else be!=="dangerouslySetInnerHTML"&&be!=="children"&&be!=="suppressContentEditableWarning"&&be!=="suppressHydrationWarning"&&be!=="autoFocus"&&(me.hasOwnProperty(be)?k||(k=[]):(k=k||[]).push(be,null));for(be in _){var se=_[be];if(Q=b!=null?b[be]:void 0,_.hasOwnProperty(be)&&se!==Q&&(se!=null||Q!=null))if(be==="style")if(Q){for(B in Q)!Q.hasOwnProperty(B)||se&&se.hasOwnProperty(B)||(h||(h={}),h[B]="");for(B in se)se.hasOwnProperty(B)&&Q[B]!==se[B]&&(h||(h={}),h[B]=se[B])}else h||(k||(k=[]),k.push(be,h)),h=se;else be==="dangerouslySetInnerHTML"?(se=se?se.__html:void 0,Q=Q?Q.__html:void 0,se!=null&&Q!==se&&(k=k||[]).push(be,se)):be==="children"?typeof se!="string"&&typeof se!="number"||(k=k||[]).push(be,""+se):be!=="suppressContentEditableWarning"&&be!=="suppressHydrationWarning"&&(me.hasOwnProperty(be)?(se!=null&&be==="onScroll"&&Sr("scroll",n),k||Q===se||(k=[])):(k=k||[]).push(be,se))}h&&(k=k||[]).push("style",h);var be=k;(o.updateQueue=be)&&(o.flags|=4)}},Ph=function(n,o,h,_){h!==_&&(o.flags|=4)};function Gl(n,o){if(!W)switch(n.tailMode){case"hidden":o=n.tail;for(var h=null;o!==null;)o.alternate!==null&&(h=o),o=o.sibling;h===null?n.tail=null:h.sibling=null;break;case"collapsed":h=n.tail;for(var _=null;h!==null;)h.alternate!==null&&(_=h),h=h.sibling;_===null?o||n.tail===null?n.tail=null:n.tail.sibling=null:_.sibling=null}}function Ki(n){var o=n.alternate!==null&&n.alternate.child===n.child,h=0,_=0;if(o)for(var b=n.child;b!==null;)h|=b.lanes|b.childLanes,_|=b.subtreeFlags&14680064,_|=b.flags&14680064,b.return=n,b=b.sibling;else for(b=n.child;b!==null;)h|=b.lanes|b.childLanes,_|=b.subtreeFlags,_|=b.flags,b.return=n,b=b.sibling;return n.subtreeFlags|=_,n.childLanes=h,o}function Bd(n,o,h){var _=o.pendingProps;switch(N(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ki(o),null;case 1:return yi(o.type)&&rl(),Ki(o),null;case 3:return _=o.stateNode,es(),Tr(Zt),Tr(gr),ya(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(n===null||n.child===null)&&(Ce(o)?o.flags|=4:n===null||n.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,J!==null&&(Dh(J),J=null))),Fu(n,o),Ki(o),null;case 5:Tu(o);var b=gn(Bt.current);if(h=o.type,n!==null&&o.stateNode!=null)Rc(n,o,h,_,b),n.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!_){if(o.stateNode===null)throw Error(Z(166));return Ki(o),null}if(n=gn(Dr.current),Ce(o)){_=o.stateNode,h=o.type;var k=o.memoizedProps;switch(_[Ri]=o,_[ys]=k,n=(o.mode&1)!==0,h){case"dialog":Sr("cancel",_),Sr("close",_);break;case"iframe":case"object":case"embed":Sr("load",_);break;case"video":case"audio":for(b=0;b<co.length;b++)Sr(co[b],_);break;case"source":Sr("error",_);break;case"img":case"image":case"link":Sr("error",_),Sr("load",_);break;case"details":Sr("toggle",_);break;case"input":wo(_,k),Sr("invalid",_);break;case"select":_._wrapperState={wasMultiple:!!k.multiple},Sr("invalid",_);break;case"textarea":ds(_,k),Sr("invalid",_)}Si(h,k),b=null;for(var B in k)if(k.hasOwnProperty(B)){var Q=k[B];B==="children"?typeof Q=="string"?_.textContent!==Q&&(k.suppressHydrationWarning!==!0&&da(_.textContent,Q,n),b=["children",Q]):typeof Q=="number"&&_.textContent!==""+Q&&(k.suppressHydrationWarning!==!0&&da(_.textContent,Q,n),b=["children",""+Q]):me.hasOwnProperty(B)&&Q!=null&&B==="onScroll"&&Sr("scroll",_)}switch(h){case"input":Ys(_),Wo(_,k,!0);break;case"textarea":Ys(_),on(_);break;case"select":case"option":break;default:typeof k.onClick=="function"&&(_.onclick=Hi)}_=b,o.updateQueue=_,_!==null&&(o.flags|=4)}else{B=b.nodeType===9?b:b.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Xo(h)),n==="http://www.w3.org/1999/xhtml"?h==="script"?(n=B.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof _.is=="string"?n=B.createElement(h,{is:_.is}):(n=B.createElement(h),h==="select"&&(B=n,_.multiple?B.multiple=!0:_.size&&(B.size=_.size))):n=B.createElementNS(n,h),n[Ri]=o,n[ys]=_,Lc(n,o,!1,!1),o.stateNode=n;e:{switch(B=an(h,_),h){case"dialog":Sr("cancel",n),Sr("close",n),b=_;break;case"iframe":case"object":case"embed":Sr("load",n),b=_;break;case"video":case"audio":for(b=0;b<co.length;b++)Sr(co[b],n);b=_;break;case"source":Sr("error",n),b=_;break;case"img":case"image":case"link":Sr("error",n),Sr("load",n),b=_;break;case"details":Sr("toggle",n),b=_;break;case"input":wo(n,_),b=us(n,_),Sr("invalid",n);break;case"option":b=_;break;case"select":n._wrapperState={wasMultiple:!!_.multiple},b=rt({},_,{value:void 0}),Sr("invalid",n);break;case"textarea":ds(n,_),b=hs(n,_),Sr("invalid",n);break;default:b=_}Si(h,b),Q=b;for(k in Q)if(Q.hasOwnProperty(k)){var se=Q[k];k==="style"?Dt(n,se):k==="dangerouslySetInnerHTML"?(se=se?se.__html:void 0,se!=null&&jn(n,se)):k==="children"?typeof se=="string"?(h!=="textarea"||se!=="")&&ii(n,se):typeof se=="number"&&ii(n,""+se):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(me.hasOwnProperty(k)?se!=null&&k==="onScroll"&&Sr("scroll",n):se!=null&&Xt(n,k,se,B))}switch(h){case"input":Ys(n),Wo(n,_,!1);break;case"textarea":Ys(n),on(n);break;case"option":_.value!=null&&n.setAttribute("value",""+$t(_.value));break;case"select":n.multiple=!!_.multiple,k=_.value,k!=null?cs(n,!!_.multiple,k,!1):_.defaultValue!=null&&cs(n,!!_.multiple,_.defaultValue,!0);break;default:typeof b.onClick=="function"&&(n.onclick=Hi)}switch(h){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}}_&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return Ki(o),null;case 6:if(n&&o.stateNode!=null)Ph(n,o,n.memoizedProps,_);else{if(typeof _!="string"&&o.stateNode===null)throw Error(Z(166));if(h=gn(Bt.current),gn(Dr.current),Ce(o)){if(_=o.stateNode,h=o.memoizedProps,_[Ri]=o,(k=_.nodeValue!==h)&&(n=U,n!==null))switch(n.tag){case 3:da(_.nodeValue,h,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&da(_.nodeValue,h,(n.mode&1)!==0)}k&&(o.flags|=4)}else _=(h.nodeType===9?h:h.ownerDocument).createTextNode(_),_[Ri]=o,o.stateNode=_}return Ki(o),null;case 13:if(Tr(Or),_=o.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(W&&$!==null&&(o.mode&1)!==0&&(o.flags&128)===0)Le(),Ne(),o.flags|=98560,k=!1;else if(k=Ce(o),_!==null&&_.dehydrated!==null){if(n===null){if(!k)throw Error(Z(318));if(k=o.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(Z(317));k[Ri]=o}else Ne(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Ki(o),k=!1}else J!==null&&(Dh(J),J=null),k=!0;if(!k)return o.flags&65536?o:null}return(o.flags&128)!==0?(o.lanes=h,o):(_=_!==null,_!==(n!==null&&n.memoizedState!==null)&&_&&(o.child.flags|=8192,(o.mode&1)!==0&&(n===null||(Or.current&1)!==0?mi===0&&(mi=3):qc())),o.updateQueue!==null&&(o.flags|=4),Ki(o),null);case 4:return es(),Fu(n,o),n===null&&Fs(o.stateNode.containerInfo),Ki(o),null;case 10:return pn(o.type._context),Ki(o),null;case 17:return yi(o.type)&&rl(),Ki(o),null;case 19:if(Tr(Or),k=o.memoizedState,k===null)return Ki(o),null;if(_=(o.flags&128)!==0,B=k.rendering,B===null)if(_)Gl(k,!1);else{if(mi!==0||n!==null&&(n.flags&128)!==0)for(n=o.child;n!==null;){if(B=ts(n),B!==null){for(o.flags|=128,Gl(k,!1),_=B.updateQueue,_!==null&&(o.updateQueue=_,o.flags|=4),o.subtreeFlags=0,_=h,h=o.child;h!==null;)k=h,n=_,k.flags&=14680066,B=k.alternate,B===null?(k.childLanes=0,k.lanes=n,k.child=null,k.subtreeFlags=0,k.memoizedProps=null,k.memoizedState=null,k.updateQueue=null,k.dependencies=null,k.stateNode=null):(k.childLanes=B.childLanes,k.lanes=B.lanes,k.child=B.child,k.subtreeFlags=0,k.deletions=null,k.memoizedProps=B.memoizedProps,k.memoizedState=B.memoizedState,k.updateQueue=B.updateQueue,k.type=B.type,n=B.dependencies,k.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),h=h.sibling;return Er(Or,Or.current&1|2),o.child}n=n.sibling}k.tail!==null&&kt()>Nr&&(o.flags|=128,_=!0,Gl(k,!1),o.lanes=4194304)}else{if(!_)if(n=ts(B),n!==null){if(o.flags|=128,_=!0,h=n.updateQueue,h!==null&&(o.updateQueue=h,o.flags|=4),Gl(k,!0),k.tail===null&&k.tailMode==="hidden"&&!B.alternate&&!W)return Ki(o),null}else 2*kt()-k.renderingStartTime>Nr&&h!==1073741824&&(o.flags|=128,_=!0,Gl(k,!1),o.lanes=4194304);k.isBackwards?(B.sibling=o.child,o.child=B):(h=k.last,h!==null?h.sibling=B:o.child=B,k.last=B)}return k.tail!==null?(o=k.tail,k.rendering=o,k.tail=o.sibling,k.renderingStartTime=kt(),o.sibling=null,h=Or.current,Er(Or,_?h&1|2:h&1),o):(Ki(o),null);case 22:case 23:return qu(),_=o.memoizedState!==null,n!==null&&n.memoizedState!==null!==_&&(o.flags|=8192),_&&(o.mode&1)!==0?(Yi&1073741824)!==0&&(Ki(o),o.subtreeFlags&6&&(o.flags|=8192)):Ki(o),null;case 24:return null;case 25:return null}throw Error(Z(156,o.tag))}function Od(n,o){switch(N(o),o.tag){case 1:return yi(o.type)&&rl(),n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 3:return es(),Tr(Zt),Tr(gr),ya(),n=o.flags,(n&65536)!==0&&(n&128)===0?(o.flags=n&-65537|128,o):null;case 5:return Tu(o),null;case 13:if(Tr(Or),n=o.memoizedState,n!==null&&n.dehydrated!==null){if(o.alternate===null)throw Error(Z(340));Ne()}return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 19:return Tr(Or),null;case 4:return es(),null;case 10:return pn(o.type._context),null;case 22:case 23:return qu(),null;case 24:return null;default:return null}}var Fc=!1,Ji=!1,Ta=typeof WeakSet=="function"?WeakSet:Set,ct=null;function ll(n,o){var h=n.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(_){$r(n,o,_)}else h.current=null}function ka(n,o,h){try{h()}catch(_){$r(n,o,_)}}var sd=!1;function Nd(n,o){if(Os=Po,n=zl(),lo(n)){if("selectionStart"in n)var h={start:n.selectionStart,end:n.selectionEnd};else e:{h=(h=n.ownerDocument)&&h.defaultView||window;var _=h.getSelection&&h.getSelection();if(_&&_.rangeCount!==0){h=_.anchorNode;var b=_.anchorOffset,k=_.focusNode;_=_.focusOffset;try{h.nodeType,k.nodeType}catch{h=null;break e}var B=0,Q=-1,se=-1,be=0,De=0,Fe=n,Ae=null;t:for(;;){for(var We;Fe!==h||b!==0&&Fe.nodeType!==3||(Q=B+b),Fe!==k||_!==0&&Fe.nodeType!==3||(se=B+_),Fe.nodeType===3&&(B+=Fe.nodeValue.length),(We=Fe.firstChild)!==null;)Ae=Fe,Fe=We;for(;;){if(Fe===n)break t;if(Ae===h&&++be===b&&(Q=B),Ae===k&&++De===_&&(se=B),(We=Fe.nextSibling)!==null)break;Fe=Ae,Ae=Fe.parentNode}Fe=We}h=Q===-1||se===-1?null:{start:Q,end:se}}else h=null}h=h||{start:0,end:0}}else h=null;for(vu={focusedElem:n,selectionRange:h},Po=!1,ct=o;ct!==null;)if(o=ct,n=o.child,(o.subtreeFlags&1028)!==0&&n!==null)n.return=o,ct=n;else for(;ct!==null;){o=ct;try{var at=o.alternate;if((o.flags&1024)!==0)switch(o.tag){case 0:case 11:case 15:break;case 1:if(at!==null){var pt=at.memoizedProps,Qr=at.memoizedState,ye=o.stateNode,le=ye.getSnapshotBeforeUpdate(o.elementType===o.type?pt:ws(o.type,pt),Qr);ye.__reactInternalSnapshotBeforeUpdate=le}break;case 3:var xe=o.stateNode.containerInfo;xe.nodeType===1?xe.textContent="":xe.nodeType===9&&xe.documentElement&&xe.removeChild(xe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Z(163))}}catch($e){$r(o,o.return,$e)}if(n=o.sibling,n!==null){n.return=o.return,ct=n;break}ct=o.return}return at=sd,sd=!1,at}function Bu(n,o,h){var _=o.updateQueue;if(_=_!==null?_.lastEffect:null,_!==null){var b=_=_.next;do{if((b.tag&n)===n){var k=b.destroy;b.destroy=void 0,k!==void 0&&ka(o,h,k)}b=b.next}while(b!==_)}}function Ou(n,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var h=o=o.next;do{if((h.tag&n)===n){var _=h.create;h.destroy=_()}h=h.next}while(h!==o)}}function Bc(n){var o=n.ref;if(o!==null){var h=n.stateNode;switch(n.tag){case 5:n=h;break;default:n=h}typeof o=="function"?o(n):o.current=n}}function od(n){var o=n.alternate;o!==null&&(n.alternate=null,od(o)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(o=n.stateNode,o!==null&&(delete o[Ri],delete o[ys],delete o[Ut],delete o[wu],delete o[dh])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function ad(n){return n.tag===5||n.tag===3||n.tag===4}function ld(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||ad(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Mh(n,o,h){var _=n.tag;if(_===5||_===6)n=n.stateNode,o?h.nodeType===8?h.parentNode.insertBefore(n,o):h.insertBefore(n,o):(h.nodeType===8?(o=h.parentNode,o.insertBefore(n,h)):(o=h,o.appendChild(n)),h=h._reactRootContainer,h!=null||o.onclick!==null||(o.onclick=Hi));else if(_!==4&&(n=n.child,n!==null))for(Mh(n,o,h),n=n.sibling;n!==null;)Mh(n,o,h),n=n.sibling}function Nu(n,o,h){var _=n.tag;if(_===5||_===6)n=n.stateNode,o?h.insertBefore(n,o):h.appendChild(n);else if(_!==4&&(n=n.child,n!==null))for(Nu(n,o,h),n=n.sibling;n!==null;)Nu(n,o,h),n=n.sibling}var li=null,ss=!1;function Ia(n,o,h){for(h=h.child;h!==null;)ud(n,o,h),h=h.sibling}function ud(n,o,h){if(Di&&typeof Di.onCommitFiberUnmount=="function")try{Di.onCommitFiberUnmount(ki,h)}catch{}switch(h.tag){case 5:Ji||ll(h,o);case 6:var _=li,b=ss;li=null,Ia(n,o,h),li=_,ss=b,li!==null&&(ss?(n=li,h=h.stateNode,n.nodeType===8?n.parentNode.removeChild(h):n.removeChild(h)):li.removeChild(h.stateNode));break;case 18:li!==null&&(ss?(n=li,h=h.stateNode,n.nodeType===8?Ye(n.parentNode,h):n.nodeType===1&&Ye(n,h),Cs(n)):Ye(li,h.stateNode));break;case 4:_=li,b=ss,li=h.stateNode.containerInfo,ss=!0,Ia(n,o,h),li=_,ss=b;break;case 0:case 11:case 14:case 15:if(!Ji&&(_=h.updateQueue,_!==null&&(_=_.lastEffect,_!==null))){b=_=_.next;do{var k=b,B=k.destroy;k=k.tag,B!==void 0&&((k&2)!==0||(k&4)!==0)&&ka(h,o,B),b=b.next}while(b!==_)}Ia(n,o,h);break;case 1:if(!Ji&&(ll(h,o),_=h.stateNode,typeof _.componentWillUnmount=="function"))try{_.props=h.memoizedProps,_.state=h.memoizedState,_.componentWillUnmount()}catch(Q){$r(h,o,Q)}Ia(n,o,h);break;case 21:Ia(n,o,h);break;case 22:h.mode&1?(Ji=(_=Ji)||h.memoizedState!==null,Ia(n,o,h),Ji=_):Ia(n,o,h);break;default:Ia(n,o,h)}}function zh(n){var o=n.updateQueue;if(o!==null){n.updateQueue=null;var h=n.stateNode;h===null&&(h=n.stateNode=new Ta),o.forEach(function(_){var b=wd.bind(null,n,_);h.has(_)||(h.add(_),_.then(b,b))})}}function $s(n,o){var h=o.deletions;if(h!==null)for(var _=0;_<h.length;_++){var b=h[_];try{var k=n,B=o,Q=B;e:for(;Q!==null;){switch(Q.tag){case 5:li=Q.stateNode,ss=!1;break e;case 3:li=Q.stateNode.containerInfo,ss=!0;break e;case 4:li=Q.stateNode.containerInfo,ss=!0;break e}Q=Q.return}if(li===null)throw Error(Z(160));ud(k,B,b),li=null,ss=!1;var se=b.alternate;se!==null&&(se.return=null),b.return=null}catch(be){$r(b,o,be)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)cd(o,n),o=o.sibling}function cd(n,o){var h=n.alternate,_=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if($s(o,n),zn(n),_&4){try{Bu(3,n,n.return),Ou(3,n)}catch(pt){$r(n,n.return,pt)}try{Bu(5,n,n.return)}catch(pt){$r(n,n.return,pt)}}break;case 1:$s(o,n),zn(n),_&512&&h!==null&&ll(h,h.return);break;case 5:if($s(o,n),zn(n),_&512&&h!==null&&ll(h,h.return),n.flags&32){var b=n.stateNode;try{ii(b,"")}catch(pt){$r(n,n.return,pt)}}if(_&4&&(b=n.stateNode,b!=null)){var k=n.memoizedProps,B=h!==null?h.memoizedProps:k,Q=n.type,se=n.updateQueue;if(n.updateQueue=null,se!==null)try{Q==="input"&&k.type==="radio"&&k.name!=null&&we(b,k),an(Q,B);var be=an(Q,k);for(B=0;B<se.length;B+=2){var De=se[B],Fe=se[B+1];De==="style"?Dt(b,Fe):De==="dangerouslySetInnerHTML"?jn(b,Fe):De==="children"?ii(b,Fe):Xt(b,De,Fe,be)}switch(Q){case"input":ks(b,k);break;case"textarea":bo(b,k);break;case"select":var Ae=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!k.multiple;var We=k.value;We!=null?cs(b,!!k.multiple,We,!1):Ae!==!!k.multiple&&(k.defaultValue!=null?cs(b,!!k.multiple,k.defaultValue,!0):cs(b,!!k.multiple,k.multiple?[]:"",!1))}b[ys]=k}catch(pt){$r(n,n.return,pt)}}break;case 6:if($s(o,n),zn(n),_&4){if(n.stateNode===null)throw Error(Z(162));b=n.stateNode,k=n.memoizedProps;try{b.nodeValue=k}catch(pt){$r(n,n.return,pt)}}break;case 3:if($s(o,n),zn(n),_&4&&h!==null&&h.memoizedState.isDehydrated)try{Cs(o.containerInfo)}catch(pt){$r(n,n.return,pt)}break;case 4:$s(o,n),zn(n);break;case 13:$s(o,n),zn(n),b=n.child,b.flags&8192&&(k=b.memoizedState!==null,b.stateNode.isHidden=k,!k||b.alternate!==null&&b.alternate.memoizedState!==null||(cl=kt())),_&4&&zh(n);break;case 22:if(De=h!==null&&h.memoizedState!==null,n.mode&1?(Ji=(be=Ji)||De,$s(o,n),Ji=be):$s(o,n),zn(n),_&8192){if(be=n.memoizedState!==null,(n.stateNode.isHidden=be)&&!De&&(n.mode&1)!==0)for(ct=n,De=n.child;De!==null;){for(Fe=ct=De;ct!==null;){switch(Ae=ct,We=Ae.child,Ae.tag){case 0:case 11:case 14:case 15:Bu(4,Ae,Ae.return);break;case 1:ll(Ae,Ae.return);var at=Ae.stateNode;if(typeof at.componentWillUnmount=="function"){_=Ae,h=Ae.return;try{o=_,at.props=o.memoizedProps,at.state=o.memoizedState,at.componentWillUnmount()}catch(pt){$r(_,h,pt)}}break;case 5:ll(Ae,Ae.return);break;case 22:if(Ae.memoizedState!==null){fd(Fe);continue}}We!==null?(We.return=Ae,ct=We):fd(Fe)}De=De.sibling}e:for(De=null,Fe=n;;){if(Fe.tag===5){if(De===null){De=Fe;try{b=Fe.stateNode,be?(k=b.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none"):(Q=Fe.stateNode,se=Fe.memoizedProps.style,B=se!=null&&se.hasOwnProperty("display")?se.display:null,Q.style.display=je("display",B))}catch(pt){$r(n,n.return,pt)}}}else if(Fe.tag===6){if(De===null)try{Fe.stateNode.nodeValue=be?"":Fe.memoizedProps}catch(pt){$r(n,n.return,pt)}}else if((Fe.tag!==22&&Fe.tag!==23||Fe.memoizedState===null||Fe===n)&&Fe.child!==null){Fe.child.return=Fe,Fe=Fe.child;continue}if(Fe===n)break e;for(;Fe.sibling===null;){if(Fe.return===null||Fe.return===n)break e;De===Fe&&(De=null),Fe=Fe.return}De===Fe&&(De=null),Fe.sibling.return=Fe.return,Fe=Fe.sibling}}break;case 19:$s(o,n),zn(n),_&4&&zh(n);break;case 21:break;default:$s(o,n),zn(n)}}function zn(n){var o=n.flags;if(o&2){try{e:{for(var h=n.return;h!==null;){if(ad(h)){var _=h;break e}h=h.return}throw Error(Z(160))}switch(_.tag){case 5:var b=_.stateNode;_.flags&32&&(ii(b,""),_.flags&=-33);var k=ld(n);Nu(n,k,b);break;case 3:case 4:var B=_.stateNode.containerInfo,Q=ld(n);Mh(n,Q,B);break;default:throw Error(Z(161))}}catch(se){$r(n,n.return,se)}n.flags&=-3}o&4096&&(n.flags&=-4097)}function hd(n,o,h){ct=n,dd(n)}function dd(n,o,h){for(var _=(n.mode&1)!==0;ct!==null;){var b=ct,k=b.child;if(b.tag===22&&_){var B=b.memoizedState!==null||Fc;if(!B){var Q=b.alternate,se=Q!==null&&Q.memoizedState!==null||Ji;Q=Fc;var be=Ji;if(Fc=B,(Ji=se)&&!be)for(ct=b;ct!==null;)B=ct,se=B.child,B.tag===22&&B.memoizedState!==null?md(b):se!==null?(se.return=B,ct=se):md(b);for(;k!==null;)ct=k,dd(k),k=k.sibling;ct=b,Fc=Q,Ji=be}pd(n)}else(b.subtreeFlags&8772)!==0&&k!==null?(k.return=b,ct=k):pd(n)}}function pd(n){for(;ct!==null;){var o=ct;if((o.flags&8772)!==0){var h=o.alternate;try{if((o.flags&8772)!==0)switch(o.tag){case 0:case 11:case 15:Ji||Ou(5,o);break;case 1:var _=o.stateNode;if(o.flags&4&&!Ji)if(h===null)_.componentDidMount();else{var b=o.elementType===o.type?h.memoizedProps:ws(o.type,h.memoizedProps);_.componentDidUpdate(b,h.memoizedState,_.__reactInternalSnapshotBeforeUpdate)}var k=o.updateQueue;k!==null&&Mn(o,k,_);break;case 3:var B=o.updateQueue;if(B!==null){if(h=null,o.child!==null)switch(o.child.tag){case 5:h=o.child.stateNode;break;case 1:h=o.child.stateNode}Mn(o,B,h)}break;case 5:var Q=o.stateNode;if(h===null&&o.flags&4){h=Q;var se=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":se.autoFocus&&h.focus();break;case"img":se.src&&(h.src=se.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var be=o.alternate;if(be!==null){var De=be.memoizedState;if(De!==null){var Fe=De.dehydrated;Fe!==null&&Cs(Fe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Z(163))}Ji||o.flags&512&&Bc(o)}catch(Ae){$r(o,o.return,Ae)}}if(o===n){ct=null;break}if(h=o.sibling,h!==null){h.return=o.return,ct=h;break}ct=o.return}}function fd(n){for(;ct!==null;){var o=ct;if(o===n){ct=null;break}var h=o.sibling;if(h!==null){h.return=o.return,ct=h;break}ct=o.return}}function md(n){for(;ct!==null;){var o=ct;try{switch(o.tag){case 0:case 11:case 15:var h=o.return;try{Ou(4,o)}catch(se){$r(o,h,se)}break;case 1:var _=o.stateNode;if(typeof _.componentDidMount=="function"){var b=o.return;try{_.componentDidMount()}catch(se){$r(o,b,se)}}var k=o.return;try{Bc(o)}catch(se){$r(o,k,se)}break;case 5:var B=o.return;try{Bc(o)}catch(se){$r(o,B,se)}}}catch(se){$r(o,o.return,se)}if(o===n){ct=null;break}var Q=o.sibling;if(Q!==null){Q.return=o.return,ct=Q;break}ct=o.return}}var Vd=Math.ceil,Oc=tr.ReactCurrentDispatcher,Nc=tr.ReactCurrentOwner,An=tr.ReactCurrentBatchConfig,nr=0,wi=null,ui=null,Oi=0,Yi=0,Hl=ho(0),mi=0,Vu=null,ul=0,Vc=0,jc=0,ju=null,Dn=null,cl=0,Nr=1/0,_o=null,Uu=!1,Uc=null,Wt=null,Wl=!1,Uo=null,$u=0,os=0,Ea=null,Zu=-1,$c=0;function yn(){return(nr&6)!==0?kt():Zu!==-1?Zu:Zu=kt()}function Ca(n){return(n.mode&1)===0?1:(nr&2)!==0&&Oi!==0?Oi&-Oi:Ve.transition!==null?($c===0&&($c=Es()),$c):(n=lr,n!==0||(n=window.event,n=n===void 0?16:io(n.type)),n)}function Zs(n,o,h,_){if(50<os)throw os=0,Ea=null,Error(Z(185));Eo(n,h,_),((nr&2)===0||n!==wi)&&(n===wi&&((nr&2)===0&&(Vc|=h),mi===4&&qs(n,Oi)),Ln(n,_),h===1&&nr===0&&(o.mode&1)===0&&(Nr=kt()+500,ft&&p()))}function Ln(n,o){var h=n.callbackNode;gl(n,o);var _=$i(n,n===wi?Oi:0);if(_===0)h!==null&&hi(h),n.callbackNode=null,n.callbackPriority=0;else if(o=_&-_,n.callbackPriority!==o){if(h!=null&&hi(h),o===1)n.tag===0?bu(hl.bind(null,n)):il(hl.bind(null,n)),pa(function(){(nr&6)===0&&p()}),h=null;else{switch(Ba(_)){case 1:h=Ra;break;case 4:h=ji;break;case 16:h=Ti;break;case 536870912:h=un;break;default:h=Ti}h=Fh(h,gd.bind(null,n))}n.callbackPriority=o,n.callbackNode=h}}function gd(n,o){if(Zu=-1,$c=0,(nr&6)!==0)throw Error(Z(327));var h=n.callbackNode;if(Hs()&&n.callbackNode!==h)return null;var _=$i(n,n===wi?Oi:0);if(_===0)return null;if((_&30)!==0||(_&n.expiredLanes)!==0||o)o=Gu(n,_);else{o=_;var b=nr;nr|=2;var k=yd();(wi!==n||Oi!==o)&&(_o=null,Nr=kt()+500,dl(n,o));do try{Lh();break}catch(Q){_d(n,Q)}while(!0);pi(),Oc.current=k,nr=b,ui!==null?o=0:(wi=null,Oi=0,o=mi)}if(o!==0){if(o===2&&(b=Is(n),b!==0&&(_=b,o=Ah(n,b))),o===1)throw h=Vu,dl(n,0),qs(n,_),Ln(n,kt()),h;if(o===6)qs(n,_);else{if(b=n.current.alternate,(_&30)===0&&!jd(b)&&(o=Gu(n,_),o===2&&(k=Is(n),k!==0&&(_=k,o=Ah(n,k))),o===1))throw h=Vu,dl(n,0),qs(n,_),Ln(n,kt()),h;switch(n.finishedWork=b,n.finishedLanes=_,o){case 0:case 1:throw Error(Z(345));case 2:Gs(n,Dn,_o);break;case 3:if(qs(n,_),(_&130023424)===_&&(o=cl+500-kt(),10<o)){if($i(n,0)!==0)break;if(b=n.suspendedLanes,(b&_)!==_){yn(),n.pingedLanes|=n.suspendedLanes&b;break}n.timeoutHandle=Fl(Gs.bind(null,n,Dn,_o),o);break}Gs(n,Dn,_o);break;case 4:if(qs(n,_),(_&4194240)===_)break;for(o=n.eventTimes,b=-1;0<_;){var B=31-pr(_);k=1<<B,B=o[B],B>b&&(b=B),_&=~k}if(_=b,_=kt()-_,_=(120>_?120:480>_?480:1080>_?1080:1920>_?1920:3e3>_?3e3:4320>_?4320:1960*Vd(_/1960))-_,10<_){n.timeoutHandle=Fl(Gs.bind(null,n,Dn,_o),_);break}Gs(n,Dn,_o);break;case 5:Gs(n,Dn,_o);break;default:throw Error(Z(329))}}}return Ln(n,kt()),n.callbackNode===h?gd.bind(null,n):null}function Ah(n,o){var h=ju;return n.current.memoizedState.isDehydrated&&(dl(n,o).flags|=256),n=Gu(n,o),n!==2&&(o=Dn,Dn=h,o!==null&&Dh(o)),n}function Dh(n){Dn===null?Dn=n:Dn.push.apply(Dn,n)}function jd(n){for(var o=n;;){if(o.flags&16384){var h=o.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var _=0;_<h.length;_++){var b=h[_],k=b.getSnapshot;b=b.value;try{if(!qi(k(),b))return!1}catch{return!1}}}if(h=o.child,o.subtreeFlags&16384&&h!==null)h.return=o,o=h;else{if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function qs(n,o){for(o&=~jc,o&=~Vc,n.suspendedLanes|=o,n.pingedLanes&=~o,n=n.expirationTimes;0<o;){var h=31-pr(o),_=1<<h;n[h]=-1,o&=~_}}function hl(n){if((nr&6)!==0)throw Error(Z(327));Hs();var o=$i(n,0);if((o&1)===0)return Ln(n,kt()),null;var h=Gu(n,o);if(n.tag!==0&&h===2){var _=Is(n);_!==0&&(o=_,h=Ah(n,_))}if(h===1)throw h=Vu,dl(n,0),qs(n,o),Ln(n,kt()),h;if(h===6)throw Error(Z(345));return n.finishedWork=n.current.alternate,n.finishedLanes=o,Gs(n,Dn,_o),Ln(n,kt()),null}function Zc(n,o){var h=nr;nr|=1;try{return n(o)}finally{nr=h,nr===0&&(Nr=kt()+500,ft&&p())}}function $o(n){Uo!==null&&Uo.tag===0&&(nr&6)===0&&Hs();var o=nr;nr|=1;var h=An.transition,_=lr;try{if(An.transition=null,lr=1,n)return n()}finally{lr=_,An.transition=h,nr=o,(nr&6)===0&&p()}}function qu(){Yi=Hl.current,Tr(Hl)}function dl(n,o){n.finishedWork=null,n.finishedLanes=0;var h=n.timeoutHandle;if(h!==-1&&(n.timeoutHandle=-1,vc(h)),ui!==null)for(h=ui.return;h!==null;){var _=h;switch(N(_),_.tag){case 1:_=_.type.childContextTypes,_!=null&&rl();break;case 3:es(),Tr(Zt),Tr(gr),ya();break;case 5:Tu(_);break;case 4:es();break;case 13:Tr(Or);break;case 19:Tr(Or);break;case 10:pn(_.type._context);break;case 22:case 23:qu()}h=h.return}if(wi=n,ui=n=Pa(n.current,null),Oi=Yi=o,mi=0,Vu=null,jc=Vc=ul=0,Dn=ju=null,qr!==null){for(o=0;o<qr.length;o++)if(h=qr[o],_=h.interleaved,_!==null){h.interleaved=null;var b=_.next,k=h.pending;if(k!==null){var B=k.next;k.next=b,_.next=B}h.pending=_}qr=null}return n}function _d(n,o){do{var h=ui;try{if(pi(),go.current=kc,ku){for(var _=vr.memoizedState;_!==null;){var b=_.queue;b!==null&&(b.pending=null),_=_.next}ku=!1}if(xs=0,oi=Ur=vr=null,Vl=!1,Iu=0,Nc.current=null,h===null||h.return===null){mi=1,Vu=o,ui=null;break}e:{var k=n,B=h.return,Q=h,se=o;if(o=Oi,Q.flags|=32768,se!==null&&typeof se=="object"&&typeof se.then=="function"){var be=se,De=Q,Fe=De.tag;if((De.mode&1)===0&&(Fe===0||Fe===11||Fe===15)){var Ae=De.alternate;Ae?(De.updateQueue=Ae.updateQueue,De.memoizedState=Ae.memoizedState,De.lanes=Ae.lanes):(De.updateQueue=null,De.memoizedState=null)}var We=Kh(B);if(We!==null){We.flags&=-257,Jh(We,B,Q,k,o),We.mode&1&&Xh(k,be,o),o=We,se=be;var at=o.updateQueue;if(at===null){var pt=new Set;pt.add(se),o.updateQueue=pt}else at.add(se);break e}else{if((o&1)===0){Xh(k,be,o),qc();break e}se=Error(Z(426))}}else if(W&&Q.mode&1){var Qr=Kh(B);if(Qr!==null){(Qr.flags&65536)===0&&(Qr.flags|=256),Jh(Qr,B,Q,k,o),He(Ii(se,Q));break e}}k=se=Ii(se,Q),mi!==4&&(mi=2),ju===null?ju=[k]:ju.push(k),k=B;do{switch(k.tag){case 3:k.flags|=65536,o&=-o,k.lanes|=o;var ye=Sh(k,se,o);mn(k,ye);break e;case 1:Q=se;var le=k.type,xe=k.stateNode;if((k.flags&128)===0&&(typeof le.getDerivedStateFromError=="function"||xe!==null&&typeof xe.componentDidCatch=="function"&&(Wt===null||!Wt.has(xe)))){k.flags|=65536,o&=-o,k.lanes|=o;var $e=Wh(k,Q,o);mn(k,$e);break e}}k=k.return}while(k!==null)}Zo(h)}catch(mt){o=mt,ui===h&&h!==null&&(ui=h=h.return);continue}break}while(!0)}function yd(){var n=Oc.current;return Oc.current=kc,n===null?kc:n}function qc(){(mi===0||mi===3||mi===2)&&(mi=4),wi===null||(ul&268435455)===0&&(Vc&268435455)===0||qs(wi,Oi)}function Gu(n,o){var h=nr;nr|=2;var _=yd();(wi!==n||Oi!==o)&&(_o=null,dl(n,o));do try{vn();break}catch(b){_d(n,b)}while(!0);if(pi(),nr=h,Oc.current=_,ui!==null)throw Error(Z(261));return wi=null,Oi=0,mi}function vn(){for(;ui!==null;)Rh(ui)}function Lh(){for(;ui!==null&&!Ai();)Rh(ui)}function Rh(n){var o=bd(n.alternate,n,Yi);n.memoizedProps=n.pendingProps,o===null?Zo(n):ui=o,Nc.current=null}function Zo(n){var o=n;do{var h=o.alternate;if(n=o.return,(o.flags&32768)===0){if(h=Bd(h,o,Yi),h!==null){ui=h;return}}else{if(h=Od(h,o),h!==null){h.flags&=32767,ui=h;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{mi=6,ui=null;return}}if(o=o.sibling,o!==null){ui=o;return}ui=o=n}while(o!==null);mi===0&&(mi=5)}function Gs(n,o,h){var _=lr,b=An.transition;try{An.transition=null,lr=1,Hu(n,o,h,_)}finally{An.transition=b,lr=_}return null}function Hu(n,o,h,_){do Hs();while(Uo!==null);if((nr&6)!==0)throw Error(Z(327));h=n.finishedWork;var b=n.finishedLanes;if(h===null)return null;if(n.finishedWork=null,n.finishedLanes=0,h===n.current)throw Error(Z(177));n.callbackNode=null,n.callbackPriority=0;var k=h.lanes|h.childLanes;if(eu(n,k),n===wi&&(ui=wi=null,Oi=0),(h.subtreeFlags&2064)===0&&(h.flags&2064)===0||Wl||(Wl=!0,Fh(Ti,function(){return Hs(),null})),k=(h.flags&15990)!==0,(h.subtreeFlags&15990)!==0||k){k=An.transition,An.transition=null;var B=lr;lr=1;var Q=nr;nr|=4,Nc.current=null,Nd(n,h),cd(h,n),Ha(vu),Po=!!Os,vu=Os=null,n.current=h,hd(h),Ko(),nr=Q,lr=B,An.transition=k}else n.current=h;if(Wl&&(Wl=!1,Uo=n,$u=b),k=n.pendingLanes,k===0&&(Wt=null),To(h.stateNode),Ln(n,kt()),o!==null)for(_=n.onRecoverableError,h=0;h<o.length;h++)b=o[h],_(b.value,{componentStack:b.stack,digest:b.digest});if(Uu)throw Uu=!1,n=Uc,Uc=null,n;return($u&1)!==0&&n.tag!==0&&Hs(),k=n.pendingLanes,(k&1)!==0?n===Ea?os++:(os=0,Ea=n):os=0,p(),null}function Hs(){if(Uo!==null){var n=Ba($u),o=An.transition,h=lr;try{if(An.transition=null,lr=16>n?16:n,Uo===null)var _=!1;else{if(n=Uo,Uo=null,$u=0,(nr&6)!==0)throw Error(Z(331));var b=nr;for(nr|=4,ct=n.current;ct!==null;){var k=ct,B=k.child;if((ct.flags&16)!==0){var Q=k.deletions;if(Q!==null){for(var se=0;se<Q.length;se++){var be=Q[se];for(ct=be;ct!==null;){var De=ct;switch(De.tag){case 0:case 11:case 15:Bu(8,De,k)}var Fe=De.child;if(Fe!==null)Fe.return=De,ct=Fe;else for(;ct!==null;){De=ct;var Ae=De.sibling,We=De.return;if(od(De),De===be){ct=null;break}if(Ae!==null){Ae.return=We,ct=Ae;break}ct=We}}}var at=k.alternate;if(at!==null){var pt=at.child;if(pt!==null){at.child=null;do{var Qr=pt.sibling;pt.sibling=null,pt=Qr}while(pt!==null)}}ct=k}}if((k.subtreeFlags&2064)!==0&&B!==null)B.return=k,ct=B;else e:for(;ct!==null;){if(k=ct,(k.flags&2048)!==0)switch(k.tag){case 0:case 11:case 15:Bu(9,k,k.return)}var ye=k.sibling;if(ye!==null){ye.return=k.return,ct=ye;break e}ct=k.return}}var le=n.current;for(ct=le;ct!==null;){B=ct;var xe=B.child;if((B.subtreeFlags&2064)!==0&&xe!==null)xe.return=B,ct=xe;else e:for(B=le;ct!==null;){if(Q=ct,(Q.flags&2048)!==0)try{switch(Q.tag){case 0:case 11:case 15:Ou(9,Q)}}catch(mt){$r(Q,Q.return,mt)}if(Q===B){ct=null;break e}var $e=Q.sibling;if($e!==null){$e.return=Q.return,ct=$e;break e}ct=Q.return}}if(nr=b,p(),Di&&typeof Di.onPostCommitFiberRoot=="function")try{Di.onPostCommitFiberRoot(ki,n)}catch{}_=!0}return _}finally{lr=h,An.transition=o}}return!1}function Wu(n,o,h){o=Ii(h,o),o=Sh(n,o,1),n=vs(n,o,1),o=yn(),n!==null&&(Eo(n,1,o),Ln(n,o))}function $r(n,o,h){if(n.tag===3)Wu(n,n,h);else for(;o!==null;){if(o.tag===3){Wu(o,n,h);break}else if(o.tag===1){var _=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(Wt===null||!Wt.has(_))){n=Ii(h,n),n=Wh(o,n,1),o=vs(o,n,1),n=yn(),o!==null&&(Eo(o,1,n),Ln(o,n));break}}o=o.return}}function Ud(n,o,h){var _=n.pingCache;_!==null&&_.delete(o),o=yn(),n.pingedLanes|=n.suspendedLanes&h,wi===n&&(Oi&h)===h&&(mi===4||mi===3&&(Oi&130023424)===Oi&&500>kt()-cl?dl(n,0):jc|=h),Ln(n,o)}function vd(n,o){o===0&&((n.mode&1)===0?o=1:(o=Ui,Ui<<=1,(Ui&130023424)===0&&(Ui=4194304)));var h=yn();n=Wi(n,o),n!==null&&(Eo(n,o,h),Ln(n,h))}function xd(n){var o=n.memoizedState,h=0;o!==null&&(h=o.retryLane),vd(n,h)}function wd(n,o){var h=0;switch(n.tag){case 13:var _=n.stateNode,b=n.memoizedState;b!==null&&(h=b.retryLane);break;case 19:_=n.stateNode;break;default:throw Error(Z(314))}_!==null&&_.delete(o),vd(n,h)}var bd;bd=function(n,o,h){if(n!==null)if(n.memoizedProps!==o.pendingProps||Zt.current)_n=!0;else{if((n.lanes&h)===0&&(o.flags&128)===0)return _n=!1,Ch(n,o,h);_n=(n.flags&131072)!==0}else _n=!1,W&&(o.flags&1048576)!==0&&M(o,u,o.index);switch(o.lanes=0,o.tag){case 2:var _=o.type;Ru(n,o),n=o.pendingProps;var b=Vs(o,gr.current);si(o,h),b=js(null,o,_,n,b,h);var k=rs();return o.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,yi(_)?(k=!0,dn(o)):k=!1,o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,fo(o),b.updater=Cc,o.stateNode=b,b._reactInternals=o,ol(o,_,n,h),o=kh(null,o,_,!0,k,h)):(o.tag=0,W&&k&&F(o),ai(null,o,b,h),o=o.child),o;case 16:_=o.elementType;e:{switch(Ru(n,o),n=o.pendingProps,b=_._init,_=b(_._payload),o.type=_,b=o.tag=$d(_),n=ws(_,n),b){case 0:o=Th(null,o,_,n,h);break e;case 1:o=id(null,o,_,n,h);break e;case 11:o=Zl(null,o,_,n,h);break e;case 14:o=Qh(null,o,_,ws(_.type,n),h);break e}throw Error(Z(306,_,""))}return o;case 0:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:ws(_,b),Th(n,o,_,b,h);case 1:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:ws(_,b),id(n,o,_,b,h);case 3:e:{if(Ac(o),n===null)throw Error(Z(387));_=o.pendingProps,k=o.memoizedState,b=k.element,fn(n,o),Qn(o,_,null,h);var B=o.memoizedState;if(_=B.element,k.isDehydrated)if(k={element:_,isDehydrated:!1,cache:B.cache,pendingSuspenseBoundaries:B.pendingSuspenseBoundaries,transitions:B.transitions},o.updateQueue.baseState=k,o.memoizedState=k,o.flags&256){b=Ii(Error(Z(423)),o),o=nd(n,o,_,h,b);break e}else if(_!==b){b=Ii(Error(Z(424)),o),o=nd(n,o,_,h,b);break e}else for($=Wn(o.stateNode.containerInfo.firstChild),U=o,W=!0,J=null,h=wt(o,null,_,h),o.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Ne(),_===b){o=ns(n,o,h);break e}ai(n,o,_,h)}o=o.child}return o;case 5:return Su(o),n===null&&ue(o),_=o.type,b=o.pendingProps,k=n!==null?n.memoizedProps:null,B=b.children,xu(_,b)?B=null:k!==null&&xu(_,k)&&(o.flags|=32),rd(n,o),ai(n,o,B,h),o.child;case 6:return n===null&&ue(o),null;case 13:return Gr(n,o,h);case 4:return mo(o,o.stateNode.containerInfo),_=o.pendingProps,n===null?o.child=Ze(o,null,_,h):ai(n,o,_,h),o.child;case 11:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:ws(_,b),Zl(n,o,_,b,h);case 7:return ai(n,o,o.pendingProps,h),o.child;case 8:return ai(n,o,o.pendingProps.children,h),o.child;case 12:return ai(n,o,o.pendingProps.children,h),o.child;case 10:e:{if(_=o.type._context,b=o.pendingProps,k=o.memoizedProps,B=b.value,Er(fr,_._currentValue),_._currentValue=B,k!==null)if(qi(k.value,B)){if(k.children===b.children&&!Zt.current){o=ns(n,o,h);break e}}else for(k=o.child,k!==null&&(k.return=o);k!==null;){var Q=k.dependencies;if(Q!==null){B=k.child;for(var se=Q.firstContext;se!==null;){if(se.context===_){if(k.tag===1){se=Pn(-1,h&-h),se.tag=2;var be=k.updateQueue;if(be!==null){be=be.shared;var De=be.pending;De===null?se.next=se:(se.next=De.next,De.next=se),be.pending=se}}k.lanes|=h,se=k.alternate,se!==null&&(se.lanes|=h),yr(k.return,h,o),Q.lanes|=h;break}se=se.next}}else if(k.tag===10)B=k.type===o.type?null:k.child;else if(k.tag===18){if(B=k.return,B===null)throw Error(Z(341));B.lanes|=h,Q=B.alternate,Q!==null&&(Q.lanes|=h),yr(B,h,o),B=k.sibling}else B=k.child;if(B!==null)B.return=k;else for(B=k;B!==null;){if(B===o){B=null;break}if(k=B.sibling,k!==null){k.return=B.return,B=k;break}B=B.return}k=B}ai(n,o,b.children,h),o=o.child}return o;case 9:return b=o.type,_=o.pendingProps.children,si(o,h),b=Cr(b),_=_(b),o.flags|=1,ai(n,o,_,h),o.child;case 14:return _=o.type,b=ws(_,o.pendingProps),b=ws(_.type,b),Qh(n,o,_,b,h);case 15:return ed(n,o,o.type,o.pendingProps,h);case 17:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:ws(_,b),Ru(n,o),o.tag=1,yi(_)?(n=!0,dn(o)):n=!1,si(o,h),bh(o,_,b),ol(o,_,b,h),kh(null,o,_,!0,n,h);case 19:return Eh(n,o,h);case 22:return td(n,o,h)}throw Error(Z(156,o.tag))};function Fh(n,o){return ni(n,o)}function Sd(n,o,h,_){this.tag=n,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rn(n,o,h,_){return new Sd(n,o,h,_)}function Xu(n){return n=n.prototype,!(!n||!n.isReactComponent)}function $d(n){if(typeof n=="function")return Xu(n)?1:0;if(n!=null){if(n=n.$$typeof,n===sn)return 11;if(n===ci)return 14}return 2}function Pa(n,o){var h=n.alternate;return h===null?(h=Rn(n.tag,o,n.key,n.mode),h.elementType=n.elementType,h.type=n.type,h.stateNode=n.stateNode,h.alternate=n,n.alternate=h):(h.pendingProps=o,h.type=n.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=n.flags&14680064,h.childLanes=n.childLanes,h.lanes=n.lanes,h.child=n.child,h.memoizedProps=n.memoizedProps,h.memoizedState=n.memoizedState,h.updateQueue=n.updateQueue,o=n.dependencies,h.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},h.sibling=n.sibling,h.index=n.index,h.ref=n.ref,h}function Ku(n,o,h,_,b,k){var B=2;if(_=n,typeof n=="function")Xu(n)&&(B=1);else if(typeof n=="string")B=5;else e:switch(n){case zr:return Ma(h.children,b,k,o);case Mi:B=8,b|=8;break;case gi:return n=Rn(12,h,o,b|2),n.elementType=gi,n.lanes=k,n;case mr:return n=Rn(13,h,o,b),n.elementType=mr,n.lanes=k,n;case Ar:return n=Rn(19,h,o,b),n.elementType=Ar,n.lanes=k,n;case or:return za(h,b,k,o);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case nn:B=10;break e;case Kt:B=9;break e;case sn:B=11;break e;case ci:B=14;break e;case ti:B=16,_=null;break e}throw Error(Z(130,n==null?n:typeof n,""))}return o=Rn(B,h,o,b),o.elementType=n,o.type=_,o.lanes=k,o}function Ma(n,o,h,_){return n=Rn(7,n,_,o),n.lanes=h,n}function za(n,o,h,_){return n=Rn(22,n,_,o),n.elementType=or,n.lanes=h,n.stateNode={isHidden:!1},n}function bs(n,o,h){return n=Rn(6,n,null,o),n.lanes=h,n}function yo(n,o,h){return o=Rn(4,n.children!==null?n.children:[],n.key,o),o.lanes=h,o.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},o}function Td(n,o,h,_,b){this.tag=o,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=er(0),this.expirationTimes=er(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=er(0),this.identifierPrefix=_,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function Ju(n,o,h,_,b,k,B,Q,se){return n=new Td(n,o,h,Q,se),o===1?(o=1,k===!0&&(o|=8)):o=0,k=Rn(3,null,null,o),n.current=k,k.stateNode=n,k.memoizedState={element:_,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},fo(k),n}function Zd(n,o,h){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fr,key:_==null?null:""+_,children:n,containerInfo:o,implementation:h}}function kd(n){if(!n)return po;n=n._reactInternals;e:{if(Mt(n)!==n||n.tag!==1)throw Error(Z(170));var o=n;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(yi(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(Z(171))}if(n.tag===1){var h=n.type;if(yi(h))return ma(n,h,o)}return o}function Yu(n,o,h,_,b,k,B,Q,se){return n=Ju(h,_,!0,n,b,k,B,Q,se),n.context=kd(null),h=n.current,_=yn(),b=Ca(h),k=Pn(_,b),k.callback=o??null,vs(h,k,b),n.current.lanes=b,Eo(n,b,_),Ln(n,_),n}function Xl(n,o,h,_){var b=o.current,k=yn(),B=Ca(b);return h=kd(h),o.context===null?o.context=h:o.pendingContext=h,o=Pn(k,B),o.payload={element:n},_=_===void 0?null:_,_!==null&&(o.callback=_),n=vs(b,o,B),n!==null&&(Zs(n,b,B,k),Fi(n,b,B)),B}function Gc(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Hc(n,o){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var h=n.retryLane;n.retryLane=h!==0&&h<o?h:o}}function Qu(n,o){Hc(n,o),(n=n.alternate)&&Hc(n,o)}function Kl(){return null}var Bh=typeof reportError=="function"?reportError:function(n){console.error(n)};function Wc(n){this._internalRoot=n}Jl.prototype.render=Wc.prototype.render=function(n){var o=this._internalRoot;if(o===null)throw Error(Z(409));Xl(n,o,null,null)},Jl.prototype.unmount=Wc.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var o=n.containerInfo;$o(function(){Xl(null,n,null,null)}),o[Xn]=null}};function Jl(n){this._internalRoot=n}Jl.prototype.unstable_scheduleHydration=function(n){if(n){var o=tu();n={blockedOn:null,target:n,priority:o};for(var h=0;h<Zn.length&&o!==0&&o<Zn[h].priority;h++);Zn.splice(h,0,n),h===0&&iu(n)}};function Xc(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function pl(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Oh(){}function qd(n,o,h,_,b){if(b){if(typeof _=="function"){var k=_;_=function(){var be=Gc(B);k.call(be)}}var B=Yu(o,_,n,0,null,!1,!1,"",Oh);return n._reactRootContainer=B,n[Xn]=B.current,Fs(n.nodeType===8?n.parentNode:n),$o(),B}for(;b=n.lastChild;)n.removeChild(b);if(typeof _=="function"){var Q=_;_=function(){var be=Gc(se);Q.call(be)}}var se=Ju(n,0,!1,null,null,!1,!1,"",Oh);return n._reactRootContainer=se,n[Xn]=se.current,Fs(n.nodeType===8?n.parentNode:n),$o(function(){Xl(o,se,h,_)}),se}function Kc(n,o,h,_,b){var k=h._reactRootContainer;if(k){var B=k;if(typeof b=="function"){var Q=b;b=function(){var se=Gc(B);Q.call(se)}}Xl(o,B,n,b)}else B=qd(h,o,n,b,_);return Gc(B)}Jo=function(n){switch(n.tag){case 3:var o=n.stateNode;if(o.current.memoizedState.isDehydrated){var h=Io(o.pendingLanes);h!==0&&(eo(o,h|1),Ln(o,kt()),(nr&6)===0&&(Nr=kt()+500,p()))}break;case 13:$o(function(){var _=Wi(n,1);if(_!==null){var b=yn();Zs(_,n,1,b)}}),Qu(n,1)}},Yo=function(n){if(n.tag===13){var o=Wi(n,134217728);if(o!==null){var h=yn();Zs(o,n,134217728,h)}Qu(n,134217728)}},Co=function(n){if(n.tag===13){var o=Ca(n),h=Wi(n,o);if(h!==null){var _=yn();Zs(h,n,o,_)}Qu(n,o)}},tu=function(){return lr},nc=function(n,o){var h=lr;try{return lr=n,o()}finally{lr=h}},Un=function(n,o,h){switch(o){case"input":if(ks(n,h),o=h.name,h.type==="radio"&&o!=null){for(h=n;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<h.length;o++){var _=h[o];if(_!==n&&_.form===n.form){var b=el(_);if(!b)throw Error(Z(90));ls(_),ks(_,b)}}}break;case"textarea":bo(n,h);break;case"select":o=h.value,o!=null&&cs(n,!!h.multiple,o,!1)}},V=Zc,H=$o;var Id={usingClientEntryPoint:!1,Events:[Qa,Kn,el,L,D,Zc]},ec={findFiberByHostInstance:Ns,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Gd={bundleType:ec.bundleType,version:ec.version,rendererPackageName:ec.rendererPackageName,rendererConfig:ec.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:tr.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=ar(n),n===null?null:n.stateNode},findFiberByHostInstance:ec.findFiberByHostInstance||Kl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Jc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Jc.isDisabled&&Jc.supportsFiber)try{ki=Jc.inject(Gd),Di=Jc}catch{}}return Ts.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Id,Ts.createPortal=function(n,o){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Xc(o))throw Error(Z(200));return Zd(n,o,null,h)},Ts.createRoot=function(n,o){if(!Xc(n))throw Error(Z(299));var h=!1,_="",b=Bh;return o!=null&&(o.unstable_strictMode===!0&&(h=!0),o.identifierPrefix!==void 0&&(_=o.identifierPrefix),o.onRecoverableError!==void 0&&(b=o.onRecoverableError)),o=Ju(n,1,!1,null,null,h,!1,_,b),n[Xn]=o.current,Fs(n.nodeType===8?n.parentNode:n),new Wc(o)},Ts.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var o=n._reactInternals;if(o===void 0)throw typeof n.render=="function"?Error(Z(188)):(n=Object.keys(n).join(","),Error(Z(268,n)));return n=ar(o),n=n===null?null:n.stateNode,n},Ts.flushSync=function(n){return $o(n)},Ts.hydrate=function(n,o,h){if(!pl(o))throw Error(Z(200));return Kc(null,n,o,!0,h)},Ts.hydrateRoot=function(n,o,h){if(!Xc(n))throw Error(Z(405));var _=h!=null&&h.hydratedSources||null,b=!1,k="",B=Bh;if(h!=null&&(h.unstable_strictMode===!0&&(b=!0),h.identifierPrefix!==void 0&&(k=h.identifierPrefix),h.onRecoverableError!==void 0&&(B=h.onRecoverableError)),o=Yu(o,null,n,1,h??null,b,!1,k,B),n[Xn]=o.current,Fs(n),_)for(n=0;n<_.length;n++)h=_[n],b=h._getVersion,b=b(h._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[h,b]:o.mutableSourceEagerHydrationData.push(h,b);return new Jl(o)},Ts.render=function(n,o,h){if(!pl(o))throw Error(Z(200));return Kc(null,n,o,!1,h)},Ts.unmountComponentAtNode=function(n){if(!pl(n))throw Error(Z(40));return n._reactRootContainer?($o(function(){Kc(null,null,n,!1,function(){n._reactRootContainer=null,n[Xn]=null})}),!0):!1},Ts.unstable_batchedUpdates=Zc,Ts.unstable_renderSubtreeIntoContainer=function(n,o,h,_){if(!pl(h))throw Error(Z(200));if(n==null||n._reactInternals===void 0)throw Error(Z(38));return Kc(n,o,h,!1,_)},Ts.version="18.3.1-next-f1338f8080-20240426",Ts}var Mp;function mf(){if(Mp)return op.exports;Mp=1;function G(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(G)}catch(Y){console.error(Y)}}return G(),op.exports=ff(),op.exports}const gf="modulepreload",_f=function(G,Y){return new URL(G,Y).href},zp={},Wf=function(Y,Z,pe){let me=Promise.resolve();if(Z&&Z.length>0){let A=function(st){return Promise.all(st.map(ke=>Promise.resolve(ke).then(ge=>({status:"fulfilled",value:ge}),ge=>({status:"rejected",reason:ge}))))};const g=document.getElementsByTagName("link"),qe=document.querySelector("meta[property=csp-nonce]"),Ke=(qe==null?void 0:qe.nonce)||(qe==null?void 0:qe.getAttribute("nonce"));me=A(Z.map(st=>{if(st=_f(st,pe),st in zp)return;zp[st]=!0;const ke=st.endsWith(".css"),ge=ke?'[rel="stylesheet"]':"";if(!!pe)for(let Rt=g.length-1;Rt>=0;Rt--){const Nt=g[Rt];if(Nt.href===st&&(!ke||Nt.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${st}"]${ge}`))return;const Ot=document.createElement("link");if(Ot.rel=ke?"stylesheet":gf,ke||(Ot.as="script"),Ot.crossOrigin="",Ot.href=st,Ke&&Ot.setAttribute("nonce",Ke),document.head.appendChild(Ot),ke)return new Promise((Rt,Nt)=>{Ot.addEventListener("load",Rt),Ot.addEventListener("error",()=>Nt(new Error(`Unable to preload CSS for ${st}`)))})}))}function Ie(A){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=A,window.dispatchEvent(g),!g.defaultPrevented)throw A}return me.then(A=>{for(const g of A||[])g.status==="rejected"&&Ie(g.reason);return Y().catch(Ie)})},yf=gt.createContext(null);function vf(G,Y){const Z=Array.isArray(G)?G[0]:G?G.x:0,pe=Array.isArray(G)?G[1]:G?G.y:0,me=Array.isArray(Y)?Y[0]:Y?Y.x:0,Ie=Array.isArray(Y)?Y[1]:Y?Y.y:0;return Z===me&&pe===Ie}function Js(G,Y){if(G===Y)return!0;if(!G||!Y)return!1;if(Array.isArray(G)){if(!Array.isArray(Y)||G.length!==Y.length)return!1;for(let Z=0;Z<G.length;Z++)if(!Js(G[Z],Y[Z]))return!1;return!0}else if(Array.isArray(Y))return!1;if(typeof G=="object"&&typeof Y=="object"){const Z=Object.keys(G),pe=Object.keys(Y);if(Z.length!==pe.length)return!1;for(const me of Z)if(!Y.hasOwnProperty(me)||!Js(G[me],Y[me]))return!1;return!0}return!1}function xf(G){const Y=G.clone();return Y.pixelsToGLUnits=G.pixelsToGLUnits,Y}function Ap(G,Y){if(!G.getProjection)return;const Z=G.getProjection(),pe=Y.getProjection();Js(Z,pe)||Y.setProjection(Z)}function Dp(G){return{longitude:G.center.lng,latitude:G.center.lat,zoom:G.zoom,pitch:G.pitch,bearing:G.bearing,padding:G.padding}}function Lp(G,Y){const Z=Y.viewState||Y;let pe=!1;if("zoom"in Z){const me=G.zoom;G.zoom=Z.zoom,pe=pe||me!==G.zoom}if("bearing"in Z){const me=G.bearing;G.bearing=Z.bearing,pe=pe||me!==G.bearing}if("pitch"in Z){const me=G.pitch;G.pitch=Z.pitch,pe=pe||me!==G.pitch}if(Z.padding&&!G.isPaddingEqual(Z.padding)&&(pe=!0,G.padding=Z.padding),"longitude"in Z&&"latitude"in Z){const me=G.center;G.center=new me.constructor(Z.longitude,Z.latitude),pe=pe||me!==G.center}return pe}const wf=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Rp(G){if(!G)return null;if(typeof G=="string"||("toJS"in G&&(G=G.toJS()),!G.layers))return G;const Y={};for(const pe of G.layers)Y[pe.id]=pe;const Z=G.layers.map(pe=>{let me=null;"interactive"in pe&&(me=Object.assign({},pe),delete me.interactive);const Ie=Y[pe.ref];if(Ie){me=me||Object.assign({},pe),delete me.ref;for(const A of wf)A in Ie&&(me[A]=Ie[A])}return me||pe});return{...G,layers:Z}}var Fp={};const Bp={version:8,sources:{},layers:[]},Op={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},up={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Np={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},bf=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Sf=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class th{constructor(Y,Z,pe){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=me=>{const Ie=this.props[Np[me.type]];Ie?Ie(me):me.type==="error"&&console.error(me.error)},this._onPointerEvent=me=>{(me.type==="mousemove"||me.type==="mouseout")&&this._updateHover(me);const Ie=this.props[Op[me.type]];Ie&&(this.props.interactiveLayerIds&&me.type!=="mouseover"&&me.type!=="mouseout"&&(me.features=this._hoveredFeatures||this._queryRenderedFeatures(me.point)),Ie(me),delete me.features)},this._onCameraEvent=me=>{if(!this._internalUpdate){const Ie=this.props[up[me.type]];Ie&&Ie(me)}me.type in this._deferredEvents&&(this._deferredEvents[me.type]=!1)},this._MapClass=Y,this.props=Z,this._initialize(pe)}get map(){return this._map}get transform(){return this._renderTransform}setProps(Y){const Z=this.props;this.props=Y;const pe=this._updateSettings(Y,Z);pe&&this._createShadowTransform(this._map);const me=this._updateSize(Y),Ie=this._updateViewState(Y,!0);this._updateStyle(Y,Z),this._updateStyleComponents(Y,Z),this._updateHandlers(Y,Z),(pe||me||Ie&&!this._map.isMoving())&&this.redraw()}static reuse(Y,Z){const pe=th.savedMaps.pop();if(!pe)return null;const me=pe.map,Ie=me.getContainer();for(Z.className=Ie.className;Ie.childNodes.length>0;)Z.appendChild(Ie.childNodes[0]);me._container=Z;const A=me._resizeObserver;A&&(A.disconnect(),A.observe(Z)),pe.setProps({...Y,styleDiffing:!1}),me.resize();const{initialViewState:g}=Y;return g&&(g.bounds?me.fitBounds(g.bounds,{...g.fitBoundsOptions,duration:0}):pe._updateViewState(g,!1)),me.isStyleLoaded()?me.fire("load"):me.once("styledata",()=>me.fire("load")),me._update(),pe}_initialize(Y){const{props:Z}=this,{mapStyle:pe=Bp}=Z,me={...Z,...Z.initialViewState,accessToken:Z.mapboxAccessToken||Tf()||null,container:Y,style:Rp(pe)},Ie=me.initialViewState||me.viewState||me;if(Object.assign(me,{center:[Ie.longitude||0,Ie.latitude||0],zoom:Ie.zoom||0,pitch:Ie.pitch||0,bearing:Ie.bearing||0}),Z.gl){const st=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=st,Z.gl)}const A=new this._MapClass(me);Ie.padding&&A.setPadding(Ie.padding),Z.cursor&&(A.getCanvas().style.cursor=Z.cursor),this._createShadowTransform(A);const g=A._render;A._render=st=>{this._inRender=!0,g.call(A,st),this._inRender=!1};const qe=A._renderTaskQueue.run;A._renderTaskQueue.run=st=>{qe.call(A._renderTaskQueue,st),this._onBeforeRepaint()},A.on("render",()=>this._onAfterRepaint());const Ke=A.fire;A.fire=this._fireEvent.bind(this,Ke),A.on("resize",()=>{this._renderTransform.resize(A.transform.width,A.transform.height)}),A.on("styledata",()=>{this._updateStyleComponents(this.props,{}),Ap(A.transform,this._renderTransform)}),A.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const st in Op)A.on(st,this._onPointerEvent);for(const st in up)A.on(st,this._onCameraEvent);for(const st in Np)A.on(st,this._onEvent);this._map=A}recycle(){const Z=this.map.getContainer().querySelector("[mapboxgl-children]");Z==null||Z.remove(),th.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const Y=this._map;!this._inRender&&Y.style&&(Y._frame&&(Y._frame.cancel(),Y._frame=null),Y._render())}_createShadowTransform(Y){const Z=xf(Y.transform);Y.painter.transform=Z,this._renderTransform=Z}_updateSize(Y){const{viewState:Z}=Y;if(Z){const pe=this._map;if(Z.width!==pe.transform.width||Z.height!==pe.transform.height)return pe.resize(),!0}return!1}_updateViewState(Y,Z){if(this._internalUpdate)return!1;const pe=this._map,me=this._renderTransform,{zoom:Ie,pitch:A,bearing:g}=me,qe=pe.isMoving();qe&&(me.cameraElevationReference="sea");const Ke=Lp(me,{...Dp(pe.transform),...Y});if(qe&&(me.cameraElevationReference="ground"),Ke&&Z){const st=this._deferredEvents;st.move=!0,st.zoom||(st.zoom=Ie!==me.zoom),st.rotate||(st.rotate=g!==me.bearing),st.pitch||(st.pitch=A!==me.pitch)}return qe||Lp(pe.transform,Y),Ke}_updateSettings(Y,Z){const pe=this._map;let me=!1;for(const Ie of bf)if(Ie in Y&&!Js(Y[Ie],Z[Ie])){me=!0;const A=pe[`set${Ie[0].toUpperCase()}${Ie.slice(1)}`];A==null||A.call(pe,Y[Ie])}return me}_updateStyle(Y,Z){if(Y.cursor!==Z.cursor&&(this._map.getCanvas().style.cursor=Y.cursor||""),Y.mapStyle!==Z.mapStyle){const{mapStyle:pe=Bp,styleDiffing:me=!0}=Y,Ie={diff:me};return"localIdeographFontFamily"in Y&&(Ie.localIdeographFontFamily=Y.localIdeographFontFamily),this._map.setStyle(Rp(pe),Ie),!0}return!1}_updateStyleComponents(Y,Z){const pe=this._map;let me=!1;return pe.isStyleLoaded()&&("light"in Y&&pe.setLight&&!Js(Y.light,Z.light)&&(me=!0,pe.setLight(Y.light)),"fog"in Y&&pe.setFog&&!Js(Y.fog,Z.fog)&&(me=!0,pe.setFog(Y.fog)),"terrain"in Y&&pe.setTerrain&&!Js(Y.terrain,Z.terrain)&&(!Y.terrain||pe.getSource(Y.terrain.source))&&(me=!0,pe.setTerrain(Y.terrain))),me}_updateHandlers(Y,Z){var pe,me;const Ie=this._map;let A=!1;for(const g of Sf){const qe=(pe=Y[g])!==null&&pe!==void 0?pe:!0,Ke=(me=Z[g])!==null&&me!==void 0?me:!0;Js(qe,Ke)||(A=!0,qe?Ie[g].enable(qe):Ie[g].disable())}return A}_queryRenderedFeatures(Y){const Z=this._map,pe=Z.transform,{interactiveLayerIds:me=[]}=this.props;try{return Z.transform=this._renderTransform,Z.queryRenderedFeatures(Y,{layers:me.filter(Z.getLayer.bind(Z))})}catch{return[]}finally{Z.transform=pe}}_updateHover(Y){var Z;const{props:pe}=this;if(pe.interactiveLayerIds&&(pe.onMouseMove||pe.onMouseEnter||pe.onMouseLeave)){const Ie=Y.type,A=((Z=this._hoveredFeatures)===null||Z===void 0?void 0:Z.length)>0,g=this._queryRenderedFeatures(Y.point),qe=g.length>0;!qe&&A&&(Y.type="mouseleave",this._onPointerEvent(Y)),this._hoveredFeatures=g,qe&&!A&&(Y.type="mouseenter",this._onPointerEvent(Y)),Y.type=Ie}else this._hoveredFeatures=null}_fireEvent(Y,Z,pe){const me=this._map,Ie=me.transform,A=typeof Z=="string"?Z:Z.type;return A==="move"&&this._updateViewState(this.props,!1),A in up&&(typeof Z=="object"&&(Z.viewState=Dp(Ie)),this._map.isMoving())?(me.transform=this._renderTransform,Y.call(me,Z,pe),me.transform=Ie,me):(Y.call(me,Z,pe),me)}_onBeforeRepaint(){const Y=this._map;this._internalUpdate=!0;for(const pe in this._deferredEvents)this._deferredEvents[pe]&&Y.fire(pe);this._internalUpdate=!1;const Z=this._map.transform;Y.transform=this._renderTransform,this._onAfterRepaint=()=>{Ap(this._renderTransform,Z),Y.transform=Z}}}th.savedMaps=[];function Tf(){let G=null;if(typeof location<"u"){const Y=/access_token=([^&\/]*)/.exec(location.search);G=Y&&Y[1]}try{G=G||Fp.MapboxAccessToken}catch{}try{G=G||Fp.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return G}const kf=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function If(G){if(!G)return null;const Y=G.map,Z={getMap:()=>Y,getCenter:()=>G.transform.center,getZoom:()=>G.transform.zoom,getBearing:()=>G.transform.bearing,getPitch:()=>G.transform.pitch,getPadding:()=>G.transform.padding,getBounds:()=>G.transform.getBounds(),project:pe=>{const me=Y.transform;Y.transform=G.transform;const Ie=Y.project(pe);return Y.transform=me,Ie},unproject:pe=>{const me=Y.transform;Y.transform=G.transform;const Ie=Y.unproject(pe);return Y.transform=me,Ie},queryTerrainElevation:(pe,me)=>{const Ie=Y.transform;Y.transform=G.transform;const A=Y.queryTerrainElevation(pe,me);return Y.transform=Ie,A},queryRenderedFeatures:(pe,me)=>{const Ie=Y.transform;Y.transform=G.transform;const A=Y.queryRenderedFeatures(pe,me);return Y.transform=Ie,A}};for(const pe of Ef(Y))!(pe in Z)&&!kf.includes(pe)&&(Z[pe]=Y[pe].bind(Y));return Z}function Ef(G){const Y=new Set;let Z=G;for(;Z;){for(const pe of Object.getOwnPropertyNames(Z))pe[0]!=="_"&&typeof G[pe]=="function"&&pe!=="fire"&&pe!=="setEventedParent"&&Y.add(pe);Z=Object.getPrototypeOf(Z)}return Array.from(Y)}const Cf=typeof document<"u"?gt.useLayoutEffect:gt.useEffect,Pf=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Mf(G,Y){for(const pe of Pf)pe in Y&&(G[pe]=Y[pe]);const{RTLTextPlugin:Z="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=Y;Z&&G.getRTLTextPluginStatus&&G.getRTLTextPluginStatus()==="unavailable"&&G.setRTLTextPlugin(Z,pe=>{pe&&console.error(pe)},!0)}const rh=gt.createContext(null);function Xf(G,Y,Z){const pe=gt.useContext(yf),[me,Ie]=gt.useState(null),A=gt.useRef(),{current:g}=gt.useRef({mapLib:null,map:null});gt.useEffect(()=>{const st=G.mapLib;let ke=!0,ge;return Promise.resolve(st||Z).then(xr=>{if(!ke)return;if(!xr)throw new Error("Invalid mapLib");const Ot="Map"in xr?xr:xr.default;if(!Ot.Map)throw new Error("Invalid mapLib");if(Mf(Ot,G),!Ot.supported||Ot.supported(G))G.reuseMaps&&(ge=th.reuse(G,A.current)),ge||(ge=new th(Ot.Map,G,A.current)),g.map=If(ge),g.mapLib=Ot,Ie(ge),pe==null||pe.onMapMount(g.map,G.id);else throw new Error("Map is not supported by this browser")}).catch(xr=>{const{onError:Ot}=G;Ot?Ot({type:"error",target:null,originalEvent:null,error:xr}):console.error(xr)}),()=>{ke=!1,ge&&(pe==null||pe.onMapUnmount(G.id),G.reuseMaps?ge.recycle():ge.destroy())}},[]),Cf(()=>{me&&me.setProps(G)}),gt.useImperativeHandle(Y,()=>g.map,[me]);const qe=gt.useMemo(()=>({position:"relative",width:"100%",height:"100%",...G.style}),[G.style]),Ke={height:"100%"};return gt.createElement("div",{id:G.id,ref:A,style:qe},me&&gt.createElement(rh.Provider,{value:g},gt.createElement("div",{"mapboxgl-children":"",style:Ke},G.children)))}var $p=mf();const zf=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function ic(G,Y){if(!G||!Y)return;const Z=G.style;for(const pe in Y){const me=Y[pe];Number.isFinite(me)&&!zf.test(pe)?Z[pe]=`${me}px`:Z[pe]=me}}function Af(G,Y){const{map:Z,mapLib:pe}=gt.useContext(rh),me=gt.useRef({props:G});me.current.props=G;const Ie=gt.useMemo(()=>{let Rt=!1;gt.Children.forEach(G.children,Rr=>{Rr&&(Rt=!0)});const Nt={...G,element:Rt?document.createElement("div"):null},Mr=new pe.Marker(Nt);return Mr.setLngLat([G.longitude,G.latitude]),Mr.getElement().addEventListener("click",Rr=>{var Xt,tr;(tr=(Xt=me.current.props).onClick)===null||tr===void 0||tr.call(Xt,{type:"click",target:Mr,originalEvent:Rr})}),Mr.on("dragstart",Rr=>{var Xt,tr;const hr=Rr;hr.lngLat=Ie.getLngLat(),(tr=(Xt=me.current.props).onDragStart)===null||tr===void 0||tr.call(Xt,hr)}),Mr.on("drag",Rr=>{var Xt,tr;const hr=Rr;hr.lngLat=Ie.getLngLat(),(tr=(Xt=me.current.props).onDrag)===null||tr===void 0||tr.call(Xt,hr)}),Mr.on("dragend",Rr=>{var Xt,tr;const hr=Rr;hr.lngLat=Ie.getLngLat(),(tr=(Xt=me.current.props).onDragEnd)===null||tr===void 0||tr.call(Xt,hr)}),Mr},[]);gt.useEffect(()=>(Ie.addTo(Z.getMap()),()=>{Ie.remove()}),[]);const{longitude:A,latitude:g,offset:qe,style:Ke,draggable:st=!1,popup:ke=null,rotation:ge=0,rotationAlignment:xr="auto",pitchAlignment:Ot="auto"}=G;return gt.useEffect(()=>{ic(Ie.getElement(),Ke)},[Ke]),gt.useImperativeHandle(Y,()=>Ie,[]),(Ie.getLngLat().lng!==A||Ie.getLngLat().lat!==g)&&Ie.setLngLat([A,g]),qe&&!vf(Ie.getOffset(),qe)&&Ie.setOffset(qe),Ie.isDraggable()!==st&&Ie.setDraggable(st),Ie.getRotation()!==ge&&Ie.setRotation(ge),Ie.getRotationAlignment()!==xr&&Ie.setRotationAlignment(xr),Ie.getPitchAlignment()!==Ot&&Ie.setPitchAlignment(Ot),Ie.getPopup()!==ke&&Ie.setPopup(ke),$p.createPortal(G.children,Ie.getElement())}gt.memo(gt.forwardRef(Af));function Vp(G){return new Set(G?G.trim().split(/\s+/):[])}function Df(G,Y){const{map:Z,mapLib:pe}=gt.useContext(rh),me=gt.useMemo(()=>document.createElement("div"),[]),Ie=gt.useRef({props:G});Ie.current.props=G;const A=gt.useMemo(()=>{const g={...G},qe=new pe.Popup(g);return qe.setLngLat([G.longitude,G.latitude]),qe.once("open",Ke=>{var st,ke;(ke=(st=Ie.current.props).onOpen)===null||ke===void 0||ke.call(st,Ke)}),qe},[]);if(gt.useEffect(()=>{const g=qe=>{var Ke,st;(st=(Ke=Ie.current.props).onClose)===null||st===void 0||st.call(Ke,qe)};return A.on("close",g),A.setDOMContent(me).addTo(Z.getMap()),()=>{A.off("close",g),A.isOpen()&&A.remove()}},[]),gt.useEffect(()=>{ic(A.getElement(),G.style)},[G.style]),gt.useImperativeHandle(Y,()=>A,[]),A.isOpen()&&((A.getLngLat().lng!==G.longitude||A.getLngLat().lat!==G.latitude)&&A.setLngLat([G.longitude,G.latitude]),G.offset&&!Js(A.options.offset,G.offset)&&A.setOffset(G.offset),(A.options.anchor!==G.anchor||A.options.maxWidth!==G.maxWidth)&&(A.options.anchor=G.anchor,A.setMaxWidth(G.maxWidth)),A.options.className!==G.className)){const g=Vp(A.options.className),qe=Vp(G.className);for(const Ke of g)qe.has(Ke)||A.removeClassName(Ke);for(const Ke of qe)g.has(Ke)||A.addClassName(Ke);A.options.className=G.className}return $p.createPortal(G.children,me)}gt.memo(gt.forwardRef(Df));function Uh(G,Y,Z,pe){const me=gt.useContext(rh),Ie=gt.useMemo(()=>G(me),[]);return gt.useEffect(()=>{const A=Y,g=null,qe=typeof Y=="function"?Y:null,{map:Ke}=me;return Ke.hasControl(Ie)||(Ke.addControl(Ie,A==null?void 0:A.position),g&&g(me)),()=>{qe&&qe(me),Ke.hasControl(Ie)&&Ke.removeControl(Ie)}},[]),Ie}function Lf(G){const Y=Uh(({mapLib:Z})=>new Z.AttributionControl(G),{position:G.position});return gt.useEffect(()=>{ic(Y._container,G.style)},[G.style]),null}gt.memo(Lf);function Rf(G){const Y=Uh(({mapLib:Z})=>new Z.FullscreenControl({container:G.containerId&&document.getElementById(G.containerId)}),{position:G.position});return gt.useEffect(()=>{ic(Y._controlContainer,G.style)},[G.style]),null}gt.memo(Rf);function Ff(G,Y){const Z=gt.useRef({props:G}),pe=Uh(({mapLib:me})=>{const Ie=new me.GeolocateControl(G),A=Ie._setupUI;return Ie._setupUI=g=>{Ie._container.hasChildNodes()||A(g)},Ie.on("geolocate",g=>{var qe,Ke;(Ke=(qe=Z.current.props).onGeolocate)===null||Ke===void 0||Ke.call(qe,g)}),Ie.on("error",g=>{var qe,Ke;(Ke=(qe=Z.current.props).onError)===null||Ke===void 0||Ke.call(qe,g)}),Ie.on("outofmaxbounds",g=>{var qe,Ke;(Ke=(qe=Z.current.props).onOutOfMaxBounds)===null||Ke===void 0||Ke.call(qe,g)}),Ie.on("trackuserlocationstart",g=>{var qe,Ke;(Ke=(qe=Z.current.props).onTrackUserLocationStart)===null||Ke===void 0||Ke.call(qe,g)}),Ie.on("trackuserlocationend",g=>{var qe,Ke;(Ke=(qe=Z.current.props).onTrackUserLocationEnd)===null||Ke===void 0||Ke.call(qe,g)}),Ie},{position:G.position});return Z.current.props=G,gt.useImperativeHandle(Y,()=>pe,[]),gt.useEffect(()=>{ic(pe._container,G.style)},[G.style]),null}gt.memo(gt.forwardRef(Ff));function Bf(G){const Y=Uh(({mapLib:Z})=>new Z.NavigationControl(G),{position:G.position});return gt.useEffect(()=>{ic(Y._container,G.style)},[G.style]),null}const Kf=gt.memo(Bf);function Of(G){const Y=Uh(({mapLib:Ie})=>new Ie.ScaleControl(G),{position:G.position}),Z=gt.useRef(G),pe=Z.current;Z.current=G;const{style:me}=G;return G.maxWidth!==void 0&&G.maxWidth!==pe.maxWidth&&(Y.options.maxWidth=G.maxWidth),G.unit!==void 0&&G.unit!==pe.unit&&Y.setUnit(G.unit),gt.useEffect(()=>{ic(Y._container,me)},[me]),null}gt.memo(Of);function Ld(G,Y){if(!G)throw new Error(Y)}function Nf(G,Y,Z,pe){if(Ld(Z.id===pe.id,"layer id changed"),Ld(Z.type===pe.type,"layer type changed"),Z.type==="custom"||pe.type==="custom")return;const{layout:me={},paint:Ie={},filter:A,minzoom:g,maxzoom:qe,beforeId:Ke}=Z;if(Ke!==pe.beforeId&&G.moveLayer(Y,Ke),me!==pe.layout){const st=pe.layout||{};for(const ke in me)Js(me[ke],st[ke])||G.setLayoutProperty(Y,ke,me[ke]);for(const ke in st)me.hasOwnProperty(ke)||G.setLayoutProperty(Y,ke,void 0)}if(Ie!==pe.paint){const st=pe.paint||{};for(const ke in Ie)Js(Ie[ke],st[ke])||G.setPaintProperty(Y,ke,Ie[ke]);for(const ke in st)Ie.hasOwnProperty(ke)||G.setPaintProperty(Y,ke,void 0)}Js(A,pe.filter)||G.setFilter(Y,A),(g!==pe.minzoom||qe!==pe.maxzoom)&&G.setLayerZoomRange(Y,g,qe)}function Vf(G,Y,Z){if(G.style&&G.style._loaded&&(!("source"in Z)||G.getSource(Z.source))){const pe={...Z,id:Y};delete pe.beforeId,G.addLayer(pe,Z.beforeId)}}let jf=0;function Jf(G){const Y=gt.useContext(rh).map.getMap(),Z=gt.useRef(G),[,pe]=gt.useState(0),me=gt.useMemo(()=>G.id||`jsx-layer-${jf++}`,[]);if(gt.useEffect(()=>{if(Y){const A=()=>pe(g=>g+1);return Y.on("styledata",A),A(),()=>{Y.off("styledata",A),Y.style&&Y.style._loaded&&Y.getLayer(me)&&Y.removeLayer(me)}}},[Y]),Y&&Y.style&&Y.getLayer(me))try{Nf(Y,me,G,Z.current)}catch(A){console.warn(A)}else Vf(Y,me,G);return Z.current=G,null}let Uf=0;function $f(G,Y,Z){if(G.style&&G.style._loaded){const pe={...Z};return delete pe.id,delete pe.children,G.addSource(Y,pe),G.getSource(Y)}return null}function Zf(G,Y,Z){Ld(Y.id===Z.id,"source id changed"),Ld(Y.type===Z.type,"source type changed");let pe="",me=0;for(const A in Y)A!=="children"&&A!=="id"&&!Js(Z[A],Y[A])&&(pe=A,me++);if(!me)return;const Ie=Y.type;Ie==="geojson"?G.setData(Y.data):Ie==="image"?G.updateImage({url:Y.url,coordinates:Y.coordinates}):"setCoordinates"in G&&me===1&&pe==="coordinates"?G.setCoordinates(Y.coordinates):"setUrl"in G&&pe==="url"?G.setUrl(Y.url):"setTiles"in G&&pe==="tiles"?G.setTiles(Y.tiles):console.warn(`Unable to update <Source> prop: ${pe}`)}function Yf(G){const Y=gt.useContext(rh).map.getMap(),Z=gt.useRef(G),[,pe]=gt.useState(0),me=gt.useMemo(()=>G.id||`jsx-source-${Uf++}`,[]);gt.useEffect(()=>{if(Y){const A=()=>setTimeout(()=>pe(g=>g+1),0);return Y.on("styledata",A),A(),()=>{var g;if(Y.off("styledata",A),Y.style&&Y.style._loaded&&Y.getSource(me)){const qe=(g=Y.getStyle())===null||g===void 0?void 0:g.layers;if(qe)for(const Ke of qe)Ke.source===me&&Y.removeLayer(Ke.id);Y.removeSource(me)}}}},[Y]);let Ie=Y&&Y.style&&Y.getSource(me);return Ie?Zf(Ie,G,Z.current):Ie=$f(Y,me,G),Z.current=G,Ie&&gt.Children.map(G.children,A=>A&&gt.cloneElement(A,{source:me}))||null}var Dd={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */var qf=Dd.exports,jp;function Qf(){return jp||(jp=1,(function(G,Y){(function(Z,pe){G.exports=pe()})(qf,(function(){var Z={},pe={};function me(A,g,qe){if(pe[A]=qe,A==="index"){var Ke="var sharedModule = {}; ("+pe.shared+")(sharedModule); ("+pe.worker+")(sharedModule);",st={};return pe.shared(st),pe.index(Z,st),typeof window<"u"&&Z.setWorkerUrl(window.URL.createObjectURL(new Blob([Ke],{type:"text/javascript"}))),Z}}me("shared",["exports"],(function(A){function g(r,t,i,a){return new(i||(i=Promise))((function(c,f){function m(T){try{x(a.next(T))}catch(E){f(E)}}function y(T){try{x(a.throw(T))}catch(E){f(E)}}function x(T){var E;T.done?c(T.value):(E=T.value,E instanceof i?E:new i((function(C){C(E)}))).then(m,y)}x((a=a.apply(r,t||[])).next())}))}function qe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var Ke=st;function st(r,t){this.x=r,this.y=t}st.prototype={clone:function(){return new st(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,i=r.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),i=Math.sin(r),a=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=a,this},_rotateAround:function(r,t){var i=Math.cos(r),a=Math.sin(r),c=t.y+a*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-a*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},st.convert=function(r){return r instanceof st?r:Array.isArray(r)?new st(r[0],r[1]):r};var ke=qe(Ke),ge=xr;function xr(r,t,i,a){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=i,this.p2y=a}xr.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var i=r,a=0;a<8;a++){var c=this.sampleCurveX(i)-r;if(Math.abs(c)<t)return i;var f=this.sampleCurveDerivativeX(i);if(Math.abs(f)<1e-6)break;i-=c/f}var m=0,y=1;for(i=r,a=0;a<20&&(c=this.sampleCurveX(i),!(Math.abs(c-r)<t));a++)r>c?m=i:y=i,i=.5*(y-m)+m;return i},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Ot=qe(ge);let Rt,Nt;function Mr(){return Rt==null&&(Rt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Rt}function Rr(){if(Nt==null&&(Nt=!1,Mr())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<25;a++){const c=4*a;t.fillStyle=`rgb(${c},${c+1},${c+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const i=t.getImageData(0,0,5,5).data;for(let a=0;a<100;a++)if(a%4!=3&&i[a]!==a){Nt=!0;break}}}return Nt||!1}function Xt(r,t,i,a){const c=new Ot(r,t,i,a);return f=>c.solve(f)}const tr=Xt(.25,.1,.25,1);function hr(r,t,i){return Math.min(i,Math.max(t,r))}function Fr(r,t,i){const a=i-t,c=((r-t)%a+a)%a+t;return c===t?i:c}function zr(r,...t){for(const i of t)for(const a in i)r[a]=i[a];return r}let Mi=1;function gi(r,t,i){const a={};for(const c in r)a[c]=t.call(this,r[c],c,r);return a}function nn(r,t,i){const a={};for(const c in r)t.call(this,r[c],c,r)&&(a[c]=r[c]);return a}function Kt(r){return Array.isArray(r)?r.map(Kt):typeof r=="object"&&r?gi(r,Kt):r}const sn={};function mr(r){sn[r]||(typeof console<"u"&&console.warn(r),sn[r]=!0)}function Ar(r,t,i){return(i.y-r.y)*(t.x-r.x)>(t.y-r.y)*(i.x-r.x)}function ci(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let ti=null;function or(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const et="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function vt(r,t,i,a,c){return g(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(r,{timestamp:0});try{const m=f==null?void 0:f.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const y=m.startsWith("BGR"),x=new Uint8ClampedArray(a*c*4);if(yield f.copyTo(x,(function(T,E,C,z,R){const O=4*Math.max(-E,0),j=(Math.max(0,C)-C)*z*4+O,X=4*z,ee=Math.max(0,E),fe=Math.max(0,C);return{rect:{x:ee,y:fe,width:Math.min(T.width,E+z)-ee,height:Math.min(T.height,C+R)-fe},layout:[{offset:j,stride:X}]}})(r,t,i,a,c)),y)for(let T=0;T<x.length;T+=4){const E=x[T];x[T]=x[T+2],x[T+2]=E}return x}finally{f.close()}}))}let rt,de;const Me="AbortError";function zt(){return new Error(Me)}const At={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Vt(r){return At.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const Gt="global-dispatcher";class qt extends Error{constructor(t,i,a,c){super(`AJAXError: ${i} (${t}): ${a}`),this.status=t,this.statusText=i,this.url=a,this.body=c}}const $t=()=>ci(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,dr=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const a=Vt(r.url);if(a)return a(r,t);if(ci(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:Gt},t)}if(!(/^file:/.test(i=r.url)||/^file:/.test($t())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(a,c){return g(this,void 0,void 0,(function*(){const f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:$t(),signal:c.signal});a.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");const m=yield fetch(f);if(!m.ok){const T=yield m.blob();throw new qt(m.status,m.statusText,a.url,T)}let y;y=a.type==="arrayBuffer"||a.type==="image"?m.arrayBuffer():a.type==="json"?m.json():m.text();const x=yield y;if(c.signal.aborted)throw zt();return{data:x,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}}))})(r,t);if(ci(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:Gt},t)}var i;return(function(a,c){return new Promise(((f,m)=>{var y;const x=new XMLHttpRequest;x.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(x.responseType="arraybuffer");for(const T in a.headers)x.setRequestHeader(T,a.headers[T]);a.type==="json"&&(x.responseType="text",!((y=a.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=a.credentials==="include",x.onerror=()=>{m(new Error(x.statusText))},x.onload=()=>{if(!c.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let T=x.response;if(a.type==="json")try{T=JSON.parse(x.response)}catch(E){return void m(E)}f({data:T,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const T=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});m(new qt(x.status,x.statusText,a.url,T))}},c.signal.addEventListener("abort",(()=>{x.abort(),m(zt())})),x.send(a.body)}))})(r,t)};function ri(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function Ys(r,t,i){i[r]&&i[r].indexOf(t)!==-1||(i[r]=i[r]||[],i[r].push(t))}function ls(r,t,i){if(i&&i[r]){const a=i[r].indexOf(t);a!==-1&&i[r].splice(a,1)}}class Vn{constructor(t,i={}){zr(this,i),this.type=t}}class us extends Vn{constructor(t,i={}){super("error",zr({error:t},i))}}class wo{on(t,i){return this._listeners=this._listeners||{},Ys(t,i,this._listeners),this}off(t,i){return ls(t,i,this._listeners),ls(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Ys(t,i,this._oneTimeListeners),this):new Promise((a=>this.once(t,a)))}fire(t,i){typeof t=="string"&&(t=new Vn(t,i||{}));const a=t.type;if(this.listens(a)){t.target=this;const c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of c)y.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of f)ls(a,y,this._oneTimeListeners),y.call(this,t);const m=this._eventedParent;m&&(zr(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof us&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ks=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Wo(r,t){const i={};for(const a in r)a!=="ref"&&(i[a]=r[a]);return ks.forEach((a=>{a in t&&(i[a]=t[a])})),i}function Jt(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let i=0;i<r.length;i++)if(!Jt(r[i],t[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const i in r)if(!Jt(r[i],t[i]))return!1;return!0}return r===t}function wr(r,t){r.push(t)}function cs(r,t,i){wr(i,{command:"addSource",args:[r,t[r]]})}function hs(r,t,i){wr(t,{command:"removeSource",args:[r]}),i[r]=!0}function ds(r,t,i,a){hs(r,i,a),cs(r,t,i)}function bo(r,t,i){let a;for(a in r[i])if(Object.prototype.hasOwnProperty.call(r[i],a)&&a!=="data"&&!Jt(r[i][a],t[i][a]))return!1;for(a in t[i])if(Object.prototype.hasOwnProperty.call(t[i],a)&&a!=="data"&&!Jt(r[i][a],t[i][a]))return!1;return!0}function on(r,t,i,a,c,f){r=r||{},t=t||{};for(const m in r)Object.prototype.hasOwnProperty.call(r,m)&&(Jt(r[m],t[m])||i.push({command:f,args:[a,m,t[m],c]}));for(const m in t)Object.prototype.hasOwnProperty.call(t,m)&&!Object.prototype.hasOwnProperty.call(r,m)&&(Jt(r[m],t[m])||i.push({command:f,args:[a,m,t[m],c]}))}function Xo(r){return r.id}function So(r,t){return r[t.id]=t,r}class Re{constructor(t,i,a,c){this.message=(t?`${t}: `:"")+a,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function jn(r,...t){for(const i of t)for(const a in i)r[a]=i[a];return r}class ii extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class Vi{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[a,c]of i)this.bindings[a]=c}concat(t){return new Vi(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Qs={kind:"null"},je={kind:"number"},Dt={kind:"string"},xt={kind:"boolean"},Si={kind:"color"},an={kind:"object"},Tt={kind:"value"},bn={kind:"collator"},Un={kind:"formatted"},ln={kind:"padding"},zi={kind:"resolvedImage"},K={kind:"variableAnchorOffsetCollection"};function L(r,t){return{kind:"array",itemType:r,N:t}}function D(r){if(r.kind==="array"){const t=D(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const V=[Qs,je,Dt,xt,Si,Un,an,L(Tt),ln,zi,K];function H(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!H(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const i of V)if(!H(i,t))return null}}return`Expected ${D(r)} but found ${D(t)} instead.`}function ie(r,t){return t.some((i=>i.kind===r.kind))}function ae(r,t){return t.some((i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r))}function he(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const te=.96422,Se=.82521,Pe=4/29,ve=6/29,Oe=3*ve*ve,ot=ve*ve*ve,dt=Math.PI/180,Yt=180/Math.PI;function Et(r){return(r%=360)<0&&(r+=360),r}function Qt([r,t,i,a]){let c,f;const m=Hr((.2225045*(r=Mt(r))+.7168786*(t=Mt(t))+.0606169*(i=Mt(i)))/1);r===t&&t===i?c=f=m:(c=Hr((.4360747*r+.3850649*t+.1430804*i)/te),f=Hr((.0139322*r+.0971045*t+.7141733*i)/Se));const y=116*m-16;return[y<0?0:y,500*(c-m),200*(m-f),a]}function Mt(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Hr(r){return r>ot?Math.pow(r,1/3):r/Oe+Pe}function Br([r,t,i,a]){let c=(r+16)/116,f=isNaN(t)?c:c+t/500,m=isNaN(i)?c:c-i/200;return c=1*ar(c),f=te*ar(f),m=Se*ar(m),[Ft(3.1338561*f-1.6168667*c-.4906146*m),Ft(-.9787684*f+1.9161415*c+.033454*m),Ft(.0719453*f-.2289914*c+1.4052427*m),a]}function Ft(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function ar(r){return r>ve?r*r*r:Oe*(r-Pe)}function Ir(r){return parseInt(r.padEnd(2,r),16)/255}function ni(r,t){return hi(t?r/100:r,0,1)}function hi(r,t,i){return Math.min(Math.max(t,r),i)}function Ai(r){return!r.some(Number.isNaN)}const Ko={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class kt{constructor(t,i,a,c=1,f=!0){this.r=t,this.g=i,this.b=a,this.a=c,f||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[t,i,a,c]))}static parse(t){if(t instanceof kt)return t;if(typeof t!="string")return;const i=(function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=Ko[a];if(c){const[m,y,x]=c;return[m/255,y/255,x/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const m=a.length<6?1:2;let y=1;return[Ir(a.slice(y,y+=m)),Ir(a.slice(y,y+=m)),Ir(a.slice(y,y+=m)),Ir(a.slice(y,y+m)||"ff")]}if(a.startsWith("rgb")){const m=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[y,x,T,E,C,z,R,O,j,X,ee,fe]=m,ne=[E||" ",R||" ",X].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const ce=[T,z,j].join(""),Te=ce==="%%%"?100:ce===""?255:0;if(Te){const ze=[hi(+x/Te,0,1),hi(+C/Te,0,1),hi(+O/Te,0,1),ee?ni(+ee,fe):1];if(Ai(ze))return ze}}return}}const f=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[m,y,x,T,E,C,z,R,O]=f,j=[x||" ",E||" ",z].join("");if(j==="  "||j==="  /"||j===",,"||j===",,,"){const X=[+y,hi(+T,0,100),hi(+C,0,100),R?ni(+R,O):1];if(Ai(X))return(function([ee,fe,ne,ce]){function Te(ze){const Je=(ze+ee/30)%12,yt=fe*Math.min(ne,1-ne);return ne-yt*Math.max(-1,Math.min(Je-3,9-Je,1))}return ee=Et(ee),fe/=100,ne/=100,[Te(0),Te(8),Te(4),ce]})(X)}}})(t);return i?new kt(...i,!1):void 0}get rgb(){const{r:t,g:i,b:a,a:c}=this,f=c||1/0;return this.overwriteGetter("rgb",[t/f,i/f,a/f,c])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[i,a,c,f]=Qt(t),m=Math.sqrt(a*a+c*c);return[Math.round(1e4*m)?Et(Math.atan2(c,a)*Yt):NaN,m,i,f]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Qt(this.rgb))}overwriteGetter(t,i){return Object.defineProperty(this,t,{value:i}),i}toString(){const[t,i,a,c]=this.rgb;return`rgba(${[t,i,a].map((f=>Math.round(255*f))).join(",")},${c})`}}kt.black=new kt(0,0,0,1),kt.white=new kt(1,1,1,1),kt.transparent=new kt(0,0,0,0),kt.red=new kt(1,0,0,1);class Ql{constructor(t,i,a){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ra{constructor(t,i,a,c,f){this.text=t,this.image=i,this.scale=a,this.fontStack=c,this.textColor=f}}class ji{constructor(t){this.sections=t}static fromString(t){return new ji([new Ra(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof ji?t:ji.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class Ti{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ti)return t;if(typeof t=="number")return new Ti([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const i of t)if(typeof i!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Ti(t)}}toString(){return JSON.stringify(this.values)}}const ih=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class un{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof un)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let i=0;i<t.length;i+=2){const a=t[i],c=t[i+1];if(typeof a!="string"||!ih.has(a)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new un(t)}}toString(){return JSON.stringify(this.values)}}class ki{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ki({name:t,available:!1}):null}}function Di(r,t,i,a){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,t,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,t,i,a]:[r,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function To(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof kt||r instanceof Ql||r instanceof ji||r instanceof Ti||r instanceof un||r instanceof ki)return!0;if(Array.isArray(r)){for(const t of r)if(!To(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!To(r[t]))return!1;return!0}return!1}function pr(r){if(r===null)return Qs;if(typeof r=="string")return Dt;if(typeof r=="boolean")return xt;if(typeof r=="number")return je;if(r instanceof kt)return Si;if(r instanceof Ql)return bn;if(r instanceof ji)return Un;if(r instanceof Ti)return ln;if(r instanceof un)return K;if(r instanceof ki)return zi;if(Array.isArray(r)){const t=r.length;let i;for(const a of r){const c=pr(a);if(i){if(i===c)continue;i=Tt;break}i=c}return L(i||Tt,t)}return an}function Fa(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof kt||r instanceof ji||r instanceof Ti||r instanceof un||r instanceof ki?r.toString():JSON.stringify(r)}class $n{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!To(t[1]))return i.error("invalid value");const a=t[1];let c=pr(a);const f=i.expectedType;return c.kind!=="array"||c.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(c=f),new $n(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Wr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ko={string:Dt,number:je,boolean:xt,object:an};class Ui{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a,c=1;const f=t[0];if(f==="array"){let y,x;if(t.length>2){const T=t[1];if(typeof T!="string"||!(T in ko)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=ko[T],c++}else y=Tt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=t[2],c++}a=L(y,x)}else{if(!ko[f])throw new Error(`Types doesn't contain name = ${f}`);a=ko[f]}const m=[];for(;c<t.length;c++){const y=i.parse(t[c],c,Tt);if(!y)return null;m.push(y)}return new Ui(a,m)}evaluate(t){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(t);if(!H(this.type,pr(a)))return a;if(i===this.args.length-1)throw new Wr(`Expected value to be of type ${D(this.type)}, but found ${D(pr(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Io={"to-boolean":xt,"to-color":Si,"to-number":je,"to-string":Dt};class $i{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[0];if(!Io[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return i.error("Expected one argument.");const c=Io[a],f=[];for(let m=1;m<t.length;m++){const y=i.parse(t[m],m,Tt);if(!y)return null;f.push(y)}return new $i(c,f)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let i,a;for(const c of this.args){if(i=c.evaluate(t),a=null,i instanceof kt)return i;if(typeof i=="string"){const f=t.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Di(i[0],i[1],i[2],i[3]),!a))return new kt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Wr(a||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const a of this.args){i=a.evaluate(t);const c=Ti.parse(i);if(c)return c}throw new Wr(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const a of this.args){i=a.evaluate(t);const c=un.parse(i);if(c)return c}throw new Wr(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const a of this.args){if(i=a.evaluate(t),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new Wr(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return ji.fromString(Fa(this.args[0].evaluate(t)));case"resolvedImage":return ki.fromString(Fa(this.args[0].evaluate(t)));default:return Fa(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const nh=["Unknown","Point","LineString","Polygon"];class gl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?nh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let i=this._parseColorCache[t];return i||(i=this._parseColorCache[t]=kt.parse(t)),i}}class Is{constructor(t,i,a=[],c,f=new Vi,m=[]){this.registry=t,this.path=a,this.key=a.map((y=>`[${y}]`)).join(""),this.scope=f,this.errors=m,this.expectedType=c,this._isConstant=i}parse(t,i,a,c,f={}){return i?this.concat(i,a,c)._parse(t,f):this._parse(t,f)}_parse(t,i){function a(c,f,m){return m==="assert"?new Ui(f,[c]):m==="coerce"?new $i(f,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[c];if(f){let m=f.parse(t,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,x=m.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(y.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(y.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(y,x))return null}else m=a(m,y,i.typeAnnotation||"coerce");else m=a(m,y,i.typeAnnotation||"coerce");else m=a(m,y,i.typeAnnotation||"coerce");else m=a(m,y,i.typeAnnotation||"assert")}if(!(m instanceof $n)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const y=new gl;try{m=new $n(m.type,m.evaluate(y))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,a){const c=typeof t=="number"?this.path.concat(t):this.path,f=a?this.scope.concat(a):this.scope;return new Is(this.registry,this._isConstant,c,i||null,f,this.errors)}error(t,...i){const a=`${this.key}${i.map((c=>`[${c}]`)).join("")}`;this.errors.push(new ii(a,t))}checkSubtype(t,i){const a=H(t,i);return a&&this.error(a),a}}class Es{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let f=1;f<t.length-1;f+=2){const m=t[f];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=i.parse(t[f+1],f+1);if(!y)return null;a.push([m,y])}const c=i.parse(t[t.length-1],t.length-1,i.expectedType,a);return c?new Es(a,c):null}outputDefined(){return this.result.outputDefined()}}class er{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=t[1];return i.scope.has(a)?new er(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Eo{constructor(t,i,a){this.type=t,this.index=i,this.input=a}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,je),c=i.parse(t[2],2,L(i.expectedType||Tt));return a&&c?new Eo(c.type.itemType,a,c):null}evaluate(t){const i=this.index.evaluate(t),a=this.input.evaluate(t);if(i<0)throw new Wr(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Wr(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Wr(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class eu{constructor(t,i){this.type=xt,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Tt),c=i.parse(t[2],2,Tt);return a&&c?ie(a.type,[xt,Dt,je,Qs,Tt])?new eu(a,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!ae(i,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${D(pr(i))} instead.`);if(!ae(a,["string","array"]))throw new Wr(`Expected second argument to be of type array or string, but found ${D(pr(a))} instead.`);return a.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class eo{constructor(t,i,a){this.type=je,this.needle=t,this.haystack=i,this.fromIndex=a}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Tt),c=i.parse(t[2],2,Tt);if(!a||!c)return null;if(!ie(a.type,[xt,Dt,je,Qs,Tt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`);if(t.length===4){const f=i.parse(t[3],3,je);return f?new eo(a,c,f):null}return new eo(a,c)}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!ae(i,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${D(pr(i))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(t)),ae(a,["string"])){const f=a.indexOf(i,c);return f===-1?-1:[...a.slice(0,f)].length}if(ae(a,["array"]))return a.indexOf(i,c);throw new Wr(`Expected second argument to be of type array or string, but found ${D(pr(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class lr{constructor(t,i,a,c,f,m){this.inputType=t,this.type=i,this.input=a,this.cases=c,this.outputs=f,this.otherwise=m}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let a,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const f={},m=[];for(let T=2;T<t.length-1;T+=2){let E=t[T];const C=t[T+1];Array.isArray(E)||(E=[E]);const z=i.concat(T);if(E.length===0)return z.error("Expected at least one branch label.");for(const O of E){if(typeof O!="number"&&typeof O!="string")return z.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return z.error("Numeric branch labels must be integer values.");if(a){if(z.checkSubtype(a,pr(O)))return null}else a=pr(O);if(f[String(O)]!==void 0)return z.error("Branch labels must be unique.");f[String(O)]=m.length}const R=i.parse(C,T,c);if(!R)return null;c=c||R.type,m.push(R)}const y=i.parse(t[1],1,Tt);if(!y)return null;const x=i.parse(t[t.length-1],t.length-1,c);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(a,y.type)?null:new lr(a,c,y,f,m,x):null}evaluate(t){const i=this.input.evaluate(t);return(pr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Ba{constructor(t,i,a){this.type=t,this.branches=i,this.otherwise=a}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const c=[];for(let m=1;m<t.length-1;m+=2){const y=i.parse(t[m],m,xt);if(!y)return null;const x=i.parse(t[m+1],m+1,a);if(!x)return null;c.push([y,x]),a=a||x.type}const f=i.parse(t[t.length-1],t.length-1,a);if(!f)return null;if(!a)throw new Error("Can't infer output type");return new Ba(a,c,f)}evaluate(t){for(const[i,a]of this.branches)if(i.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,a]of this.branches)t(i),t(a);t(this.otherwise)}outputDefined(){return this.branches.every((([t,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class Jo{constructor(t,i,a,c){this.type=t,this.input=i,this.beginIndex=a,this.endIndex=c}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Tt),c=i.parse(t[2],2,je);if(!a||!c)return null;if(!ie(a.type,[L(Tt),Dt,Tt]))return i.error(`Expected first argument to be of type array or string, but found ${D(a.type)} instead`);if(t.length===4){const f=i.parse(t[3],3,je);return f?new Jo(a.type,a,c,f):null}return new Jo(a.type,a,c)}evaluate(t){const i=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let c;if(this.endIndex&&(c=this.endIndex.evaluate(t)),ae(i,["string"]))return[...i].slice(a,c).join("");if(ae(i,["array"]))return i.slice(a,c);throw new Wr(`Expected first argument to be of type array or string, but found ${D(pr(i))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Yo(r,t){const i=r.length-1;let a,c,f=0,m=i,y=0;for(;f<=m;)if(y=Math.floor((f+m)/2),a=r[y],c=r[y+1],a<=t){if(y===i||t<c)return y;f=y+1}else{if(!(a>t))throw new Wr("Input is not a number.");m=y-1}return 0}class Co{constructor(t,i,a){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[c,f]of a)this.labels.push(c),this.outputs.push(f)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(t[1],1,je);if(!a)return null;const c=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let m=1;m<t.length;m+=2){const y=m===1?-1/0:t[m],x=t[m+1],T=m,E=m+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(c.length&&c[c.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const C=i.parse(x,E,f);if(!C)return null;f=f||C.type,c.push([y,C])}return new Co(f,a,c)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=i[0])return a[0].evaluate(t);const f=i.length;return c>=i[f-1]?a[f-1].evaluate(t):a[Yo(i,c)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function tu(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var nc=_l;function _l(r,t,i,a){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=i,this.p2y=a}_l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var i=r,a=0;a<8;a++){var c=this.sampleCurveX(i)-r;if(Math.abs(c)<t)return i;var f=this.sampleCurveDerivativeX(i);if(Math.abs(f)<1e-6)break;i-=c/f}var m=0,y=1;for(i=r,a=0;a<20&&(c=this.sampleCurveX(i),!(Math.abs(c-r)<t));a++)r>c?m=i:y=i,i=.5*(y-m)+m;return i},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var yl=tu(nc);function Zi(r,t,i){return r+i*(t-r)}function Sn(r,t,i){return r.map(((a,c)=>Zi(a,t[c],i)))}const Xr={number:Zi,color:function(r,t,i,a="rgb"){switch(a){case"rgb":{const[c,f,m,y]=Sn(r.rgb,t.rgb,i);return new kt(c,f,m,y,!1)}case"hcl":{const[c,f,m,y]=r.hcl,[x,T,E,C]=t.hcl;let z,R;if(isNaN(c)||isNaN(x))isNaN(c)?isNaN(x)?z=NaN:(z=x,m!==1&&m!==0||(R=T)):(z=c,E!==1&&E!==0||(R=f));else{let fe=x-c;x>c&&fe>180?fe-=360:x<c&&c-x>180&&(fe+=360),z=c+i*fe}const[O,j,X,ee]=(function([fe,ne,ce,Te]){return fe=isNaN(fe)?0:fe*dt,Br([ce,Math.cos(fe)*ne,Math.sin(fe)*ne,Te])})([z,R??Zi(f,T,i),Zi(m,E,i),Zi(y,C,i)]);return new kt(O,j,X,ee,!1)}case"lab":{const[c,f,m,y]=Br(Sn(r.lab,t.lab,i));return new kt(c,f,m,y,!1)}}},array:Sn,padding:function(r,t,i){return new Ti(Sn(r.values,t.values,i))},variableAnchorOffsetCollection:function(r,t,i){const a=r.values,c=t.values;if(a.length!==c.length)throw new Wr(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${t.toString()}`);const f=[];for(let m=0;m<a.length;m+=2){if(a[m]!==c[m])throw new Wr(`Cannot interpolate values containing mismatched anchors. from[${m}]: ${a[m]}, to[${m}]: ${c[m]}`);f.push(a[m]);const[y,x]=a[m+1],[T,E]=c[m+1];f.push([Zi(y,T,i),Zi(x,E,i)])}return new un(f)}};class di{constructor(t,i,a,c,f){this.type=t,this.operator=i,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[m,y]of f)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(t,i,a,c){let f=0;if(t.name==="exponential")f=to(i,t.base,a,c);else if(t.name==="linear")f=to(i,1,a,c);else if(t.name==="cubic-bezier"){const m=t.controlPoints;f=new yl(m[0],m[1],m[2],m[3]).solve(to(i,1,a,c))}return f}static parse(t,i){let[a,c,f,...m]=t;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const T=c[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:T}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const T=c.slice(1);if(T.length!==4||T.some((E=>typeof E!="number"||E<0||E>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:T}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,je),!f)return null;const y=[];let x=null;a==="interpolate-hcl"||a==="interpolate-lab"?x=Si:i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType);for(let T=0;T<m.length;T+=2){const E=m[T],C=m[T+1],z=T+3,R=T+4;if(typeof E!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(y.length&&y[y.length-1][0]>=E)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const O=i.parse(C,R,x);if(!O)return null;x=x||O.type,y.push([E,O])}return he(x,je)||he(x,Si)||he(x,ln)||he(x,K)||he(x,L(je))?new di(x,a,c,f,y):i.error(`Type ${D(x)} is not interpolatable.`)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=i[0])return a[0].evaluate(t);const f=i.length;if(c>=i[f-1])return a[f-1].evaluate(t);const m=Yo(i,c),y=di.interpolationFactor(this.interpolation,c,i[m],i[m+1]),x=a[m].evaluate(t),T=a[m+1].evaluate(t);switch(this.operator){case"interpolate":return Xr[this.type.kind](x,T,y);case"interpolate-hcl":return Xr.color(x,T,y,"hcl");case"interpolate-lab":return Xr.color(x,T,y,"lab")}}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function to(r,t,i,a){const c=a-i,f=r-i;return c===0?0:t===1?f/c:(Math.pow(t,f)-1)/(Math.pow(t,c)-1)}class Zn{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let a=null;const c=i.expectedType;c&&c.kind!=="value"&&(a=c);const f=[];for(const y of t.slice(1)){const x=i.parse(y,1+f.length,a,void 0,{typeAnnotation:"omit"});if(!x)return null;a=a||x.type,f.push(x)}if(!a)throw new Error("No output type");const m=c&&f.some((y=>H(c,y.type)));return new Zn(m?Tt:a,f)}evaluate(t){let i,a=null,c=0;for(const f of this.args)if(c++,a=f.evaluate(t),a&&a instanceof ki&&!a.available&&(i||(i=a.name),a=null,c===this.args.length&&(a=i)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function vl(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ru(r,t,i,a){return a.compare(t,i)===0}function ps(r,t,i){const a=r!=="=="&&r!=="!=";return class Zp{constructor(f,m,y){this.type=xt,this.lhs=f,this.rhs=m,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const y=f[0];let x=m.parse(f[1],1,Tt);if(!x)return null;if(!vl(y,x.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${D(x.type)}'.`);let T=m.parse(f[2],2,Tt);if(!T)return null;if(!vl(y,T.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${D(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return m.error(`Cannot compare types '${D(x.type)}' and '${D(T.type)}'.`);a&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new Ui(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new Ui(x.type,[T])));let E=null;if(f.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(E=m.parse(f[3],3,bn),!E)return null}return new Zp(x,T,E)}evaluate(f){const m=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(a&&this.hasUntypedArgument){const x=pr(m),T=pr(y);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new Wr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const x=pr(m),T=pr(y);if(x.kind!=="string"||T.kind!=="string")return t(f,m,y)}return this.collator?i(f,m,y,this.collator.evaluate(f)):t(f,m,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const sh=ps("==",(function(r,t,i){return t===i}),ru),iu=ps("!=",(function(r,t,i){return t!==i}),(function(r,t,i,a){return!ru(0,t,i,a)})),Oa=ps("<",(function(r,t,i){return t<i}),(function(r,t,i,a){return a.compare(t,i)<0})),sc=ps(">",(function(r,t,i){return t>i}),(function(r,t,i,a){return a.compare(t,i)>0})),oh=ps("<=",(function(r,t,i){return t<=i}),(function(r,t,i,a){return a.compare(t,i)<=0})),Qo=ps(">=",(function(r,t,i){return t>=i}),(function(r,t,i,a){return a.compare(t,i)>=0}));class Cs{constructor(t,i,a){this.type=bn,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const c=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,xt);if(!c)return null;const f=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,xt);if(!f)return null;let m=null;return a.locale&&(m=i.parse(a.locale,1,Dt),!m)?null:new Cs(c,f,m)}evaluate(t){return new Ql(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class ro{constructor(t,i,a,c,f){this.type=Dt,this.number=t,this.locale=i,this.currency=a,this.minFractionDigits=c,this.maxFractionDigits=f}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const a=i.parse(t[1],1,je);if(!a)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let f=null;if(c.locale&&(f=i.parse(c.locale,1,Dt),!f))return null;let m=null;if(c.currency&&(m=i.parse(c.currency,1,Dt),!m))return null;let y=null;if(c["min-fraction-digits"]&&(y=i.parse(c["min-fraction-digits"],1,je),!y))return null;let x=null;return c["max-fraction-digits"]&&(x=i.parse(c["max-fraction-digits"],1,je),!x)?null:new ro(a,f,m,y,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Po{constructor(t){this.type=Un,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const c=[];let f=!1;for(let m=1;m<=t.length-1;++m){const y=t[m];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let x=null;if(y["font-scale"]&&(x=i.parse(y["font-scale"],1,je),!x))return null;let T=null;if(y["text-font"]&&(T=i.parse(y["text-font"],1,L(Dt)),!T))return null;let E=null;if(y["text-color"]&&(E=i.parse(y["text-color"],1,Si),!E))return null;const C=c[c.length-1];C.scale=x,C.font=T,C.textColor=E}else{const x=i.parse(t[m],1,Tt);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new Po(c)}evaluate(t){return new ji(this.sections.map((i=>{const a=i.content.evaluate(t);return pr(a)===zi?new Ra("",a,null,null,null):new Ra(Fa(a),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)})))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}}class nu{constructor(t){this.type=zi,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");const a=i.parse(t[1],1,Dt);return a?new nu(a):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),a=ki.fromString(i);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(i)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class su{constructor(t){this.type=je,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=i.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${D(a.type)} instead.`):new su(a):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Wr(`Expected value to be of type string or array, but found ${D(pr(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Tn=8192;function xl(r,t){const i=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(i*c*Tn),Math.round(a*c*Tn)]}function Na(r,t){const i=Math.pow(2,t.z);return[(c=(r[0]/Tn+t.x)/i,360*c-180),(a=(r[1]/Tn+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,c}function io(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Li(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function rr(r,t,i){const a=r[0]-t[0],c=r[1]-t[1],f=r[0]-i[0],m=r[1]-i[1];return a*m-f*c==0&&a*f<=0&&c*m<=0}function Mo(r,t,i,a){return(c=[a[0]-i[0],a[1]-i[1]])[0]*(f=[t[0]-r[0],t[1]-r[1]])[1]-c[1]*f[0]!=0&&!(!zo(r,t,i,a)||!zo(i,a,r,t));var c,f}function oc(r,t,i){for(const a of i)for(let c=0;c<a.length-1;++c)if(Mo(r,t,a[c],a[c+1]))return!0;return!1}function Ps(r,t,i=!1){let a=!1;for(const y of t)for(let x=0;x<y.length-1;x++){if(rr(r,y[x],y[x+1]))return i;(f=y[x])[1]>(c=r)[1]!=(m=y[x+1])[1]>c[1]&&c[0]<(m[0]-f[0])*(c[1]-f[1])/(m[1]-f[1])+f[0]&&(a=!a)}var c,f,m;return a}function wl(r,t){for(const i of t)if(Ps(r,i))return!0;return!1}function ou(r,t){for(const i of r)if(!Ps(i,t))return!1;for(let i=0;i<r.length-1;++i)if(oc(r[i],r[i+1],t))return!1;return!0}function cn(r,t){for(const i of t)if(ou(r,i))return!0;return!1}function zo(r,t,i,a){const c=a[0]-i[0],f=a[1]-i[1],m=(r[0]-i[0])*f-c*(r[1]-i[1]),y=(t[0]-i[0])*f-c*(t[1]-i[1]);return m>0&&y<0||m<0&&y>0}function Va(r,t,i){const a=[];for(let c=0;c<r.length;c++){const f=[];for(let m=0;m<r[c].length;m++){const y=xl(r[c][m],i);io(t,y),f.push(y)}a.push(f)}return a}function ea(r,t,i){const a=[];for(let c=0;c<r.length;c++){const f=Va(r[c],t,i);a.push(f)}return a}function ac(r,t,i,a){if(r[0]<i[0]||r[0]>i[2]){const c=.5*a;let f=r[0]-i[0]>c?-a:i[0]-r[0]>c?a:0;f===0&&(f=r[0]-i[2]>c?-a:i[2]-r[0]>c?a:0),r[0]+=f}io(t,r)}function bl(r,t,i,a){const c=Math.pow(2,a.z)*Tn,f=[a.x*Tn,a.y*Tn],m=[];for(const y of r)for(const x of y){const T=[x.x+f[0],x.y+f[1]];ac(T,t,i,c),m.push(T)}return m}function Sl(r,t,i,a){const c=Math.pow(2,a.z)*Tn,f=[a.x*Tn,a.y*Tn],m=[];for(const x of r){const T=[];for(const E of x){const C=[E.x+f[0],E.y+f[1]];io(t,C),T.push(C)}m.push(T)}if(t[2]-t[0]<=c/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of m)for(const T of x)ac(T,t,i,c)}var y;return m}class qn{constructor(t,i){this.type=xt,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(To(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const c=[];for(const f of a.features){const{type:m,coordinates:y}=f.geometry;m==="Polygon"&&c.push(y),m==="MultiPolygon"&&c.push(...y)}if(c.length)return new qn(a,{type:"MultiPolygon",coordinates:c})}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new qn(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new qn(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,a){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(a.type==="Polygon"){const y=Va(a.coordinates,f,m),x=bl(i.geometry(),c,f,m);if(!Li(c,f))return!1;for(const T of x)if(!Ps(T,y))return!1}if(a.type==="MultiPolygon"){const y=ea(a.coordinates,f,m),x=bl(i.geometry(),c,f,m);if(!Li(c,f))return!1;for(const T of x)if(!wl(T,y))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,a){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(a.type==="Polygon"){const y=Va(a.coordinates,f,m),x=Sl(i.geometry(),c,f,m);if(!Li(c,f))return!1;for(const T of x)if(!ou(T,y))return!1}if(a.type==="MultiPolygon"){const y=ea(a.coordinates,f,m),x=Sl(i.geometry(),c,f,m);if(!Li(c,f))return!1;for(const T of x)if(!cn(T,y))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ja=class{constructor(r=[],t=((i,a)=>i<a?-1:i>a?1:0)){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:i}=this,a=t[r];for(;r>0;){const c=r-1>>1,f=t[c];if(i(a,f)>=0)break;t[r]=f,r=c}t[r]=a}_down(r){const{data:t,compare:i}=this,a=this.length>>1,c=t[r];for(;r<a;){let f=1+(r<<1);const m=f+1;if(m<this.length&&i(t[m],t[f])<0&&(f=m),i(t[f],c)>=0)break;t[r]=t[f],r=f}t[r]=c}};function lc(r,t,i,a,c){uc(r,t,i,a||r.length-1,c||ah)}function uc(r,t,i,a,c){for(;a>i;){if(a-i>600){var f=a-i+1,m=t-i+1,y=Math.log(f),x=.5*Math.exp(2*y/3),T=.5*Math.sqrt(y*x*(f-x)/f)*(m-f/2<0?-1:1);uc(r,t,Math.max(i,Math.floor(t-m*x/f+T)),Math.min(a,Math.floor(t+(f-m)*x/f+T)),c)}var E=r[t],C=i,z=a;for(Ua(r,i,t),c(r[a],E)>0&&Ua(r,i,a);C<z;){for(Ua(r,C,z),C++,z--;c(r[C],E)<0;)C++;for(;c(r[z],E)>0;)z--}c(r[i],E)===0?Ua(r,i,z):Ua(r,++z,a),z<=t&&(i=z+1),t<=z&&(a=z-1)}}function Ua(r,t,i){var a=r[t];r[t]=r[i],r[i]=a}function ah(r,t){return r<t?-1:r>t?1:0}function ta(r,t){if(r.length<=1)return[r];const i=[];let a,c;for(const f of r){const m=uh(f);m!==0&&(f.area=Math.abs(m),c===void 0&&(c=m<0),c===m<0?(a&&i.push(a),a=[f]):a.push(f))}if(a&&i.push(a),t>1)for(let f=0;f<i.length;f++)i[f].length<=t||(lc(i[f],t,1,i[f].length-1,lh),i[f]=i[f].slice(0,t));return i}function lh(r,t){return t.area-r.area}function uh(r){let t=0;for(let i,a,c=0,f=r.length,m=f-1;c<f;m=c++)i=r[c],a=r[m],t+=(a.x-i.x)*(i.y+a.y);return t}const cc=1/298.257223563,hc=cc*(2-cc),dc=Math.PI/180;class Tl{constructor(t){const i=6378.137*dc*1e3,a=Math.cos(t*dc),c=1/(1-hc*(1-a*a)),f=Math.sqrt(c);this.kx=i*f*a,this.ky=i*f*c*(1-hc)}distance(t,i){const a=this.wrap(t[0]-i[0])*this.kx,c=(t[1]-i[1])*this.ky;return Math.sqrt(a*a+c*c)}pointOnLine(t,i){let a,c,f,m,y=1/0;for(let x=0;x<t.length-1;x++){let T=t[x][0],E=t[x][1],C=this.wrap(t[x+1][0]-T)*this.kx,z=(t[x+1][1]-E)*this.ky,R=0;C===0&&z===0||(R=(this.wrap(i[0]-T)*this.kx*C+(i[1]-E)*this.ky*z)/(C*C+z*z),R>1?(T=t[x+1][0],E=t[x+1][1]):R>0&&(T+=C/this.kx*R,E+=z/this.ky*R)),C=this.wrap(i[0]-T)*this.kx,z=(i[1]-E)*this.ky;const O=C*C+z*z;O<y&&(y=O,a=T,c=E,f=x,m=R)}return{point:[a,c],index:f,t:Math.max(0,Math.min(1,m))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function pc(r,t){return t[0]-r[0]}function kl(r){return r[1]-r[0]+1}function Ms(r,t){return r[1]>=r[0]&&r[1]<t}function au(r,t){if(r[0]>r[1])return[null,null];const i=kl(r);if(t){if(i===2)return[r,null];const c=Math.floor(i/2);return[[r[0],r[0]+c],[r[0]+c,r[1]]]}if(i===1)return[r,null];const a=Math.floor(i/2)-1;return[[r[0],r[0]+a],[r[0]+a+1,r[1]]]}function $a(r,t){if(!Ms(t,r.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)io(i,r[a]);return i}function lu(r){const t=[1/0,1/0,-1/0,-1/0];for(const i of r)for(const a of i)io(t,a);return t}function Il(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function uu(r,t,i){if(!Il(r)||!Il(t))return NaN;let a=0,c=0;return r[2]<t[0]&&(a=t[0]-r[2]),r[0]>t[2]&&(a=r[0]-t[2]),r[1]>t[3]&&(c=r[1]-t[3]),r[3]<t[1]&&(c=t[1]-r[3]),i.distance([0,0],[a,c])}function no(r,t,i){const a=i.pointOnLine(t,r);return i.distance(r,a.point)}function cu(r,t,i,a,c){const f=Math.min(no(r,[i,a],c),no(t,[i,a],c)),m=Math.min(no(i,[r,t],c),no(a,[r,t],c));return Math.min(f,m)}function ch(r,t,i,a,c){if(!Ms(t,r.length)||!Ms(a,i.length))return 1/0;let f=1/0;for(let m=t[0];m<t[1];++m){const y=r[m],x=r[m+1];for(let T=a[0];T<a[1];++T){const E=i[T],C=i[T+1];if(Mo(y,x,E,C))return 0;f=Math.min(f,cu(y,x,E,C,c))}}return f}function Zr(r,t,i,a,c){if(!Ms(t,r.length)||!Ms(a,i.length))return NaN;let f=1/0;for(let m=t[0];m<=t[1];++m)for(let y=a[0];y<=a[1];++y)if(f=Math.min(f,c.distance(r[m],i[y])),f===0)return f;return f}function hh(r,t,i){if(Ps(r,t,!0))return 0;let a=1/0;for(const c of t){const f=c[0],m=c[c.length-1];if(f!==m&&(a=Math.min(a,no(r,[m,f],i)),a===0))return a;const y=i.pointOnLine(c,r);if(a=Math.min(a,i.distance(r,y.point)),a===0)return a}return a}function jt(r,t,i,a){if(!Ms(t,r.length))return NaN;for(let f=t[0];f<=t[1];++f)if(Ps(r[f],i,!0))return 0;let c=1/0;for(let f=t[0];f<t[1];++f){const m=r[f],y=r[f+1];for(const x of i)for(let T=0,E=x.length,C=E-1;T<E;C=T++){const z=x[C],R=x[T];if(Mo(m,y,z,R))return 0;c=Math.min(c,cu(m,y,z,R,a))}}return c}function El(r,t){for(const i of r)for(const a of i)if(Ps(a,t,!0))return!0;return!1}function br(r,t,i,a=1/0){const c=lu(r),f=lu(t);if(a!==1/0&&uu(c,f,i)>=a)return a;if(Li(c,f)){if(El(r,t))return 0}else if(El(t,r))return 0;let m=1/0;for(const y of r)for(let x=0,T=y.length,E=T-1;x<T;E=x++){const C=y[E],z=y[x];for(const R of t)for(let O=0,j=R.length,X=j-1;O<j;X=O++){const ee=R[X],fe=R[O];if(Mo(C,z,ee,fe))return 0;m=Math.min(m,cu(C,z,ee,fe,i))}}return m}function ur(r,t,i,a,c,f){if(!f)return;const m=uu($a(a,f),c,i);m<t&&r.push([m,f,[0,0]])}function Gn(r,t,i,a,c,f,m){if(!f||!m)return;const y=uu($a(a,f),$a(c,m),i);y<t&&r.push([y,f,m])}function Za(r,t,i,a,c=1/0){let f=Math.min(a.distance(r[0],i[0][0]),c);if(f===0)return f;const m=new ja([[0,[0,r.length-1],[0,0]]],pc),y=lu(i);for(;m.length>0;){const x=m.pop();if(x[0]>=f)continue;const T=x[1],E=t?50:100;if(kl(T)<=E){if(!Ms(T,r.length))return NaN;if(t){const C=jt(r,T,i,a);if(isNaN(C)||C===0)return C;f=Math.min(f,C)}else for(let C=T[0];C<=T[1];++C){const z=hh(r[C],i,a);if(f=Math.min(f,z),f===0)return 0}}else{const C=au(T,t);ur(m,f,a,r,y,C[0]),ur(m,f,a,r,y,C[1])}}return f}function ra(r,t,i,a,c,f=1/0){let m=Math.min(f,c.distance(r[0],i[0]));if(m===0)return m;const y=new ja([[0,[0,r.length-1],[0,i.length-1]]],pc);for(;y.length>0;){const x=y.pop();if(x[0]>=m)continue;const T=x[1],E=x[2],C=t?50:100,z=a?50:100;if(kl(T)<=C&&kl(E)<=z){if(!Ms(T,r.length)&&Ms(E,i.length))return NaN;let R;if(t&&a)R=ch(r,T,i,E,c),m=Math.min(m,R);else if(t&&!a){const O=r.slice(T[0],T[1]+1);for(let j=E[0];j<=E[1];++j)if(R=no(i[j],O,c),m=Math.min(m,R),m===0)return m}else if(!t&&a){const O=i.slice(E[0],E[1]+1);for(let j=T[0];j<=T[1];++j)if(R=no(r[j],O,c),m=Math.min(m,R),m===0)return m}else R=Zr(r,T,i,E,c),m=Math.min(m,R)}else{const R=au(T,t),O=au(E,a);Gn(y,m,c,r,i,R[0],O[0]),Gn(y,m,c,r,i,R[0],O[1]),Gn(y,m,c,r,i,R[1],O[0]),Gn(y,m,c,r,i,R[1],O[1])}}return m}function Cl(r){return r.type==="MultiPolygon"?r.coordinates.map((t=>({type:"Polygon",coordinates:t}))):r.type==="MultiLineString"?r.coordinates.map((t=>({type:"LineString",coordinates:t}))):r.type==="MultiPoint"?r.coordinates.map((t=>({type:"Point",coordinates:t}))):[r]}class so{constructor(t,i){this.type=je,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(To(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new so(a,a.features.map((c=>Cl(c.geometry))).flat());if(a.type==="Feature")return new so(a,Cl(a.geometry));if("type"in a&&"coordinates"in a)return new so(a,Cl(a))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,a){const c=i.geometry(),f=c.flat().map((x=>Na([x.x,x.y],i.canonical)));if(c.length===0)return NaN;const m=new Tl(f[0][1]);let y=1/0;for(const x of a){switch(x.type){case"Point":y=Math.min(y,ra(f,!1,[x.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,ra(f,!1,x.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,Za(f,!1,x.coordinates,m,y))}if(y===0)return y}return y})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,a){const c=i.geometry(),f=c.flat().map((x=>Na([x.x,x.y],i.canonical)));if(c.length===0)return NaN;const m=new Tl(f[0][1]);let y=1/0;for(const x of a){switch(x.type){case"Point":y=Math.min(y,ra(f,!0,[x.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,ra(f,!0,x.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,Za(f,!0,x.coordinates,m,y))}if(y===0)return y}return y})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(i,a){const c=i.geometry();if(c.length===0||c[0].length===0)return NaN;const f=ta(c,0).map((x=>x.map((T=>T.map((E=>Na([E.x,E.y],i.canonical))))))),m=new Tl(f[0][0][0][1]);let y=1/0;for(const x of a)for(const T of f){switch(x.type){case"Point":y=Math.min(y,Za([x.coordinates],!1,T,m,y));break;case"LineString":y=Math.min(y,Za(x.coordinates,!0,T,m,y));break;case"Polygon":y=Math.min(y,br(T,x.coordinates,m,y))}if(y===0)return y}return y})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ao={"==":sh,"!=":iu,">":sc,"<":Oa,">=":Qo,"<=":oh,array:Ui,at:Eo,boolean:Ui,case:Ba,coalesce:Zn,collator:Cs,format:Po,image:nu,in:eu,"index-of":eo,interpolate:di,"interpolate-hcl":di,"interpolate-lab":di,length:su,let:Es,literal:$n,match:lr,number:Ui,"number-format":ro,object:Ui,slice:Jo,step:Co,string:Ui,"to-boolean":$i,"to-color":$i,"to-number":$i,"to-string":$i,var:er,within:qn,distance:so};class hn{constructor(t,i,a,c){this.name=t,this.type=i,this._evaluate=a,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,i){const a=t[0],c=hn.definitions[a];if(!c)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=m.filter((([T])=>!Array.isArray(T)||T.length===t.length-1));let x=null;for(const[T,E]of y){x=new Is(i.registry,ia,i.path,null,i.scope);const C=[];let z=!1;for(let R=1;R<t.length;R++){const O=t[R],j=Array.isArray(T)?T[R-1]:T.type,X=x.parse(O,1+C.length,j);if(!X){z=!0;break}C.push(X)}if(!z)if(Array.isArray(T)&&T.length!==C.length)x.error(`Expected ${T.length} arguments, but found ${C.length} instead.`);else{for(let R=0;R<C.length;R++){const O=Array.isArray(T)?T[R]:T.type,j=C[R];x.concat(R+1).checkSubtype(O,j.type)}if(x.errors.length===0)return new hn(a,f,E,C)}}if(y.length===1)i.errors.push(...x.errors);else{const T=(y.length?y:m).map((([C])=>{return z=C,Array.isArray(z)?`(${z.map(D).join(", ")})`:`(${D(z.type)}...)`;var z})).join(" | "),E=[];for(let C=1;C<t.length;C++){const z=i.parse(t[C],1+E.length);if(!z)return null;E.push(D(z.type))}i.error(`Expected arguments of type ${T}, but found (${E.join(", ")}) instead.`)}return null}static register(t,i){hn.definitions=i;for(const a in i)t[a]=hn}}function oo(r,[t,i,a,c]){t=t.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const f=c?c.evaluate(r):1,m=Di(t,i,a,f);if(m)throw new Wr(m);return new kt(t/255,i/255,a/255,f,!1)}function hu(r,t){return r in t}function du(r,t){const i=t[r];return i===void 0?null:i}function Do(r){return{type:r}}function ia(r){if(r instanceof er)return ia(r.boundExpression);if(r instanceof hn&&r.name==="error"||r instanceof Cs||r instanceof qn||r instanceof so)return!1;const t=r instanceof $i||r instanceof Ui;let i=!0;return r.eachChild((a=>{i=t?i&&ia(a):i&&a instanceof $n})),!!i&&na(r)&&zs(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function na(r){if(r instanceof hn&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof qn||r instanceof so)return!1;let t=!0;return r.eachChild((i=>{t&&!na(i)&&(t=!1)})),t}function fs(r){if(r instanceof hn&&r.name==="feature-state")return!1;let t=!0;return r.eachChild((i=>{t&&!fs(i)&&(t=!1)})),t}function zs(r,t){if(r instanceof hn&&t.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild((a=>{i&&!zs(a,t)&&(i=!1)})),i}function Pl(r){return{result:"success",value:r}}function As(r){return{result:"error",value:r}}function sa(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function pu(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function qa(r){return!!r.expression&&r.expression.interpolated}function Ht(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Ga(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function fc(r){return r}function fu(r,t){const i=t.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",c=a||!(a||r.property!==void 0),f=r.type||(qa(t)?"exponential":"interval");if(i||t.type==="padding"){const E=i?kt.parse:Ti.parse;(r=jn({},r)).stops&&(r.stops=r.stops.map((C=>[C[0],E(C[1])]))),r.default=E(r.default?r.default:t.default)}if(r.colorSpace&&(m=r.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var m;let y,x,T;if(f==="exponential")y=gc;else if(f==="interval")y=Ml;else if(f==="categorical"){y=mc,x=Object.create(null);for(const E of r.stops)x[E[0]]=E[1];T=typeof r.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);y=_c}if(a){const E={},C=[];for(let O=0;O<r.stops.length;O++){const j=r.stops[O],X=j[0].zoom;E[X]===void 0&&(E[X]={zoom:X,type:r.type,property:r.property,default:r.default,stops:[]},C.push(X)),E[X].stops.push([j[0].value,j[1]])}const z=[];for(const O of C)z.push([E[O].zoom,fu(E[O],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:di.interpolationFactor.bind(void 0,R),zoomStops:z.map((O=>O[0])),evaluate:({zoom:O},j)=>gc({stops:z,base:r.base},t,O).evaluate(O,j)}}if(c){const E=f==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:di.interpolationFactor.bind(void 0,E),zoomStops:r.stops.map((C=>C[0])),evaluate:({zoom:C})=>y(r,t,C,x,T)}}return{kind:"source",evaluate(E,C){const z=C&&C.properties?C.properties[r.property]:void 0;return z===void 0?oa(r.default,t.default):y(r,t,z,x,T)}}}function oa(r,t,i){return r!==void 0?r:t!==void 0?t:i!==void 0?i:void 0}function mc(r,t,i,a,c){return oa(typeof i===c?a[i]:void 0,r.default,t.default)}function Ml(r,t,i){if(Ht(i)!=="number")return oa(r.default,t.default);const a=r.stops.length;if(a===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[a-1][0])return r.stops[a-1][1];const c=Yo(r.stops.map((f=>f[0])),i);return r.stops[c][1]}function gc(r,t,i){const a=r.base!==void 0?r.base:1;if(Ht(i)!=="number")return oa(r.default,t.default);const c=r.stops.length;if(c===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[c-1][0])return r.stops[c-1][1];const f=Yo(r.stops.map((E=>E[0])),i),m=(function(E,C,z,R){const O=R-z,j=E-z;return O===0?0:C===1?j/O:(Math.pow(C,j)-1)/(Math.pow(C,O)-1)})(i,a,r.stops[f][0],r.stops[f+1][0]),y=r.stops[f][1],x=r.stops[f+1][1],T=Xr[t.type]||fc;return typeof y.evaluate=="function"?{evaluate(...E){const C=y.evaluate.apply(void 0,E),z=x.evaluate.apply(void 0,E);if(C!==void 0&&z!==void 0)return T(C,z,m,r.colorSpace)}}:T(y,x,m,r.colorSpace)}function _c(r,t,i){switch(t.type){case"color":i=kt.parse(i);break;case"formatted":i=ji.fromString(i.toString());break;case"resolvedImage":i=ki.fromString(i.toString());break;case"padding":i=Ti.parse(i);break;default:Ht(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0)}return oa(i,r.default,t.default)}hn.register(Ao,{error:[{kind:"error"},[Dt],(r,[t])=>{throw new Wr(t.evaluate(r))}],typeof:[Dt,[Tt],(r,[t])=>D(pr(t.evaluate(r)))],"to-rgba":[L(je,4),[Si],(r,[t])=>{const[i,a,c,f]=t.evaluate(r).rgb;return[255*i,255*a,255*c,f]}],rgb:[Si,[je,je,je],oo],rgba:[Si,[je,je,je,je],oo],has:{type:xt,overloads:[[[Dt],(r,[t])=>hu(t.evaluate(r),r.properties())],[[Dt,an],(r,[t,i])=>hu(t.evaluate(r),i.evaluate(r))]]},get:{type:Tt,overloads:[[[Dt],(r,[t])=>du(t.evaluate(r),r.properties())],[[Dt,an],(r,[t,i])=>du(t.evaluate(r),i.evaluate(r))]]},"feature-state":[Tt,[Dt],(r,[t])=>du(t.evaluate(r),r.featureState||{})],properties:[an,[],r=>r.properties()],"geometry-type":[Dt,[],r=>r.geometryType()],id:[Tt,[],r=>r.id()],zoom:[je,[],r=>r.globals.zoom],"heatmap-density":[je,[],r=>r.globals.heatmapDensity||0],"line-progress":[je,[],r=>r.globals.lineProgress||0],accumulated:[Tt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[je,Do(je),(r,t)=>{let i=0;for(const a of t)i+=a.evaluate(r);return i}],"*":[je,Do(je),(r,t)=>{let i=1;for(const a of t)i*=a.evaluate(r);return i}],"-":{type:je,overloads:[[[je,je],(r,[t,i])=>t.evaluate(r)-i.evaluate(r)],[[je],(r,[t])=>-t.evaluate(r)]]},"/":[je,[je,je],(r,[t,i])=>t.evaluate(r)/i.evaluate(r)],"%":[je,[je,je],(r,[t,i])=>t.evaluate(r)%i.evaluate(r)],ln2:[je,[],()=>Math.LN2],pi:[je,[],()=>Math.PI],e:[je,[],()=>Math.E],"^":[je,[je,je],(r,[t,i])=>Math.pow(t.evaluate(r),i.evaluate(r))],sqrt:[je,[je],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[je,[je],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[je,[je],(r,[t])=>Math.log(t.evaluate(r))],log2:[je,[je],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[je,[je],(r,[t])=>Math.sin(t.evaluate(r))],cos:[je,[je],(r,[t])=>Math.cos(t.evaluate(r))],tan:[je,[je],(r,[t])=>Math.tan(t.evaluate(r))],asin:[je,[je],(r,[t])=>Math.asin(t.evaluate(r))],acos:[je,[je],(r,[t])=>Math.acos(t.evaluate(r))],atan:[je,[je],(r,[t])=>Math.atan(t.evaluate(r))],min:[je,Do(je),(r,t)=>Math.min(...t.map((i=>i.evaluate(r))))],max:[je,Do(je),(r,t)=>Math.max(...t.map((i=>i.evaluate(r))))],abs:[je,[je],(r,[t])=>Math.abs(t.evaluate(r))],round:[je,[je],(r,[t])=>{const i=t.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[je,[je],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[je,[je],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[xt,[Dt,Tt],(r,[t,i])=>r.properties()[t.value]===i.value],"filter-id-==":[xt,[Tt],(r,[t])=>r.id()===t.value],"filter-type-==":[xt,[Dt],(r,[t])=>r.geometryType()===t.value],"filter-<":[xt,[Dt,Tt],(r,[t,i])=>{const a=r.properties()[t.value],c=i.value;return typeof a==typeof c&&a<c}],"filter-id-<":[xt,[Tt],(r,[t])=>{const i=r.id(),a=t.value;return typeof i==typeof a&&i<a}],"filter->":[xt,[Dt,Tt],(r,[t,i])=>{const a=r.properties()[t.value],c=i.value;return typeof a==typeof c&&a>c}],"filter-id->":[xt,[Tt],(r,[t])=>{const i=r.id(),a=t.value;return typeof i==typeof a&&i>a}],"filter-<=":[xt,[Dt,Tt],(r,[t,i])=>{const a=r.properties()[t.value],c=i.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[xt,[Tt],(r,[t])=>{const i=r.id(),a=t.value;return typeof i==typeof a&&i<=a}],"filter->=":[xt,[Dt,Tt],(r,[t,i])=>{const a=r.properties()[t.value],c=i.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[xt,[Tt],(r,[t])=>{const i=r.id(),a=t.value;return typeof i==typeof a&&i>=a}],"filter-has":[xt,[Tt],(r,[t])=>t.value in r.properties()],"filter-has-id":[xt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[xt,[L(Dt)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[xt,[L(Tt)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[xt,[Dt,L(Tt)],(r,[t,i])=>i.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[xt,[Dt,L(Tt)],(r,[t,i])=>(function(a,c,f,m){for(;f<=m;){const y=f+m>>1;if(c[y]===a)return!0;c[y]>a?m=y-1:f=y+1}return!1})(r.properties()[t.value],i.value,0,i.value.length-1)],all:{type:xt,overloads:[[[xt,xt],(r,[t,i])=>t.evaluate(r)&&i.evaluate(r)],[Do(xt),(r,t)=>{for(const i of t)if(!i.evaluate(r))return!1;return!0}]]},any:{type:xt,overloads:[[[xt,xt],(r,[t,i])=>t.evaluate(r)||i.evaluate(r)],[Do(xt),(r,t)=>{for(const i of t)if(i.evaluate(r))return!0;return!1}]]},"!":[xt,[xt],(r,[t])=>!t.evaluate(r)],"is-supported-script":[xt,[Dt],(r,[t])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(t.evaluate(r))}],upcase:[Dt,[Dt],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[Dt,[Dt],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[Dt,Do(Tt),(r,t)=>t.map((i=>Fa(i.evaluate(r)))).join("")],"resolved-locale":[Dt,[bn],(r,[t])=>t.evaluate(r).resolvedLocale()]});class qi{constructor(t,i){var a;this.expression=t,this._warningHistory={},this._evaluator=new gl,this._defaultValue=i?(a=i).type==="color"&&Ga(a.default)?new kt(0,0,0,0):a.type==="color"?kt.parse(a.default)||null:a.type==="padding"?Ti.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?un.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,a,c,f,m){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=c,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(t,i,a,c,f,m){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Wr(`Expected value to be one of ${Object.keys(this._enumValues).map((x=>JSON.stringify(x))).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function ao(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Ao}function Lo(r,t){const i=new Is(Ao,ia,[],t?(function(c){const f={color:Si,string:Dt,number:je,enum:Dt,boolean:xt,formatted:Un,padding:ln,resolvedImage:zi,variableAnchorOffsetCollection:K};return c.type==="array"?L(f[c.value]||Tt,c.length):f[c.type]})(t):void 0),a=i.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Pl(new qi(a,t)):As(i.errors)}class Ro{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!fs(i.expression)}evaluateWithoutErrorHandling(t,i,a,c,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,c,f,m)}evaluate(t,i,a,c,f,m){return this._styleExpression.evaluate(t,i,a,c,f,m)}}class Fo{constructor(t,i,a,c){this.kind=t,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!fs(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,i,a,c,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,c,f,m)}evaluate(t,i,a,c,f,m){return this._styleExpression.evaluate(t,i,a,c,f,m)}interpolationFactor(t,i,a){return this.interpolationType?di.interpolationFactor(this.interpolationType,t,i,a):0}}function zl(r,t){const i=Lo(r,t);if(i.result==="error")return i;const a=i.value.expression,c=na(a);if(!c&&!sa(t))return As([new ii("","data expressions not supported")]);const f=zs(a,["zoom"]);if(!f&&!pu(t))return As([new ii("","zoom expressions not supported")]);const m=Ha(a);return m||f?m instanceof ii?As([m]):m instanceof di&&!qa(t)?As([new ii("",'"interpolate" expressions cannot be used with this property')]):Pl(m?new Fo(c?"camera":"composite",i.value,m.labels,m instanceof di?m.interpolation:void 0):new Ro(c?"constant":"source",i.value)):As([new ii("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class lo{constructor(t,i){this._parameters=t,this._specification=i,jn(this,fu(this._parameters,this._specification))}static deserialize(t){return new lo(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Ha(r){let t=null;if(r instanceof Es)t=Ha(r.result);else if(r instanceof Zn){for(const i of r.args)if(t=Ha(i),t)break}else(r instanceof Co||r instanceof di)&&r.input instanceof hn&&r.input.name==="zoom"&&(t=r);return t instanceof ii||r.eachChild((i=>{const a=Ha(i);a instanceof ii?t=a:!t&&a?t=new ii("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new ii("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function Al(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!Al(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Ds={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Wa(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Al(r)||(r=Ka(r));const t=Lo(r,Ds);if(t.result==="error")throw new Error(t.value.map((i=>`${i.key}: ${i.message}`)).join(", "));return{filter:(i,a,c)=>t.value.evaluate(i,a,{},c),needGeometry:Dl(r)}}function Xa(r,t){return r<t?-1:r>t?1:0}function Dl(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(Dl(r[t]))return!0;return!1}function Ka(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?aa(r[1],r[2],"=="):t==="!="?_i(aa(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?aa(r[1],r[2],t):t==="any"?(i=r.slice(1),["any"].concat(i.map(Ka))):t==="all"?["all"].concat(r.slice(1).map(Ka)):t==="none"?["all"].concat(r.slice(1).map(Ka).map(_i)):t==="in"?ms(r[1],r.slice(2)):t==="!in"?_i(ms(r[1],r.slice(2))):t==="has"?Bo(r[1]):t!=="!has"||_i(Bo(r[1]));var i}function aa(r,t,i){switch(r){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,r,t]}}function ms(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((i=>typeof i!=typeof t[0]))?["filter-in-large",r,["literal",t.sort(Xa)]]:["filter-in-small",r,["literal",t]]}}function Bo(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function _i(r){return["!",r]}function gs(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let c="[";for(const f of r)c+=`${gs(f)},`;return`${c}]`}const i=Object.keys(r).sort();let a="{";for(let c=0;c<i.length;c++)a+=`${JSON.stringify(i[c])}:${gs(r[i[c]])},`;return`${a}}`}function mu(r){let t="";for(const i of ks)t+=`/${gs(r[i])}`;return t}function gu(r){const t=r.value;return t?[new Re(r.key,t,"constants have been deprecated as of v8")]:[]}function jr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function kn(r){if(Array.isArray(r))return r.map(kn);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const i in r)t[i]=kn(r[i]);return t}return jr(r)}function Gi(r){const t=r.key,i=r.value,a=r.valueSpec||{},c=r.objectElementValidators||{},f=r.style,m=r.styleSpec,y=r.validateSpec;let x=[];const T=Ht(i);if(T!=="object")return[new Re(t,i,`object expected, ${T} found`)];for(const E in i){const C=E.split(".")[0],z=a[C]||a["*"];let R;if(c[C])R=c[C];else if(a[C])R=y;else if(c["*"])R=c["*"];else{if(!a["*"]){x.push(new Re(t,i[E],`unknown property "${E}"`));continue}R=y}x=x.concat(R({key:(t&&`${t}.`)+E,value:i[E],valueSpec:z,style:f,styleSpec:m,object:i,objectKey:E,validateSpec:y},i))}for(const E in a)c[E]||a[E].required&&a[E].default===void 0&&i[E]===void 0&&x.push(new Re(t,i,`missing required property "${E}"`));return x}function la(r){const t=r.value,i=r.valueSpec,a=r.style,c=r.styleSpec,f=r.key,m=r.arrayElementValidator||r.validateSpec;if(Ht(t)!=="array")return[new Re(f,t,`array expected, ${Ht(t)} found`)];if(i.length&&t.length!==i.length)return[new Re(f,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Re(f,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let y={type:i.value,values:i.values};c.$version<7&&(y.function=i.function),Ht(i.value)==="object"&&(y=i.value);let x=[];for(let T=0;T<t.length;T++)x=x.concat(m({array:t,arrayIndex:T,value:t[T],valueSpec:y,validateSpec:r.validateSpec,style:a,styleSpec:c,key:`${f}[${T}]`}));return x}function _s(r){const t=r.key,i=r.value,a=r.valueSpec;let c=Ht(i);return c==="number"&&i!=i&&(c="NaN"),c!=="number"?[new Re(t,i,`number expected, ${c} found`)]:"minimum"in a&&i<a.minimum?[new Re(t,i,`${i} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&i>a.maximum?[new Re(t,i,`${i} is greater than the maximum value ${a.maximum}`)]:[]}function ua(r){const t=r.valueSpec,i=jr(r.value.type);let a,c,f,m={};const y=i!=="categorical"&&r.value.property===void 0,x=!y,T=Ht(r.value.stops)==="array"&&Ht(r.value.stops[0])==="array"&&Ht(r.value.stops[0][0])==="object",E=Gi({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(R){if(i==="identity")return[new Re(R.key,R.value,'identity function may not have a "stops" property')];let O=[];const j=R.value;return O=O.concat(la({key:R.key,value:j,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:C})),Ht(j)==="array"&&j.length===0&&O.push(new Re(R.key,j,"array must have at least one stop")),O},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return i==="identity"&&y&&E.push(new Re(r.key,r.value,'missing required property "property"')),i==="identity"||r.value.stops||E.push(new Re(r.key,r.value,'missing required property "stops"')),i==="exponential"&&r.valueSpec.expression&&!qa(r.valueSpec)&&E.push(new Re(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(x&&!sa(r.valueSpec)?E.push(new Re(r.key,r.value,"property functions not supported")):y&&!pu(r.valueSpec)&&E.push(new Re(r.key,r.value,"zoom functions not supported"))),i!=="categorical"&&!T||r.value.property!==void 0||E.push(new Re(r.key,r.value,'"property" property is required')),E;function C(R){let O=[];const j=R.value,X=R.key;if(Ht(j)!=="array")return[new Re(X,j,`array expected, ${Ht(j)} found`)];if(j.length!==2)return[new Re(X,j,`array length 2 expected, length ${j.length} found`)];if(T){if(Ht(j[0])!=="object")return[new Re(X,j,`object expected, ${Ht(j[0])} found`)];if(j[0].zoom===void 0)return[new Re(X,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new Re(X,j,"object stop key must have value")];if(f&&f>jr(j[0].zoom))return[new Re(X,j[0].zoom,"stop zoom values must appear in ascending order")];jr(j[0].zoom)!==f&&(f=jr(j[0].zoom),c=void 0,m={}),O=O.concat(Gi({key:`${X}[0]`,value:j[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:_s,value:z}}))}else O=O.concat(z({key:`${X}[0]`,value:j[0],validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},j));return ao(kn(j[1]))?O.concat([new Re(`${X}[1]`,j[1],"expressions are not allowed in function stops.")]):O.concat(R.validateSpec({key:`${X}[1]`,value:j[1],valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function z(R,O){const j=Ht(R.value),X=jr(R.value),ee=R.value!==null?R.value:O;if(a){if(j!==a)return[new Re(R.key,ee,`${j} stop domain type must match previous stop domain type ${a}`)]}else a=j;if(j!=="number"&&j!=="string"&&j!=="boolean")return[new Re(R.key,ee,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&i!=="categorical"){let fe=`number expected, ${j} found`;return sa(t)&&i===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Re(R.key,ee,fe)]}return i!=="categorical"||j!=="number"||isFinite(X)&&Math.floor(X)===X?i!=="categorical"&&j==="number"&&c!==void 0&&X<c?[new Re(R.key,ee,"stop domain values must appear in ascending order")]:(c=X,i==="categorical"&&X in m?[new Re(R.key,ee,"stop domain values must be unique")]:(m[X]=!0,[])):[new Re(R.key,ee,`integer expected, found ${X}`)]}}function uo(r){const t=(r.expressionContext==="property"?zl:Lo)(kn(r.value),r.valueSpec);if(t.result==="error")return t.value.map((a=>new Re(`${r.key}${a.key}`,r.value,a.message)));const i=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!i.outputDefined())return[new Re(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!fs(i))return[new Re(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!fs(i))return[new Re(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!zs(i,["zoom","feature-state"]))return[new Re(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!na(i))return[new Re(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ls(r){const t=r.key,i=r.value,a=r.valueSpec,c=[];return Array.isArray(a.values)?a.values.indexOf(jr(i))===-1&&c.push(new Re(t,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(jr(i))===-1&&c.push(new Re(t,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function _u(r){return Al(kn(r.value))?uo(jn({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):co(r)}function co(r){const t=r.value,i=r.key;if(Ht(t)!=="array")return[new Re(i,t,`array expected, ${Ht(t)} found`)];const a=r.styleSpec;let c,f=[];if(t.length<1)return[new Re(i,t,"filter array must have at least 1 element")];switch(f=f.concat(Ls({key:`${i}[0]`,value:t[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),jr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&jr(t[1])==="$type"&&f.push(new Re(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&f.push(new Re(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=Ht(t[1]),c!=="string"&&f.push(new Re(`${i}[1]`,t[1],`string expected, ${c} found`)));for(let m=2;m<t.length;m++)c=Ht(t[m]),jr(t[1])==="$type"?f=f.concat(Ls({key:`${i}[${m}]`,value:t[m],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&f.push(new Re(`${i}[${m}]`,t[m],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)f=f.concat(co({key:`${i}[${m}]`,value:t[m],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=Ht(t[1]),t.length!==2?f.push(new Re(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&f.push(new Re(`${i}[1]`,t[1],`string expected, ${c} found`))}return f}function yu(r,t){const i=r.key,a=r.validateSpec,c=r.style,f=r.styleSpec,m=r.value,y=r.objectKey,x=f[`${t}_${r.layerType}`];if(!x)return[];const T=y.match(/^(.*)-transition$/);if(t==="paint"&&T&&x[T[1]]&&x[T[1]].transition)return a({key:i,value:m,valueSpec:f.transition,style:c,styleSpec:f});const E=r.valueSpec||x[y];if(!E)return[new Re(i,m,`unknown property "${y}"`)];let C;if(Ht(m)==="string"&&sa(E)&&!E.tokens&&(C=/^{([^}]+)}$/.exec(m)))return[new Re(i,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const z=[];return r.layerType==="symbol"&&(y==="text-field"&&c&&!c.glyphs&&z.push(new Re(i,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Ga(kn(m))&&jr(m.type)==="identity"&&z.push(new Re(i,m,'"text-font" does not support identity functions'))),z.concat(a({key:r.key,value:m,valueSpec:E,style:c,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:y}))}function Ja(r){return yu(r,"paint")}function Ll(r){return yu(r,"layout")}function Sr(r){let t=[];const i=r.value,a=r.key,c=r.style,f=r.styleSpec;i.type||i.ref||t.push(new Re(a,i,'either "type" or "ref" is required'));let m=jr(i.type);const y=jr(i.ref);if(i.id){const x=jr(i.id);for(let T=0;T<r.arrayIndex;T++){const E=c.layers[T];jr(E.id)===x&&t.push(new Re(a,i.id,`duplicate layer id "${i.id}", previously used at line ${E.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach((T=>{T in i&&t.push(new Re(a,i[T],`"${T}" is prohibited for ref layers`))})),c.layers.forEach((T=>{jr(T.id)===y&&(x=T)})),x?x.ref?t.push(new Re(a,i.ref,"ref cannot reference another ref layer")):m=jr(x.type):t.push(new Re(a,i.ref,`ref layer "${y}" not found`))}else if(m!=="background")if(i.source){const x=c.sources&&c.sources[i.source],T=x&&jr(x.type);x?T==="vector"&&m==="raster"?t.push(new Re(a,i.source,`layer "${i.id}" requires a raster source`)):T!=="raster-dem"&&m==="hillshade"?t.push(new Re(a,i.source,`layer "${i.id}" requires a raster-dem source`)):T==="raster"&&m!=="raster"?t.push(new Re(a,i.source,`layer "${i.id}" requires a vector source`)):T!=="vector"||i["source-layer"]?T==="raster-dem"&&m!=="hillshade"?t.push(new Re(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!i.paint||!i.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||t.push(new Re(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Re(a,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Re(a,i.source,`source "${i.source}" not found`))}else t.push(new Re(a,i,'missing required property "source"'));return t=t.concat(Gi({key:a,value:i,valueSpec:f.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${a}.type`,value:i.type,valueSpec:f.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:i,objectKey:"type"}),filter:_u,layout:x=>Gi({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>Ll(jn({layerType:m},T))}}),paint:x=>Gi({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>Ja(jn({layerType:m},T))}})}})),t}function Rs(r){const t=r.value,i=r.key,a=Ht(t);return a!=="string"?[new Re(i,t,`string expected, ${a} found`)]:[]}const Oo={promoteId:function({key:r,value:t}){if(Ht(t)==="string")return Rs({key:r,value:t});{const i=[];for(const a in t)i.push(...Rs({key:`${r}.${a}`,value:t[a]}));return i}}};function Fs(r){const t=r.value,i=r.key,a=r.styleSpec,c=r.style,f=r.validateSpec;if(!t.type)return[new Re(i,t,'"type" is required')];const m=jr(t.type);let y;switch(m){case"vector":case"raster":return y=Gi({key:i,value:t,valueSpec:a[`source_${m.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:Oo,validateSpec:f}),y;case"raster-dem":return y=(function(x){var T;const E=(T=x.sourceName)!==null&&T!==void 0?T:"",C=x.value,z=x.styleSpec,R=z.source_raster_dem,O=x.style;let j=[];const X=Ht(C);if(C===void 0)return j;if(X!=="object")return j.push(new Re("source_raster_dem",C,`object expected, ${X} found`)),j;const ee=jr(C.encoding)==="custom",fe=["redFactor","greenFactor","blueFactor","baseShift"],ne=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const ce in C)!ee&&fe.includes(ce)?j.push(new Re(ce,C[ce],`In "${E}": "${ce}" is only valid when "encoding" is set to "custom". ${ne} encoding found`)):R[ce]?j=j.concat(x.validateSpec({key:ce,value:C[ce],valueSpec:R[ce],validateSpec:x.validateSpec,style:O,styleSpec:z})):j.push(new Re(ce,C[ce],`unknown property "${ce}"`));return j})({sourceName:i,value:t,style:r.style,styleSpec:a,validateSpec:f}),y;case"geojson":if(y=Gi({key:i,value:t,valueSpec:a.source_geojson,style:c,styleSpec:a,validateSpec:f,objectElementValidators:Oo}),t.cluster)for(const x in t.clusterProperties){const[T,E]=t.clusterProperties[x],C=typeof T=="string"?[T,["accumulated"],["get",x]]:T;y.push(...uo({key:`${i}.${x}.map`,value:E,expressionContext:"cluster-map"})),y.push(...uo({key:`${i}.${x}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return y;case"video":return Gi({key:i,value:t,valueSpec:a.source_video,style:c,validateSpec:f,styleSpec:a});case"image":return Gi({key:i,value:t,valueSpec:a.source_image,style:c,validateSpec:f,styleSpec:a});case"canvas":return[new Re(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ls({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Rl(r){const t=r.value,i=r.styleSpec,a=i.light,c=r.style;let f=[];const m=Ht(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new Re("light",t,`object expected, ${m} found`)]),f;for(const y in t){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&a[x[1]]&&a[x[1]].transition?r.validateSpec({key:y,value:t[y],valueSpec:i.transition,validateSpec:r.validateSpec,style:c,styleSpec:i}):a[y]?r.validateSpec({key:y,value:t[y],valueSpec:a[y],validateSpec:r.validateSpec,style:c,styleSpec:i}):[new Re(y,t[y],`unknown property "${y}"`)])}return f}function Ya(r){const t=r.value,i=r.styleSpec,a=i.sky,c=r.style,f=Ht(t);if(t===void 0)return[];if(f!=="object")return[new Re("sky",t,`object expected, ${f} found`)];let m=[];for(const y in t)m=m.concat(a[y]?r.validateSpec({key:y,value:t[y],valueSpec:a[y],style:c,styleSpec:i}):[new Re(y,t[y],`unknown property "${y}"`)]);return m}function No(r){const t=r.value,i=r.styleSpec,a=i.terrain,c=r.style;let f=[];const m=Ht(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new Re("terrain",t,`object expected, ${m} found`)]),f;for(const y in t)f=f.concat(a[y]?r.validateSpec({key:y,value:t[y],valueSpec:a[y],validateSpec:r.validateSpec,style:c,styleSpec:i}):[new Re(y,t[y],`unknown property "${y}"`)]);return f}function ca(r){let t=[];const i=r.value,a=r.key;if(Array.isArray(i)){const c=[],f=[];for(const m in i)i[m].id&&c.includes(i[m].id)&&t.push(new Re(a,i,`all the sprites' ids must be unique, but ${i[m].id} is duplicated`)),c.push(i[m].id),i[m].url&&f.includes(i[m].url)&&t.push(new Re(a,i,`all the sprites' URLs must be unique, but ${i[m].url} is duplicated`)),f.push(i[m].url),t=t.concat(Gi({key:`${a}[${m}]`,value:i[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return Rs({key:a,value:i})}const Bs={"*":()=>[],array:la,boolean:function(r){const t=r.value,i=r.key,a=Ht(t);return a!=="boolean"?[new Re(i,t,`boolean expected, ${a} found`)]:[]},number:_s,color:function(r){const t=r.key,i=r.value,a=Ht(i);return a!=="string"?[new Re(t,i,`color expected, ${a} found`)]:kt.parse(String(i))?[]:[new Re(t,i,`color expected, "${i}" found`)]},constants:gu,enum:Ls,filter:_u,function:ua,layer:Sr,object:Gi,source:Fs,light:Rl,sky:Ya,terrain:No,projection:function(r){const t=r.value,i=r.styleSpec,a=i.projection,c=r.style,f=Ht(t);if(t===void 0)return[];if(f!=="object")return[new Re("projection",t,`object expected, ${f} found`)];let m=[];for(const y in t)m=m.concat(a[y]?r.validateSpec({key:y,value:t[y],valueSpec:a[y],style:c,styleSpec:i}):[new Re(y,t[y],`unknown property "${y}"`)]);return m},string:Rs,formatted:function(r){return Rs(r).length===0?[]:uo(r)},resolvedImage:function(r){return Rs(r).length===0?[]:uo(r)},padding:function(r){const t=r.key,i=r.value;if(Ht(i)==="array"){if(i.length<1||i.length>4)return[new Re(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];const a={type:"number"};let c=[];for(let f=0;f<i.length;f++)c=c.concat(r.validateSpec({key:`${t}[${f}]`,value:i[f],validateSpec:r.validateSpec,valueSpec:a}));return c}return _s({key:t,value:i,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const t=r.key,i=r.value,a=Ht(i),c=r.styleSpec;if(a!=="array"||i.length<1||i.length%2!=0)return[new Re(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let m=0;m<i.length;m+=2)f=f.concat(Ls({key:`${t}[${m}]`,value:i[m],valueSpec:c.layout_symbol["text-anchor"]})),f=f.concat(la({key:`${t}[${m+1}]`,value:i[m+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:c}));return f},sprite:ca};function ha(r){const t=r.value,i=r.valueSpec,a=r.styleSpec;return r.validateSpec=ha,i.expression&&Ga(jr(t))?ua(r):i.expression&&ao(kn(t))?uo(r):i.type&&Bs[i.type]?Bs[i.type](r):Gi(jn({},r,{valueSpec:i.type?a[i.type]:i}))}function yc(r){const t=r.value,i=r.key,a=Rs(r);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new Re(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new Re(i,t,'"glyphs" url must include a "{range}" token'))),a}function In(r,t=we){let i=[];return i=i.concat(ha({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:ha,objectElementValidators:{glyphs:yc,"*":()=>[]}})),r.constants&&(i=i.concat(gu({key:"constants",value:r.constants}))),da(i)}function Hn(r){return function(t){return r({...t,validateSpec:ha})}}function da(r){return[].concat(r).sort(((t,i)=>t.line-i.line))}function Hi(r){return function(...t){return da(r.apply(this,t))}}In.source=Hi(Hn(Fs)),In.sprite=Hi(Hn(ca)),In.glyphs=Hi(Hn(yc)),In.light=Hi(Hn(Rl)),In.sky=Hi(Hn(Ya)),In.terrain=Hi(Hn(No)),In.layer=Hi(Hn(Sr)),In.filter=Hi(Hn(_u)),In.paintProperty=Hi(Hn(Ja)),In.layoutProperty=Hi(Hn(Ll));const Os=In,vu=Os.light,xu=Os.sky,Fl=Os.paintProperty,vc=Os.layoutProperty;function Bl(r,t){let i=!1;if(t&&t.length)for(const a of t)r.fire(new us(new Error(a.message))),i=!0;return i}class pa{constructor(t,i,a){const c=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(i=m[1])+2*(a=m[2]);for(let x=0;x<this.d*this.d;x++){const T=m[3+x],E=m[3+x+1];c.push(T===E?null:m.subarray(T,E))}const y=m[3+c.length+1];this.keys=m.subarray(m[3+c.length],y),this.bboxes=m.subarray(y),this.insert=this._insertReadonly}else{this.d=i+2*a;for(let m=0;m<this.d*this.d;m++)c.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=t,this.padding=a,this.scale=i/t,this.uid=0;const f=a/i*t;this.min=-f,this.max=t+f}insert(t,i,a,c,f){this._forEachCell(i,a,c,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,i,a,c,f,m){this.cells[f].push(m)}query(t,i,a,c,f){const m=this.min,y=this.max;if(t<=m&&i<=m&&y<=a&&y<=c&&!f)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,i,a,c,this._queryCell,x,{},f),x}}_queryCell(t,i,a,c,f,m,y,x){const T=this.cells[f];if(T!==null){const E=this.keys,C=this.bboxes;for(let z=0;z<T.length;z++){const R=T[z];if(y[R]===void 0){const O=4*R;(x?x(C[O+0],C[O+1],C[O+2],C[O+3]):t<=C[O+2]&&i<=C[O+3]&&a>=C[O+0]&&c>=C[O+1])?(y[R]=!0,m.push(E[R])):y[R]=!1}}}}_forEachCell(t,i,a,c,f,m,y,x){const T=this._convertToCellCoord(t),E=this._convertToCellCoord(i),C=this._convertToCellCoord(a),z=this._convertToCellCoord(c);for(let R=T;R<=C;R++)for(let O=E;O<=z;O++){const j=this.d*O+R;if((!x||x(this._convertFromCellCoord(R),this._convertFromCellCoord(O),this._convertFromCellCoord(R+1),this._convertFromCellCoord(O+1)))&&f.call(this,t,i,a,c,j,m,y,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,i=3+this.cells.length+1+1;let a=0;for(let m=0;m<this.cells.length;m++)a+=this.cells[m].length;const c=new Int32Array(i+a+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let f=i;for(let m=0;m<t.length;m++){const y=t[m];c[3+m]=f,c.set(y,f),f+=y.length}return c[3+t.length]=f,c.set(this.keys,f),f+=this.keys.length,c[3+t.length+1]=f,c.set(this.bboxes,f),f+=this.bboxes.length,c.buffer}static serialize(t,i){const a=t.toArrayBuffer();return i&&i.push(a),{buffer:a}}static deserialize(t){return new pa(t.buffer)}}const En={};function Ye(r,t,i={}){if(En[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),En[r]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}Ye("Object",Object),Ye("TransferableGridIndex",pa),Ye("Color",kt),Ye("Error",Error),Ye("AJAXError",qt),Ye("ResolvedImage",ki),Ye("StylePropertyFunction",lo),Ye("StyleExpression",qi,{omit:["_evaluator"]}),Ye("ZoomDependentExpression",Fo),Ye("ZoomConstantExpression",Ro),Ye("CompoundExpression",hn,{omit:["_evaluate"]});for(const r in Ao)Ao[r]._classRegistryKey||Ye(`Expression_${r}`,Ao[r]);function Wn(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Ol(r){return r.$name||r.constructor._classRegistryKey}function Vo(r){return!(function(t){if(t===null||typeof t!="object")return!1;const i=Ol(t);return!(!i||i==="Object")})(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||Wn(r)||or(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function Ri(r,t){if(Vo(r))return(Wn(r)||or(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const f=[];for(const m of r)f.push(Ri(m,t));return f}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const i=Ol(r);if(!i)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!En[i])throw new Error(`${i} is not registered.`);const{klass:a}=En[i],c=a.serialize?a.serialize(r,t):{};if(a.serialize){if(t&&c===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in r){if(!r.hasOwnProperty(f)||En[i].omit.indexOf(f)>=0)continue;const m=r[f];c[f]=En[i].shallow.indexOf(f)>=0?m:Ri(m,t)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(c.$name=i),c}function ys(r){if(Vo(r))return r;if(Array.isArray(r))return r.map(ys);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=Ol(r)||"Object";if(!En[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:i}=En[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(r);const a=Object.create(i.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const f=r[c];a[c]=En[t].shallow.indexOf(c)>=0?f:ys(f)}return a}class Xn{constructor(){this.first=!0}update(t,i){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=i),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const Ut={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function wu(r){for(const t of r)if(tl(t.charCodeAt(0)))return!0;return!1}function dh(r){for(const t of r)if(!Kn(t.charCodeAt(0)))return!1;return!0}function Ns(r){const t=r.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(t.join("|"),"u")}const Qa=Ns(["Arab","Dupl","Mong","Ougr","Syrc"]);function Kn(r){return!Qa.test(String.fromCodePoint(r))}const el=Ns(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function tl(r){return!(r!==746&&r!==747&&(r<4352||!(Ut["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Ut["CJK Compatibility"](r)||Ut["CJK Strokes"](r)||!(!Ut["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Ut["Enclosed CJK Letters and Months"](r)||Ut["Ideographic Description Characters"](r)||Ut.Kanbun(r)||Ut.Katakana(r)&&r!==12540||!(!Ut["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Ut["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Ut["Vertical Forms"](r)||Ut["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||el.test(String.fromCodePoint(r)))))}function jo(r){return!(tl(r)||(function(t){return!!(Ut["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ut["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ut["Letterlike Symbols"](t)||Ut["Number Forms"](t)||Ut["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ut["Control Pictures"](t)&&t!==9251||Ut["Optical Character Recognition"](t)||Ut["Enclosed Alphanumerics"](t)||Ut["Geometric Shapes"](t)||Ut["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ut["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ut["CJK Symbols and Punctuation"](t)||Ut.Katakana(t)||Ut["Private Use Area"](t)||Ut["CJK Compatibility Forms"](t)||Ut["Small Form Variants"](t)||Ut["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(r))}const ho=Ns(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Tr(r){return ho.test(String.fromCodePoint(r))}function Er(r,t){return!(!t&&Tr(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Ut.Khmer(r))}function po(r){for(const t of r)if(Tr(t.charCodeAt(0)))return!0;return!1}const gr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Zt{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Xn,this.transition={})}isSupportedScript(t){return(function(i,a){for(const c of i)if(!Er(c.charCodeAt(0),a))return!1;return!0})(t,gr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,i=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*i}}}class Cn{constructor(t,i){this.property=t,this.value=i,this.expression=(function(a,c){if(Ga(a))return new lo(a,c);if(ao(a)){const f=zl(a,c);if(f.result==="error")throw new Error(f.value.map((m=>`${m.key}: ${m.message}`)).join(", "));return f.value}{let f=a;return c.type==="color"&&typeof a=="string"?f=kt.parse(a):c.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(f=un.parse(a)):f=Ti.parse(a),{kind:"constant",evaluate:()=>f}}})(i===void 0?t.specification.default:i,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,a){return this.property.possiblyEvaluate(this,t,i,a)}}class Vs{constructor(t){this.property=t,this.value=new Cn(t,void 0)}transitioned(t,i){return new rl(this.property,this.value,i,zr({},t.transition,this.transition),t.now)}untransitioned(){return new rl(this.property,this.value,null,{},0)}}class yi{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Kt(this._values[t].value.value)}setValue(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Vs(this._values[t].property)),this._values[t].value=new Cn(this._values[t].property,i===null?void 0:Kt(i))}getTransition(t){return Kt(this._values[t].transition)}setTransition(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Vs(this._values[t].property)),this._values[t].transition=Kt(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a);const c=this.getTransition(i);c!==void 0&&(t[`${i}-transition`]=c)}return t}transitioned(t,i){const a=new fa(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(t,i._values[c]);return a}untransitioned(){const t=new fa(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class rl{constructor(t,i,a,c,f){this.property=t,this.value=i,this.begin=f+c.delay||0,this.end=this.begin+c.duration||0,t.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(t,i,a){const c=t.now||0,f=this.value.possiblyEvaluate(t,i,a),m=this.prior;if(m){if(c>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(c<this.begin)return m.possiblyEvaluate(t,i,a);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,i,a),f,(function(x){if(x<=0)return 0;if(x>=1)return 1;const T=x*x,E=T*x;return 4*(x<.5?E:3*(x-T)+E-.75)})(y))}}return f}}class fa{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,a){const c=new ga(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(t,i,a);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ma{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Kt(this._values[t].value)}setValue(t,i){this._values[t]=new Cn(this._values[t].property,i===null?void 0:Kt(i))}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a)}return t}possiblyEvaluate(t,i,a){const c=new ga(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(t,i,a);return c}}class dn{constructor(t,i,a){this.property=t,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,a,c){return this.property.evaluate(this.value,this.parameters,t,i,a,c)}}class ga{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Qe{constructor(t){this.specification=t}possiblyEvaluate(t,i){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(i)}interpolate(t,i,a){const c=Xr[this.specification.type];return c?c(t,i,a):t}}class ft{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,a,c){return new dn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},a,c)}:t.expression,i)}interpolate(t,i,a){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new dn(this,{kind:"constant",value:void 0},t.parameters);const c=Xr[this.specification.type];if(c){const f=c(t.value.value,i.value.value,a);return new dn(this,{kind:"constant",value:f},t.parameters)}return t}evaluate(t,i,a,c,f,m){return t.kind==="constant"?t.value:t.evaluate(i,a,c,f,m)}}class _a extends ft{possiblyEvaluate(t,i,a,c){if(t.value===void 0)return new dn(this,{kind:"constant",value:void 0},i);if(t.expression.kind==="constant"){const f=t.expression.evaluate(i,null,{},a,c),m=t.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,y=this._calculate(m,m,m,i);return new dn(this,{kind:"constant",value:y},i)}if(t.expression.kind==="camera"){const f=this._calculate(t.expression.evaluate({zoom:i.zoom-1}),t.expression.evaluate({zoom:i.zoom}),t.expression.evaluate({zoom:i.zoom+1}),i);return new dn(this,{kind:"constant",value:f},i)}return new dn(this,t.expression,i)}evaluate(t,i,a,c,f,m){if(t.kind==="source"){const y=t.evaluate(i,a,c,f,m);return this._calculate(y,y,y,i)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(i.zoom)-1},a,c),t.evaluate({zoom:Math.floor(i.zoom)},a,c),t.evaluate({zoom:Math.floor(i.zoom)+1},a,c),i):t.value}_calculate(t,i,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class il{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,c){if(t.value!==void 0){if(t.expression.kind==="constant"){const f=t.expression.evaluate(i,null,{},a,c);return this._calculate(f,f,f,i)}return this._calculate(t.expression.evaluate(new Zt(Math.floor(i.zoom-1),i)),t.expression.evaluate(new Zt(Math.floor(i.zoom),i)),t.expression.evaluate(new Zt(Math.floor(i.zoom+1),i)),i)}}_calculate(t,i,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class bu{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,c){return!!t.expression.evaluate(i,null,{},a,c)}interpolate(){return!1}}class p{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in t){const a=t[i];a.specification.overridable&&this.overridableProperties.push(i);const c=this.defaultPropertyValues[i]=new Cn(a,void 0),f=this.defaultTransitionablePropertyValues[i]=new Vs(a);this.defaultTransitioningPropertyValues[i]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=c.possiblyEvaluate({})}}}Ye("DataDrivenProperty",ft),Ye("DataConstantProperty",Qe),Ye("CrossFadedDataDrivenProperty",_a),Ye("CrossFadedProperty",il),Ye("ColorRampProperty",bu);const e="-transition";class s extends wo{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),i.layout&&(this._unevaluatedLayout=new ma(i.layout)),i.paint)){this._transitionablePaint=new yi(i.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ga(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,a={}){i!=null&&this._validate(vc,`layers.${this.id}.layout.${t}`,t,i,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,a={}){if(i!=null&&this._validate(Fl,`layers.${this.id}.paint.${t}`,t,i,a))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{const c=this._transitionablePaint._values[t],f=c.property.specification["property-type"]==="cross-faded-data-driven",m=c.value.isDataDriven(),y=c.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||m||f||this._handleOverridablePaintPropertyUpdate(t,y,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,i,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),nn(t,((i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length)))}_validate(t,i,a,c,f={}){return(!f||f.validate!==!1)&&Bl(this,t.call(Os,{key:i,layerType:this.type,objectKey:a,value:c,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof dn&&sa(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}const l={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class u{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class d{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function v(r,t=1){let i=0,a=0;return{members:r.map((c=>{const f=l[c.type].BYTES_PER_ELEMENT,m=i=w(i,Math.max(t,f)),y=c.components||1;return a=Math.max(a,f),i+=f*y,{name:c.name,type:c.type,components:y,offset:m}})),size:w(i,Math.max(a,t)),alignment:t}}function w(r,t){return Math.ceil(r/t)*t}class S extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const c=2*t;return this.int16[c+0]=i,this.int16[c+1]=a,t}}S.prototype.bytesPerElement=4,Ye("StructArrayLayout2i4",S);class I extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,a)}emplace(t,i,a,c){const f=3*t;return this.int16[f+0]=i,this.int16[f+1]=a,this.int16[f+2]=c,t}}I.prototype.bytesPerElement=6,Ye("StructArrayLayout3i6",I);class P extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,a,c)}emplace(t,i,a,c,f){const m=4*t;return this.int16[m+0]=i,this.int16[m+1]=a,this.int16[m+2]=c,this.int16[m+3]=f,t}}P.prototype.bytesPerElement=8,Ye("StructArrayLayout4i8",P);class M extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,a,c,f,m)}emplace(t,i,a,c,f,m,y){const x=6*t;return this.int16[x+0]=i,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=y,t}}M.prototype.bytesPerElement=12,Ye("StructArrayLayout2i4i12",M);class F extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,a,c,f,m)}emplace(t,i,a,c,f,m,y){const x=4*t,T=8*t;return this.int16[x+0]=i,this.int16[x+1]=a,this.uint8[T+4]=c,this.uint8[T+5]=f,this.uint8[T+6]=m,this.uint8[T+7]=y,t}}F.prototype.bytesPerElement=8,Ye("StructArrayLayout2i4ub8",F);class N extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const c=2*t;return this.float32[c+0]=i,this.float32[c+1]=a,t}}N.prototype.bytesPerElement=8,Ye("StructArrayLayout2f8",N);class U extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,f,m,y,x,T,E){const C=this.length;return this.resize(C+1),this.emplace(C,t,i,a,c,f,m,y,x,T,E)}emplace(t,i,a,c,f,m,y,x,T,E,C){const z=10*t;return this.uint16[z+0]=i,this.uint16[z+1]=a,this.uint16[z+2]=c,this.uint16[z+3]=f,this.uint16[z+4]=m,this.uint16[z+5]=y,this.uint16[z+6]=x,this.uint16[z+7]=T,this.uint16[z+8]=E,this.uint16[z+9]=C,t}}U.prototype.bytesPerElement=20,Ye("StructArrayLayout10ui20",U);class $ extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,f,m,y,x,T,E,C,z){const R=this.length;return this.resize(R+1),this.emplace(R,t,i,a,c,f,m,y,x,T,E,C,z)}emplace(t,i,a,c,f,m,y,x,T,E,C,z,R){const O=12*t;return this.int16[O+0]=i,this.int16[O+1]=a,this.int16[O+2]=c,this.int16[O+3]=f,this.uint16[O+4]=m,this.uint16[O+5]=y,this.uint16[O+6]=x,this.uint16[O+7]=T,this.int16[O+8]=E,this.int16[O+9]=C,this.int16[O+10]=z,this.int16[O+11]=R,t}}$.prototype.bytesPerElement=24,Ye("StructArrayLayout4i4ui4i24",$);class W extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,a)}emplace(t,i,a,c){const f=3*t;return this.float32[f+0]=i,this.float32[f+1]=a,this.float32[f+2]=c,t}}W.prototype.bytesPerElement=12,Ye("StructArrayLayout3f12",W);class J extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}J.prototype.bytesPerElement=4,Ye("StructArrayLayout1ul4",J);class re extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,f,m,y,x,T){const E=this.length;return this.resize(E+1),this.emplace(E,t,i,a,c,f,m,y,x,T)}emplace(t,i,a,c,f,m,y,x,T,E){const C=10*t,z=5*t;return this.int16[C+0]=i,this.int16[C+1]=a,this.int16[C+2]=c,this.int16[C+3]=f,this.int16[C+4]=m,this.int16[C+5]=y,this.uint32[z+3]=x,this.uint16[C+8]=T,this.uint16[C+9]=E,t}}re.prototype.bytesPerElement=20,Ye("StructArrayLayout6i1ul2ui20",re);class q extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,a,c,f,m)}emplace(t,i,a,c,f,m,y){const x=6*t;return this.int16[x+0]=i,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=y,t}}q.prototype.bytesPerElement=12,Ye("StructArrayLayout2i2i2i12",q);class oe extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,i,a,c,f)}emplace(t,i,a,c,f,m){const y=4*t,x=8*t;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=c,this.int16[x+6]=f,this.int16[x+7]=m,t}}oe.prototype.bytesPerElement=16,Ye("StructArrayLayout2f1f2i16",oe);class ue extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,a,c,f,m)}emplace(t,i,a,c,f,m,y){const x=16*t,T=4*t,E=8*t;return this.uint8[x+0]=i,this.uint8[x+1]=a,this.float32[T+1]=c,this.float32[T+2]=f,this.int16[E+6]=m,this.int16[E+7]=y,t}}ue.prototype.bytesPerElement=16,Ye("StructArrayLayout2ub2f2i16",ue);class _e extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,a)}emplace(t,i,a,c){const f=3*t;return this.uint16[f+0]=i,this.uint16[f+1]=a,this.uint16[f+2]=c,t}}_e.prototype.bytesPerElement=6,Ye("StructArrayLayout3ui6",_e);class Ce extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,c,f,m,y,x,T,E,C,z,R,O,j,X,ee){const fe=this.length;return this.resize(fe+1),this.emplace(fe,t,i,a,c,f,m,y,x,T,E,C,z,R,O,j,X,ee)}emplace(t,i,a,c,f,m,y,x,T,E,C,z,R,O,j,X,ee,fe){const ne=24*t,ce=12*t,Te=48*t;return this.int16[ne+0]=i,this.int16[ne+1]=a,this.uint16[ne+2]=c,this.uint16[ne+3]=f,this.uint32[ce+2]=m,this.uint32[ce+3]=y,this.uint32[ce+4]=x,this.uint16[ne+10]=T,this.uint16[ne+11]=E,this.uint16[ne+12]=C,this.float32[ce+7]=z,this.float32[ce+8]=R,this.uint8[Te+36]=O,this.uint8[Te+37]=j,this.uint8[Te+38]=X,this.uint32[ce+10]=ee,this.int16[ne+22]=fe,t}}Ce.prototype.bytesPerElement=48,Ye("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ce);class Le extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,c,f,m,y,x,T,E,C,z,R,O,j,X,ee,fe,ne,ce,Te,ze,Je,yt,Xe,Ge,ut,nt){const tt=this.length;return this.resize(tt+1),this.emplace(tt,t,i,a,c,f,m,y,x,T,E,C,z,R,O,j,X,ee,fe,ne,ce,Te,ze,Je,yt,Xe,Ge,ut,nt)}emplace(t,i,a,c,f,m,y,x,T,E,C,z,R,O,j,X,ee,fe,ne,ce,Te,ze,Je,yt,Xe,Ge,ut,nt,tt){const Ee=32*t,ht=16*t;return this.int16[Ee+0]=i,this.int16[Ee+1]=a,this.int16[Ee+2]=c,this.int16[Ee+3]=f,this.int16[Ee+4]=m,this.int16[Ee+5]=y,this.int16[Ee+6]=x,this.int16[Ee+7]=T,this.uint16[Ee+8]=E,this.uint16[Ee+9]=C,this.uint16[Ee+10]=z,this.uint16[Ee+11]=R,this.uint16[Ee+12]=O,this.uint16[Ee+13]=j,this.uint16[Ee+14]=X,this.uint16[Ee+15]=ee,this.uint16[Ee+16]=fe,this.uint16[Ee+17]=ne,this.uint16[Ee+18]=ce,this.uint16[Ee+19]=Te,this.uint16[Ee+20]=ze,this.uint16[Ee+21]=Je,this.uint16[Ee+22]=yt,this.uint32[ht+12]=Xe,this.float32[ht+13]=Ge,this.float32[ht+14]=ut,this.uint16[Ee+30]=nt,this.uint16[Ee+31]=tt,t}}Le.prototype.bytesPerElement=64,Ye("StructArrayLayout8i15ui1ul2f2ui64",Le);class Ne extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Ne.prototype.bytesPerElement=4,Ye("StructArrayLayout1f4",Ne);class He extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,a)}emplace(t,i,a,c){const f=3*t;return this.uint16[6*t+0]=i,this.float32[f+1]=a,this.float32[f+2]=c,t}}He.prototype.bytesPerElement=12,Ye("StructArrayLayout1ui2f12",He);class Ve extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,a)}emplace(t,i,a,c){const f=4*t;return this.uint32[2*t+0]=i,this.uint16[f+2]=a,this.uint16[f+3]=c,t}}Ve.prototype.bytesPerElement=8,Ye("StructArrayLayout1ul2ui8",Ve);class Be extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const c=2*t;return this.uint16[c+0]=i,this.uint16[c+1]=a,t}}Be.prototype.bytesPerElement=4,Ye("StructArrayLayout2ui4",Be);class it extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}it.prototype.bytesPerElement=2,Ye("StructArrayLayout1ui2",it);class bt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,a,c)}emplace(t,i,a,c,f){const m=4*t;return this.float32[m+0]=i,this.float32[m+1]=a,this.float32[m+2]=c,this.float32[m+3]=f,t}}bt.prototype.bytesPerElement=16,Ye("StructArrayLayout4f16",bt);class Ue extends u{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ke(this.anchorPointX,this.anchorPointY)}}Ue.prototype.size=20;class Ze extends re{get(t){return new Ue(this,t)}}Ye("CollisionBoxArray",Ze);class wt extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}wt.prototype.size=48;class fr extends Ce{get(t){return new wt(this,t)}}Ye("PlacedSymbolArray",fr);class Ct extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ct.prototype.size=64;class Lt extends Le{get(t){return new Ct(this,t)}}Ye("SymbolInstanceArray",Lt);class _r extends Ne{getoffsetX(t){return this.float32[1*t+0]}}Ye("GlyphOffsetArray",_r);class pi extends I{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ye("SymbolLineVertexArray",pi);class pn extends u{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}pn.prototype.size=12;class yr extends He{get(t){return new pn(this,t)}}Ye("TextAnchorOffsetArray",yr);class si extends u{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}si.prototype.size=8;class Cr extends Ve{get(t){return new si(this,t)}}Ye("FeatureIndexArray",Cr);class qr extends S{}class vi extends S{}class Jn extends S{}class Wi extends M{}class Yn extends F{}class fo extends N{}class fn extends U{}class Pn extends ${}class vs extends W{}class Fi extends J{}class mn extends q{}class Qn extends ue{}class Mn extends _e{}class Kr extends Be{}const Dr=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:xi}=Dr;class Bt{constructor(t=[]){this.segments=t}prepareSegment(t,i,a,c){let f=this.segments[this.segments.length-1];return t>Bt.MAX_VERTEX_ARRAY_LENGTH&&mr(`Max vertices per segment is ${Bt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!f||f.vertexLength+t>Bt.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==c)&&(f={vertexOffset:i.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},c!==void 0&&(f.sortKey=c),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,a,c){return new Bt([{vertexOffset:t,primitiveOffset:i,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function gn(r,t){return 256*(r=hr(Math.floor(r),0,255))+hr(Math.floor(t),0,255)}Bt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ye("SegmentVector",Bt);const mo=v([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var es={exports:{}},Su={exports:{}};Su.exports=function(r,t){var i,a,c,f,m,y,x,T;for(a=r.length-(i=3&r.length),c=t,m=3432918353,y=461845907,T=0;T<a;)x=255&r.charCodeAt(T)|(255&r.charCodeAt(++T))<<8|(255&r.charCodeAt(++T))<<16|(255&r.charCodeAt(++T))<<24,++T,c=27492+(65535&(f=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(x=0,i){case 3:x^=(255&r.charCodeAt(T+2))<<16;case 2:x^=(255&r.charCodeAt(T+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&r.charCodeAt(T)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return c^=r.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Tu=Su.exports,Or={exports:{}};Or.exports=function(r,t){for(var i,a=r.length,c=t^a,f=0;a>=4;)i=1540483477*(65535&(i=255&r.charCodeAt(f)|(255&r.charCodeAt(++f))<<8|(255&r.charCodeAt(++f))<<16|(255&r.charCodeAt(++f))<<24))+((1540483477*(i>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++f;switch(a){case 3:c^=(255&r.charCodeAt(f+2))<<16;case 2:c^=(255&r.charCodeAt(f+1))<<8;case 1:c=1540483477*(65535&(c^=255&r.charCodeAt(f)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var ts=Tu,Nl=Or.exports;es.exports=ts,es.exports.murmur3=ts,es.exports.murmur2=Nl;var ya=qe(es.exports);class go{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,a,c){this.ids.push(va(t)),this.positions.push(i,a,c)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=va(t);let a=0,c=this.ids.length-1;for(;a<c;){const m=a+c>>1;this.ids[m]>=i?c=m:a=m+1}const f=[];for(;this.ids[a]===i;)f.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return f}static serialize(t,i){const a=new Float64Array(t.ids),c=new Uint32Array(t.positions);return xs(a,c,0,a.length-1),i&&i.push(a.buffer,c.buffer),{ids:a,positions:c}}static deserialize(t){const i=new go;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function va(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ya(String(r))}function xs(r,t,i,a){for(;i<a;){const c=r[i+a>>1];let f=i-1,m=a+1;for(;;){do f++;while(r[f]<c);do m--;while(r[m]>c);if(f>=m)break;vr(r,f,m),vr(t,3*f,3*m),vr(t,3*f+1,3*m+1),vr(t,3*f+2,3*m+2)}m-i<a-m?(xs(r,t,i,m),i=m+1):(xs(r,t,m+1,a),a=m)}}function vr(r,t,i){const a=r[t];r[t]=r[i],r[i]=a}Ye("FeaturePositionMap",go);class Ur{constructor(t,i){this.gl=t.gl,this.location=i}}class oi extends Ur{constructor(t,i){super(t,i),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class ku extends Ur{constructor(t,i){super(t,i),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Vl extends Ur{constructor(t,i){super(t,i),this.current=kt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Iu=new Float32Array(16);function ph(r){return[gn(255*r.r,255*r.g),gn(255*r.b,255*r.a)]}class fi{constructor(t,i,a){this.value=t,this.uniformNames=i.map((c=>`u_${c}`)),this.type=a}setUniform(t,i,a){t.set(a.constantOr(this.value))}getBinding(t,i,a){return this.type==="color"?new Vl(t,i):new oi(t,i)}}class xa{constructor(t,i){this.uniformNames=i.map((a=>`u_${a}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=t.tlbr}setUniform(t,i,a,c){const f=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&t.set(f)}getBinding(t,i,a){return a.substr(0,9)==="u_pattern"?new ku(t,i):new oi(t,i)}}class js{constructor(t,i,a,c){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map((f=>({name:`a_${f}`,type:"Float32",components:a==="color"?2:1,offset:0}))),this.paintVertexArray=new c}populatePaintArray(t,i,a,c,f){const m=this.paintVertexArray.length,y=this.expression.evaluate(new Zt(0),i,{},c,[],f);this.paintVertexArray.resize(t),this._setPaintValue(m,t,y)}updatePaintArray(t,i,a,c){const f=this.expression.evaluate({zoom:0},a,c);this._setPaintValue(t,i,f)}_setPaintValue(t,i,a){if(this.type==="color"){const c=ph(a);for(let f=t;f<i;f++)this.paintVertexArray.emplace(f,c[0],c[1])}else{for(let c=t;c<i;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class rs{constructor(t,i,a,c,f,m){this.expression=t,this.uniformNames=i.map((y=>`u_${y}_t`)),this.type=a,this.useIntegerZoom=c,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map((y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0}))),this.paintVertexArray=new m}populatePaintArray(t,i,a,c,f){const m=this.expression.evaluate(new Zt(this.zoom),i,{},c,[],f),y=this.expression.evaluate(new Zt(this.zoom+1),i,{},c,[],f),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,m,y)}updatePaintArray(t,i,a,c){const f=this.expression.evaluate({zoom:this.zoom},a,c),m=this.expression.evaluate({zoom:this.zoom+1},a,c);this._setPaintValue(t,i,f,m)}_setPaintValue(t,i,a,c){if(this.type==="color"){const f=ph(a),m=ph(c);for(let y=t;y<i;y++)this.paintVertexArray.emplace(y,f[0],f[1],m[0],m[1])}else{for(let f=t;f<i;f++)this.paintVertexArray.emplace(f,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i){const a=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,c=hr(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(c)}getBinding(t,i,a){return new oi(t,i)}}class Bi{constructor(t,i,a,c,f,m){this.expression=t,this.type=i,this.useIntegerZoom=a,this.zoom=c,this.layerId=m,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(t,i,a){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(c,t,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(t,i,a,c,f){this._setPaintValues(t,i,a.patterns&&a.patterns[this.layerId],f)}_setPaintValues(t,i,a,c){if(!c||!a)return;const{min:f,mid:m,max:y}=a,x=c[f],T=c[m],E=c[y];if(x&&T&&E)for(let C=t;C<i;C++)this.zoomInPaintVertexArray.emplace(C,T.tl[0],T.tl[1],T.br[0],T.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],T.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,T.tl[0],T.tl[1],T.br[0],T.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],T.pixelRatio,E.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,mo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,mo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class is{constructor(t,i,a){this.binders={},this._buffers=[];const c=[];for(const f in t.paint._values){if(!a(f))continue;const m=t.paint.get(f);if(!(m instanceof dn&&sa(m.property.specification)))continue;const y=fh(f,t.type),x=m.value,T=m.property.specification.type,E=m.property.useIntegerZoom,C=m.property.specification["property-type"],z=C==="cross-faded"||C==="cross-faded-data-driven";if(x.kind==="constant")this.binders[f]=z?new xa(x.value,y):new fi(x.value,y,T),c.push(`/u_${f}`);else if(x.kind==="source"||z){const R=xc(f,T,"source");this.binders[f]=z?new Bi(x,T,E,i,R,t.id):new js(x,y,T,R),c.push(`/a_${f}`)}else{const R=xc(f,T,"composite");this.binders[f]=new rs(x,y,T,E,i,R),c.push(`/z_${f}`)}}this.cacheKey=c.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof js||i instanceof rs?i.maxValue:0}populatePaintArrays(t,i,a,c,f){for(const m in this.binders){const y=this.binders[m];(y instanceof js||y instanceof rs||y instanceof Bi)&&y.populatePaintArray(t,i,a,c,f)}}setConstantPatternPositions(t,i){for(const a in this.binders){const c=this.binders[a];c instanceof xa&&c.setConstantPatternPositions(t,i)}}updatePaintArrays(t,i,a,c,f){let m=!1;for(const y in t){const x=i.getPositions(y);for(const T of x){const E=a.feature(T.index);for(const C in this.binders){const z=this.binders[C];if((z instanceof js||z instanceof rs||z instanceof Bi)&&z.expression.isStateDependent===!0){const R=c.paint.get(C);z.expression=R.value,z.updatePaintArray(T.start,T.end,E,t[y],f),m=!0}}}}return m}defines(){const t=[];for(const i in this.binders){const a=this.binders[i];(a instanceof fi||a instanceof xa)&&t.push(...a.uniformNames.map((c=>`#define HAS_UNIFORM_${c}`)))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof js||a instanceof rs)for(let c=0;c<a.paintVertexAttributes.length;c++)t.push(a.paintVertexAttributes[c].name);else if(a instanceof Bi)for(let c=0;c<mo.members.length;c++)t.push(mo.members[c].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof fi||a instanceof xa||a instanceof rs)for(const c of a.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,i){const a=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof fi||f instanceof xa||f instanceof rs){for(const m of f.uniformNames)if(i[m]){const y=f.getBinding(t,i[m],m);a.push({name:m,property:c,binding:y})}}}return a}setUniforms(t,i,a,c){for(const{name:f,property:m,binding:y}of i)this.binders[m].setUniform(y,c,a.get(m),f)}updatePaintBuffers(t){this._buffers=[];for(const i in this.binders){const a=this.binders[i];if(t&&a instanceof Bi){const c=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(a instanceof js||a instanceof rs)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const i in this.binders){const a=this.binders[i];(a instanceof js||a instanceof rs||a instanceof Bi)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof js||i instanceof rs||i instanceof Bi)&&i.destroy()}}}class Us{constructor(t,i,a=(()=>!0)){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new is(c,i,a);this.needsUpload=!1,this._featureMap=new go,this._bufferOffset=0}populatePaintArrays(t,i,a,c,f,m){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(t,i,c,f,m);i.id!==void 0&&this._featureMap.add(i.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,a,c){for(const f of a)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(t,this._featureMap,i,f,c)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function fh(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function xc(r,t,i){const a={color:{source:N,composite:bt},number:{source:Ne,composite:N}},c=(function(f){return{"line-pattern":{source:fn,composite:fn},"fill-pattern":{source:fn,composite:fn},"fill-extrusion-pattern":{source:fn,composite:fn}}[f]})(r);return c&&c[i]||a[t][i]}Ye("ConstantBinder",fi),Ye("CrossFadedConstantBinder",xa),Ye("SourceExpressionBinder",js),Ye("CrossFadedCompositeBinder",Bi),Ye("CompositeExpressionBinder",rs),Ye("ProgramConfiguration",is,{omit:["_buffers"]}),Ye("ProgramConfigurationSet",Us);const Jr=8192,wc=Math.pow(2,14)-1,mh=-wc-1;function wa(r){const t=Jr/r.extent,i=r.loadGeometry();for(let a=0;a<i.length;a++){const c=i[a];for(let f=0;f<c.length;f++){const m=c[f],y=Math.round(m.x*t),x=Math.round(m.y*t);m.x=hr(y,mh,wc),m.y=hr(x,mh,wc),(y<m.x||y>m.x+1||x<m.y||x>m.y+1)&&mr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function ba(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?wa(r):[]}}function Eu(r,t,i,a,c){r.emplaceBack(2*t+(a+1)/2,2*i+(c+1)/2)}class bc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new vi,this.indexArray=new Mn,this.segments=new Bt,this.programConfigurations=new Us(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,a){const c=this.layers[0],f=[];let m=null,y=!1;c.type==="circle"&&(m=c.layout.get("circle-sort-key"),y=!m.isConstant());for(const{feature:x,id:T,index:E,sourceLayerIndex:C}of t){const z=this.layers[0]._featureFilter.needGeometry,R=ba(x,z);if(!this.layers[0]._featureFilter.filter(new Zt(this.zoom),R,a))continue;const O=y?m.evaluate(R,{},a):void 0,j={id:T,properties:x.properties,type:x.type,sourceLayerIndex:C,index:E,geometry:z?R.geometry:wa(x),patterns:{},sortKey:O};f.push(j)}y&&f.sort(((x,T)=>x.sortKey-T.sortKey));for(const x of f){const{geometry:T,index:E,sourceLayerIndex:C}=x,z=t[E].feature;this.addFeature(x,T,E,a),i.featureIndex.insert(z,T,E,C,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,a,c){for(const f of i)for(const m of f){const y=m.x,x=m.y;if(y<0||y>=Jr||x<0||x>=Jr)continue;const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),E=T.vertexLength;Eu(this.layoutVertexArray,y,x,-1,-1),Eu(this.layoutVertexArray,y,x,1,-1),Eu(this.layoutVertexArray,y,x,1,1),Eu(this.layoutVertexArray,y,x,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},c)}}function gh(r,t){for(let i=0;i<r.length;i++)if(nl(t,r[i]))return!0;for(let i=0;i<t.length;i++)if(nl(r,t[i]))return!0;return!!jl(r,t)}function Cu(r,t,i){return!!nl(r,t)||!!Pu(t,r,i)}function _h(r,t){if(r.length===1)return vh(t,r[0]);for(let i=0;i<t.length;i++){const a=t[i];for(let c=0;c<a.length;c++)if(nl(r,a[c]))return!0}for(let i=0;i<r.length;i++)if(vh(t,r[i]))return!0;for(let i=0;i<t.length;i++)if(jl(r,t[i]))return!0;return!1}function Sc(r,t,i){if(r.length>1){if(jl(r,t))return!0;for(let a=0;a<t.length;a++)if(Pu(t[a],r,i))return!0}for(let a=0;a<r.length;a++)if(Pu(r[a],t,i))return!0;return!1}function jl(r,t){if(r.length===0||t.length===0)return!1;for(let i=0;i<r.length-1;i++){const a=r[i],c=r[i+1];for(let f=0;f<t.length-1;f++)if($h(a,c,t[f],t[f+1]))return!0}return!1}function $h(r,t,i,a){return Ar(r,i,a)!==Ar(t,i,a)&&Ar(r,t,i)!==Ar(r,t,a)}function Pu(r,t,i){const a=i*i;if(t.length===1)return r.distSqr(t[0])<a;for(let c=1;c<t.length;c++)if(yh(r,t[c-1],t[c])<a)return!0;return!1}function yh(r,t,i){const a=t.distSqr(i);if(a===0)return r.distSqr(t);const c=((r.x-t.x)*(i.x-t.x)+(r.y-t.y)*(i.y-t.y))/a;return r.distSqr(c<0?t:c>1?i:i.sub(t)._mult(c)._add(t))}function vh(r,t){let i,a,c,f=!1;for(let m=0;m<r.length;m++){i=r[m];for(let y=0,x=i.length-1;y<i.length;x=y++)a=i[y],c=i[x],a.y>t.y!=c.y>t.y&&t.x<(c.x-a.x)*(t.y-a.y)/(c.y-a.y)+a.x&&(f=!f)}return f}function nl(r,t){let i=!1;for(let a=0,c=r.length-1;a<r.length;c=a++){const f=r[a],m=r[c];f.y>t.y!=m.y>t.y&&t.x<(m.x-f.x)*(t.y-f.y)/(m.y-f.y)+f.x&&(i=!i)}return i}function Zh(r,t,i){const a=i[0],c=i[2];if(r.x<a.x&&t.x<a.x||r.x>c.x&&t.x>c.x||r.y<a.y&&t.y<a.y||r.y>c.y&&t.y>c.y)return!1;const f=Ar(r,t,i[0]);return f!==Ar(r,t,i[1])||f!==Ar(r,t,i[2])||f!==Ar(r,t,i[3])}function sl(r,t,i){const a=t.paint.get(r).value;return a.kind==="constant"?a.value:i.programConfigurations.get(t.id).getMaxValue(r)}function Mu(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function zu(r,t,i,a,c){if(!t[0]&&!t[1])return r;const f=ke.convert(t)._mult(c);i==="viewport"&&f._rotate(-a);const m=[];for(let y=0;y<r.length;y++)m.push(r[y].sub(f));return m}let xh,qh;Ye("CircleBucket",bc,{omit:["layers"]});var Gh={get paint(){return qh=qh||new p({"circle-radius":new ft(we.paint_circle["circle-radius"]),"circle-color":new ft(we.paint_circle["circle-color"]),"circle-blur":new ft(we.paint_circle["circle-blur"]),"circle-opacity":new ft(we.paint_circle["circle-opacity"]),"circle-translate":new Qe(we.paint_circle["circle-translate"]),"circle-translate-anchor":new Qe(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qe(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qe(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ft(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ft(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ft(we.paint_circle["circle-stroke-opacity"])})},get layout(){return xh=xh||new p({"circle-sort-key":new ft(we.layout_circle["circle-sort-key"])})}},Xi=1e-6,Ul=typeof Float32Array<"u"?Float32Array:Array;function Tc(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function wh(r,t,i){var a=t[0],c=t[1],f=t[2],m=t[3],y=t[4],x=t[5],T=t[6],E=t[7],C=t[8],z=t[9],R=t[10],O=t[11],j=t[12],X=t[13],ee=t[14],fe=t[15],ne=i[0],ce=i[1],Te=i[2],ze=i[3];return r[0]=ne*a+ce*y+Te*C+ze*j,r[1]=ne*c+ce*x+Te*z+ze*X,r[2]=ne*f+ce*T+Te*R+ze*ee,r[3]=ne*m+ce*E+Te*O+ze*fe,r[4]=(ne=i[4])*a+(ce=i[5])*y+(Te=i[6])*C+(ze=i[7])*j,r[5]=ne*c+ce*x+Te*z+ze*X,r[6]=ne*f+ce*T+Te*R+ze*ee,r[7]=ne*m+ce*E+Te*O+ze*fe,r[8]=(ne=i[8])*a+(ce=i[9])*y+(Te=i[10])*C+(ze=i[11])*j,r[9]=ne*c+ce*x+Te*z+ze*X,r[10]=ne*f+ce*T+Te*R+ze*ee,r[11]=ne*m+ce*E+Te*O+ze*fe,r[12]=(ne=i[12])*a+(ce=i[13])*y+(Te=i[14])*C+(ze=i[15])*j,r[13]=ne*c+ce*x+Te*z+ze*X,r[14]=ne*f+ce*T+Te*R+ze*ee,r[15]=ne*m+ce*E+Te*O+ze*fe,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var $l,kc=wh;function Ic(r,t,i){var a=t[0],c=t[1],f=t[2],m=t[3];return r[0]=i[0]*a+i[4]*c+i[8]*f+i[12]*m,r[1]=i[1]*a+i[5]*c+i[9]*f+i[13]*m,r[2]=i[2]*a+i[6]*c+i[10]*f+i[14]*m,r[3]=i[3]*a+i[7]*c+i[11]*f+i[15]*m,r}$l=new Ul(4),Ul!=Float32Array&&($l[0]=0,$l[1]=0,$l[2]=0,$l[3]=0);class Rd extends s{constructor(t){super(t,Gh)}createBucket(t){return new bc(t)}queryRadius(t){const i=t;return sl("circle-radius",this,i)+sl("circle-stroke-width",this,i)+Mu(this.paint.get("circle-translate"))}queryIntersectsFeature(t,i,a,c,f,m,y,x){const T=zu(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,y),E=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a),C=this.paint.get("circle-pitch-alignment")==="map",z=C?T:(function(O,j){return O.map((X=>Hh(X,j)))})(T,x),R=C?E*y:E;for(const O of c)for(const j of O){const X=C?j:Hh(j,x);let ee=R;const fe=Ic([],[j.x,j.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ee*=fe[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ee*=m.cameraToCenterDistance/fe[3]),Cu(z,X,ee))return!0}return!1}}function Hh(r,t){const i=Ic([],[r.x,r.y,0,1],t);return new ke(i[0]/i[3],i[1]/i[3])}class ws extends bc{}let Ec;Ye("HeatmapBucket",ws,{omit:["layers"]});var Cc={get paint(){return Ec=Ec||new p({"heatmap-radius":new ft(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ft(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qe(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bu(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qe(we.paint_heatmap["heatmap-opacity"])})}};function Pc(r,{width:t,height:i},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*i*a)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${t*i*a}`)}else c=new Uint8Array(t*i*a);return r.width=t,r.height=i,r.data=c,r}function bh(r,{width:t,height:i},a){if(t===r.width&&i===r.height)return;const c=Pc({},{width:t,height:i},a);Mc(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,i)},a),r.width=t,r.height=i,r.data=c.data}function Mc(r,t,i,a,c,f){if(c.width===0||c.height===0)return t;if(c.width>r.width||c.height>r.height||i.x>r.width-c.width||i.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||a.x>t.width-c.width||a.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const m=r.data,y=t.data;if(m===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<c.height;x++){const T=((i.y+x)*r.width+i.x)*f,E=((a.y+x)*t.width+a.x)*f;for(let C=0;C<c.width*f;C++)y[E+C]=m[T+C]}return t}class ol{constructor(t,i){Pc(this,t,1,i)}resize(t){bh(this,t,1)}clone(){return new ol({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,c,f){Mc(t,i,a,c,f,1)}}class Ii{constructor(t,i){Pc(this,t,4,i)}resize(t){bh(this,t,4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ii({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,c,f){Mc(t,i,a,c,f,4)}}function zc(r){const t={},i=r.resolution||256,a=r.clips?r.clips.length:1,c=r.image||new Ii({width:i,height:a});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const f=(m,y,x)=>{t[r.evaluationKey]=x;const T=r.expression.evaluate(t);c.data[m+y+0]=Math.floor(255*T.r/T.a),c.data[m+y+1]=Math.floor(255*T.g/T.a),c.data[m+y+2]=Math.floor(255*T.b/T.a),c.data[m+y+3]=Math.floor(255*T.a)};if(r.clips)for(let m=0,y=0;m<a;++m,y+=4*i)for(let x=0,T=0;x<i;x++,T+=4){const E=x/(i-1),{start:C,end:z}=r.clips[m];f(y,T,C*(1-E)+z*E)}else for(let m=0,y=0;m<i;m++,y+=4)f(0,y,m/(i-1));return c}Ye("AlphaImage",ol),Ye("RGBAImage",Ii);const Au="big-fb";class Fd extends s{createBucket(t){return new ws(t)}constructor(t){super(t,Cc),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=zc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Au)&&this.heatmapFbos.delete(Au)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Sh;var Wh={get paint(){return Sh=Sh||new p({"hillshade-illumination-direction":new Qe(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qe(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qe(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qe(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qe(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qe(we.paint_hillshade["hillshade-accent-color"])})}};class Xh extends s{constructor(t){super(t,Wh)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Kh=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:Jh}=Kh;function Yh(r,t,i=2){const a=t&&t.length,c=a?t[0]*i:r.length;let f=_n(r,0,c,i,!0);const m=[];if(!f||f.next===f.prev)return m;let y,x,T;if(a&&(f=(function(E,C,z,R){const O=[];for(let j=0,X=C.length;j<X;j++){const ee=_n(E,C[j]*R,j<X-1?C[j+1]*R:E.length,R,!1);ee===ee.next&&(ee.steiner=!0),O.push(nd(ee))}O.sort(Th);for(let j=0;j<O.length;j++)z=id(O[j],z);return z})(r,t,f,i)),r.length>80*i){y=1/0,x=1/0;let E=-1/0,C=-1/0;for(let z=i;z<c;z+=i){const R=r[z],O=r[z+1];R<y&&(y=R),O<x&&(x=O),R>E&&(E=R),O>C&&(C=O)}T=Math.max(E-y,C-x),T=T!==0?32767/T:0}return Zl(f,m,i,y,x,T,0),m}function _n(r,t,i,a,c){let f;if(c===(function(m,y,x,T){let E=0;for(let C=y,z=x-T;C<x;C+=T)E+=(m[z]-m[C])*(m[C+1]+m[z+1]),z=C;return E})(r,t,i,a)>0)for(let m=t;m<i;m+=a)f=Ru(m/a|0,r[m],r[m+1],f);else for(let m=i-a;m>=t;m-=a)f=Ru(m/a|0,r[m],r[m+1],f);return f&&ql(f,f.next)&&(ns(f),f=f.next),f}function ai(r,t){if(!r)return r;t||(t=r);let i,a=r;do if(i=!1,a.steiner||!ql(a,a.next)&&Gr(a.prev,a,a.next)!==0)a=a.next;else{if(ns(a),a=t=a.prev,a===a.next)break;i=!0}while(i||a!==t);return t}function Zl(r,t,i,a,c,f,m){if(!r)return;!m&&f&&(function(x,T,E,C){let z=x;do z.z===0&&(z.z=Ac(z.x,z.y,T,E,C)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==x);z.prevZ.nextZ=null,z.prevZ=null,(function(R){let O,j=1;do{let X,ee=R;R=null;let fe=null;for(O=0;ee;){O++;let ne=ee,ce=0;for(let ze=0;ze<j&&(ce++,ne=ne.nextZ,ne);ze++);let Te=j;for(;ce>0||Te>0&&ne;)ce!==0&&(Te===0||!ne||ee.z<=ne.z)?(X=ee,ee=ee.nextZ,ce--):(X=ne,ne=ne.nextZ,Te--),fe?fe.nextZ=X:R=X,X.prevZ=fe,fe=X;ee=ne}fe.nextZ=null,j*=2}while(O>1)})(z)})(r,a,c,f);let y=r;for(;r.prev!==r.next;){const x=r.prev,T=r.next;if(f?ed(r,a,c,f):Qh(r))t.push(x.i,r.i,T.i),ns(r),r=T.next,y=T.next;else if((r=T)===y){m?m===1?Zl(r=td(ai(r),t),t,i,a,c,f,2):m===2&&rd(r,t,i,a,c,f):Zl(ai(r),t,i,a,c,f,1);break}}}function Qh(r){const t=r.prev,i=r,a=r.next;if(Gr(t,i,a)>=0)return!1;const c=t.x,f=i.x,m=a.x,y=t.y,x=i.y,T=a.y,E=c<f?c<m?c:m:f<m?f:m,C=y<x?y<T?y:T:x<T?x:T,z=c>f?c>m?c:m:f>m?f:m,R=y>x?y>T?y:T:x>T?x:T;let O=a.next;for(;O!==t;){if(O.x>=E&&O.x<=z&&O.y>=C&&O.y<=R&&Sa(c,y,f,x,m,T,O.x,O.y)&&Gr(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function ed(r,t,i,a){const c=r.prev,f=r,m=r.next;if(Gr(c,f,m)>=0)return!1;const y=c.x,x=f.x,T=m.x,E=c.y,C=f.y,z=m.y,R=y<x?y<T?y:T:x<T?x:T,O=E<C?E<z?E:z:C<z?C:z,j=y>x?y>T?y:T:x>T?x:T,X=E>C?E>z?E:z:C>z?C:z,ee=Ac(R,O,t,i,a),fe=Ac(j,X,t,i,a);let ne=r.prevZ,ce=r.nextZ;for(;ne&&ne.z>=ee&&ce&&ce.z<=fe;){if(ne.x>=R&&ne.x<=j&&ne.y>=O&&ne.y<=X&&ne!==c&&ne!==m&&Sa(y,E,x,C,T,z,ne.x,ne.y)&&Gr(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,ce.x>=R&&ce.x<=j&&ce.y>=O&&ce.y<=X&&ce!==c&&ce!==m&&Sa(y,E,x,C,T,z,ce.x,ce.y)&&Gr(ce.prev,ce,ce.next)>=0))return!1;ce=ce.nextZ}for(;ne&&ne.z>=ee;){if(ne.x>=R&&ne.x<=j&&ne.y>=O&&ne.y<=X&&ne!==c&&ne!==m&&Sa(y,E,x,C,T,z,ne.x,ne.y)&&Gr(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;ce&&ce.z<=fe;){if(ce.x>=R&&ce.x<=j&&ce.y>=O&&ce.y<=X&&ce!==c&&ce!==m&&Sa(y,E,x,C,T,z,ce.x,ce.y)&&Gr(ce.prev,ce,ce.next)>=0)return!1;ce=ce.nextZ}return!0}function td(r,t){let i=r;do{const a=i.prev,c=i.next.next;!ql(a,c)&&Du(a,i,i.next,c)&&al(a,c)&&al(c,a)&&(t.push(a.i,i.i,c.i),ns(i),ns(i.next),i=r=c),i=i.next}while(i!==r);return ai(i)}function rd(r,t,i,a,c,f){let m=r;do{let y=m.next.next;for(;y!==m.prev;){if(m.i!==y.i&&Ih(m,y)){let x=Eh(m,y);return m=ai(m,m.next),x=ai(x,x.next),Zl(m,t,i,a,c,f,0),void Zl(x,t,i,a,c,f,0)}y=y.next}m=m.next}while(m!==r)}function Th(r,t){return r.x-t.x}function id(r,t){const i=(function(c,f){let m=f;const y=c.x,x=c.y;let T,E=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){const j=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(j<=y&&j>E&&(E=j,T=m.x<m.next.x?m:m.next,j===y))return T}m=m.next}while(m!==f);if(!T)return null;const C=T,z=T.x,R=T.y;let O=1/0;m=T;do{if(y>=m.x&&m.x>=z&&y!==m.x&&Sa(x<R?y:E,x,z,R,x<R?E:y,x,m.x,m.y)){const j=Math.abs(x-m.y)/(y-m.x);al(m,c)&&(j<O||j===O&&(m.x>T.x||m.x===T.x&&kh(T,m)))&&(T=m,O=j)}m=m.next}while(m!==C);return T})(r,t);if(!i)return t;const a=Eh(i,r);return ai(a,a.next),ai(i,i.next)}function kh(r,t){return Gr(r.prev,r,t.prev)<0&&Gr(t.next,r,r.next)<0}function Ac(r,t,i,a,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function nd(r){let t=r,i=r;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==r);return i}function Sa(r,t,i,a,c,f,m,y){return(c-m)*(t-y)>=(r-m)*(f-y)&&(r-m)*(a-y)>=(i-m)*(t-y)&&(i-m)*(f-y)>=(c-m)*(a-y)}function Ih(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!(function(i,a){let c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==a.i&&c.next.i!==a.i&&Du(c,c.next,i,a))return!0;c=c.next}while(c!==i);return!1})(r,t)&&(al(r,t)&&al(t,r)&&(function(i,a){let c=i,f=!1;const m=(i.x+a.x)/2,y=(i.y+a.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&m<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(f=!f),c=c.next;while(c!==i);return f})(r,t)&&(Gr(r.prev,r,t.prev)||Gr(r,t.prev,t))||ql(r,t)&&Gr(r.prev,r,r.next)>0&&Gr(t.prev,t,t.next)>0)}function Gr(r,t,i){return(t.y-r.y)*(i.x-t.x)-(t.x-r.x)*(i.y-t.y)}function ql(r,t){return r.x===t.x&&r.y===t.y}function Du(r,t,i,a){const c=Lu(Gr(r,t,i)),f=Lu(Gr(r,t,a)),m=Lu(Gr(i,a,r)),y=Lu(Gr(i,a,t));return c!==f&&m!==y||!(c!==0||!Dc(r,i,t))||!(f!==0||!Dc(r,a,t))||!(m!==0||!Dc(i,r,a))||!(y!==0||!Dc(i,t,a))}function Dc(r,t,i){return t.x<=Math.max(r.x,i.x)&&t.x>=Math.min(r.x,i.x)&&t.y<=Math.max(r.y,i.y)&&t.y>=Math.min(r.y,i.y)}function Lu(r){return r>0?1:r<0?-1:0}function al(r,t){return Gr(r.prev,r,r.next)<0?Gr(r,t,r.next)>=0&&Gr(r,r.prev,t)>=0:Gr(r,t,r.prev)<0||Gr(r,r.next,t)<0}function Eh(r,t){const i=Ch(r.i,r.x,r.y),a=Ch(t.i,t.x,t.y),c=r.next,f=t.prev;return r.next=t,t.prev=r,i.next=c,c.prev=i,a.next=i,i.prev=a,f.next=a,a.prev=f,a}function Ru(r,t,i,a){const c=Ch(r,t,i);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function ns(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Ch(r,t,i){return{i:r,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Lc(r,t,i){const a=i.patternDependencies;let c=!1;for(const f of t){const m=f.paint.get(`${r}-pattern`);m.isConstant()||(c=!0);const y=m.constantOr(null);y&&(c=!0,a[y.to]=!0,a[y.from]=!0)}return c}function Fu(r,t,i,a,c){const f=c.patternDependencies;for(const m of t){const y=m.paint.get(`${r}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:a-1},i,{},c.availableImages),T=y.evaluate({zoom:a},i,{},c.availableImages),E=y.evaluate({zoom:a+1},i,{},c.availableImages);x=x&&x.name?x.name:x,T=T&&T.name?T.name:T,E=E&&E.name?E.name:E,f[x]=!0,f[T]=!0,f[E]=!0,i.patterns[m.id]={min:x,mid:T,max:E}}}return i}class Rc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Jn,this.indexArray=new Mn,this.indexArray2=new Kr,this.programConfigurations=new Us(t.layers,t.zoom),this.segments=new Bt,this.segments2=new Bt,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,a){this.hasPattern=Lc("fill",this.layers,i);const c=this.layers[0].layout.get("fill-sort-key"),f=!c.isConstant(),m=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of t){const C=this.layers[0]._featureFilter.needGeometry,z=ba(y,C);if(!this.layers[0]._featureFilter.filter(new Zt(this.zoom),z,a))continue;const R=f?c.evaluate(z,{},a,i.availableImages):void 0,O={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:C?z.geometry:wa(y),patterns:{},sortKey:R};m.push(O)}f&&m.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of m){const{geometry:x,index:T,sourceLayerIndex:E}=y;if(this.hasPattern){const C=Fu("fill",this.layers,y,this.zoom,i);this.patternFeatures.push(C)}else this.addFeature(y,x,T,a,{});i.featureIndex.insert(t[T].feature,x,T,E,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}addFeatures(t,i,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,i,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,a,c,f){for(const m of ta(i,500)){let y=0;for(const R of m)y+=R.length;const x=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),T=x.vertexLength,E=[],C=[];for(const R of m){if(R.length===0)continue;R!==m[0]&&C.push(E.length/2);const O=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),j=O.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(j+R.length-1,j),E.push(R[0].x),E.push(R[0].y);for(let X=1;X<R.length;X++)this.layoutVertexArray.emplaceBack(R[X].x,R[X].y),this.indexArray2.emplaceBack(j+X-1,j+X),E.push(R[X].x),E.push(R[X].y);O.vertexLength+=R.length,O.primitiveLength+=R.length}const z=Yh(E,C);for(let R=0;R<z.length;R+=3)this.indexArray.emplaceBack(T+z[R],T+z[R+1],T+z[R+2]);x.vertexLength+=y,x.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,f,c)}}let Ph,Gl;Ye("FillBucket",Rc,{omit:["layers","patternFeatures"]});var Ki={get paint(){return Gl=Gl||new p({"fill-antialias":new Qe(we.paint_fill["fill-antialias"]),"fill-opacity":new ft(we.paint_fill["fill-opacity"]),"fill-color":new ft(we.paint_fill["fill-color"]),"fill-outline-color":new ft(we.paint_fill["fill-outline-color"]),"fill-translate":new Qe(we.paint_fill["fill-translate"]),"fill-translate-anchor":new Qe(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new _a(we.paint_fill["fill-pattern"])})},get layout(){return Ph=Ph||new p({"fill-sort-key":new ft(we.layout_fill["fill-sort-key"])})}};class Bd extends s{constructor(t){super(t,Ki)}recalculate(t,i){super.recalculate(t,i);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Rc(t)}queryRadius(){return Mu(this.paint.get("fill-translate"))}queryIntersectsFeature(t,i,a,c,f,m,y){return _h(zu(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,y),c)}isTileClipped(){return!0}}const Od=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Fc=v([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ji}=Od;var Ta={},ct=Ke,ll=ka;function ka(r,t,i,a,c){this.properties={},this.extent=i,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=c,r.readFields(sd,this,t)}function sd(r,t,i){r==1?t.id=i.readVarint():r==2?(function(a,c){for(var f=a.readVarint()+a.pos;a.pos<f;){var m=c._keys[a.readVarint()],y=c._values[a.readVarint()];c.properties[m]=y}})(i,t):r==3?t.type=i.readVarint():r==4&&(t._geometry=i.pos)}function Nd(r){for(var t,i,a=0,c=0,f=r.length,m=f-1;c<f;m=c++)a+=((i=r[m]).x-(t=r[c]).x)*(t.y+i.y);return a}ka.types=["Unknown","Point","LineString","Polygon"],ka.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,i=r.readVarint()+r.pos,a=1,c=0,f=0,m=0,y=[];r.pos<i;){if(c<=0){var x=r.readVarint();a=7&x,c=x>>3}if(c--,a===1||a===2)f+=r.readSVarint(),m+=r.readSVarint(),a===1&&(t&&y.push(t),t=[]),t.push(new ct(f,m));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&y.push(t),y},ka.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,i=1,a=0,c=0,f=0,m=1/0,y=-1/0,x=1/0,T=-1/0;r.pos<t;){if(a<=0){var E=r.readVarint();i=7&E,a=E>>3}if(a--,i===1||i===2)(c+=r.readSVarint())<m&&(m=c),c>y&&(y=c),(f+=r.readSVarint())<x&&(x=f),f>T&&(T=f);else if(i!==7)throw new Error("unknown command "+i)}return[m,x,y,T]},ka.prototype.toGeoJSON=function(r,t,i){var a,c,f=this.extent*Math.pow(2,i),m=this.extent*r,y=this.extent*t,x=this.loadGeometry(),T=ka.types[this.type];function E(R){for(var O=0;O<R.length;O++){var j=R[O];R[O]=[360*(j.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(a=0;a<x.length;a++)C[a]=x[a][0];E(x=C);break;case 2:for(a=0;a<x.length;a++)E(x[a]);break;case 3:for(x=(function(R){var O=R.length;if(O<=1)return[R];for(var j,X,ee=[],fe=0;fe<O;fe++){var ne=Nd(R[fe]);ne!==0&&(X===void 0&&(X=ne<0),X===ne<0?(j&&ee.push(j),j=[R[fe]]):j.push(R[fe]))}return j&&ee.push(j),ee})(x),a=0;a<x.length;a++)for(c=0;c<x[a].length;c++)E(x[a][c])}x.length===1?x=x[0]:T="Multi"+T;var z={type:"Feature",geometry:{type:T,coordinates:x},properties:this.properties};return"id"in this&&(z.id=this.id),z};var Bu=ll,Ou=Bc;function Bc(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(od,this,t),this.length=this._features.length}function od(r,t,i){r===15?t.version=i.readVarint():r===1?t.name=i.readString():r===5?t.extent=i.readVarint():r===2?t._features.push(i.pos):r===3?t._keys.push(i.readString()):r===4&&t._values.push((function(a){for(var c=null,f=a.readVarint()+a.pos;a.pos<f;){var m=a.readVarint()>>3;c=m===1?a.readString():m===2?a.readFloat():m===3?a.readDouble():m===4?a.readVarint64():m===5?a.readVarint():m===6?a.readSVarint():m===7?a.readBoolean():null}return c})(i))}Bc.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new Bu(this._pbf,t,this.extent,this._keys,this._values)};var ad=Ou;function ld(r,t,i){if(r===3){var a=new ad(i,i.readVarint()+i.pos);a.length&&(t[a.name]=a)}}Ta.VectorTile=function(r,t){this.layers=r.readFields(ld,{},t)},Ta.VectorTileFeature=ll,Ta.VectorTileLayer=Ou;const Mh=Ta.VectorTileFeature.types,Nu=Math.pow(2,13);function li(r,t,i,a,c,f,m,y){r.emplaceBack(t,i,2*Math.floor(a*Nu)+m,c*Nu*2,f*Nu*2,Math.round(y))}class ss{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Wi,this.centroidVertexArray=new qr,this.indexArray=new Mn,this.programConfigurations=new Us(t.layers,t.zoom),this.segments=new Bt,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,a){this.features=[],this.hasPattern=Lc("fill-extrusion",this.layers,i);for(const{feature:c,id:f,index:m,sourceLayerIndex:y}of t){const x=this.layers[0]._featureFilter.needGeometry,T=ba(c,x);if(!this.layers[0]._featureFilter.filter(new Zt(this.zoom),T,a))continue;const E={id:f,sourceLayerIndex:y,index:m,geometry:x?T.geometry:wa(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Fu("fill-extrusion",this.layers,E,this.zoom,i)):this.addFeature(E,E.geometry,m,a,{}),i.featureIndex.insert(c,E.geometry,m,y,this.index,!0)}}addFeatures(t,i,a){for(const c of this.features){const{geometry:f}=c;this.addFeature(c,f,c.index,i,a)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ji),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Fc.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,i,a,c,f){for(const m of ta(i,500)){const y={x:0,y:0,vertexCount:0};let x=0;for(const O of m)x+=O.length;let T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const O of m){if(O.length===0||ud(O))continue;let j=0;for(let X=0;X<O.length;X++){const ee=O[X];if(X>=1){const fe=O[X-1];if(!Ia(ee,fe)){T.vertexLength+4>Bt.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ne=ee.sub(fe)._perp()._unit(),ce=fe.dist(ee);j+ce>32768&&(j=0),li(this.layoutVertexArray,ee.x,ee.y,ne.x,ne.y,0,0,j),li(this.layoutVertexArray,ee.x,ee.y,ne.x,ne.y,0,1,j),y.x+=2*ee.x,y.y+=2*ee.y,y.vertexCount+=2,j+=ce,li(this.layoutVertexArray,fe.x,fe.y,ne.x,ne.y,0,0,j),li(this.layoutVertexArray,fe.x,fe.y,ne.x,ne.y,0,1,j),y.x+=2*fe.x,y.y+=2*fe.y,y.vertexCount+=2;const Te=T.vertexLength;this.indexArray.emplaceBack(Te,Te+2,Te+1),this.indexArray.emplaceBack(Te+1,Te+2,Te+3),T.vertexLength+=4,T.primitiveLength+=2}}}}if(T.vertexLength+x>Bt.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),Mh[t.type]!=="Polygon")continue;const E=[],C=[],z=T.vertexLength;for(const O of m)if(O.length!==0){O!==m[0]&&C.push(E.length/2);for(let j=0;j<O.length;j++){const X=O[j];li(this.layoutVertexArray,X.x,X.y,0,0,1,1,0),y.x+=X.x,y.y+=X.y,y.vertexCount+=1,E.push(X.x),E.push(X.y)}}const R=Yh(E,C);for(let O=0;O<R.length;O+=3)this.indexArray.emplaceBack(z+R[O],z+R[O+2],z+R[O+1]);T.primitiveLength+=R.length/3,T.vertexLength+=x;for(let O=0;O<y.vertexCount;O++){const j=Math.floor(y.x/y.vertexCount),X=Math.floor(y.y/y.vertexCount);this.centroidVertexArray.emplaceBack(j,X)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,f,c)}}function Ia(r,t){return r.x===t.x&&(r.x<0||r.x>Jr)||r.y===t.y&&(r.y<0||r.y>Jr)}function ud(r){return r.every((t=>t.x<0))||r.every((t=>t.x>Jr))||r.every((t=>t.y<0))||r.every((t=>t.y>Jr))}let zh;Ye("FillExtrusionBucket",ss,{omit:["layers","features"]});var $s={get paint(){return zh=zh||new p({"fill-extrusion-opacity":new Qe(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ft(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qe(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qe(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _a(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ft(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ft(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qe(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class cd extends s{constructor(t){super(t,$s)}createBucket(t){return new ss(t)}queryRadius(){return Mu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,i,a,c,f,m,y,x){const T=zu(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,y),E=this.paint.get("fill-extrusion-height").evaluate(i,a),C=this.paint.get("fill-extrusion-base").evaluate(i,a),z=(function(O,j,X,ee){const fe=[];for(const ne of O){const ce=[ne.x,ne.y,0,1];Ic(ce,ce,j),fe.push(new ke(ce[0]/ce[3],ce[1]/ce[3]))}return fe})(T,x),R=(function(O,j,X,ee){const fe=[],ne=[],ce=ee[8]*j,Te=ee[9]*j,ze=ee[10]*j,Je=ee[11]*j,yt=ee[8]*X,Xe=ee[9]*X,Ge=ee[10]*X,ut=ee[11]*X;for(const nt of O){const tt=[],Ee=[];for(const ht of nt){const lt=ht.x,It=ht.y,Pr=ee[0]*lt+ee[4]*It+ee[12],kr=ee[1]*lt+ee[5]*It+ee[13],Ei=ee[2]*lt+ee[6]*It+ee[14],vo=ee[3]*lt+ee[7]*It+ee[15],en=Ei+ze,Ci=vo+Je,Fn=Pr+yt,Bn=kr+Xe,On=Ei+Ge,ei=vo+ut,Pi=new ke((Pr+ce)/Ci,(kr+Te)/Ci);Pi.z=en/Ci,tt.push(Pi);const xn=new ke(Fn/ei,Bn/ei);xn.z=On/ei,Ee.push(xn)}fe.push(tt),ne.push(Ee)}return[fe,ne]})(c,C,E,x);return(function(O,j,X){let ee=1/0;_h(X,j)&&(ee=hd(X,j[0]));for(let fe=0;fe<j.length;fe++){const ne=j[fe],ce=O[fe];for(let Te=0;Te<ne.length-1;Te++){const ze=ne[Te],Je=[ze,ne[Te+1],ce[Te+1],ce[Te],ze];gh(X,Je)&&(ee=Math.min(ee,hd(X,Je)))}}return ee!==1/0&&ee})(R[0],R[1],z)}}function zn(r,t){return r.x*t.x+r.y*t.y}function hd(r,t){if(r.length===1){let i=0;const a=t[i++];let c;for(;!c||a.equals(c);)if(c=t[i++],!c)return 1/0;for(;i<t.length;i++){const f=t[i],m=r[0],y=c.sub(a),x=f.sub(a),T=m.sub(a),E=zn(y,y),C=zn(y,x),z=zn(x,x),R=zn(T,y),O=zn(T,x),j=E*z-C*C,X=(z*R-C*O)/j,ee=(E*O-C*R)/j,fe=a.z*(1-X-ee)+c.z*X+f.z*ee;if(isFinite(fe))return fe}return 1/0}{let i=1/0;for(const a of t)i=Math.min(i,a.z);return i}}const dd=v([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:pd}=dd,fd=v([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:md}=fd,Vd=Ta.VectorTileFeature.types,Oc=Math.cos(Math.PI/180*37.5),Nc=Math.pow(2,14)/.5;class An{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new Yn,this.layoutVertexArray2=new fo,this.indexArray=new Mn,this.programConfigurations=new Us(t.layers,t.zoom),this.segments=new Bt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,a){this.hasPattern=Lc("line",this.layers,i);const c=this.layers[0].layout.get("line-sort-key"),f=!c.isConstant(),m=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of t){const C=this.layers[0]._featureFilter.needGeometry,z=ba(y,C);if(!this.layers[0]._featureFilter.filter(new Zt(this.zoom),z,a))continue;const R=f?c.evaluate(z,{},a):void 0,O={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:C?z.geometry:wa(y),patterns:{},sortKey:R};m.push(O)}f&&m.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of m){const{geometry:x,index:T,sourceLayerIndex:E}=y;if(this.hasPattern){const C=Fu("line",this.layers,y,this.zoom,i);this.patternFeatures.push(C)}else this.addFeature(y,x,T,a,{});i.featureIndex.insert(t[T].feature,x,T,E,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}addFeatures(t,i,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,i,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,md)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,pd),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,a,c,f){const m=this.layers[0].layout,y=m.get("line-join").evaluate(t,{}),x=m.get("line-cap"),T=m.get("line-miter-limit"),E=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const C of i)this.addLine(C,t,y,x,T,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,f,c)}addLine(t,i,a,c,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<t.length-1;ee++)this.totalDistance+=t[ee].dist(t[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=Vd[i.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let T=0;for(;T<x-1&&t[T].equals(t[T+1]);)T++;if(x<(y?3:2))return;a==="bevel"&&(f=1.05);const E=this.overscaling<=16?15*Jr/(512*this.overscaling):0,C=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let z,R,O,j,X;this.e1=this.e2=-1,y&&(z=t[x-2],X=t[T].sub(z)._unit()._perp());for(let ee=T;ee<x;ee++){if(O=ee===x-1?y?t[T+1]:void 0:t[ee+1],O&&t[ee].equals(O))continue;X&&(j=X),z&&(R=z),z=t[ee],X=O?O.sub(z)._unit()._perp():j,j=j||X;let fe=j.add(X);fe.x===0&&fe.y===0||fe._unit();const ne=j.x*X.x+j.y*X.y,ce=fe.x*X.x+fe.y*X.y,Te=ce!==0?1/ce:1/0,ze=2*Math.sqrt(2-2*ce),Je=ce<Oc&&R&&O,yt=j.x*X.y-j.y*X.x>0;if(Je&&ee>T){const ut=z.dist(R);if(ut>2*E){const nt=z.sub(z.sub(R)._mult(E/ut)._round());this.updateDistance(R,nt),this.addCurrentVertex(nt,j,0,0,C),R=nt}}const Xe=R&&O;let Ge=Xe?a:y?"butt":c;if(Xe&&Ge==="round"&&(Te<m?Ge="miter":Te<=2&&(Ge="fakeround")),Ge==="miter"&&Te>f&&(Ge="bevel"),Ge==="bevel"&&(Te>2&&(Ge="flipbevel"),Te<f&&(Ge="miter")),R&&this.updateDistance(R,z),Ge==="miter")fe._mult(Te),this.addCurrentVertex(z,fe,0,0,C);else if(Ge==="flipbevel"){if(Te>100)fe=X.mult(-1);else{const ut=Te*j.add(X).mag()/j.sub(X).mag();fe._perp()._mult(ut*(yt?-1:1))}this.addCurrentVertex(z,fe,0,0,C),this.addCurrentVertex(z,fe.mult(-1),0,0,C)}else if(Ge==="bevel"||Ge==="fakeround"){const ut=-Math.sqrt(Te*Te-1),nt=yt?ut:0,tt=yt?0:ut;if(R&&this.addCurrentVertex(z,j,nt,tt,C),Ge==="fakeround"){const Ee=Math.round(180*ze/Math.PI/20);for(let ht=1;ht<Ee;ht++){let lt=ht/Ee;if(lt!==.5){const Pr=lt-.5;lt+=lt*Pr*(lt-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*Pr*Pr+(.848013+ne*(.215638*ne-1.06021)))}const It=X.sub(j)._mult(lt)._add(j)._unit()._mult(yt?-1:1);this.addHalfVertex(z,It.x,It.y,!1,yt,0,C)}}O&&this.addCurrentVertex(z,X,-nt,-tt,C)}else if(Ge==="butt")this.addCurrentVertex(z,fe,0,0,C);else if(Ge==="square"){const ut=R?1:-1;this.addCurrentVertex(z,fe,ut,ut,C)}else Ge==="round"&&(R&&(this.addCurrentVertex(z,j,0,0,C),this.addCurrentVertex(z,j,1,1,C,!0)),O&&(this.addCurrentVertex(z,X,-1,-1,C,!0),this.addCurrentVertex(z,X,0,0,C)));if(Je&&ee<x-1){const ut=z.dist(O);if(ut>2*E){const nt=z.add(O.sub(z)._mult(E/ut)._round());this.updateDistance(z,nt),this.addCurrentVertex(nt,X,0,0,C),z=nt}}}}addCurrentVertex(t,i,a,c,f,m=!1){const y=i.y*c-i.x,x=-i.y-i.x*c;this.addHalfVertex(t,i.x+i.y*a,i.y-i.x*a,m,!1,a,f),this.addHalfVertex(t,y,x,m,!0,-c,f),this.distance>Nc/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,i,a,c,f,m))}addHalfVertex({x:t,y:i},a,c,f,m,y,x){const T=.5*(this.lineClips?this.scaledDistance*(Nc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(i<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),x.primitiveLength++),m?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}let nr,wi;Ye("LineBucket",An,{omit:["layers","patternFeatures"]});var ui={get paint(){return wi=wi||new p({"line-opacity":new ft(we.paint_line["line-opacity"]),"line-color":new ft(we.paint_line["line-color"]),"line-translate":new Qe(we.paint_line["line-translate"]),"line-translate-anchor":new Qe(we.paint_line["line-translate-anchor"]),"line-width":new ft(we.paint_line["line-width"]),"line-gap-width":new ft(we.paint_line["line-gap-width"]),"line-offset":new ft(we.paint_line["line-offset"]),"line-blur":new ft(we.paint_line["line-blur"]),"line-dasharray":new il(we.paint_line["line-dasharray"]),"line-pattern":new _a(we.paint_line["line-pattern"]),"line-gradient":new bu(we.paint_line["line-gradient"])})},get layout(){return nr=nr||new p({"line-cap":new Qe(we.layout_line["line-cap"]),"line-join":new ft(we.layout_line["line-join"]),"line-miter-limit":new Qe(we.layout_line["line-miter-limit"]),"line-round-limit":new Qe(we.layout_line["line-round-limit"]),"line-sort-key":new ft(we.layout_line["line-sort-key"])})}};class Oi extends ft{possiblyEvaluate(t,i){return i=new Zt(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(t,i)}evaluate(t,i,a,c){return i=zr({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,a,c)}}let Yi;class Hl extends s{constructor(t){super(t,ui),this.gradientVersion=0,Yi||(Yi=new Oi(ui.paint.properties["line-width"].specification),Yi.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!(function(a){return a._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof Co,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,i){super.recalculate(t,i),this.paint._values["line-floorwidth"]=Yi.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new An(t)}queryRadius(t){const i=t,a=mi(sl("line-width",this,i),sl("line-gap-width",this,i)),c=sl("line-offset",this,i);return a/2+Math.abs(c)+Mu(this.paint.get("line-translate"))}queryIntersectsFeature(t,i,a,c,f,m,y){const x=zu(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,y),T=y/2*mi(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),E=this.paint.get("line-offset").evaluate(i,a);return E&&(c=(function(C,z){const R=[];for(let O=0;O<C.length;O++){const j=C[O],X=[];for(let ee=0;ee<j.length;ee++){const fe=j[ee-1],ne=j[ee],ce=j[ee+1],Te=ee===0?new ke(0,0):ne.sub(fe)._unit()._perp(),ze=ee===j.length-1?new ke(0,0):ce.sub(ne)._unit()._perp(),Je=Te._add(ze)._unit(),yt=Je.x*ze.x+Je.y*ze.y;yt!==0&&Je._mult(1/yt),X.push(Je._mult(z)._add(ne))}R.push(X)}return R})(c,E*y)),(function(C,z,R){for(let O=0;O<z.length;O++){const j=z[O];if(C.length>=3){for(let X=0;X<j.length;X++)if(nl(C,j[X]))return!0}if(Sc(C,j,R))return!0}return!1})(x,c,T)}isTileClipped(){return!0}}function mi(r,t){return t>0?t+2*r:r}const Vu=v([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ul=v([{name:"a_projected_pos",components:3,type:"Float32"}],4);v([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Vc=v([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);v([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jc=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ju=v([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Dn(r,t,i){return r.sections.forEach((a=>{a.text=(function(c,f,m){const y=f.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),gr.applyArabicShaping&&(c=gr.applyArabicShaping(c)),c})(a.text,t,i)})),r}v([{name:"triangle",components:3,type:"Uint16"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),v([{type:"Float32",name:"offsetX"}]),v([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),v([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const cl={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Nr=24,_o=Wt,Uu=function(r,t,i,a,c){var f,m,y=8*c-a-1,x=(1<<y)-1,T=x>>1,E=-7,C=c-1,z=-1,R=r[t+C];for(C+=z,f=R&(1<<-E)-1,R>>=-E,E+=y;E>0;f=256*f+r[t+C],C+=z,E-=8);for(m=f&(1<<-E)-1,f>>=-E,E+=a;E>0;m=256*m+r[t+C],C+=z,E-=8);if(f===0)f=1-T;else{if(f===x)return m?NaN:1/0*(R?-1:1);m+=Math.pow(2,a),f-=T}return(R?-1:1)*m*Math.pow(2,f-a)},Uc=function(r,t,i,a,c,f){var m,y,x,T=8*f-c-1,E=(1<<T)-1,C=E>>1,z=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=0,O=1,j=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,m=E):(m=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-m))<1&&(m--,x*=2),(t+=m+C>=1?z/x:z*Math.pow(2,1-C))*x>=2&&(m++,x/=2),m+C>=E?(y=0,m=E):m+C>=1?(y=(t*x-1)*Math.pow(2,c),m+=C):(y=t*Math.pow(2,C-1)*Math.pow(2,c),m=0));c>=8;r[i+R]=255&y,R+=O,y/=256,c-=8);for(m=m<<c|y,T+=c;T>0;r[i+R]=255&m,R+=O,m/=256,T-=8);r[i+R-O]|=128*j};function Wt(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Wt.Varint=0,Wt.Fixed64=1,Wt.Bytes=2,Wt.Fixed32=5;var Wl=4294967296,Uo=1/Wl,$u=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function os(r){return r.type===Wt.Bytes?r.readVarint()+r.pos:r.pos+1}function Ea(r,t,i){return i?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function Zu(r,t,i){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(a);for(var c=i.pos-1;c>=r;c--)i.buf[c+a]=i.buf[c]}function $c(r,t){for(var i=0;i<r.length;i++)t.writeVarint(r[i])}function yn(r,t){for(var i=0;i<r.length;i++)t.writeSVarint(r[i])}function Ca(r,t){for(var i=0;i<r.length;i++)t.writeFloat(r[i])}function Zs(r,t){for(var i=0;i<r.length;i++)t.writeDouble(r[i])}function Ln(r,t){for(var i=0;i<r.length;i++)t.writeBoolean(r[i])}function gd(r,t){for(var i=0;i<r.length;i++)t.writeFixed32(r[i])}function Ah(r,t){for(var i=0;i<r.length;i++)t.writeSFixed32(r[i])}function Dh(r,t){for(var i=0;i<r.length;i++)t.writeFixed64(r[i])}function jd(r,t){for(var i=0;i<r.length;i++)t.writeSFixed64(r[i])}function qs(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function hl(r,t,i){r[i]=t,r[i+1]=t>>>8,r[i+2]=t>>>16,r[i+3]=t>>>24}function Zc(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}Wt.prototype={destroy:function(){this.buf=null},readFields:function(r,t,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),c=a>>3,f=this.pos;this.type=7&a,r(c,t,this),this.pos===f&&this.skip(a)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=qs(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Zc(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=qs(this.buf,this.pos)+qs(this.buf,this.pos+4)*Wl;return this.pos+=8,r},readSFixed64:function(){var r=qs(this.buf,this.pos)+Zc(this.buf,this.pos+4)*Wl;return this.pos+=8,r},readFloat:function(){var r=Uu(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Uu(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,i,a=this.buf;return t=127&(i=a[this.pos++]),i<128?t:(t|=(127&(i=a[this.pos++]))<<7,i<128?t:(t|=(127&(i=a[this.pos++]))<<14,i<128?t:(t|=(127&(i=a[this.pos++]))<<21,i<128?t:(function(c,f,m){var y,x,T=m.buf;if(y=(112&(x=T[m.pos++]))>>4,x<128||(y|=(127&(x=T[m.pos++]))<<3,x<128)||(y|=(127&(x=T[m.pos++]))<<10,x<128)||(y|=(127&(x=T[m.pos++]))<<17,x<128)||(y|=(127&(x=T[m.pos++]))<<24,x<128)||(y|=(1&(x=T[m.pos++]))<<31,x<128))return Ea(c,y,f);throw new Error("Expected varint not more than 10 bytes")})(t|=(15&(i=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&$u?(function(i,a,c){return $u.decode(i.subarray(a,c))})(this.buf,t,r):(function(i,a,c){for(var f="",m=a;m<c;){var y,x,T,E=i[m],C=null,z=E>239?4:E>223?3:E>191?2:1;if(m+z>c)break;z===1?E<128&&(C=E):z===2?(192&(y=i[m+1]))==128&&(C=(31&E)<<6|63&y)<=127&&(C=null):z===3?(x=i[m+2],(192&(y=i[m+1]))==128&&(192&x)==128&&((C=(15&E)<<12|(63&y)<<6|63&x)<=2047||C>=55296&&C<=57343)&&(C=null)):z===4&&(x=i[m+2],T=i[m+3],(192&(y=i[m+1]))==128&&(192&x)==128&&(192&T)==128&&((C=(15&E)<<18|(63&y)<<12|(63&x)<<6|63&T)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,z=1):C>65535&&(C-=65536,f+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),f+=String.fromCharCode(C),m+=z}return f})(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==Wt.Bytes)return r.push(this.readVarint(t));var i=os(this);for(r=r||[];this.pos<i;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==Wt.Bytes)return r.push(this.readSVarint());var t=os(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Wt.Bytes)return r.push(this.readBoolean());var t=os(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Wt.Bytes)return r.push(this.readFloat());var t=os(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Wt.Bytes)return r.push(this.readDouble());var t=os(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Wt.Bytes)return r.push(this.readFixed32());var t=os(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Wt.Bytes)return r.push(this.readSFixed32());var t=os(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Wt.Bytes)return r.push(this.readFixed64());var t=os(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Wt.Bytes)return r.push(this.readSFixed64());var t=os(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===Wt.Varint)for(;this.buf[this.pos++]>127;);else if(t===Wt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Wt.Fixed32)this.pos+=4;else{if(t!==Wt.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),hl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),hl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),hl(this.buf,-1&r,this.pos),hl(this.buf,Math.floor(r*Uo),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),hl(this.buf,-1&r,this.pos),hl(this.buf,Math.floor(r*Uo),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?(function(t,i){var a,c;if(t>=0?(a=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(f,m,y){y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7)})(a,0,i),(function(f,m){var y=(7&f)<<4;m.buf[m.pos++]|=y|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))})(c,i)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=(function(a,c,f){for(var m,y,x=0;x<c.length;x++){if((m=c.charCodeAt(x))>55295&&m<57344){if(!y){m>56319||x+1===c.length?(a[f++]=239,a[f++]=191,a[f++]=189):y=m;continue}if(m<56320){a[f++]=239,a[f++]=191,a[f++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(a[f++]=239,a[f++]=191,a[f++]=189,y=null);m<128?a[f++]=m:(m<2048?a[f++]=m>>6|192:(m<65536?a[f++]=m>>12|224:(a[f++]=m>>18|240,a[f++]=m>>12&63|128),a[f++]=m>>6&63|128),a[f++]=63&m|128)}return f})(this.buf,r,this.pos);var i=this.pos-t;i>=128&&Zu(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(r){this.realloc(4),Uc(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Uc(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=r[i]},writeRawMessage:function(r,t){this.pos++;var i=this.pos;r(t,this);var a=this.pos-i;a>=128&&Zu(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,t,i){this.writeTag(r,Wt.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,$c,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,yn,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,Ln,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,Ca,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,Zs,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,gd,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,Ah,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,Dh,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,jd,t)},writeBytesField:function(r,t){this.writeTag(r,Wt.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,Wt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,Wt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,Wt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,Wt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,Wt.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,Wt.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,Wt.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,Wt.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,Wt.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var $o=qe(_o);const qu=3;function dl(r,t,i){r===1&&i.readMessage(_d,t)}function _d(r,t,i){if(r===3){const{id:a,bitmap:c,width:f,height:m,left:y,top:x,advance:T}=i.readMessage(yd,{});t.push({id:a,bitmap:new ol({width:f+2*qu,height:m+2*qu},c),metrics:{width:f,height:m,left:y,top:x,advance:T}})}}function yd(r,t,i){r===1?t.id=i.readVarint():r===2?t.bitmap=i.readBytes():r===3?t.width=i.readVarint():r===4?t.height=i.readVarint():r===5?t.left=i.readSVarint():r===6?t.top=i.readSVarint():r===7&&(t.advance=i.readVarint())}const qc=qu;function Gu(r){let t=0,i=0;for(const m of r)t+=m.w*m.h,i=Math.max(i,m.w);r.sort(((m,y)=>y.h-m.h));const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let c=0,f=0;for(const m of r)for(let y=a.length-1;y>=0;y--){const x=a[y];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,f=Math.max(f,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===x.w&&m.h===x.h){const T=a.pop();y<a.length&&(a[y]=T)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(a.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:c,h:f,fill:t/(c*f)||0}}const vn=1;class Lh{constructor(t,{pixelRatio:i,version:a,stretchX:c,stretchY:f,content:m,textFitWidth:y,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=c,this.stretchY=f,this.content=m,this.version=a,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+vn,this.paddedRect.y+vn]}get br(){return[this.paddedRect.x+this.paddedRect.w-vn,this.paddedRect.y+this.paddedRect.h-vn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*vn)/this.pixelRatio,(this.paddedRect.h-2*vn)/this.pixelRatio]}}class Rh{constructor(t,i){const a={},c={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,a,f),this.addImages(i,c,f);const{w:m,h:y}=Gu(f),x=new Ii({width:m||1,height:y||1});for(const T in t){const E=t[T],C=a[T].paddedRect;Ii.copy(E.data,x,{x:0,y:0},{x:C.x+vn,y:C.y+vn},E.data)}for(const T in i){const E=i[T],C=c[T].paddedRect,z=C.x+vn,R=C.y+vn,O=E.data.width,j=E.data.height;Ii.copy(E.data,x,{x:0,y:0},{x:z,y:R},E.data),Ii.copy(E.data,x,{x:0,y:j-1},{x:z,y:R-1},{width:O,height:1}),Ii.copy(E.data,x,{x:0,y:0},{x:z,y:R+j},{width:O,height:1}),Ii.copy(E.data,x,{x:O-1,y:0},{x:z-1,y:R},{width:1,height:j}),Ii.copy(E.data,x,{x:0,y:0},{x:z+O,y:R},{width:1,height:j})}this.image=x,this.iconPositions=a,this.patternPositions=c}addImages(t,i,a){for(const c in t){const f=t[c],m={x:0,y:0,w:f.data.width+2*vn,h:f.data.height+2*vn};a.push(m),i[c]=new Lh(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,i){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),i)}patchUpdatedImage(t,i,a){if(!t||!i||t.version===i.version)return;t.version=i.version;const[c,f]=t.tl;a.update(i.data,void 0,{x:c,y:f})}}var Zo;Ye("ImagePosition",Lh),Ye("ImageAtlas",Rh),A.ah=void 0,(Zo=A.ah||(A.ah={}))[Zo.none=0]="none",Zo[Zo.horizontal=1]="horizontal",Zo[Zo.vertical=2]="vertical",Zo[Zo.horizontalOnly=3]="horizontalOnly";const Gs=-17;class Hu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){const a=new Hu;return a.scale=t||1,a.fontStack=i,a}static forImage(t){const i=new Hu;return i.imageName=t,i}}class Hs{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const a=new Hs;for(let c=0;c<t.sections.length;c++){const f=t.sections[c];f.image?a.addImageSection(f):a.addTextSection(f,i)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let i="";for(let a=0;a<t.length;a++){const c=t.charCodeAt(a+1)||null,f=t.charCodeAt(a-1)||null;i+=c&&jo(c)&&!cl[t[a+1]]||f&&jo(f)&&!cl[t[a-1]]||!cl[t[a]]?t[a]:cl[t[a]]}return i})(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&$r[this.text.charCodeAt(a)];a++)t++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&$r[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const a=new Hs;return a.text=this.text.substring(t,i),a.sectionIndex=this.sectionIndex.slice(t,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,i)=>Math.max(t,this.sections[i].scale)),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(Hu.forText(t.scale,t.fontStack||i));const a=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(a)}addImageSection(t){const i=t.image?t.image.name:"";if(i.length===0)return void mr("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Hu.forImage(i)),this.sectionIndex.push(this.sections.length-1)):mr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wu(r,t,i,a,c,f,m,y,x,T,E,C,z,R,O){const j=Hs.fromFeature(r,c);let X;C===A.ah.vertical&&j.verticalizePunctuation();const{processBidirectionalText:ee,processStyledBidirectionalText:fe}=gr;if(ee&&j.sections.length===1){X=[];const Te=ee(j.toString(),Rn(j,T,f,t,a,R));for(const ze of Te){const Je=new Hs;Je.text=ze,Je.sections=j.sections;for(let yt=0;yt<ze.length;yt++)Je.sectionIndex.push(0);X.push(Je)}}else if(fe){X=[];const Te=fe(j.text,j.sectionIndex,Rn(j,T,f,t,a,R));for(const ze of Te){const Je=new Hs;Je.text=ze[0],Je.sectionIndex=ze[1],Je.sections=j.sections,X.push(Je)}}else X=(function(Te,ze){const Je=[],yt=Te.text;let Xe=0;for(const Ge of ze)Je.push(Te.substring(Xe,Ge)),Xe=Ge;return Xe<yt.length&&Je.push(Te.substring(Xe,yt.length)),Je})(j,Rn(j,T,f,t,a,R));const ne=[],ce={positionedLines:ne,text:j.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:C,iconsInText:!1,verticalizable:!1};return(function(Te,ze,Je,yt,Xe,Ge,ut,nt,tt,Ee,ht,lt){let It=0,Pr=Gs,kr=0,Ei=0;const vo=nt==="right"?1:nt==="left"?0:.5;let en=0;for(const ei of Xe){ei.trim();const Pi=ei.getMaxScale(),xn=(Pi-1)*Nr,tn={positionedGlyphs:[],lineOffset:0};Te.positionedLines[en]=tn;const Nn=tn.positionedGlyphs;let rn=0;if(!ei.length()){Pr+=Ge,++en;continue}for(let as=0;as<ei.length();as++){const sr=ei.getSection(as),Lr=ei.getSectionIndex(as),Vr=ei.getCharCode(as);let Ss=0,Yr=null,eh=null,Aa=null,Da=Nr;const xo=!(tt===A.ah.horizontal||!ht&&!tl(Vr)||ht&&($r[Vr]||(Ci=Vr,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Ci)))));if(sr.imageName){const Xs=yt[sr.imageName];if(!Xs)continue;Aa=sr.imageName,Te.iconsInText=Te.iconsInText||!0,eh=Xs.paddedRect;const Ni=Xs.displaySize;sr.scale=sr.scale*Nr/lt,Yr={width:Ni[0],height:Ni[1],left:vn,top:-qc,advance:xo?Ni[1]:Ni[0]},Ss=xn+(Nr-Ni[1]*sr.scale),Da=Yr.advance;const fl=xo?Ni[0]*sr.scale-Nr*Pi:Ni[1]*sr.scale-Nr*Pi;fl>0&&fl>rn&&(rn=fl)}else{const Xs=Je[sr.fontStack],Ni=Xs&&Xs[Vr];if(Ni&&Ni.rect)eh=Ni.rect,Yr=Ni.metrics;else{const fl=ze[sr.fontStack],jh=fl&&fl[Vr];if(!jh)continue;Yr=jh.metrics}Ss=(Pi-sr.scale)*Nr}xo?(Te.verticalizable=!0,Nn.push({glyph:Vr,imageName:Aa,x:It,y:Pr+Ss,vertical:xo,scale:sr.scale,fontStack:sr.fontStack,sectionIndex:Lr,metrics:Yr,rect:eh}),It+=Da*sr.scale+Ee):(Nn.push({glyph:Vr,imageName:Aa,x:It,y:Pr+Ss,vertical:xo,scale:sr.scale,fontStack:sr.fontStack,sectionIndex:Lr,metrics:Yr,rect:eh}),It+=Yr.advance*sr.scale+Ee)}Nn.length!==0&&(kr=Math.max(It-Ee,kr),$d(Nn,0,Nn.length-1,vo,rn)),It=0;const Ws=Ge*Pi+rn;tn.lineOffset=Math.max(rn,xn),Pr+=Ws,Ei=Math.max(Ws,Ei),++en}var Ci;const Fn=Pr-Gs,{horizontalAlign:Bn,verticalAlign:On}=Xu(ut);(function(ei,Pi,xn,tn,Nn,rn,Ws,as,sr){const Lr=(Pi-xn)*Nn;let Vr=0;Vr=rn!==Ws?-as*tn-Gs:(-tn*sr+.5)*Ws;for(const Ss of ei)for(const Yr of Ss.positionedGlyphs)Yr.x+=Lr,Yr.y+=Vr})(Te.positionedLines,vo,Bn,On,kr,Ei,Ge,Fn,Xe.length),Te.top+=-On*Fn,Te.bottom=Te.top+Fn,Te.left+=-Bn*kr,Te.right=Te.left+kr})(ce,t,i,a,X,m,y,x,C,T,z,O),!(function(Te){for(const ze of Te)if(ze.positionedGlyphs.length!==0)return!1;return!0})(ne)&&ce}const $r={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ud={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},vd={40:!0};function xd(r,t,i,a,c,f){if(t.imageName){const m=a[t.imageName];return m?m.displaySize[0]*t.scale*Nr/f+c:0}{const m=i[t.fontStack],y=m&&m[r];return y?y.metrics.advance*t.scale+c:0}}function wd(r,t,i,a){const c=Math.pow(r-t,2);return a?r<t?c/2:2*c:c+Math.abs(i)*i}function bd(r,t,i){let a=0;return r===10&&(a-=1e4),i&&(a+=150),r!==40&&r!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function Fh(r,t,i,a,c,f){let m=null,y=wd(t,i,c,f);for(const x of a){const T=wd(t-x.x,i,c,f)+x.badness;T<=y&&(m=x,y=T)}return{index:r,x:t,priorBreak:m,badness:y}}function Sd(r){return r?Sd(r.priorBreak).concat(r.index):[]}function Rn(r,t,i,a,c,f){if(!r)return[];const m=[],y=(function(C,z,R,O,j,X){let ee=0;for(let fe=0;fe<C.length();fe++){const ne=C.getSection(fe);ee+=xd(C.getCharCode(fe),ne,O,j,z,X)}return ee/Math.max(1,Math.ceil(ee/R))})(r,t,i,a,c,f),x=r.text.indexOf("")>=0;let T=0;for(let C=0;C<r.length();C++){const z=r.getSection(C),R=r.getCharCode(C);if($r[R]||(T+=xd(R,z,a,c,t,f)),C<r.length()-1){const O=!((E=R)<11904)&&(!!Ut["CJK Compatibility Forms"](E)||!!Ut["CJK Compatibility"](E)||!!Ut["CJK Strokes"](E)||!!Ut["CJK Symbols and Punctuation"](E)||!!Ut["Enclosed CJK Letters and Months"](E)||!!Ut["Halfwidth and Fullwidth Forms"](E)||!!Ut["Ideographic Description Characters"](E)||!!Ut["Vertical Forms"](E)||el.test(String.fromCodePoint(E)));(Ud[R]||O||z.imageName||C!==r.length()-2&&vd[r.getCharCode(C+1)])&&m.push(Fh(C+1,T,y,m,bd(R,r.getCharCode(C+1),O&&x),!1))}}var E;return Sd(Fh(r.length(),T,y,m,0,!0))}function Xu(r){let t=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function $d(r,t,i,a,c){if(!a&&!c)return;const f=r[i],m=(r[i].x+f.metrics.advance*f.scale)*a;for(let y=t;y<=i;y++)r[y].x-=m,r[y].y+=c}function Pa(r,t,i){const{horizontalAlign:a,verticalAlign:c}=Xu(i),f=t[0]-r.displaySize[0]*a,m=t[1]-r.displaySize[1]*c;return{image:r,top:m,bottom:m+r.displaySize[1],left:f,right:f+r.displaySize[0]}}function Ku(r){var t,i;let a=r.left,c=r.top,f=r.right-a,m=r.bottom-c;const y=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(i=r.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",T=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&f/m<T||y==="proportional"){const E=Math.ceil(m*T);a*=E/f,f=E}}else if(y==="proportional"&&x==="stretchOnly"&&T!==0&&f/m>T){const E=Math.ceil(f/T);c*=E/m,m=E}return{x1:a,y1:c,x2:a+f,y2:c+m}}function Ma(r,t,i,a,c,f){const m=r.image;let y;if(m.content){const X=m.content,ee=m.pixelRatio||1;y=[X[0]/ee,X[1]/ee,m.displaySize[0]-X[2]/ee,m.displaySize[1]-X[3]/ee]}const x=t.left*f,T=t.right*f;let E,C,z,R;i==="width"||i==="both"?(R=c[0]+x-a[3],C=c[0]+T+a[1]):(R=c[0]+(x+T-m.displaySize[0])/2,C=R+m.displaySize[0]);const O=t.top*f,j=t.bottom*f;return i==="height"||i==="both"?(E=c[1]+O-a[0],z=c[1]+j+a[2]):(E=c[1]+(O+j-m.displaySize[1])/2,z=E+m.displaySize[1]),{image:m,top:E,right:C,bottom:z,left:R,collisionPadding:y}}const za=255,bs=128,yo=za*bs;function Td(r,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Zt(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:c}=i;let f=0;for(;f<a.length&&a[f]<=r;)f++;f=Math.max(0,f-1);let m=f;for(;m<a.length&&a[m]<r+1;)m++;m=Math.min(a.length-1,m);const y=a[f],x=a[m];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new Zt(y)),maxSize:i.evaluate(new Zt(x)),interpolationType:c}}}function Ju(r,t,i){let a="never";const c=r.get(t);return c?a=c:r.get(i)&&(a="always"),a}const Zd=Ta.VectorTileFeature.types,kd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Yu(r,t,i,a,c,f,m,y,x,T,E,C,z){const R=y?Math.min(yo,Math.round(y[0])):0,O=y?Math.min(yo,Math.round(y[1])):0;r.emplaceBack(t,i,Math.round(32*a),Math.round(32*c),f,m,(R<<1)+(x?1:0),O,16*T,16*E,256*C,256*z)}function Xl(r,t,i){r.emplaceBack(t.x,t.y,i),r.emplaceBack(t.x,t.y,i),r.emplaceBack(t.x,t.y,i),r.emplaceBack(t.x,t.y,i)}function Gc(r){for(const t of r.sections)if(po(t.text))return!0;return!1}class Hc{constructor(t){this.layoutVertexArray=new Pn,this.indexArray=new Mn,this.programConfigurations=t,this.segments=new Bt,this.dynamicLayoutVertexArray=new vs,this.opacityVertexArray=new Fi,this.hasVisibleVertices=!1,this.placedSymbolArray=new fr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,a,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vu.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ul.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,kd,!0),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ye("SymbolBuffers",Hc);class Qu{constructor(t,i,a){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new a,this.segments=new Bt,this.collisionVertexArray=new Qn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Vc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ye("CollisionBuffers",Qu);class Kl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((m=>m.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Tc([]),this.placementViewportMatrix=Tc([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Td(this.zoom,i["text-size"]),this.iconSizeData=Td(this.zoom,i["icon-size"]);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),f=a.get("symbol-z-order");this.canOverlap=Ju(a,"text-overlap","text-allow-overlap")!=="never"||Ju(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map((m=>A.ah[m]))),this.stateDependentLayerIds=this.layers.filter((m=>m.isStateDependent())).map((m=>m.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Hc(new Us(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Hc(new Us(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new _r,this.lineVertexArray=new pi,this.symbolInstances=new Lt,this.textAnchorOffsets=new yr}calculateGlyphDependencies(t,i,a,c,f){for(let m=0;m<t.length;m++)if(i[t.charCodeAt(m)]=!0,(a||c)&&f){const y=cl[t.charAt(m)];y&&(i[y.charCodeAt(0)]=!0)}}populate(t,i,a){const c=this.layers[0],f=c.layout,m=f.get("text-font"),y=f.get("text-field"),x=f.get("icon-image"),T=(y.value.kind!=="constant"||y.value.value instanceof ji&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,C=f.get("symbol-sort-key");if(this.features=[],!T&&!E)return;const z=i.iconDependencies,R=i.glyphDependencies,O=i.availableImages,j=new Zt(this.zoom);for(const{feature:X,id:ee,index:fe,sourceLayerIndex:ne}of t){const ce=c._featureFilter.needGeometry,Te=ba(X,ce);if(!c._featureFilter.filter(j,Te,a))continue;let ze,Je;if(ce||(Te.geometry=wa(X)),T){const Xe=c.getValueAndResolveTokens("text-field",Te,a,O),Ge=ji.factory(Xe),ut=this.hasRTLText=this.hasRTLText||Gc(Ge);(!ut||gr.getRTLTextPluginStatus()==="unavailable"||ut&&gr.isParsed())&&(ze=Dn(Ge,c,Te))}if(E){const Xe=c.getValueAndResolveTokens("icon-image",Te,a,O);Je=Xe instanceof ki?Xe:ki.fromString(Xe)}if(!ze&&!Je)continue;const yt=this.sortFeaturesByKey?C.evaluate(Te,{},a):void 0;if(this.features.push({id:ee,text:ze,icon:Je,index:fe,sourceLayerIndex:ne,geometry:Te.geometry,properties:X.properties,type:Zd[X.type],sortKey:yt}),Je&&(z[Je.name]=!0),ze){const Xe=m.evaluate(Te,{},a).join(","),Ge=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(A.ah.vertical)>=0;for(const ut of ze.sections)if(ut.image)z[ut.image.name]=!0;else{const nt=wu(ze.toString()),tt=ut.fontStack||Xe,Ee=R[tt]=R[tt]||{};this.calculateGlyphDependencies(ut.text,Ee,Ge,this.allowVerticalPlacement,nt)}}}f.get("symbol-placement")==="line"&&(this.features=(function(X){const ee={},fe={},ne=[];let ce=0;function Te(Xe){ne.push(X[Xe]),ce++}function ze(Xe,Ge,ut){const nt=fe[Xe];return delete fe[Xe],fe[Ge]=nt,ne[nt].geometry[0].pop(),ne[nt].geometry[0]=ne[nt].geometry[0].concat(ut[0]),nt}function Je(Xe,Ge,ut){const nt=ee[Ge];return delete ee[Ge],ee[Xe]=nt,ne[nt].geometry[0].shift(),ne[nt].geometry[0]=ut[0].concat(ne[nt].geometry[0]),nt}function yt(Xe,Ge,ut){const nt=ut?Ge[0][Ge[0].length-1]:Ge[0][0];return`${Xe}:${nt.x}:${nt.y}`}for(let Xe=0;Xe<X.length;Xe++){const Ge=X[Xe],ut=Ge.geometry,nt=Ge.text?Ge.text.toString():null;if(!nt){Te(Xe);continue}const tt=yt(nt,ut),Ee=yt(nt,ut,!0);if(tt in fe&&Ee in ee&&fe[tt]!==ee[Ee]){const ht=Je(tt,Ee,ut),lt=ze(tt,Ee,ne[ht].geometry);delete ee[tt],delete fe[Ee],fe[yt(nt,ne[lt].geometry,!0)]=lt,ne[ht].geometry=null}else tt in fe?ze(tt,Ee,ut):Ee in ee?Je(tt,Ee,ut):(Te(Xe),ee[tt]=ce-1,fe[Ee]=ce-1)}return ne.filter((Xe=>Xe.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((X,ee)=>X.sortKey-ee.sortKey))}update(t,i,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const a=this.lineVertexArray.length;if(t.segment!==void 0){let c=t.dist(i[t.segment+1]),f=t.dist(i[t.segment]);const m={};for(let y=t.segment+1;y<i.length;y++)m[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:c},y<i.length-1&&(c+=i[y+1].dist(i[y]));for(let y=t.segment||0;y>=0;y--)m[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:f},y>0&&(f+=i[y-1].dist(i[y]));for(let y=0;y<i.length;y++){const x=m[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,i,a,c,f,m,y,x,T,E,C,z){const R=t.indexArray,O=t.layoutVertexArray,j=t.segments.prepareSegment(4*i.length,O,R,this.canOverlap?m.sortKey:void 0),X=this.glyphOffsetArray.length,ee=j.vertexLength,fe=this.allowVerticalPlacement&&y===A.ah.vertical?Math.PI/2:0,ne=m.text&&m.text.sections;for(let ce=0;ce<i.length;ce++){const{tl:Te,tr:ze,bl:Je,br:yt,tex:Xe,pixelOffsetTL:Ge,pixelOffsetBR:ut,minFontScaleX:nt,minFontScaleY:tt,glyphOffset:Ee,isSDF:ht,sectionIndex:lt}=i[ce],It=j.vertexLength,Pr=Ee[1];Yu(O,x.x,x.y,Te.x,Pr+Te.y,Xe.x,Xe.y,a,ht,Ge.x,Ge.y,nt,tt),Yu(O,x.x,x.y,ze.x,Pr+ze.y,Xe.x+Xe.w,Xe.y,a,ht,ut.x,Ge.y,nt,tt),Yu(O,x.x,x.y,Je.x,Pr+Je.y,Xe.x,Xe.y+Xe.h,a,ht,Ge.x,ut.y,nt,tt),Yu(O,x.x,x.y,yt.x,Pr+yt.y,Xe.x+Xe.w,Xe.y+Xe.h,a,ht,ut.x,ut.y,nt,tt),Xl(t.dynamicLayoutVertexArray,x,fe),R.emplaceBack(It,It+1,It+2),R.emplaceBack(It+1,It+2,It+3),j.vertexLength+=4,j.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ee[0]),ce!==i.length-1&&lt===i[ce+1].sectionIndex||t.programConfigurations.populatePaintArrays(O.length,m,m.index,{},z,ne&&ne[lt])}t.placedSymbolArray.emplaceBack(x.x,x.y,X,this.glyphOffsetArray.length-X,ee,T,E,x.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],y,0,!1,0,C)}_addCollisionDebugVertex(t,i,a,c,f,m){return i.emplaceBack(0,0),t.emplaceBack(a.x,a.y,c,f,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(t,i,a,c,f,m,y){const x=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),T=x.vertexLength,E=f.layoutVertexArray,C=f.collisionVertexArray,z=y.anchorX,R=y.anchorY;this._addCollisionDebugVertex(E,C,m,z,R,new ke(t,i)),this._addCollisionDebugVertex(E,C,m,z,R,new ke(a,i)),this._addCollisionDebugVertex(E,C,m,z,R,new ke(a,c)),this._addCollisionDebugVertex(E,C,m,z,R,new ke(t,c)),x.vertexLength+=4;const O=f.indexArray;O.emplaceBack(T,T+1),O.emplaceBack(T+1,T+2),O.emplaceBack(T+2,T+3),O.emplaceBack(T+3,T),x.primitiveLength+=4}addDebugCollisionBoxes(t,i,a,c){for(let f=t;f<i;f++){const m=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,c?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Qu(mn,jc.members,Kr),this.iconCollisionBox=new Qu(mn,jc.members,Kr);for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(t,i,a,c,f,m,y,x,T){const E={};for(let C=i;C<a;C++){const z=t.get(C);E.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.textFeatureIndex=z.featureIndex;break}for(let C=c;C<f;C++){const z=t.get(C);E.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.verticalTextFeatureIndex=z.featureIndex;break}for(let C=m;C<y;C++){const z=t.get(C);E.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.iconFeatureIndex=z.featureIndex;break}for(let C=x;C<T;C++){const z=t.get(C);E.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.verticalIconFeatureIndex=z.featureIndex;break}return E}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const a=t.placedSymbolArray.get(i),c=a.vertexStartIndex+4*a.numGlyphs;for(let f=a.vertexStartIndex;f<c;f+=4)t.indexArray.emplaceBack(f,f+1,f+2),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),a=Math.cos(t),c=[],f=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const x=this.symbolInstances.get(y);c.push(0|Math.round(i*x.anchorX+a*x.anchorY)),f.push(x.featureIndex)}return m.sort(((y,x)=>c[y]-c[x]||f[x]-f[y])),m}addToSortKeyRanges(t,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach(((c,f,m)=>{c>=0&&m.indexOf(c)===f&&this.addIndicesForPlacedSymbol(this.text,c)})),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Bh,Wc;Ye("SymbolBucket",Kl,{omit:["layers","collisionBoxArray","features","compareText"]}),Kl.MAX_GLYPHS=65535,Kl.addDynamicAttributes=Xl;var Jl={get paint(){return Wc=Wc||new p({"icon-opacity":new ft(we.paint_symbol["icon-opacity"]),"icon-color":new ft(we.paint_symbol["icon-color"]),"icon-halo-color":new ft(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new ft(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ft(we.paint_symbol["icon-halo-blur"]),"icon-translate":new Qe(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qe(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new ft(we.paint_symbol["text-opacity"]),"text-color":new ft(we.paint_symbol["text-color"],{runtimeType:Si,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new ft(we.paint_symbol["text-halo-color"]),"text-halo-width":new ft(we.paint_symbol["text-halo-width"]),"text-halo-blur":new ft(we.paint_symbol["text-halo-blur"]),"text-translate":new Qe(we.paint_symbol["text-translate"]),"text-translate-anchor":new Qe(we.paint_symbol["text-translate-anchor"])})},get layout(){return Bh=Bh||new p({"symbol-placement":new Qe(we.layout_symbol["symbol-placement"]),"symbol-spacing":new Qe(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qe(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ft(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qe(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Qe(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Qe(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Qe(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qe(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qe(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new ft(we.layout_symbol["icon-size"]),"icon-text-fit":new Qe(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qe(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new ft(we.layout_symbol["icon-image"]),"icon-rotate":new ft(we.layout_symbol["icon-rotate"]),"icon-padding":new ft(we.layout_symbol["icon-padding"]),"icon-keep-upright":new Qe(we.layout_symbol["icon-keep-upright"]),"icon-offset":new ft(we.layout_symbol["icon-offset"]),"icon-anchor":new ft(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qe(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qe(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qe(we.layout_symbol["text-rotation-alignment"]),"text-field":new ft(we.layout_symbol["text-field"]),"text-font":new ft(we.layout_symbol["text-font"]),"text-size":new ft(we.layout_symbol["text-size"]),"text-max-width":new ft(we.layout_symbol["text-max-width"]),"text-line-height":new Qe(we.layout_symbol["text-line-height"]),"text-letter-spacing":new ft(we.layout_symbol["text-letter-spacing"]),"text-justify":new ft(we.layout_symbol["text-justify"]),"text-radial-offset":new ft(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qe(we.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ft(we.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ft(we.layout_symbol["text-anchor"]),"text-max-angle":new Qe(we.layout_symbol["text-max-angle"]),"text-writing-mode":new Qe(we.layout_symbol["text-writing-mode"]),"text-rotate":new ft(we.layout_symbol["text-rotate"]),"text-padding":new Qe(we.layout_symbol["text-padding"]),"text-keep-upright":new Qe(we.layout_symbol["text-keep-upright"]),"text-transform":new ft(we.layout_symbol["text-transform"]),"text-offset":new ft(we.layout_symbol["text-offset"]),"text-allow-overlap":new Qe(we.layout_symbol["text-allow-overlap"]),"text-overlap":new Qe(we.layout_symbol["text-overlap"]),"text-ignore-placement":new Qe(we.layout_symbol["text-ignore-placement"]),"text-optional":new Qe(we.layout_symbol["text-optional"])})}};class Xc{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Qs,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ye("FormatSectionOverride",Xc,{omit:["defaultValue"]});class pl extends s{constructor(t){super(t,Jl)}recalculate(t,i){if(super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const f of a)c.indexOf(f)<0&&c.push(f);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,i,a,c){const f=this.layout.get(t).evaluate(i,{},a,c),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||ao(m.value)||!f?f:(function(y,x){return x.replace(/{([^{}]+)}/g,((T,E)=>y&&E in y?String(y[E]):""))})(i.properties,f)}createBucket(t){return new Kl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Jl.paint.overridableProperties){if(!pl.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),a=new Xc(i),c=new qi(a,i.property.specification);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new Ro("source",c):new Fo("composite",c,i.value.zoomStops),this.paint._values[t]=new dn(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&pl.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const a=t.get("text-field"),c=Jl.paint.properties[i];let f=!1;const m=y=>{for(const x of y)if(c.overrides&&c.overrides.hasOverride(x))return void(f=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ji)m(a.value.value.sections);else if(a.value.kind==="source"){const y=T=>{f||(T instanceof $n&&pr(T.value)===Un?m(T.value.sections):T instanceof Po?m(T.sections):T.eachChild(y))},x=a.value;x._styleExpression&&y(x._styleExpression.expression)}return f}}let Oh;var qd={get paint(){return Oh=Oh||new p({"background-color":new Qe(we.paint_background["background-color"]),"background-pattern":new il(we.paint_background["background-pattern"]),"background-opacity":new Qe(we.paint_background["background-opacity"])})}};class Kc extends s{constructor(t){super(t,qd)}}let Id;var ec={get paint(){return Id=Id||new p({"raster-opacity":new Qe(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new Qe(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qe(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qe(we.paint_raster["raster-brightness-max"]),"raster-saturation":new Qe(we.paint_raster["raster-saturation"]),"raster-contrast":new Qe(we.paint_raster["raster-contrast"]),"raster-resampling":new Qe(we.paint_raster["raster-resampling"]),"raster-fade-duration":new Qe(we.paint_raster["raster-fade-duration"])})}};class Gd extends s{constructor(t){super(t,ec)}}class Jc extends s{constructor(t){super(t,{}),this.onAdd=i=>{this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)},this.onRemove=i=>{this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class n{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const o=63710088e-1;class h{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new h(Fr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,a=this.lat*i,c=t.lat*i,f=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((t.lng-this.lng)*i);return o*Math.acos(Math.min(f,1))}static convert(t){if(t instanceof h)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new h(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new h(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const _=2*Math.PI*o;function b(r){return _*Math.cos(r*Math.PI/180)}function k(r){return(180+r)/360}function B(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Q(r,t){return r/b(t)}function se(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class be{constructor(t,i,a=0){this.x=+t,this.y=+i,this.z=+a}static fromLngLat(t,i=0){const a=h.convert(t);return new be(k(a.lng),B(a.lat),Q(i,a.lat))}toLngLat(){return new h(360*this.x-180,se(this.y))}toAltitude(){return this.z*b(se(this.y))}meterInMercatorCoordinateUnits(){return 1/_*(t=se(this.y),1/Math.cos(t*Math.PI/180));var t}}function De(r,t,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[r*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Fe{constructor(t,i,a){if(!(function(c,f,m){return!(c<0||c>25||m<0||m>=Math.pow(2,c)||f<0||f>=Math.pow(2,c))})(t,i,a))throw new Error(`x=${i}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=i,this.y=a,this.key=at(0,t,t,i,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i,a){const c=(m=this.y,y=this.z,x=De(256*(f=this.x),256*(m=Math.pow(2,y)-m-1),y),T=De(256*(f+1),256*(m+1),y),x[0]+","+x[1]+","+T[0]+","+T[1]);var f,m,y,x,T;const E=(function(C,z,R){let O,j="";for(let X=C;X>0;X--)O=1<<X-1,j+=(z&O?1:0)+(R&O?2:0);return j})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,c)}isChildOf(t){const i=this.z-t.z;return i>0&&t.x===this.x>>i&&t.y===this.y>>i}getTilePoint(t){const i=Math.pow(2,this.z);return new ke((t.x*i-this.x)*Jr,(t.y*i-this.y)*Jr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ae{constructor(t,i){this.wrap=t,this.canonical=i,this.key=at(t,i.z,i.z,i.x,i.y)}}class We{constructor(t,i,a,c,f){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=i,this.canonical=new Fe(a,+c,+f),this.key=at(i,t,a,c,f)}clone(){return new We(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?new We(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new We(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?at(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y):at(this.wrap*+i,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new We(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new We(i,this.wrap,i,a,c),new We(i,this.wrap,i,a+1,c),new We(i,this.wrap,i,a,c+1),new We(i,this.wrap,i,a+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new We(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new We(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ae(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new be(t.x-this.wrap,t.y))}}function at(r,t,i,a,c){(r*=2)<0&&(r=-1*r-1);const f=1<<i;return(f*f*r+f*c+a).toString(36)+i.toString(36)+t.toString(36)}Ye("CanonicalTileID",Fe),Ye("OverscaledTileID",We,{omit:["posMatrix"]});class pt{constructor(t,i,a,c=1,f=1,m=1,y=0){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void mr(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const x=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=f,this.blueFactor=m,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<x;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(x,T)]=this.data[this._idx(x-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,x)]=this.data[this._idx(T,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<x;T++)for(let E=0;E<x;E++){const C=this.get(T,E);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(t,i){const a=new Uint8Array(this.data.buffer),c=4*this._idx(t,i);return this.unpack(a[c],a[c+1],a[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}unpack(t,i,a){return t*this.redFactor+i*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Ii({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,i,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,f=i*this.dim+this.dim,m=a*this.dim,y=a*this.dim+this.dim;switch(i){case-1:c=f-1;break;case 1:f=c+1}switch(a){case-1:m=y-1;break;case 1:y=m+1}const x=-i*this.dim,T=-a*this.dim;for(let E=m;E<y;E++)for(let C=c;C<f;C++)this.data[this._idx(C,E)]=t.data[this._idx(C+x,E+T)]}}Ye("DEMData",pt);class Qr{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const a=t[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class ye{constructor(t,i,a,c,f){this.type="Feature",this._vectorTileFeature=t,t._z=i,t._x=a,t._y=c,this.properties=t.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(t[i]=this[i]);return t}}class le{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new pa(Jr,16,0),this.grid3D=new pa(Jr,16,0),this.featureIndexArray=new Cr,this.promoteId=i}insert(t,i,a,c,f,m){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,f);const x=m?this.grid3D:this.grid;for(let T=0;T<i.length;T++){const E=i[T],C=[1/0,1/0,-1/0,-1/0];for(let z=0;z<E.length;z++){const R=E[z];C[0]=Math.min(C[0],R.x),C[1]=Math.min(C[1],R.y),C[2]=Math.max(C[2],R.x),C[3]=Math.max(C[3],R.y)}C[0]<Jr&&C[1]<Jr&&C[2]>=0&&C[3]>=0&&x.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ta.VectorTile(new $o(this.rawTileData)).layers,this.sourceLayerCoder=new Qr(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,i,a,c){this.loadVTLayers();const f=t.params||{},m=Jr/t.tileSize/t.scale,y=Wa(f.filter),x=t.queryGeometry,T=t.queryPadding*m,E=$e(x),C=this.grid.query(E.minX-T,E.minY-T,E.maxX+T,E.maxY+T),z=$e(t.cameraQueryGeometry),R=this.grid3D.query(z.minX-T,z.minY-T,z.maxX+T,z.maxY+T,((X,ee,fe,ne)=>(function(ce,Te,ze,Je,yt){for(const Ge of ce)if(Te<=Ge.x&&ze<=Ge.y&&Je>=Ge.x&&yt>=Ge.y)return!0;const Xe=[new ke(Te,ze),new ke(Te,yt),new ke(Je,yt),new ke(Je,ze)];if(ce.length>2){for(const Ge of Xe)if(nl(ce,Ge))return!0}for(let Ge=0;Ge<ce.length-1;Ge++)if(Zh(ce[Ge],ce[Ge+1],Xe))return!0;return!1})(t.cameraQueryGeometry,X-T,ee-T,fe+T,ne+T)));for(const X of R)C.push(X);C.sort(mt);const O={};let j;for(let X=0;X<C.length;X++){const ee=C[X];if(ee===j)continue;j=ee;const fe=this.featureIndexArray.get(ee);let ne=null;this.loadMatchingFeature(O,fe.bucketIndex,fe.sourceLayerIndex,fe.featureIndex,y,f.layers,f.availableImages,i,a,c,((ce,Te,ze)=>(ne||(ne=wa(ce)),Te.queryIntersectsFeature(x,ce,ze,ne,this.z,t.transform,m,t.pixelPosMatrix))))}return O}loadMatchingFeature(t,i,a,c,f,m,y,x,T,E,C){const z=this.bucketLayerIDs[i];if(m&&!(function(X,ee){for(let fe=0;fe<X.length;fe++)if(ee.indexOf(X[fe])>=0)return!0;return!1})(m,z))return;const R=this.sourceLayerCoder.decode(a),O=this.vtLayers[R].feature(c);if(f.needGeometry){const X=ba(O,!0);if(!f.filter(new Zt(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!f.filter(new Zt(this.tileID.overscaledZ),O))return;const j=this.getId(O,R);for(let X=0;X<z.length;X++){const ee=z[X];if(m&&m.indexOf(ee)<0)continue;const fe=x[ee];if(!fe)continue;let ne={};j&&E&&(ne=E.getState(fe.sourceLayer||"_geojsonTileLayer",j));const ce=zr({},T[ee]);ce.paint=xe(ce.paint,fe.paint,O,ne,y),ce.layout=xe(ce.layout,fe.layout,O,ne,y);const Te=!C||C(O,fe,ne);if(!Te)continue;const ze=new ye(O,this.z,this.x,this.y,j);ze.layer=ce;let Je=t[ee];Je===void 0&&(Je=t[ee]=[]),Je.push({featureIndex:c,feature:ze,intersectionZ:Te})}}lookupSymbolFeatures(t,i,a,c,f,m,y,x){const T={};this.loadVTLayers();const E=Wa(f);for(const C of t)this.loadMatchingFeature(T,a,c,C,E,m,y,x,i);return T}hasLayer(t){for(const i of this.bucketLayerIDs)for(const a of i)if(t===a)return!0;return!1}getId(t,i){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof a=="boolean"&&(a=Number(a))),a}}function xe(r,t,i,a,c){return gi(r,((f,m)=>{const y=t instanceof ga?t.get(m):null;return y&&y.evaluate?y.evaluate(i,a,c):y}))}function $e(r){let t=1/0,i=1/0,a=-1/0,c=-1/0;for(const f of r)t=Math.min(t,f.x),i=Math.min(i,f.y),a=Math.max(a,f.x),c=Math.max(c,f.y);return{minX:t,minY:i,maxX:a,maxY:c}}function mt(r,t){return t-r}function St(r,t,i,a,c){const f=[];for(let m=0;m<r.length;m++){const y=r[m];let x;for(let T=0;T<y.length-1;T++){let E=y[T],C=y[T+1];E.x<t&&C.x<t||(E.x<t?E=new ke(t,E.y+(t-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x<t&&(C=new ke(t,E.y+(t-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y<i&&C.y<i||(E.y<i?E=new ke(E.x+(i-E.y)/(C.y-E.y)*(C.x-E.x),i)._round():C.y<i&&(C=new ke(E.x+(i-E.y)/(C.y-E.y)*(C.x-E.x),i)._round()),E.x>=a&&C.x>=a||(E.x>=a?E=new ke(a,E.y+(a-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x>=a&&(C=new ke(a,E.y+(a-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y>=c&&C.y>=c||(E.y>=c?E=new ke(E.x+(c-E.y)/(C.y-E.y)*(C.x-E.x),c)._round():C.y>=c&&(C=new ke(E.x+(c-E.y)/(C.y-E.y)*(C.x-E.x),c)._round()),x&&E.equals(x[x.length-1])||(x=[E],f.push(x)),x.push(C)))))}}return f}Ye("FeatureIndex",le,{omit:["rawTileData","sourceLayerCoder"]});class _t extends ke{constructor(t,i,a,c){super(t,i),this.angle=a,c!==void 0&&(this.segment=c)}clone(){return new _t(this.x,this.y,this.angle,this.segment)}}function Pt(r,t,i,a,c){if(t.segment===void 0||i===0)return!0;let f=t,m=t.segment+1,y=0;for(;y>-i/2;){if(m--,m<0)return!1;y-=r[m].dist(f),f=r[m]}y+=r[m].dist(r[m+1]),m++;const x=[];let T=0;for(;y<i/2;){const E=r[m],C=r[m+1];if(!C)return!1;let z=r[m-1].angleTo(E)-E.angleTo(C);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:z}),T+=z;y-x[0].distance>a;)T-=x.shift().angleDelta;if(T>c)return!1;m++,y+=E.dist(C)}return!0}function bi(r){let t=0;for(let i=0;i<r.length-1;i++)t+=r[i].dist(r[i+1]);return t}function cr(r,t,i){return r?.6*t*i:0}function qo(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Hd(r,t,i,a,c,f){const m=cr(i,c,f),y=qo(i,a)*f;let x=0;const T=bi(r)/2;for(let E=0;E<r.length-1;E++){const C=r[E],z=r[E+1],R=C.dist(z);if(x+R>T){const O=(T-x)/R,j=Xr.number(C.x,z.x,O),X=Xr.number(C.y,z.y,O),ee=new _t(j,X,z.angleTo(C),E);return ee._round(),!m||Pt(r,ee,y,m,t)?ee:void 0}x+=R}}function qp(r,t,i,a,c,f,m,y,x){const T=cr(a,f,m),E=qo(a,c),C=E*m,z=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return t-C<t/4&&(t=C+t/4),cp(r,z?t/2*y%t:(E/2+2*f)*m*y%t,t,T,i,C,z,!1,x)}function cp(r,t,i,a,c,f,m,y,x){const T=f/2,E=bi(r);let C=0,z=t-i,R=[];for(let O=0;O<r.length-1;O++){const j=r[O],X=r[O+1],ee=j.dist(X),fe=X.angleTo(j);for(;z+i<C+ee;){z+=i;const ne=(z-C)/ee,ce=Xr.number(j.x,X.x,ne),Te=Xr.number(j.y,X.y,ne);if(ce>=0&&ce<x&&Te>=0&&Te<x&&z-T>=0&&z+T<=E){const ze=new _t(ce,Te,fe,O);ze._round(),a&&!Pt(r,ze,f,a,c)||R.push(ze)}}C+=ee}return y||R.length||m||(R=cp(r,C/2,i,a,c,f,m,!0,x)),R}Ye("Anchor",_t);const Yc=vn;function hp(r,t,i,a){const c=[],f=r.image,m=f.pixelRatio,y=f.paddedRect.w-2*Yc,x=f.paddedRect.h-2*Yc;let T={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const E=f.stretchX||[[0,y]],C=f.stretchY||[[0,x]],z=(Ee,ht)=>Ee+ht[1]-ht[0],R=E.reduce(z,0),O=C.reduce(z,0),j=y-R,X=x-O;let ee=0,fe=R,ne=0,ce=O,Te=0,ze=j,Je=0,yt=X;if(f.content&&a){const Ee=f.content,ht=Ee[2]-Ee[0],lt=Ee[3]-Ee[1];(f.textFitWidth||f.textFitHeight)&&(T=Ku(r)),ee=Ed(E,0,Ee[0]),ne=Ed(C,0,Ee[1]),fe=Ed(E,Ee[0],Ee[2]),ce=Ed(C,Ee[1],Ee[3]),Te=Ee[0]-ee,Je=Ee[1]-ne,ze=ht-fe,yt=lt-ce}const Xe=T.x1,Ge=T.y1,ut=T.x2-Xe,nt=T.y2-Ge,tt=(Ee,ht,lt,It)=>{const Pr=Cd(Ee.stretch-ee,fe,ut,Xe),kr=Pd(Ee.fixed-Te,ze,Ee.stretch,R),Ei=Cd(ht.stretch-ne,ce,nt,Ge),vo=Pd(ht.fixed-Je,yt,ht.stretch,O),en=Cd(lt.stretch-ee,fe,ut,Xe),Ci=Pd(lt.fixed-Te,ze,lt.stretch,R),Fn=Cd(It.stretch-ne,ce,nt,Ge),Bn=Pd(It.fixed-Je,yt,It.stretch,O),On=new ke(Pr,Ei),ei=new ke(en,Ei),Pi=new ke(en,Fn),xn=new ke(Pr,Fn),tn=new ke(kr/m,vo/m),Nn=new ke(Ci/m,Bn/m),rn=t*Math.PI/180;if(rn){const sr=Math.sin(rn),Lr=Math.cos(rn),Vr=[Lr,-sr,sr,Lr];On._matMult(Vr),ei._matMult(Vr),xn._matMult(Vr),Pi._matMult(Vr)}const Ws=Ee.stretch+Ee.fixed,as=ht.stretch+ht.fixed;return{tl:On,tr:ei,bl:xn,br:Pi,tex:{x:f.paddedRect.x+Yc+Ws,y:f.paddedRect.y+Yc+as,w:lt.stretch+lt.fixed-Ws,h:It.stretch+It.fixed-as},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:tn,pixelOffsetBR:Nn,minFontScaleX:ze/m/ut,minFontScaleY:yt/m/nt,isSDF:i}};if(a&&(f.stretchX||f.stretchY)){const Ee=dp(E,j,R),ht=dp(C,X,O);for(let lt=0;lt<Ee.length-1;lt++){const It=Ee[lt],Pr=Ee[lt+1];for(let kr=0;kr<ht.length-1;kr++)c.push(tt(It,ht[kr],Pr,ht[kr+1]))}}else c.push(tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return c}function Ed(r,t,i){let a=0;for(const c of r)a+=Math.max(t,Math.min(i,c[1]))-Math.max(t,Math.min(i,c[0]));return a}function dp(r,t,i){const a=[{fixed:-Yc,stretch:0}];for(const[c,f]of r){const m=a[a.length-1];a.push({fixed:c-m.stretch,stretch:m.stretch}),a.push({fixed:c-m.stretch,stretch:m.stretch+(f-c)})}return a.push({fixed:t+Yc,stretch:i}),a}function Cd(r,t,i,a){return r/t*i+a}function Pd(r,t,i,a){return r-t*i/a}class Md{constructor(t,i,a,c,f,m,y,x,T,E){var C;if(this.boxStartIndex=t.length,T){let z=m.top,R=m.bottom;const O=m.collisionPadding;O&&(z-=O[1],R+=O[3]);let j=R-z;j>0&&(j=Math.max(10,j),this.circleDiameter=j)}else{const z=!((C=m.image)===null||C===void 0)&&C.content&&(m.image.textFitWidth||m.image.textFitHeight)?Ku(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};z.y1=z.y1*y-x[0],z.y2=z.y2*y+x[2],z.x1=z.x1*y-x[3],z.x2=z.x2*y+x[1];const R=m.collisionPadding;if(R&&(z.x1-=R[0]*y,z.y1-=R[1]*y,z.x2+=R[2]*y,z.y2+=R[3]*y),E){const O=new ke(z.x1,z.y1),j=new ke(z.x2,z.y1),X=new ke(z.x1,z.y2),ee=new ke(z.x2,z.y2),fe=E*Math.PI/180;O._rotate(fe),j._rotate(fe),X._rotate(fe),ee._rotate(fe),z.x1=Math.min(O.x,j.x,X.x,ee.x),z.x2=Math.max(O.x,j.x,X.x,ee.x),z.y1=Math.min(O.y,j.y,X.y,ee.y),z.y2=Math.max(O.y,j.y,X.y,ee.y)}t.emplaceBack(i.x,i.y,z.x1,z.y1,z.x2,z.y2,a,c,f)}this.boxEndIndex=t.length}}class Gp{constructor(t=[],i=((a,c)=>a<c?-1:a>c?1:0)){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:a}=this,c=i[t];for(;t>0;){const f=t-1>>1,m=i[f];if(a(c,m)>=0)break;i[t]=m,t=f}i[t]=c}_down(t){const{data:i,compare:a}=this,c=this.length>>1,f=i[t];for(;t<c;){let m=1+(t<<1);const y=m+1;if(y<this.length&&a(i[y],i[m])<0&&(m=y),a(i[m],f)>=0)break;i[t]=i[m],t=m}i[t]=f}}function Hp(r,t=1,i=!1){let a=1/0,c=1/0,f=-1/0,m=-1/0;const y=r[0];for(let R=0;R<y.length;R++){const O=y[R];(!R||O.x<a)&&(a=O.x),(!R||O.y<c)&&(c=O.y),(!R||O.x>f)&&(f=O.x),(!R||O.y>m)&&(m=O.y)}const x=Math.min(f-a,m-c);let T=x/2;const E=new Gp([],Wp);if(x===0)return new ke(a,c);for(let R=a;R<f;R+=x)for(let O=c;O<m;O+=x)E.push(new Qc(R+T,O+T,T,r));let C=(function(R){let O=0,j=0,X=0;const ee=R[0];for(let fe=0,ne=ee.length,ce=ne-1;fe<ne;ce=fe++){const Te=ee[fe],ze=ee[ce],Je=Te.x*ze.y-ze.x*Te.y;j+=(Te.x+ze.x)*Je,X+=(Te.y+ze.y)*Je,O+=3*Je}return new Qc(j/O,X/O,0,R)})(r),z=E.length;for(;E.length;){const R=E.pop();(R.d>C.d||!C.d)&&(C=R,i&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,z)),R.max-C.d<=t||(T=R.h/2,E.push(new Qc(R.p.x-T,R.p.y-T,T,r)),E.push(new Qc(R.p.x+T,R.p.y-T,T,r)),E.push(new Qc(R.p.x-T,R.p.y+T,T,r)),E.push(new Qc(R.p.x+T,R.p.y+T,T,r)),z+=4)}return i&&(console.log(`num probes: ${z}`),console.log(`best distance: ${C.d}`)),C.p}function Wp(r,t){return t.max-r.max}function Qc(r,t,i,a){this.p=new ke(r,t),this.h=i,this.d=(function(c,f){let m=!1,y=1/0;for(let x=0;x<f.length;x++){const T=f[x];for(let E=0,C=T.length,z=C-1;E<C;z=E++){const R=T[E],O=T[z];R.y>c.y!=O.y>c.y&&c.x<(O.x-R.x)*(c.y-R.y)/(O.y-R.y)+R.x&&(m=!m),y=Math.min(y,yh(c,R,O))}}return(m?1:-1)*Math.sqrt(y)})(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Qi;A.aq=void 0,(Qi=A.aq||(A.aq={}))[Qi.center=1]="center",Qi[Qi.left=2]="left",Qi[Qi.right=3]="right",Qi[Qi.top=4]="top",Qi[Qi.bottom=5]="bottom",Qi[Qi["top-left"]=6]="top-left",Qi[Qi["top-right"]=7]="top-right",Qi[Qi["bottom-left"]=8]="bottom-left",Qi[Qi["bottom-right"]=9]="bottom-right";const Yl=7,Wd=Number.POSITIVE_INFINITY;function pp(r,t){return t[1]!==Wd?(function(i,a,c){let f=0,m=0;switch(a=Math.abs(a),c=Math.abs(c),i){case"top-right":case"top-left":case"top":m=c-Yl;break;case"bottom-right":case"bottom-left":case"bottom":m=-c+Yl}switch(i){case"top-right":case"bottom-right":case"right":f=-a;break;case"top-left":case"bottom-left":case"left":f=a}return[f,m]})(r,t[0],t[1]):(function(i,a){let c=0,f=0;a<0&&(a=0);const m=a/Math.SQRT2;switch(i){case"top-right":case"top-left":f=m-Yl;break;case"bottom-right":case"bottom-left":f=-m+Yl;break;case"bottom":f=-a+Yl;break;case"top":f=a-Yl}switch(i){case"top-right":case"bottom-right":c=-m;break;case"top-left":case"bottom-left":c=m;break;case"left":c=a;break;case"right":c=-a}return[c,f]})(r,t[0])}function fp(r,t,i){var a;const c=r.layout,f=(a=c.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},i);if(f){const y=f.values,x=[];for(let T=0;T<y.length;T+=2){const E=x[T]=y[T],C=y[T+1].map((z=>z*Nr));E.startsWith("top")?C[1]-=Yl:E.startsWith("bottom")&&(C[1]+=Yl),x[T+1]=C}return new un(x)}const m=c.get("text-variable-anchor");if(m){let y;y=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(t,{},i)*Nr,Wd]:c.get("text-offset").evaluate(t,{},i).map((T=>T*Nr));const x=[];for(const T of m)x.push(T,pp(T,y));return new un(x)}return null}function Xd(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Xp(r,t,i,a,c,f,m,y,x,T,E){let C=f.textMaxSize.evaluate(t,{});C===void 0&&(C=m);const z=r.layers[0].layout,R=z.get("icon-offset").evaluate(t,{},E),O=gp(i.horizontal),j=m/24,X=r.tilePixelRatio*j,ee=r.tilePixelRatio*C/24,fe=r.tilePixelRatio*y,ne=r.tilePixelRatio*z.get("symbol-spacing"),ce=z.get("text-padding")*r.tilePixelRatio,Te=(function(Ee,ht,lt,It=1){const Pr=Ee.get("icon-padding").evaluate(ht,{},lt),kr=Pr&&Pr.values;return[kr[0]*It,kr[1]*It,kr[2]*It,kr[3]*It]})(z,t,E,r.tilePixelRatio),ze=z.get("text-max-angle")/180*Math.PI,Je=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",yt=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Xe=z.get("symbol-placement"),Ge=ne/2,ut=z.get("icon-text-fit");let nt;a&&ut!=="none"&&(r.allowVerticalPlacement&&i.vertical&&(nt=Ma(a,i.vertical,ut,z.get("icon-text-fit-padding"),R,j)),O&&(a=Ma(a,O,ut,z.get("icon-text-fit-padding"),R,j)));const tt=(Ee,ht)=>{ht.x<0||ht.x>=Jr||ht.y<0||ht.y>=Jr||(function(lt,It,Pr,kr,Ei,vo,en,Ci,Fn,Bn,On,ei,Pi,xn,tn,Nn,rn,Ws,as,sr,Lr,Vr,Ss,Yr,eh){const Aa=lt.addToLineVertexArray(It,Pr);let Da,xo,Xs,Ni,fl=0,jh=0,xp=0,wp=0,ip=-1,np=-1;const ml={};let bp=ya("");if(lt.allowVerticalPlacement&&kr.vertical){const wn=Ci.layout.get("text-rotate").evaluate(Lr,{},Yr)+90;Xs=new Md(Fn,It,Bn,On,ei,kr.vertical,Pi,xn,tn,wn),en&&(Ni=new Md(Fn,It,Bn,On,ei,en,rn,Ws,tn,wn))}if(Ei){const wn=Ci.layout.get("icon-rotate").evaluate(Lr,{}),Ks=Ci.layout.get("icon-text-fit")!=="none",tc=hp(Ei,wn,Ss,Ks),Ho=en?hp(en,wn,Ss,Ks):void 0;xo=new Md(Fn,It,Bn,On,ei,Ei,rn,Ws,!1,wn),fl=4*tc.length;const rc=lt.iconSizeData;let La=null;rc.kind==="source"?(La=[bs*Ci.layout.get("icon-size").evaluate(Lr,{})],La[0]>yo&&mr(`${lt.layerIds[0]}: Value for "icon-size" is >= ${za}. Reduce your "icon-size".`)):rc.kind==="composite"&&(La=[bs*Vr.compositeIconSizes[0].evaluate(Lr,{},Yr),bs*Vr.compositeIconSizes[1].evaluate(Lr,{},Yr)],(La[0]>yo||La[1]>yo)&&mr(`${lt.layerIds[0]}: Value for "icon-size" is >= ${za}. Reduce your "icon-size".`)),lt.addSymbols(lt.icon,tc,La,sr,as,Lr,A.ah.none,It,Aa.lineStartIndex,Aa.lineLength,-1,Yr),ip=lt.icon.placedSymbolArray.length-1,Ho&&(jh=4*Ho.length,lt.addSymbols(lt.icon,Ho,La,sr,as,Lr,A.ah.vertical,It,Aa.lineStartIndex,Aa.lineLength,-1,Yr),np=lt.icon.placedSymbolArray.length-1)}const Sp=Object.keys(kr.horizontal);for(const wn of Sp){const Ks=kr.horizontal[wn];if(!Da){bp=ya(Ks.text);const Ho=Ci.layout.get("text-rotate").evaluate(Lr,{},Yr);Da=new Md(Fn,It,Bn,On,ei,Ks,Pi,xn,tn,Ho)}const tc=Ks.positionedLines.length===1;if(xp+=mp(lt,It,Ks,vo,Ci,tn,Lr,Nn,Aa,kr.vertical?A.ah.horizontal:A.ah.horizontalOnly,tc?Sp:[wn],ml,ip,Vr,Yr),tc)break}kr.vertical&&(wp+=mp(lt,It,kr.vertical,vo,Ci,tn,Lr,Nn,Aa,A.ah.vertical,["vertical"],ml,np,Vr,Yr));const Yp=Da?Da.boxStartIndex:lt.collisionBoxArray.length,Qp=Da?Da.boxEndIndex:lt.collisionBoxArray.length,ef=Xs?Xs.boxStartIndex:lt.collisionBoxArray.length,tf=Xs?Xs.boxEndIndex:lt.collisionBoxArray.length,rf=xo?xo.boxStartIndex:lt.collisionBoxArray.length,nf=xo?xo.boxEndIndex:lt.collisionBoxArray.length,sf=Ni?Ni.boxStartIndex:lt.collisionBoxArray.length,of=Ni?Ni.boxEndIndex:lt.collisionBoxArray.length;let Go=-1;const Ad=(wn,Ks)=>wn&&wn.circleDiameter?Math.max(wn.circleDiameter,Ks):Ks;Go=Ad(Da,Go),Go=Ad(Xs,Go),Go=Ad(xo,Go),Go=Ad(Ni,Go);const Tp=Go>-1?1:0;Tp&&(Go*=eh/Nr),lt.glyphOffsetArray.length>=Kl.MAX_GLYPHS&&mr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Lr.sortKey!==void 0&&lt.addToSortKeyRanges(lt.symbolInstances.length,Lr.sortKey);const af=fp(Ci,Lr,Yr),[lf,uf]=(function(wn,Ks){const tc=wn.length,Ho=Ks==null?void 0:Ks.values;if((Ho==null?void 0:Ho.length)>0)for(let rc=0;rc<Ho.length;rc+=2){const La=Ho[rc+1];wn.emplaceBack(A.aq[Ho[rc]],La[0],La[1])}return[tc,wn.length]})(lt.textAnchorOffsets,af);lt.symbolInstances.emplaceBack(It.x,It.y,ml.right>=0?ml.right:-1,ml.center>=0?ml.center:-1,ml.left>=0?ml.left:-1,ml.vertical||-1,ip,np,bp,Yp,Qp,ef,tf,rf,nf,sf,of,Bn,xp,wp,fl,jh,Tp,0,Pi,Go,lf,uf)})(r,ht,Ee,i,a,c,nt,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,X,[ce,ce,ce,ce],Je,x,fe,Te,yt,R,t,f,T,E,m)};if(Xe==="line")for(const Ee of St(t.geometry,0,0,Jr,Jr)){const ht=qp(Ee,ne,ze,i.vertical||O,a,24,ee,r.overscaling,Jr);for(const lt of ht)O&&Kp(r,O.text,Ge,lt)||tt(Ee,lt)}else if(Xe==="line-center"){for(const Ee of t.geometry)if(Ee.length>1){const ht=Hd(Ee,ze,i.vertical||O,a,24,ee);ht&&tt(Ee,ht)}}else if(t.type==="Polygon")for(const Ee of ta(t.geometry,0)){const ht=Hp(Ee,16);tt(Ee[0],new _t(ht.x,ht.y,0))}else if(t.type==="LineString")for(const Ee of t.geometry)tt(Ee,new _t(Ee[0].x,Ee[0].y,0));else if(t.type==="Point")for(const Ee of t.geometry)for(const ht of Ee)tt([ht],new _t(ht.x,ht.y,0))}function mp(r,t,i,a,c,f,m,y,x,T,E,C,z,R,O){const j=(function(fe,ne,ce,Te,ze,Je,yt,Xe){const Ge=Te.layout.get("text-rotate").evaluate(Je,{})*Math.PI/180,ut=[];for(const nt of ne.positionedLines)for(const tt of nt.positionedGlyphs){if(!tt.rect)continue;const Ee=tt.rect||{};let ht=qc+1,lt=!0,It=1,Pr=0;const kr=(ze||Xe)&&tt.vertical,Ei=tt.metrics.advance*tt.scale/2;if(Xe&&ne.verticalizable&&(Pr=nt.lineOffset/2-(tt.imageName?-(Nr-tt.metrics.width*tt.scale)/2:(tt.scale-1)*Nr)),tt.imageName){const sr=yt[tt.imageName];lt=sr.sdf,It=sr.pixelRatio,ht=vn/It}const vo=ze?[tt.x+Ei,tt.y]:[0,0];let en=ze?[0,0]:[tt.x+Ei+ce[0],tt.y+ce[1]-Pr],Ci=[0,0];kr&&(Ci=en,en=[0,0]);const Fn=tt.metrics.isDoubleResolution?2:1,Bn=(tt.metrics.left-ht)*tt.scale-Ei+en[0],On=(-tt.metrics.top-ht)*tt.scale+en[1],ei=Bn+Ee.w/Fn*tt.scale/It,Pi=On+Ee.h/Fn*tt.scale/It,xn=new ke(Bn,On),tn=new ke(ei,On),Nn=new ke(Bn,Pi),rn=new ke(ei,Pi);if(kr){const sr=new ke(-Ei,Ei-Gs),Lr=-Math.PI/2,Vr=Nr/2-Ei,Ss=new ke(5-Gs-Vr,-(tt.imageName?Vr:0)),Yr=new ke(...Ci);xn._rotateAround(Lr,sr)._add(Ss)._add(Yr),tn._rotateAround(Lr,sr)._add(Ss)._add(Yr),Nn._rotateAround(Lr,sr)._add(Ss)._add(Yr),rn._rotateAround(Lr,sr)._add(Ss)._add(Yr)}if(Ge){const sr=Math.sin(Ge),Lr=Math.cos(Ge),Vr=[Lr,-sr,sr,Lr];xn._matMult(Vr),tn._matMult(Vr),Nn._matMult(Vr),rn._matMult(Vr)}const Ws=new ke(0,0),as=new ke(0,0);ut.push({tl:xn,tr:tn,bl:Nn,br:rn,tex:Ee,writingMode:ne.writingMode,glyphOffset:vo,sectionIndex:tt.sectionIndex,isSDF:lt,pixelOffsetTL:Ws,pixelOffsetBR:as,minFontScaleX:0,minFontScaleY:0})}return ut})(0,i,y,c,f,m,a,r.allowVerticalPlacement),X=r.textSizeData;let ee=null;X.kind==="source"?(ee=[bs*c.layout.get("text-size").evaluate(m,{})],ee[0]>yo&&mr(`${r.layerIds[0]}: Value for "text-size" is >= ${za}. Reduce your "text-size".`)):X.kind==="composite"&&(ee=[bs*R.compositeTextSizes[0].evaluate(m,{},O),bs*R.compositeTextSizes[1].evaluate(m,{},O)],(ee[0]>yo||ee[1]>yo)&&mr(`${r.layerIds[0]}: Value for "text-size" is >= ${za}. Reduce your "text-size".`)),r.addSymbols(r.text,j,ee,y,f,m,T,t,x.lineStartIndex,x.lineLength,z,O);for(const fe of E)C[fe]=r.text.placedSymbolArray.length-1;return 4*j.length}function gp(r){for(const t in r)return r[t];return null}function Kp(r,t,i,a){const c=r.compareText;if(t in c){const f=c[t];for(let m=f.length-1;m>=0;m--)if(a.dist(f[m])<i)return!0}else c[t]=[];return c[t].push(a),!1}const _p=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Kd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const f=_p[15&a];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new Kd(y,m,f,t)}constructor(t,i=64,a=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const f=_p.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=i,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Jd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:y}=this,x=[0,f.length-1,0],T=[];for(;x.length;){const E=x.pop()||0,C=x.pop()||0,z=x.pop()||0;if(C-z<=y){for(let X=z;X<=C;X++){const ee=m[2*X],fe=m[2*X+1];ee>=t&&ee<=a&&fe>=i&&fe<=c&&T.push(f[X])}continue}const R=z+C>>1,O=m[2*R],j=m[2*R+1];O>=t&&O<=a&&j>=i&&j<=c&&T.push(f[R]),(E===0?t<=O:i<=j)&&(x.push(z),x.push(R-1),x.push(1-E)),(E===0?a>=O:c>=j)&&(x.push(R+1),x.push(C),x.push(1-E))}return T}within(t,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:f,nodeSize:m}=this,y=[0,c.length-1,0],x=[],T=a*a;for(;y.length;){const E=y.pop()||0,C=y.pop()||0,z=y.pop()||0;if(C-z<=m){for(let X=z;X<=C;X++)vp(f[2*X],f[2*X+1],t,i)<=T&&x.push(c[X]);continue}const R=z+C>>1,O=f[2*R],j=f[2*R+1];vp(O,j,t,i)<=T&&x.push(c[R]),(E===0?t-a<=O:i-a<=j)&&(y.push(z),y.push(R-1),y.push(1-E)),(E===0?t+a>=O:i+a>=j)&&(y.push(R+1),y.push(C),y.push(1-E))}return x}}function Jd(r,t,i,a,c,f){if(c-a<=i)return;const m=a+c>>1;yp(r,t,m,a,c,f),Jd(r,t,i,a,m-1,1-f),Jd(r,t,i,m+1,c,1-f)}function yp(r,t,i,a,c,f){for(;c>a;){if(c-a>600){const T=c-a+1,E=i-a+1,C=Math.log(T),z=.5*Math.exp(2*C/3),R=.5*Math.sqrt(C*z*(T-z)/T)*(E-T/2<0?-1:1);yp(r,t,i,Math.max(a,Math.floor(i-E*z/T+R)),Math.min(c,Math.floor(i+(T-E)*z/T+R)),f)}const m=t[2*i+f];let y=a,x=c;for(Nh(r,t,a,i),t[2*c+f]>m&&Nh(r,t,a,c);y<x;){for(Nh(r,t,y,x),y++,x--;t[2*y+f]<m;)y++;for(;t[2*x+f]>m;)x--}t[2*a+f]===m?Nh(r,t,a,x):(x++,Nh(r,t,x,c)),x<=i&&(a=x+1),i<=x&&(c=x-1)}}function Nh(r,t,i,a){Yd(r,i,a),Yd(t,2*i,2*a),Yd(t,2*i+1,2*a+1)}function Yd(r,t,i){const a=r[t];r[t]=r[i],r[i]=a}function vp(r,t,i,a){const c=r-i,f=t-a;return c*c+f*f}var Qd;A.bg=void 0,(Qd=A.bg||(A.bg={})).create="create",Qd.load="load",Qd.fullLoad="fullLoad";let zd=null,Vh=[];const ep=1e3/60,tp="loadTime",rp="fullLoadTime",Jp={mark(r){performance.mark(r)},frame(r){const t=r;zd!=null&&Vh.push(t-zd),zd=t},clearMetrics(){zd=null,Vh=[],performance.clearMeasures(tp),performance.clearMeasures(rp);for(const r in A.bg)performance.clearMarks(A.bg[r])},getPerformanceMetrics(){performance.measure(tp,A.bg.create,A.bg.load),performance.measure(rp,A.bg.create,A.bg.fullLoad);const r=performance.getEntriesByName(tp)[0].duration,t=performance.getEntriesByName(rp)[0].duration,i=Vh.length,a=1/(Vh.reduce(((f,m)=>f+m),0)/i/1e3),c=Vh.filter((f=>f>ep)).reduce(((f,m)=>f+(m-ep)/ep),0);return{loadTime:r,fullLoadTime:t,fps:a,percentDroppedFrames:c/(i+c)*100,totalFrames:i}}};A.$=class extends P{},A.A=Ul,A.B=xu,A.C=function(r){if(ti==null){const t=r.navigator?r.navigator.userAgent:null;ti=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ti},A.D=Qe,A.E=wo,A.F=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new n((()=>this.process())),this.subscription=(function(i,a,c,f){return i.addEventListener(a,c,!1),{unsubscribe:()=>{i.removeEventListener(a,c,!1)}}})(this.target,"message",(i=>this.receive(i))),this.globalScope=ci(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise(((i,a)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:i,reject:a},t&&t.signal.addEventListener("abort",(()=>{delete this.resolveRejects[c];const y={id:c,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(y)}),{once:!0});const f=[],m=Object.assign(Object.assign({},r),{id:c,sourceMapId:this.mapId,origin:location.origin,data:Ri(r.data,f)});this.target.postMessage(m,{transfer:f})}))}receive(r){const t=r.data,i=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[i];const a=this.abortControllers[i];return delete this.abortControllers[i],void(a&&a.abort())}if(ci(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return g(this,void 0,void 0,(function*(){if(t.type==="<response>"){const c=this.resolveRejects[r];return delete this.resolveRejects[r],c?void(t.error?c.reject(ys(t.error)):c.resolve(ys(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=ys(t.data),a=new AbortController;this.abortControllers[r]=a;try{const c=yield this.messageHandlers[t.type](t.sourceMapId,i,a);this.completeTask(r,null,c)}catch(c){this.completeTask(r,c)}}))}completeTask(r,t,i){const a=[];delete this.abortControllers[r];const c={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Ri(t):null,data:Ri(i,a)};this.target.postMessage(c,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},A.G=Gt,A.H=function(){var r=new Ul(16);return Ul!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},A.I=Lh,A.J=function(r,t,i){var a,c,f,m,y,x,T,E,C,z,R,O,j=i[0],X=i[1],ee=i[2];return t===r?(r[12]=t[0]*j+t[4]*X+t[8]*ee+t[12],r[13]=t[1]*j+t[5]*X+t[9]*ee+t[13],r[14]=t[2]*j+t[6]*X+t[10]*ee+t[14],r[15]=t[3]*j+t[7]*X+t[11]*ee+t[15]):(c=t[1],f=t[2],m=t[3],y=t[4],x=t[5],T=t[6],E=t[7],C=t[8],z=t[9],R=t[10],O=t[11],r[0]=a=t[0],r[1]=c,r[2]=f,r[3]=m,r[4]=y,r[5]=x,r[6]=T,r[7]=E,r[8]=C,r[9]=z,r[10]=R,r[11]=O,r[12]=a*j+y*X+C*ee+t[12],r[13]=c*j+x*X+z*ee+t[13],r[14]=f*j+T*X+R*ee+t[14],r[15]=m*j+E*X+O*ee+t[15]),r},A.K=function(r,t,i){var a=i[0],c=i[1],f=i[2];return r[0]=t[0]*a,r[1]=t[1]*a,r[2]=t[2]*a,r[3]=t[3]*a,r[4]=t[4]*c,r[5]=t[5]*c,r[6]=t[6]*c,r[7]=t[7]*c,r[8]=t[8]*f,r[9]=t[9]*f,r[10]=t[10]*f,r[11]=t[11]*f,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},A.L=wh,A.M=function(r,t){const i={};for(let a=0;a<t.length;a++){const c=t[a];c in r&&(i[c]=r[c])}return i},A.N=h,A.O=k,A.P=ke,A.Q=B,A.R=Ii,A.S=We,A.T=yi,A.U=Mr,A.V=Rr,A.W=vt,A.X=Jr,A.Y=v,A.Z=be,A._=g,A.a=At,A.a$=function(r,t){var i=r[0],a=r[1],c=r[2],f=r[3],m=r[4],y=r[5],x=r[6],T=r[7],E=r[8],C=r[9],z=r[10],R=r[11],O=r[12],j=r[13],X=r[14],ee=r[15],fe=t[0],ne=t[1],ce=t[2],Te=t[3],ze=t[4],Je=t[5],yt=t[6],Xe=t[7],Ge=t[8],ut=t[9],nt=t[10],tt=t[11],Ee=t[12],ht=t[13],lt=t[14],It=t[15];return Math.abs(i-fe)<=Xi*Math.max(1,Math.abs(i),Math.abs(fe))&&Math.abs(a-ne)<=Xi*Math.max(1,Math.abs(a),Math.abs(ne))&&Math.abs(c-ce)<=Xi*Math.max(1,Math.abs(c),Math.abs(ce))&&Math.abs(f-Te)<=Xi*Math.max(1,Math.abs(f),Math.abs(Te))&&Math.abs(m-ze)<=Xi*Math.max(1,Math.abs(m),Math.abs(ze))&&Math.abs(y-Je)<=Xi*Math.max(1,Math.abs(y),Math.abs(Je))&&Math.abs(x-yt)<=Xi*Math.max(1,Math.abs(x),Math.abs(yt))&&Math.abs(T-Xe)<=Xi*Math.max(1,Math.abs(T),Math.abs(Xe))&&Math.abs(E-Ge)<=Xi*Math.max(1,Math.abs(E),Math.abs(Ge))&&Math.abs(C-ut)<=Xi*Math.max(1,Math.abs(C),Math.abs(ut))&&Math.abs(z-nt)<=Xi*Math.max(1,Math.abs(z),Math.abs(nt))&&Math.abs(R-tt)<=Xi*Math.max(1,Math.abs(R),Math.abs(tt))&&Math.abs(O-Ee)<=Xi*Math.max(1,Math.abs(O),Math.abs(Ee))&&Math.abs(j-ht)<=Xi*Math.max(1,Math.abs(j),Math.abs(ht))&&Math.abs(X-lt)<=Xi*Math.max(1,Math.abs(X),Math.abs(lt))&&Math.abs(ee-It)<=Xi*Math.max(1,Math.abs(ee),Math.abs(It))},A.a0=Bt,A.a1=Fe,A.a2=Re,A.a3=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((i=>{t.onloadstart=()=>{i(t)};for(const a of r){const c=window.document.createElement("source");ri(a)||(t.crossOrigin="Anonymous"),c.src=a,t.appendChild(c)}}))},A.a4=function(){return Mi++},A.a5=Ze,A.a6=Kl,A.a7=Wa,A.a8=ba,A.a9=ye,A.aA=function(r){if(r.type==="custom")return new Jc(r);switch(r.type){case"background":return new Kc(r);case"circle":return new Rd(r);case"fill":return new Bd(r);case"fill-extrusion":return new cd(r);case"heatmap":return new Fd(r);case"hillshade":return new Xh(r);case"line":return new Hl(r);case"raster":return new Gd(r);case"symbol":return new pl(r)}},A.aB=Kt,A.aC=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let i=[];try{if(!Jt(r.version,t.version))return[{command:"setStyle",args:[t]}];Jt(r.center,t.center)||i.push({command:"setCenter",args:[t.center]}),Jt(r.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),Jt(r.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),Jt(r.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),Jt(r.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),Jt(r.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),Jt(r.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),Jt(r.light,t.light)||i.push({command:"setLight",args:[t.light]}),Jt(r.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),Jt(r.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),Jt(r.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});const a={},c=[];(function(m,y,x,T){let E;for(E in y=y||{},m=m||{})Object.prototype.hasOwnProperty.call(m,E)&&(Object.prototype.hasOwnProperty.call(y,E)||hs(E,x,T));for(E in y)Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(m,E)?Jt(m[E],y[E])||(m[E].type==="geojson"&&y[E].type==="geojson"&&bo(m,y,E)?wr(x,{command:"setGeoJSONSourceData",args:[E,y[E].data]}):ds(E,y,x,T)):cs(E,y,x))})(r.sources,t.sources,c,a);const f=[];r.layers&&r.layers.forEach((m=>{"source"in m&&a[m.source]?i.push({command:"removeLayer",args:[m.id]}):f.push(m)})),i=i.concat(c),(function(m,y,x){y=y||[];const T=(m=m||[]).map(Xo),E=y.map(Xo),C=m.reduce(So,{}),z=y.reduce(So,{}),R=T.slice(),O=Object.create(null);let j,X,ee,fe,ne;for(let ce=0,Te=0;ce<T.length;ce++)j=T[ce],Object.prototype.hasOwnProperty.call(z,j)?Te++:(wr(x,{command:"removeLayer",args:[j]}),R.splice(R.indexOf(j,Te),1));for(let ce=0,Te=0;ce<E.length;ce++)j=E[E.length-1-ce],R[R.length-1-ce]!==j&&(Object.prototype.hasOwnProperty.call(C,j)?(wr(x,{command:"removeLayer",args:[j]}),R.splice(R.lastIndexOf(j,R.length-Te),1)):Te++,fe=R[R.length-ce],wr(x,{command:"addLayer",args:[z[j],fe]}),R.splice(R.length-ce,0,j),O[j]=!0);for(let ce=0;ce<E.length;ce++)if(j=E[ce],X=C[j],ee=z[j],!O[j]&&!Jt(X,ee))if(Jt(X.source,ee.source)&&Jt(X["source-layer"],ee["source-layer"])&&Jt(X.type,ee.type)){for(ne in on(X.layout,ee.layout,x,j,null,"setLayoutProperty"),on(X.paint,ee.paint,x,j,null,"setPaintProperty"),Jt(X.filter,ee.filter)||wr(x,{command:"setFilter",args:[j,ee.filter]}),Jt(X.minzoom,ee.minzoom)&&Jt(X.maxzoom,ee.maxzoom)||wr(x,{command:"setLayerZoomRange",args:[j,ee.minzoom,ee.maxzoom]}),X)Object.prototype.hasOwnProperty.call(X,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?on(X[ne],ee[ne],x,j,ne.slice(6),"setPaintProperty"):Jt(X[ne],ee[ne])||wr(x,{command:"setLayerProperty",args:[j,ne,ee[ne]]}));for(ne in ee)Object.prototype.hasOwnProperty.call(ee,ne)&&!Object.prototype.hasOwnProperty.call(X,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?on(X[ne],ee[ne],x,j,ne.slice(6),"setPaintProperty"):Jt(X[ne],ee[ne])||wr(x,{command:"setLayerProperty",args:[j,ne,ee[ne]]}))}else wr(x,{command:"removeLayer",args:[j]}),fe=R[R.lastIndexOf(j)+1],wr(x,{command:"addLayer",args:[ee,fe]})})(f,t.layers,i)}catch(a){console.warn("Unable to compute style diff:",a),i=[{command:"setStyle",args:[t]}]}return i},A.aD=function(r){const t=[],i=r.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},A.aE=function r(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let a=0;a<t.length;a++)if(!r(t[a],i[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&i!==null){if(typeof i!="object"||Object.keys(t).length!==Object.keys(i).length)return!1;for(const a in t)if(!r(t[a],i[a]))return!1;return!0}return t===i},A.aF=gi,A.aG=nn,A.aH=class extends Ur{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},A.aI=oi,A.aJ=class extends Ur{constructor(r,t){super(r,t),this.current=Iu}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},A.aK=ku,A.aL=Vl,A.aM=kt,A.aN=class extends Ur{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},A.aO=class extends Ur{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},A.aP=function(r,t,i,a,c,f,m){var y=1/(t-i),x=1/(a-c),T=1/(f-m);return r[0]=-2*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*T,r[11]=0,r[12]=(t+i)*y,r[13]=(c+a)*x,r[14]=(m+f)*T,r[15]=1,r},A.aQ=kc,A.aR=class extends oe{},A.aS=ju,A.aT=class extends _e{},A.aU=Au,A.aV=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},A.aW=zc,A.aX=qr,A.aY=Mn,A.aZ=class extends it{},A.a_=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},A.aa=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,a,c,f)=>{const m=c||f;return t[a]=!m||m.toLowerCase(),""})),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t},A.ab=function(r,t){const i=[];for(const a in r)a in t||i.push(a);return i},A.ac=hr,A.ad=function(r,t,i){var a=Math.sin(i),c=Math.cos(i),f=t[0],m=t[1],y=t[2],x=t[3],T=t[4],E=t[5],C=t[6],z=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=f*c+T*a,r[1]=m*c+E*a,r[2]=y*c+C*a,r[3]=x*c+z*a,r[4]=T*c-f*a,r[5]=E*c-m*a,r[6]=C*c-y*a,r[7]=z*c-x*a,r},A.ae=function(r){var t=new Ul(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},A.af=Ic,A.ag=function(r,t){let i=0,a=0;if(r.kind==="constant")a=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:f,maxZoom:m}=r,y=c?hr(di.interpolationFactor(c,t,f,m),0,1):0;r.kind==="camera"?a=Xr.number(r.minSize,r.maxSize,y):i=y}return{uSizeT:i,uSize:a}},A.ai=function(r,{uSize:t,uSizeT:i},{lowerSize:a,upperSize:c}){return r.kind==="source"?a/bs:r.kind==="composite"?Xr.number(a/bs,c/bs,i):t},A.aj=Xl,A.ak=function(r,t,i,a){const c=t.y-r.y,f=t.x-r.x,m=a.y-i.y,y=a.x-i.x,x=m*f-y*c;if(x===0)return null;const T=(y*(r.y-i.y)-m*(r.x-i.x))/x;return new ke(r.x+T*f,r.y+T*c)},A.al=St,A.am=gh,A.an=Tc,A.ao=function(r){let t=1/0,i=1/0,a=-1/0,c=-1/0;for(const f of r)t=Math.min(t,f.x),i=Math.min(i,f.y),a=Math.max(a,f.x),c=Math.max(c,f.y);return[t,i,a,c]},A.ap=Nr,A.ar=Ju,A.as=function(r,t){var i=t[0],a=t[1],c=t[2],f=t[3],m=t[4],y=t[5],x=t[6],T=t[7],E=t[8],C=t[9],z=t[10],R=t[11],O=t[12],j=t[13],X=t[14],ee=t[15],fe=i*y-a*m,ne=i*x-c*m,ce=i*T-f*m,Te=a*x-c*y,ze=a*T-f*y,Je=c*T-f*x,yt=E*j-C*O,Xe=E*X-z*O,Ge=E*ee-R*O,ut=C*X-z*j,nt=C*ee-R*j,tt=z*ee-R*X,Ee=fe*tt-ne*nt+ce*ut+Te*Ge-ze*Xe+Je*yt;return Ee?(r[0]=(y*tt-x*nt+T*ut)*(Ee=1/Ee),r[1]=(c*nt-a*tt-f*ut)*Ee,r[2]=(j*Je-X*ze+ee*Te)*Ee,r[3]=(z*ze-C*Je-R*Te)*Ee,r[4]=(x*Ge-m*tt-T*Xe)*Ee,r[5]=(i*tt-c*Ge+f*Xe)*Ee,r[6]=(X*ce-O*Je-ee*ne)*Ee,r[7]=(E*Je-z*ce+R*ne)*Ee,r[8]=(m*nt-y*Ge+T*yt)*Ee,r[9]=(a*Ge-i*nt-f*yt)*Ee,r[10]=(O*ze-j*ce+ee*fe)*Ee,r[11]=(C*ce-E*ze-R*fe)*Ee,r[12]=(y*Xe-m*ut-x*yt)*Ee,r[13]=(i*ut-a*Xe+c*yt)*Ee,r[14]=(j*ne-O*Te-X*fe)*Ee,r[15]=(E*Te-C*ne+z*fe)*Ee,r):null},A.at=Xd,A.au=Xu,A.av=Kd,A.aw=function(){const r={},t=we.$version;for(const i in we.$root){const a=we.$root[i];if(a.required){let c=null;c=i==="version"?t:a.type==="array"?[]:{},c!=null&&(r[i]=c)}}return r},A.ax=Xn,A.ay=$t,A.az=function(r){r=r.slice();const t=Object.create(null);for(let i=0;i<r.length;i++)t[r[i].id]=r[i];for(let i=0;i<r.length;i++)"ref"in r[i]&&(r[i]=Wo(r[i],t[r[i].ref]));return r},A.b=or,A.b0=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},A.b1=function(r,t,i){return r[0]=t[0]*i[0],r[1]=t[1]*i[1],r[2]=t[2]*i[2],r[3]=t[3]*i[3],r},A.b2=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},A.b3=Fr,A.b4=Ae,A.b5=Q,A.b6=function(r,t,i,a,c){var f,m=1/Math.tan(t/2);return r[0]=m/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=m,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+a)*(f=1/(a-c)),r[14]=2*c*a*f):(r[10]=-1,r[14]=-2*a),r},A.b7=function(r,t,i){var a=Math.sin(i),c=Math.cos(i),f=t[4],m=t[5],y=t[6],x=t[7],T=t[8],E=t[9],C=t[10],z=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=f*c+T*a,r[5]=m*c+E*a,r[6]=y*c+C*a,r[7]=x*c+z*a,r[8]=T*c-f*a,r[9]=E*c-m*a,r[10]=C*c-y*a,r[11]=z*c-x*a,r},A.b8=Xt,A.b9=tr,A.bA=_o,A.bB=function(r){return r.message===Me},A.bC=Lo,A.bD=gr,A.ba=function(r){return r*Math.PI/180},A.bb=function(r,t){const{x:i,y:a}=be.fromLngLat(t);return!(r<0||r>25||a<0||a>=1||i<0||i>=1)},A.bc=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},A.bd=class extends I{},A.be=o,A.bf=Jp,A.bh=qt,A.bi=function(r,t){At.REGISTERED_PROTOCOLS[r]=t},A.bj=function(r){delete At.REGISTERED_PROTOCOLS[r]},A.bk=function(r,t){const i={};for(let c=0;c<r.length;c++){const f=t&&t[r[c].id]||mu(r[c]);t&&(t[r[c].id]=f);let m=i[f];m||(m=i[f]=[]),m.push(r[c])}const a=[];for(const c in i)a.push(i[c]);return a},A.bl=Ye,A.bm=Qr,A.bn=le,A.bo=Rh,A.bp=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Jr/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],i=t.layout,a=t._unevaluatedLayout._values,c={layoutIconSize:a["icon-size"].possiblyEvaluate(new Zt(r.bucket.zoom+1),r.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Zt(r.bucket.zoom+1),r.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Zt(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=r.bucket.textSizeData;c.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Zt(T),r.canonical),a["text-size"].possiblyEvaluate(new Zt(E),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=r.bucket.iconSizeData;c.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Zt(T),r.canonical),a["icon-size"].possiblyEvaluate(new Zt(E),r.canonical)]}const f=i.get("text-line-height")*Nr,m=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",y=i.get("text-keep-upright"),x=i.get("text-size");for(const T of r.bucket.features){const E=i.get("text-font").evaluate(T,{},r.canonical).join(","),C=x.evaluate(T,{},r.canonical),z=c.layoutTextSize.evaluate(T,{},r.canonical),R=c.layoutIconSize.evaluate(T,{},r.canonical),O={horizontal:{},vertical:void 0},j=T.text;let X,ee=[0,0];if(j){const ce=j.toString(),Te=i.get("text-letter-spacing").evaluate(T,{},r.canonical)*Nr,ze=dh(ce)?Te:0,Je=i.get("text-anchor").evaluate(T,{},r.canonical),yt=fp(t,T,r.canonical);if(!yt){const nt=i.get("text-radial-offset").evaluate(T,{},r.canonical);ee=nt?pp(Je,[nt*Nr,Wd]):i.get("text-offset").evaluate(T,{},r.canonical).map((tt=>tt*Nr))}let Xe=m?"center":i.get("text-justify").evaluate(T,{},r.canonical);const Ge=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(T,{},r.canonical)*Nr:1/0,ut=()=>{r.bucket.allowVerticalPlacement&&wu(ce)&&(O.vertical=Wu(j,r.glyphMap,r.glyphPositions,r.imagePositions,E,Ge,f,Je,"left",ze,ee,A.ah.vertical,!0,z,C))};if(!m&&yt){const nt=new Set;if(Xe==="auto")for(let Ee=0;Ee<yt.values.length;Ee+=2)nt.add(Xd(yt.values[Ee]));else nt.add(Xe);let tt=!1;for(const Ee of nt)if(!O.horizontal[Ee])if(tt)O.horizontal[Ee]=O.horizontal[0];else{const ht=Wu(j,r.glyphMap,r.glyphPositions,r.imagePositions,E,Ge,f,"center",Ee,ze,ee,A.ah.horizontal,!1,z,C);ht&&(O.horizontal[Ee]=ht,tt=ht.positionedLines.length===1)}ut()}else{Xe==="auto"&&(Xe=Xd(Je));const nt=Wu(j,r.glyphMap,r.glyphPositions,r.imagePositions,E,Ge,f,Je,Xe,ze,ee,A.ah.horizontal,!1,z,C);nt&&(O.horizontal[Xe]=nt),ut(),wu(ce)&&m&&y&&(O.vertical=Wu(j,r.glyphMap,r.glyphPositions,r.imagePositions,E,Ge,f,Je,Xe,ze,ee,A.ah.vertical,!1,z,C))}}let fe=!1;if(T.icon&&T.icon.name){const ce=r.imageMap[T.icon.name];ce&&(X=Pa(r.imagePositions[T.icon.name],i.get("icon-offset").evaluate(T,{},r.canonical),i.get("icon-anchor").evaluate(T,{},r.canonical)),fe=!!ce.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=fe:r.bucket.sdfIcons!==fe&&mr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ce.pixelRatio!==r.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const ne=gp(O.horizontal)||O.vertical;r.bucket.iconsInText=!!ne&&ne.iconsInText,(ne||X)&&Xp(r.bucket,T,O,X,r.imageMap,c,z,R,ee,fe,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},A.bq=An,A.br=Rc,A.bs=ss,A.bt=Ta,A.bu=$o,A.bv=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},A.bw=function(r,t,i,a,c){return g(this,void 0,void 0,(function*(){if(Rr())try{return yield vt(r,t,i,a,c)}catch{}return(function(f,m,y,x,T){const E=f.width,C=f.height;rt&&de||(rt=new OffscreenCanvas(E,C),de=rt.getContext("2d",{willReadFrequently:!0})),rt.width=E,rt.height=C,de.drawImage(f,0,0,E,C);const z=de.getImageData(m,y,x,T);return de.clearRect(0,0,E,C),z.data})(r,t,i,a,c)}))},A.bx=pt,A.by=qe,A.bz=Ke,A.c=zt,A.d=r=>g(void 0,void 0,void 0,(function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),A.e=zr,A.f=r=>new Promise(((t,i)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame((()=>{a.src=et}))},a.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(r)],{type:"image/png"});a.src=r.byteLength?URL.createObjectURL(c):et})),A.g=Vt,A.h=(r,t)=>dr(zr(r,{type:"json"}),t),A.i=ci,A.j=us,A.k=Vn,A.l=(r,t)=>dr(zr(r,{type:"arrayBuffer"}),t),A.m=dr,A.n=function(r){return new $o(r).readFields(dl,[])},A.o=ol,A.p=Gu,A.q=p,A.r=vu,A.s=ri,A.t=Bl,A.u=Os,A.v=we,A.w=mr,A.x=function([r,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(i),y:r*Math.sin(t)*Math.sin(i),z:r*Math.cos(i)}},A.y=Xr,A.z=Zt})),me("worker",["./shared"],(function(A){class g{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,D){for(const H of L){this._layerConfigs[H.id]=H;const ie=this._layers[H.id]=A.aA(H);ie._featureFilter=A.a7(ie.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of D)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const V=A.bk(Object.values(this._layerConfigs),this.keyCache);for(const H of V){const ie=H.map((ve=>this._layers[ve.id])),ae=ie[0];if(ae.visibility==="none")continue;const he=ae.source||"";let te=this.familiesBySource[he];te||(te=this.familiesBySource[he]={});const Se=ae.sourceLayer||"_geojsonTileLayer";let Pe=te[Se];Pe||(Pe=te[Se]=[]),Pe.push(ie)}}}class qe{constructor(L){const D={},V=[];for(const he in L){const te=L[he],Se=D[he]={};for(const Pe in te){const ve=te[+Pe];if(!ve||ve.bitmap.width===0||ve.bitmap.height===0)continue;const Oe={x:0,y:0,w:ve.bitmap.width+2,h:ve.bitmap.height+2};V.push(Oe),Se[Pe]={rect:Oe,metrics:ve.metrics}}}const{w:H,h:ie}=A.p(V),ae=new A.o({width:H||1,height:ie||1});for(const he in L){const te=L[he];for(const Se in te){const Pe=te[+Se];if(!Pe||Pe.bitmap.width===0||Pe.bitmap.height===0)continue;const ve=D[he][Se].rect;A.o.copy(Pe.bitmap,ae,{x:0,y:0},{x:ve.x+1,y:ve.y+1},Pe.bitmap)}}this.image=ae,this.positions=D}}A.bl("GlyphAtlas",qe);class Ke{constructor(L){this.tileID=new A.S(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId,this.inFlightDependencies=[]}parse(L,D,V,H){return A._(this,void 0,void 0,(function*(){this.status="parsing",this.data=L,this.collisionBoxArray=new A.a5;const ie=new A.bm(Object.keys(L.layers).sort()),ae=new A.bn(this.tileID,this.promoteId);ae.bucketLayerIDs=[];const he={},te={featureIndex:ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:V},Se=D.familiesBySource[this.source];for(const Ft in Se){const ar=L.layers[Ft];if(!ar)continue;ar.version===1&&A.w(`Vector tile source "${this.source}" layer "${Ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ir=ie.encode(Ft),ni=[];for(let hi=0;hi<ar.length;hi++){const Ai=ar.feature(hi),Ko=ae.getId(Ai,Ft);ni.push({feature:Ai,id:Ko,index:hi,sourceLayerIndex:Ir})}for(const hi of Se[Ft]){const Ai=hi[0];Ai.source!==this.source&&A.w(`layer.source = ${Ai.source} does not equal this.source = ${this.source}`),Ai.minzoom&&this.zoom<Math.floor(Ai.minzoom)||Ai.maxzoom&&this.zoom>=Ai.maxzoom||Ai.visibility!=="none"&&(st(hi,this.zoom,V),(he[Ai.id]=Ai.createBucket({index:ae.bucketLayerIDs.length,layers:hi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ir,sourceID:this.source})).populate(ni,te,this.tileID.canonical),ae.bucketLayerIDs.push(hi.map((Ko=>Ko.id))))}}const Pe=A.aF(te.glyphDependencies,(Ft=>Object.keys(Ft).map(Number)));this.inFlightDependencies.forEach((Ft=>Ft==null?void 0:Ft.abort())),this.inFlightDependencies=[];let ve=Promise.resolve({});if(Object.keys(Pe).length){const Ft=new AbortController;this.inFlightDependencies.push(Ft),ve=H.sendAsync({type:"GG",data:{stacks:Pe,source:this.source,tileID:this.tileID,type:"glyphs"}},Ft)}const Oe=Object.keys(te.iconDependencies);let ot=Promise.resolve({});if(Oe.length){const Ft=new AbortController;this.inFlightDependencies.push(Ft),ot=H.sendAsync({type:"GI",data:{icons:Oe,source:this.source,tileID:this.tileID,type:"icons"}},Ft)}const dt=Object.keys(te.patternDependencies);let Yt=Promise.resolve({});if(dt.length){const Ft=new AbortController;this.inFlightDependencies.push(Ft),Yt=H.sendAsync({type:"GI",data:{icons:dt,source:this.source,tileID:this.tileID,type:"patterns"}},Ft)}const[Et,Qt,Mt]=yield Promise.all([ve,ot,Yt]),Hr=new qe(Et),Br=new A.bo(Qt,Mt);for(const Ft in he){const ar=he[Ft];ar instanceof A.a6?(st(ar.layers,this.zoom,V),A.bp({bucket:ar,glyphMap:Et,glyphPositions:Hr.positions,imageMap:Qt,imagePositions:Br.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ar.hasPattern&&(ar instanceof A.bq||ar instanceof A.br||ar instanceof A.bs)&&(st(ar.layers,this.zoom,V),ar.addFeatures(te,this.tileID.canonical,Br.patternPositions))}return this.status="done",{buckets:Object.values(he).filter((Ft=>!Ft.isEmpty())),featureIndex:ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Hr.image,imageAtlas:Br,glyphMap:this.returnDependencies?Et:null,iconMap:this.returnDependencies?Qt:null,glyphPositions:this.returnDependencies?Hr.positions:null}}))}}function st(K,L,D){const V=new A.z(L);for(const H of K)H.recalculate(V,D)}class ke{constructor(L,D,V){this.actor=L,this.layerIndex=D,this.availableImages=V,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(L,D){return A._(this,void 0,void 0,(function*(){const V=yield A.l(L.request,D);try{return{vectorTile:new A.bt.VectorTile(new A.bu(V.data)),rawData:V.data,cacheControl:V.cacheControl,expires:V.expires}}catch(H){const ie=new Uint8Array(V.data);let ae=`Unable to parse the tile at ${L.request.url}, `;throw ae+=ie[0]===31&&ie[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${H.message}`,new Error(ae)}}))}loadTile(L){return A._(this,void 0,void 0,(function*(){const D=L.uid,V=!!(L&&L.request&&L.request.collectResourceTiming)&&new A.bv(L.request),H=new Ke(L);this.loading[D]=H;const ie=new AbortController;H.abort=ie;try{const ae=yield this.loadVectorTile(L,ie);if(delete this.loading[D],!ae)return null;const he=ae.rawData,te={};ae.expires&&(te.expires=ae.expires),ae.cacheControl&&(te.cacheControl=ae.cacheControl);const Se={};if(V){const ve=V.finish();ve&&(Se.resourceTiming=JSON.parse(JSON.stringify(ve)))}H.vectorTile=ae.vectorTile;const Pe=H.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[D]=H,this.fetching[D]={rawTileData:he,cacheControl:te,resourceTiming:Se};try{const ve=yield Pe;return A.e({rawTileData:he.slice(0)},ve,te,Se)}finally{delete this.fetching[D]}}catch(ae){throw delete this.loading[D],H.status="done",this.loaded[D]=H,ae}}))}reloadTile(L){return A._(this,void 0,void 0,(function*(){const D=L.uid;if(!this.loaded||!this.loaded[D])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const V=this.loaded[D];if(V.showCollisionBoxes=L.showCollisionBoxes,V.status==="parsing"){const H=yield V.parse(V.vectorTile,this.layerIndex,this.availableImages,this.actor);let ie;if(this.fetching[D]){const{rawTileData:ae,cacheControl:he,resourceTiming:te}=this.fetching[D];delete this.fetching[D],ie=A.e({rawTileData:ae.slice(0)},H,he,te)}else ie=H;return ie}if(V.status==="done"&&V.vectorTile)return V.parse(V.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(L){return A._(this,void 0,void 0,(function*(){const D=this.loading,V=L.uid;D&&D[V]&&D[V].abort&&(D[V].abort.abort(),delete D[V])}))}removeTile(L){return A._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[L.uid]&&delete this.loaded[L.uid]}))}}class ge{constructor(){this.loaded={}}loadTile(L){return A._(this,void 0,void 0,(function*(){const{uid:D,encoding:V,rawImageData:H,redFactor:ie,greenFactor:ae,blueFactor:he,baseShift:te}=L,Se=H.width+2,Pe=H.height+2,ve=A.b(H)?new A.R({width:Se,height:Pe},yield A.bw(H,-1,-1,Se,Pe)):H,Oe=new A.bx(D,ve,V,ie,ae,he,te);return this.loaded=this.loaded||{},this.loaded[D]=Oe,Oe}))}removeTile(L){const D=this.loaded,V=L.uid;D&&D[V]&&delete D[V]}}function xr(K,L){if(K.length!==0){Ot(K[0],L);for(var D=1;D<K.length;D++)Ot(K[D],!L)}}function Ot(K,L){for(var D=0,V=0,H=0,ie=K.length,ae=ie-1;H<ie;ae=H++){var he=(K[H][0]-K[ae][0])*(K[ae][1]+K[H][1]),te=D+he;V+=Math.abs(D)>=Math.abs(he)?D-te+he:he-te+D,D=te}D+V>=0!=!!L&&K.reverse()}var Rt=A.by((function K(L,D){var V,H=L&&L.type;if(H==="FeatureCollection")for(V=0;V<L.features.length;V++)K(L.features[V],D);else if(H==="GeometryCollection")for(V=0;V<L.geometries.length;V++)K(L.geometries[V],D);else if(H==="Feature")K(L.geometry,D);else if(H==="Polygon")xr(L.coordinates,D);else if(H==="MultiPolygon")for(V=0;V<L.coordinates.length;V++)xr(L.coordinates[V],D);return L}));const Nt=A.bt.VectorTileFeature.prototype.toGeoJSON;var Mr={exports:{}},Rr=A.bz,Xt=A.bt.VectorTileFeature,tr=hr;function hr(K,L){this.options=L||{},this.features=K,this.length=K.length}function Fr(K,L){this.id=typeof K.id=="number"?K.id:void 0,this.type=K.type,this.rawGeometry=K.type===1?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=L||4096}hr.prototype.feature=function(K){return new Fr(this.features[K],this.options.extent)},Fr.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var L=0;L<K.length;L++){for(var D=K[L],V=[],H=0;H<D.length;H++)V.push(new Rr(D[H][0],D[H][1]));this.geometry.push(V)}return this.geometry},Fr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,L=1/0,D=-1/0,V=1/0,H=-1/0,ie=0;ie<K.length;ie++)for(var ae=K[ie],he=0;he<ae.length;he++){var te=ae[he];L=Math.min(L,te.x),D=Math.max(D,te.x),V=Math.min(V,te.y),H=Math.max(H,te.y)}return[L,V,D,H]},Fr.prototype.toGeoJSON=Xt.prototype.toGeoJSON;var zr=A.bA,Mi=tr;function gi(K){var L=new zr;return(function(D,V){for(var H in D.layers)V.writeMessage(3,nn,D.layers[H])})(K,L),L.finish()}function nn(K,L){var D;L.writeVarintField(15,K.version||1),L.writeStringField(1,K.name||""),L.writeVarintField(5,K.extent||4096);var V={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<K.length;D++)V.feature=K.feature(D),L.writeMessage(2,Kt,V);var H=V.keys;for(D=0;D<H.length;D++)L.writeStringField(3,H[D]);var ie=V.values;for(D=0;D<ie.length;D++)L.writeMessage(4,ti,ie[D])}function Kt(K,L){var D=K.feature;D.id!==void 0&&L.writeVarintField(1,D.id),L.writeMessage(2,sn,K),L.writeVarintField(3,D.type),L.writeMessage(4,ci,D)}function sn(K,L){var D=K.feature,V=K.keys,H=K.values,ie=K.keycache,ae=K.valuecache;for(var he in D.properties){var te=D.properties[he],Se=ie[he];if(te!==null){Se===void 0&&(V.push(he),ie[he]=Se=V.length-1),L.writeVarint(Se);var Pe=typeof te;Pe!=="string"&&Pe!=="boolean"&&Pe!=="number"&&(te=JSON.stringify(te));var ve=Pe+":"+te,Oe=ae[ve];Oe===void 0&&(H.push(te),ae[ve]=Oe=H.length-1),L.writeVarint(Oe)}}}function mr(K,L){return(L<<3)+(7&K)}function Ar(K){return K<<1^K>>31}function ci(K,L){for(var D=K.loadGeometry(),V=K.type,H=0,ie=0,ae=D.length,he=0;he<ae;he++){var te=D[he],Se=1;V===1&&(Se=te.length),L.writeVarint(mr(1,Se));for(var Pe=V===3?te.length-1:te.length,ve=0;ve<Pe;ve++){ve===1&&V!==1&&L.writeVarint(mr(2,Pe-1));var Oe=te[ve].x-H,ot=te[ve].y-ie;L.writeVarint(Ar(Oe)),L.writeVarint(Ar(ot)),H+=Oe,ie+=ot}V===3&&L.writeVarint(mr(7,1))}}function ti(K,L){var D=typeof K;D==="string"?L.writeStringField(1,K):D==="boolean"?L.writeBooleanField(7,K):D==="number"&&(K%1!=0?L.writeDoubleField(3,K):K<0?L.writeSVarintField(6,K):L.writeVarintField(5,K))}Mr.exports=gi,Mr.exports.fromVectorTileJs=gi,Mr.exports.fromGeojsonVt=function(K,L){L=L||{};var D={};for(var V in K)D[V]=new Mi(K[V].features,L),D[V].name=V,D[V].version=L.version,D[V].extent=L.extent;return gi({layers:D})},Mr.exports.GeoJSONWrapper=Mi;var or=A.by(Mr.exports);const et={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},vt=Math.fround||(rt=new Float32Array(1),K=>(rt[0]=+K,rt[0]));var rt;const de=3,Me=5,zt=6;class At{constructor(L){this.options=Object.assign(Object.create(et),L),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(L){const{log:D,minZoom:V,maxZoom:H}=this.options;D&&console.time("total time");const ie=`prepare ${L.length} points`;D&&console.time(ie),this.points=L;const ae=[];for(let te=0;te<L.length;te++){const Se=L[te];if(!Se.geometry)continue;const[Pe,ve]=Se.geometry.coordinates,Oe=vt(qt(Pe)),ot=vt($t(ve));ae.push(Oe,ot,1/0,te,-1,1),this.options.reduce&&ae.push(0)}let he=this.trees[H+1]=this._createTree(ae);D&&console.timeEnd(ie);for(let te=H;te>=V;te--){const Se=+Date.now();he=this.trees[te]=this._createTree(this._cluster(he,te)),D&&console.log("z%d: %d clusters in %dms",te,he.numItems,+Date.now()-Se)}return D&&console.timeEnd("total time"),this}getClusters(L,D){let V=((L[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,L[1]));let ie=L[2]===180?180:((L[2]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)V=-180,ie=180;else if(V>ie){const ve=this.getClusters([V,H,180,ae],D),Oe=this.getClusters([-180,H,ie,ae],D);return ve.concat(Oe)}const he=this.trees[this._limitZoom(D)],te=he.range(qt(V),$t(ae),qt(ie),$t(H)),Se=he.data,Pe=[];for(const ve of te){const Oe=this.stride*ve;Pe.push(Se[Oe+Me]>1?Vt(Se,Oe,this.clusterProps):this.points[Se[Oe+de]])}return Pe}getChildren(L){const D=this._getOriginId(L),V=this._getOriginZoom(L),H="No cluster with the specified id.",ie=this.trees[V];if(!ie)throw new Error(H);const ae=ie.data;if(D*this.stride>=ae.length)throw new Error(H);const he=this.options.radius/(this.options.extent*Math.pow(2,V-1)),te=ie.within(ae[D*this.stride],ae[D*this.stride+1],he),Se=[];for(const Pe of te){const ve=Pe*this.stride;ae[ve+4]===L&&Se.push(ae[ve+Me]>1?Vt(ae,ve,this.clusterProps):this.points[ae[ve+de]])}if(Se.length===0)throw new Error(H);return Se}getLeaves(L,D,V){const H=[];return this._appendLeaves(H,L,D=D||10,V=V||0,0),H}getTile(L,D,V){const H=this.trees[this._limitZoom(L)],ie=Math.pow(2,L),{extent:ae,radius:he}=this.options,te=he/ae,Se=(V-te)/ie,Pe=(V+1+te)/ie,ve={features:[]};return this._addTileFeatures(H.range((D-te)/ie,Se,(D+1+te)/ie,Pe),H.data,D,V,ie,ve),D===0&&this._addTileFeatures(H.range(1-te/ie,Se,1,Pe),H.data,ie,V,ie,ve),D===ie-1&&this._addTileFeatures(H.range(0,Se,te/ie,Pe),H.data,-1,V,ie,ve),ve.features.length?ve:null}getClusterExpansionZoom(L){let D=this._getOriginZoom(L)-1;for(;D<=this.options.maxZoom;){const V=this.getChildren(L);if(D++,V.length!==1)break;L=V[0].properties.cluster_id}return D}_appendLeaves(L,D,V,H,ie){const ae=this.getChildren(D);for(const he of ae){const te=he.properties;if(te&&te.cluster?ie+te.point_count<=H?ie+=te.point_count:ie=this._appendLeaves(L,te.cluster_id,V,H,ie):ie<H?ie++:L.push(he),L.length===V)break}return ie}_createTree(L){const D=new A.av(L.length/this.stride|0,this.options.nodeSize,Float32Array);for(let V=0;V<L.length;V+=this.stride)D.add(L[V],L[V+1]);return D.finish(),D.data=L,D}_addTileFeatures(L,D,V,H,ie,ae){for(const he of L){const te=he*this.stride,Se=D[te+Me]>1;let Pe,ve,Oe;if(Se)Pe=Gt(D,te,this.clusterProps),ve=D[te],Oe=D[te+1];else{const Yt=this.points[D[te+de]];Pe=Yt.properties;const[Et,Qt]=Yt.geometry.coordinates;ve=qt(Et),Oe=$t(Qt)}const ot={type:1,geometry:[[Math.round(this.options.extent*(ve*ie-V)),Math.round(this.options.extent*(Oe*ie-H))]],tags:Pe};let dt;dt=Se||this.options.generateId?D[te+de]:this.points[D[te+de]].id,dt!==void 0&&(ot.id=dt),ae.features.push(ot)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,D){const{radius:V,extent:H,reduce:ie,minPoints:ae}=this.options,he=V/(H*Math.pow(2,D)),te=L.data,Se=[],Pe=this.stride;for(let ve=0;ve<te.length;ve+=Pe){if(te[ve+2]<=D)continue;te[ve+2]=D;const Oe=te[ve],ot=te[ve+1],dt=L.within(te[ve],te[ve+1],he),Yt=te[ve+Me];let Et=Yt;for(const Qt of dt){const Mt=Qt*Pe;te[Mt+2]>D&&(Et+=te[Mt+Me])}if(Et>Yt&&Et>=ae){let Qt,Mt=Oe*Yt,Hr=ot*Yt,Br=-1;const Ft=((ve/Pe|0)<<5)+(D+1)+this.points.length;for(const ar of dt){const Ir=ar*Pe;if(te[Ir+2]<=D)continue;te[Ir+2]=D;const ni=te[Ir+Me];Mt+=te[Ir]*ni,Hr+=te[Ir+1]*ni,te[Ir+4]=Ft,ie&&(Qt||(Qt=this._map(te,ve,!0),Br=this.clusterProps.length,this.clusterProps.push(Qt)),ie(Qt,this._map(te,Ir)))}te[ve+4]=Ft,Se.push(Mt/Et,Hr/Et,1/0,Ft,-1,Et),ie&&Se.push(Br)}else{for(let Qt=0;Qt<Pe;Qt++)Se.push(te[ve+Qt]);if(Et>1)for(const Qt of dt){const Mt=Qt*Pe;if(!(te[Mt+2]<=D)){te[Mt+2]=D;for(let Hr=0;Hr<Pe;Hr++)Se.push(te[Mt+Hr])}}}}return Se}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,D,V){if(L[D+Me]>1){const ae=this.clusterProps[L[D+zt]];return V?Object.assign({},ae):ae}const H=this.points[L[D+de]].properties,ie=this.options.map(H);return V&&ie===H?Object.assign({},ie):ie}}function Vt(K,L,D){return{type:"Feature",id:K[L+de],properties:Gt(K,L,D),geometry:{type:"Point",coordinates:[(V=K[L],360*(V-.5)),dr(K[L+1])]}};var V}function Gt(K,L,D){const V=K[L+Me],H=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V,ie=K[L+zt],ae=ie===-1?{}:Object.assign({},D[ie]);return Object.assign(ae,{cluster:!0,cluster_id:K[L+de],point_count:V,point_count_abbreviated:H})}function qt(K){return K/360+.5}function $t(K){const L=Math.sin(K*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function dr(K){const L=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function ri(K,L,D,V){let H=V;const ie=L+(D-L>>1);let ae,he=D-L;const te=K[L],Se=K[L+1],Pe=K[D],ve=K[D+1];for(let Oe=L+3;Oe<D;Oe+=3){const ot=Ys(K[Oe],K[Oe+1],te,Se,Pe,ve);if(ot>H)ae=Oe,H=ot;else if(ot===H){const dt=Math.abs(Oe-ie);dt<he&&(ae=Oe,he=dt)}}H>V&&(ae-L>3&&ri(K,L,ae,V),K[ae+2]=H,D-ae>3&&ri(K,ae,D,V))}function Ys(K,L,D,V,H,ie){let ae=H-D,he=ie-V;if(ae!==0||he!==0){const te=((K-D)*ae+(L-V)*he)/(ae*ae+he*he);te>1?(D=H,V=ie):te>0&&(D+=ae*te,V+=he*te)}return ae=K-D,he=L-V,ae*ae+he*he}function ls(K,L,D,V){const H={id:K??null,type:L,geometry:D,tags:V,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(L==="Point"||L==="MultiPoint"||L==="LineString")Vn(H,D);else if(L==="Polygon")Vn(H,D[0]);else if(L==="MultiLineString")for(const ie of D)Vn(H,ie);else if(L==="MultiPolygon")for(const ie of D)Vn(H,ie[0]);return H}function Vn(K,L){for(let D=0;D<L.length;D+=3)K.minX=Math.min(K.minX,L[D]),K.minY=Math.min(K.minY,L[D+1]),K.maxX=Math.max(K.maxX,L[D]),K.maxY=Math.max(K.maxY,L[D+1])}function us(K,L,D,V){if(!L.geometry)return;const H=L.geometry.coordinates;if(H&&H.length===0)return;const ie=L.geometry.type,ae=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2);let he=[],te=L.id;if(D.promoteId?te=L.properties[D.promoteId]:D.generateId&&(te=V||0),ie==="Point")wo(H,he);else if(ie==="MultiPoint")for(const Se of H)wo(Se,he);else if(ie==="LineString")we(H,he,ae,!1);else if(ie==="MultiLineString"){if(D.lineMetrics){for(const Se of H)he=[],we(Se,he,ae,!1),K.push(ls(te,"LineString",he,L.properties));return}ks(H,he,ae,!1)}else if(ie==="Polygon")ks(H,he,ae,!0);else{if(ie!=="MultiPolygon"){if(ie==="GeometryCollection"){for(const Se of L.geometry.geometries)us(K,{id:te,geometry:Se,properties:L.properties},D,V);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Se of H){const Pe=[];ks(Se,Pe,ae,!0),he.push(Pe)}}K.push(ls(te,ie,he,L.properties))}function wo(K,L){L.push(Wo(K[0]),Jt(K[1]),0)}function we(K,L,D,V){let H,ie,ae=0;for(let te=0;te<K.length;te++){const Se=Wo(K[te][0]),Pe=Jt(K[te][1]);L.push(Se,Pe,0),te>0&&(ae+=V?(H*Pe-Se*ie)/2:Math.sqrt(Math.pow(Se-H,2)+Math.pow(Pe-ie,2))),H=Se,ie=Pe}const he=L.length-3;L[2]=1,ri(L,0,he,D),L[he+2]=1,L.size=Math.abs(ae),L.start=0,L.end=L.size}function ks(K,L,D,V){for(let H=0;H<K.length;H++){const ie=[];we(K[H],ie,D,V),L.push(ie)}}function Wo(K){return K/360+.5}function Jt(K){const L=Math.sin(K*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function wr(K,L,D,V,H,ie,ae,he){if(V/=L,ie>=(D/=L)&&ae<V)return K;if(ae<D||ie>=V)return null;const te=[];for(const Se of K){const Pe=Se.geometry;let ve=Se.type;const Oe=H===0?Se.minX:Se.minY,ot=H===0?Se.maxX:Se.maxY;if(Oe>=D&&ot<V){te.push(Se);continue}if(ot<D||Oe>=V)continue;let dt=[];if(ve==="Point"||ve==="MultiPoint")cs(Pe,dt,D,V,H);else if(ve==="LineString")hs(Pe,dt,D,V,H,!1,he.lineMetrics);else if(ve==="MultiLineString")bo(Pe,dt,D,V,H,!1);else if(ve==="Polygon")bo(Pe,dt,D,V,H,!0);else if(ve==="MultiPolygon")for(const Yt of Pe){const Et=[];bo(Yt,Et,D,V,H,!0),Et.length&&dt.push(Et)}if(dt.length){if(he.lineMetrics&&ve==="LineString"){for(const Yt of dt)te.push(ls(Se.id,ve,Yt,Se.tags));continue}ve!=="LineString"&&ve!=="MultiLineString"||(dt.length===1?(ve="LineString",dt=dt[0]):ve="MultiLineString"),ve!=="Point"&&ve!=="MultiPoint"||(ve=dt.length===3?"Point":"MultiPoint"),te.push(ls(Se.id,ve,dt,Se.tags))}}return te.length?te:null}function cs(K,L,D,V,H){for(let ie=0;ie<K.length;ie+=3){const ae=K[ie+H];ae>=D&&ae<=V&&on(L,K[ie],K[ie+1],K[ie+2])}}function hs(K,L,D,V,H,ie,ae){let he=ds(K);const te=H===0?Xo:So;let Se,Pe,ve=K.start;for(let Et=0;Et<K.length-3;Et+=3){const Qt=K[Et],Mt=K[Et+1],Hr=K[Et+2],Br=K[Et+3],Ft=K[Et+4],ar=H===0?Qt:Mt,Ir=H===0?Br:Ft;let ni=!1;ae&&(Se=Math.sqrt(Math.pow(Qt-Br,2)+Math.pow(Mt-Ft,2))),ar<D?Ir>D&&(Pe=te(he,Qt,Mt,Br,Ft,D),ae&&(he.start=ve+Se*Pe)):ar>V?Ir<V&&(Pe=te(he,Qt,Mt,Br,Ft,V),ae&&(he.start=ve+Se*Pe)):on(he,Qt,Mt,Hr),Ir<D&&ar>=D&&(Pe=te(he,Qt,Mt,Br,Ft,D),ni=!0),Ir>V&&ar<=V&&(Pe=te(he,Qt,Mt,Br,Ft,V),ni=!0),!ie&&ni&&(ae&&(he.end=ve+Se*Pe),L.push(he),he=ds(K)),ae&&(ve+=Se)}let Oe=K.length-3;const ot=K[Oe],dt=K[Oe+1],Yt=H===0?ot:dt;Yt>=D&&Yt<=V&&on(he,ot,dt,K[Oe+2]),Oe=he.length-3,ie&&Oe>=3&&(he[Oe]!==he[0]||he[Oe+1]!==he[1])&&on(he,he[0],he[1],he[2]),he.length&&L.push(he)}function ds(K){const L=[];return L.size=K.size,L.start=K.start,L.end=K.end,L}function bo(K,L,D,V,H,ie){for(const ae of K)hs(ae,L,D,V,H,ie,!1)}function on(K,L,D,V){K.push(L,D,V)}function Xo(K,L,D,V,H,ie){const ae=(ie-L)/(V-L);return on(K,ie,D+(H-D)*ae,1),ae}function So(K,L,D,V,H,ie){const ae=(ie-D)/(H-D);return on(K,L+(V-L)*ae,ie,1),ae}function Re(K,L){const D=[];for(let V=0;V<K.length;V++){const H=K[V],ie=H.type;let ae;if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")ae=jn(H.geometry,L);else if(ie==="MultiLineString"||ie==="Polygon"){ae=[];for(const he of H.geometry)ae.push(jn(he,L))}else if(ie==="MultiPolygon"){ae=[];for(const he of H.geometry){const te=[];for(const Se of he)te.push(jn(Se,L));ae.push(te)}}D.push(ls(H.id,ie,ae,H.tags))}return D}function jn(K,L){const D=[];D.size=K.size,K.start!==void 0&&(D.start=K.start,D.end=K.end);for(let V=0;V<K.length;V+=3)D.push(K[V]+L,K[V+1],K[V+2]);return D}function ii(K,L){if(K.transformed)return K;const D=1<<K.z,V=K.x,H=K.y;for(const ie of K.features){const ae=ie.geometry,he=ie.type;if(ie.geometry=[],he===1)for(let te=0;te<ae.length;te+=2)ie.geometry.push(Vi(ae[te],ae[te+1],L,D,V,H));else for(let te=0;te<ae.length;te++){const Se=[];for(let Pe=0;Pe<ae[te].length;Pe+=2)Se.push(Vi(ae[te][Pe],ae[te][Pe+1],L,D,V,H));ie.geometry.push(Se)}}return K.transformed=!0,K}function Vi(K,L,D,V,H,ie){return[Math.round(D*(K*V-H)),Math.round(D*(L*V-ie))]}function Qs(K,L,D,V,H){const ie=L===H.maxZoom?0:H.tolerance/((1<<L)*H.extent),ae={features:[],numPoints:0,numSimplified:0,numFeatures:K.length,source:null,x:D,y:V,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const he of K)je(ae,he,ie,H);return ae}function je(K,L,D,V){const H=L.geometry,ie=L.type,ae=[];if(K.minX=Math.min(K.minX,L.minX),K.minY=Math.min(K.minY,L.minY),K.maxX=Math.max(K.maxX,L.maxX),K.maxY=Math.max(K.maxY,L.maxY),ie==="Point"||ie==="MultiPoint")for(let he=0;he<H.length;he+=3)ae.push(H[he],H[he+1]),K.numPoints++,K.numSimplified++;else if(ie==="LineString")Dt(ae,H,K,D,!1,!1);else if(ie==="MultiLineString"||ie==="Polygon")for(let he=0;he<H.length;he++)Dt(ae,H[he],K,D,ie==="Polygon",he===0);else if(ie==="MultiPolygon")for(let he=0;he<H.length;he++){const te=H[he];for(let Se=0;Se<te.length;Se++)Dt(ae,te[Se],K,D,!0,Se===0)}if(ae.length){let he=L.tags||null;if(ie==="LineString"&&V.lineMetrics){he={};for(const Se in L.tags)he[Se]=L.tags[Se];he.mapbox_clip_start=H.start/H.size,he.mapbox_clip_end=H.end/H.size}const te={geometry:ae,type:ie==="Polygon"||ie==="MultiPolygon"?3:ie==="LineString"||ie==="MultiLineString"?2:1,tags:he};L.id!==null&&(te.id=L.id),K.features.push(te)}}function Dt(K,L,D,V,H,ie){const ae=V*V;if(V>0&&L.size<(H?ae:V))return void(D.numPoints+=L.length/3);const he=[];for(let te=0;te<L.length;te+=3)(V===0||L[te+2]>ae)&&(D.numSimplified++,he.push(L[te],L[te+1])),D.numPoints++;H&&(function(te,Se){let Pe=0;for(let ve=0,Oe=te.length,ot=Oe-2;ve<Oe;ot=ve,ve+=2)Pe+=(te[ve]-te[ot])*(te[ve+1]+te[ot+1]);if(Pe>0===Se)for(let ve=0,Oe=te.length;ve<Oe/2;ve+=2){const ot=te[ve],dt=te[ve+1];te[ve]=te[Oe-2-ve],te[ve+1]=te[Oe-1-ve],te[Oe-2-ve]=ot,te[Oe-1-ve]=dt}})(he,ie),K.push(he)}const xt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Si{constructor(L,D){const V=(D=this.options=(function(ie,ae){for(const he in ae)ie[he]=ae[he];return ie})(Object.create(xt),D)).debug;if(V&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");let H=(function(ie,ae){const he=[];if(ie.type==="FeatureCollection")for(let te=0;te<ie.features.length;te++)us(he,ie.features[te],ae,te);else us(he,ie.type==="Feature"?ie:{geometry:ie},ae);return he})(L,D);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),H=(function(ie,ae){const he=ae.buffer/ae.extent;let te=ie;const Se=wr(ie,1,-1-he,he,0,-1,2,ae),Pe=wr(ie,1,1-he,2+he,0,-1,2,ae);return(Se||Pe)&&(te=wr(ie,1,-he,1+he,0,-1,2,ae)||[],Se&&(te=Re(Se,1).concat(te)),Pe&&(te=te.concat(Re(Pe,-1)))),te})(H,D),H.length&&this.splitTile(H,0,0,0),V&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(L,D,V,H,ie,ae,he){const te=[L,D,V,H],Se=this.options,Pe=Se.debug;for(;te.length;){H=te.pop(),V=te.pop(),D=te.pop(),L=te.pop();const ve=1<<D,Oe=an(D,V,H);let ot=this.tiles[Oe];if(!ot&&(Pe>1&&console.time("creation"),ot=this.tiles[Oe]=Qs(L,D,V,H,Se),this.tileCoords.push({z:D,x:V,y:H}),Pe)){Pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,V,H,ot.numFeatures,ot.numPoints,ot.numSimplified),console.timeEnd("creation"));const ni=`z${D}`;this.stats[ni]=(this.stats[ni]||0)+1,this.total++}if(ot.source=L,ie==null){if(D===Se.indexMaxZoom||ot.numPoints<=Se.indexMaxPoints)continue}else{if(D===Se.maxZoom||D===ie)continue;if(ie!=null){const ni=ie-D;if(V!==ae>>ni||H!==he>>ni)continue}}if(ot.source=null,L.length===0)continue;Pe>1&&console.time("clipping");const dt=.5*Se.buffer/Se.extent,Yt=.5-dt,Et=.5+dt,Qt=1+dt;let Mt=null,Hr=null,Br=null,Ft=null,ar=wr(L,ve,V-dt,V+Et,0,ot.minX,ot.maxX,Se),Ir=wr(L,ve,V+Yt,V+Qt,0,ot.minX,ot.maxX,Se);L=null,ar&&(Mt=wr(ar,ve,H-dt,H+Et,1,ot.minY,ot.maxY,Se),Hr=wr(ar,ve,H+Yt,H+Qt,1,ot.minY,ot.maxY,Se),ar=null),Ir&&(Br=wr(Ir,ve,H-dt,H+Et,1,ot.minY,ot.maxY,Se),Ft=wr(Ir,ve,H+Yt,H+Qt,1,ot.minY,ot.maxY,Se),Ir=null),Pe>1&&console.timeEnd("clipping"),te.push(Mt||[],D+1,2*V,2*H),te.push(Hr||[],D+1,2*V,2*H+1),te.push(Br||[],D+1,2*V+1,2*H),te.push(Ft||[],D+1,2*V+1,2*H+1)}}getTile(L,D,V){L=+L,D=+D,V=+V;const H=this.options,{extent:ie,debug:ae}=H;if(L<0||L>24)return null;const he=1<<L,te=an(L,D=D+he&he-1,V);if(this.tiles[te])return ii(this.tiles[te],ie);ae>1&&console.log("drilling down to z%d-%d-%d",L,D,V);let Se,Pe=L,ve=D,Oe=V;for(;!Se&&Pe>0;)Pe--,ve>>=1,Oe>>=1,Se=this.tiles[an(Pe,ve,Oe)];return Se&&Se.source?(ae>1&&(console.log("found parent tile z%d-%d-%d",Pe,ve,Oe),console.time("drilling down")),this.splitTile(Se.source,Pe,ve,Oe,L,D,V),ae>1&&console.timeEnd("drilling down"),this.tiles[te]?ii(this.tiles[te],ie):null):null}}function an(K,L,D){return 32*((1<<K)*D+L)+K}function Tt(K,L){return L?K.properties[L]:K.id}function bn(K,L){if(K==null)return!0;if(K.type==="Feature")return Tt(K,L)!=null;if(K.type==="FeatureCollection"){const D=new Set;for(const V of K.features){const H=Tt(V,L);if(H==null||D.has(H))return!1;D.add(H)}return!0}return!1}function Un(K,L){const D=new Map;if(K!=null)if(K.type==="Feature")D.set(Tt(K,L),K);else for(const V of K.features)D.set(Tt(V,L),V);return D}class ln extends ke{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(L,D){return A._(this,void 0,void 0,(function*(){const V=L.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const H=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!H)return null;const ie=new class{constructor(he){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=A.X,this.length=he.length,this._features=he}feature(he){return new class{constructor(te){this._feature=te,this.extent=A.X,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const Se of this._feature.geometry)te.push([new A.P(Se[0],Se[1])]);return te}{const te=[];for(const Se of this._feature.geometry){const Pe=[];for(const ve of Se)Pe.push(new A.P(ve[0],ve[1]));te.push(Pe)}return te}}toGeoJSON(te,Se,Pe){return Nt.call(this,te,Se,Pe)}}(this._features[he])}}(H.features);let ae=or(ie);return ae.byteOffset===0&&ae.byteLength===ae.buffer.byteLength||(ae=new Uint8Array(ae)),{vectorTile:ie,rawData:ae.buffer}}))}loadData(L){return A._(this,void 0,void 0,(function*(){var D;(D=this._pendingRequest)===null||D===void 0||D.abort();const V=!!(L&&L.request&&L.request.collectResourceTiming)&&new A.bv(L.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(L,this._pendingRequest),this._geoJSONIndex=L.cluster?new At((function({superclusterOptions:ae,clusterProperties:he}){if(!he||!ae)return ae;const te={},Se={},Pe={accumulated:null,zoom:0},ve={properties:null},Oe=Object.keys(he);for(const ot of Oe){const[dt,Yt]=he[ot],Et=A.bC(Yt),Qt=A.bC(typeof dt=="string"?[dt,["accumulated"],["get",ot]]:dt);te[ot]=Et.value,Se[ot]=Qt.value}return ae.map=ot=>{ve.properties=ot;const dt={};for(const Yt of Oe)dt[Yt]=te[Yt].evaluate(Pe,ve);return dt},ae.reduce=(ot,dt)=>{ve.properties=dt;for(const Yt of Oe)Pe.accumulated=ot[Yt],ot[Yt]=Se[Yt].evaluate(Pe,ve)},ae})(L)).load((yield this._pendingData).features):(H=yield this._pendingData,new Si(H,L.geojsonVtOptions)),this.loaded={};const ie={};if(V){const ae=V.finish();ae&&(ie.resourceTiming={},ie.resourceTiming[L.source]=JSON.parse(JSON.stringify(ae)))}return ie}catch(ie){if(delete this._pendingRequest,A.bB(ie))return{abandoned:!0};throw ie}var H}))}getData(){return A._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(L){const D=this.loaded;return D&&D[L.uid]?super.reloadTile(L):this.loadTile(L)}loadAndProcessGeoJSON(L,D){return A._(this,void 0,void 0,(function*(){let V=yield this.loadGeoJSON(L,D);if(delete this._pendingRequest,typeof V!="object")throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(Rt(V,!0),L.filter){const H=A.bC(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(H.result==="error")throw new Error(H.value.map((ae=>`${ae.key}: ${ae.message}`)).join(", "));V={type:"FeatureCollection",features:V.features.filter((ae=>H.value.evaluate({zoom:0},ae)))}}return V}))}loadGeoJSON(L,D){return A._(this,void 0,void 0,(function*(){const{promoteId:V}=L;if(L.request){const H=yield A.h(L.request,D);return this._dataUpdateable=bn(H.data,V)?Un(H.data,V):void 0,H.data}if(typeof L.data=="string")try{const H=JSON.parse(L.data);return this._dataUpdateable=bn(H,V)?Un(H,V):void 0,H}catch{throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`)}if(!L.dataDiff)throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${L.source}`);return(function(H,ie,ae){var he,te,Se,Pe;if(ie.removeAll&&H.clear(),ie.remove)for(const ve of ie.remove)H.delete(ve);if(ie.add)for(const ve of ie.add){const Oe=Tt(ve,ae);Oe!=null&&H.set(Oe,ve)}if(ie.update)for(const ve of ie.update){let Oe=H.get(ve.id);if(Oe==null)continue;const ot=!ve.removeAllProperties&&(((he=ve.removeProperties)===null||he===void 0?void 0:he.length)>0||((te=ve.addOrUpdateProperties)===null||te===void 0?void 0:te.length)>0);if((ve.newGeometry||ve.removeAllProperties||ot)&&(Oe=Object.assign({},Oe),H.set(ve.id,Oe),ot&&(Oe.properties=Object.assign({},Oe.properties))),ve.newGeometry&&(Oe.geometry=ve.newGeometry),ve.removeAllProperties)Oe.properties={};else if(((Se=ve.removeProperties)===null||Se===void 0?void 0:Se.length)>0)for(const dt of ve.removeProperties)Object.prototype.hasOwnProperty.call(Oe.properties,dt)&&delete Oe.properties[dt];if(((Pe=ve.addOrUpdateProperties)===null||Pe===void 0?void 0:Pe.length)>0)for(const{key:dt,value:Yt}of ve.addOrUpdateProperties)Oe.properties[dt]=Yt}})(this._dataUpdateable,L.dataDiff,V),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(L){return A._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(L){return this._geoJSONIndex.getClusterExpansionZoom(L.clusterId)}getClusterChildren(L){return this._geoJSONIndex.getChildren(L.clusterId)}getClusterLeaves(L){return this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset)}}class zi{constructor(L){this.self=L,this.actor=new A.F(L),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(D,V)=>{if(this.externalWorkerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.externalWorkerSourceTypes[D]=V},this.self.addProtocol=A.bi,this.self.removeProtocol=A.bj,this.self.registerRTLTextPlugin=D=>{if(A.bD.isParsed())throw new Error("RTL text plugin already registered.");A.bD.setMethods(D)},this.actor.registerMessageHandler("LDT",((D,V)=>this._getDEMWorkerSource(D,V.source).loadTile(V))),this.actor.registerMessageHandler("RDT",((D,V)=>A._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(D,V.source).removeTile(V)})))),this.actor.registerMessageHandler("GCEZ",((D,V)=>A._(this,void 0,void 0,(function*(){return this._getWorkerSource(D,V.type,V.source).getClusterExpansionZoom(V)})))),this.actor.registerMessageHandler("GCC",((D,V)=>A._(this,void 0,void 0,(function*(){return this._getWorkerSource(D,V.type,V.source).getClusterChildren(V)})))),this.actor.registerMessageHandler("GCL",((D,V)=>A._(this,void 0,void 0,(function*(){return this._getWorkerSource(D,V.type,V.source).getClusterLeaves(V)})))),this.actor.registerMessageHandler("LD",((D,V)=>this._getWorkerSource(D,V.type,V.source).loadData(V))),this.actor.registerMessageHandler("GD",((D,V)=>this._getWorkerSource(D,V.type,V.source).getData())),this.actor.registerMessageHandler("LT",((D,V)=>this._getWorkerSource(D,V.type,V.source).loadTile(V))),this.actor.registerMessageHandler("RT",((D,V)=>this._getWorkerSource(D,V.type,V.source).reloadTile(V))),this.actor.registerMessageHandler("AT",((D,V)=>this._getWorkerSource(D,V.type,V.source).abortTile(V))),this.actor.registerMessageHandler("RMT",((D,V)=>this._getWorkerSource(D,V.type,V.source).removeTile(V))),this.actor.registerMessageHandler("RS",((D,V)=>A._(this,void 0,void 0,(function*(){if(!this.workerSources[D]||!this.workerSources[D][V.type]||!this.workerSources[D][V.type][V.source])return;const H=this.workerSources[D][V.type][V.source];delete this.workerSources[D][V.type][V.source],H.removeSource!==void 0&&H.removeSource(V)})))),this.actor.registerMessageHandler("RM",(D=>A._(this,void 0,void 0,(function*(){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D]})))),this.actor.registerMessageHandler("SR",((D,V)=>A._(this,void 0,void 0,(function*(){this.referrer=V})))),this.actor.registerMessageHandler("SRPS",((D,V)=>this._syncRTLPluginState(D,V))),this.actor.registerMessageHandler("IS",((D,V)=>A._(this,void 0,void 0,(function*(){this.self.importScripts(V)})))),this.actor.registerMessageHandler("SI",((D,V)=>this._setImages(D,V))),this.actor.registerMessageHandler("UL",((D,V)=>A._(this,void 0,void 0,(function*(){this._getLayerIndex(D).update(V.layers,V.removedIds)})))),this.actor.registerMessageHandler("SL",((D,V)=>A._(this,void 0,void 0,(function*(){this._getLayerIndex(D).replace(V)}))))}_setImages(L,D){return A._(this,void 0,void 0,(function*(){this.availableImages[L]=D;for(const V in this.workerSources[L]){const H=this.workerSources[L][V];for(const ie in H)H[ie].availableImages=D}}))}_syncRTLPluginState(L,D){return A._(this,void 0,void 0,(function*(){if(A.bD.isParsed())return A.bD.getState();if(D.pluginStatus!=="loading")return A.bD.setState(D),D;const V=D.pluginURL;if(this.self.importScripts(V),A.bD.isParsed()){const H={pluginStatus:"loaded",pluginURL:V};return A.bD.setState(H),H}throw A.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${V}`)}))}_getAvailableImages(L){let D=this.availableImages[L];return D||(D=[]),D}_getLayerIndex(L){let D=this.layerIndexes[L];return D||(D=this.layerIndexes[L]=new g),D}_getWorkerSource(L,D,V){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][D]||(this.workerSources[L][D]={}),!this.workerSources[L][D][V]){const H={sendAsync:(ie,ae)=>(ie.targetMapId=L,this.actor.sendAsync(ie,ae))};switch(D){case"vector":this.workerSources[L][D][V]=new ke(H,this._getLayerIndex(L),this._getAvailableImages(L));break;case"geojson":this.workerSources[L][D][V]=new ln(H,this._getLayerIndex(L),this._getAvailableImages(L));break;default:this.workerSources[L][D][V]=new this.externalWorkerSourceTypes[D](H,this._getLayerIndex(L),this._getAvailableImages(L))}}return this.workerSources[L][D][V]}_getDEMWorkerSource(L,D){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][D]||(this.demWorkerSources[L][D]=new ge),this.demWorkerSources[L][D]}}return A.i(self)&&(self.worker=new zi(self)),zi})),me("index",["exports","./shared"],(function(A,g){var qe="4.7.1";let Ke,st;const ke={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:p=>new Promise(((e,s)=>{const l=requestAnimationFrame(e);p.signal.addEventListener("abort",(()=>{cancelAnimationFrame(l),s(g.c())}))})),getImageData(p,e=0){return this.getImageCanvasContext(p).getImageData(-e,-e,p.width+2*e,p.height+2*e)},getImageCanvasContext(p){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=p.width,e.height=p.height,s.drawImage(p,0,0,p.width,p.height),s},resolveURL:p=>(Ke||(Ke=document.createElement("a")),Ke.href=p,Ke.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(st==null&&(st=matchMedia("(prefers-reduced-motion: reduce)")),st.matches)}};class ge{static testProp(e){if(!ge.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in ge.docStyle)return e[s];return e[0]}static create(e,s,l){const u=window.document.createElement(e);return s!==void 0&&(u.className=s),l&&l.appendChild(u),u}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){ge.docStyle&&ge.selectProp&&(ge.userSelect=ge.docStyle[ge.selectProp],ge.docStyle[ge.selectProp]="none")}static enableDrag(){ge.docStyle&&ge.selectProp&&(ge.docStyle[ge.selectProp]=ge.userSelect)}static setTransform(e,s){e.style[ge.transformProp]=s}static addEventListener(e,s,l,u={}){e.addEventListener(s,l,"passive"in u?u:u.capture)}static removeEventListener(e,s,l,u={}){e.removeEventListener(s,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",ge.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ge.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",ge.suppressClickInternal,!0)}),0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,l){const u=s.boundingClientRect;return new g.P((l.clientX-u.left)/s.x-e.clientLeft,(l.clientY-u.top)/s.y-e.clientTop)}static mousePos(e,s){const l=ge.getScale(e);return ge.getPoint(e,l,s)}static touchPos(e,s){const l=[],u=ge.getScale(e);for(let d=0;d<s.length;d++)l.push(ge.getPoint(e,u,s[d]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}ge.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ge.selectProp=ge.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ge.transformProp=ge.testProp(["transform","WebkitTransform"]);const xr={supported:!1,testSupport:function(p){!Nt&&Rt&&(Mr?Rr(p):Ot=p)}};let Ot,Rt,Nt=!1,Mr=!1;function Rr(p){const e=p.createTexture();p.bindTexture(p.TEXTURE_2D,e);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,Rt),p.isContextLost())return;xr.supported=!0}catch{}p.deleteTexture(e),Nt=!0}var Xt;typeof document<"u"&&(Rt=document.createElement("img"),Rt.onload=()=>{Ot&&Rr(Ot),Ot=null,Mr=!0},Rt.onerror=()=>{Nt=!0,Ot=null},Rt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(p){let e,s,l,u;p.resetRequestQueue=()=>{e=[],s=0,l=0,u={}},p.addThrottleControl=S=>{const I=l++;return u[I]=S,I},p.removeThrottleControl=S=>{delete u[S],v()},p.getImage=(S,I,P=!0)=>new Promise(((M,F)=>{xr.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),g.e(S,{type:"image"}),e.push({abortController:I,requestParameters:S,supportImageRefresh:P,state:"queued",onError:N=>{F(N)},onSuccess:N=>{M(N)}}),v()}));const d=S=>g._(this,void 0,void 0,(function*(){S.state="running";const{requestParameters:I,supportImageRefresh:P,onError:M,onSuccess:F,abortController:N}=S,U=P===!1&&!g.i(self)&&!g.g(I.url)&&(!I.headers||Object.keys(I.headers).reduce(((J,re)=>J&&re==="accept"),!0));s++;const $=U?w(I,N):g.m(I,N);try{const J=yield $;delete S.abortController,S.state="completed",J.data instanceof HTMLImageElement||g.b(J.data)?F(J):J.data&&F({data:yield(W=J.data,typeof createImageBitmap=="function"?g.d(W):g.f(W)),cacheControl:J.cacheControl,expires:J.expires})}catch(J){delete S.abortController,M(J)}finally{s--,v()}var W})),v=()=>{const S=(()=>{for(const I of Object.keys(u))if(u[I]())return!0;return!1})()?g.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:g.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let I=s;I<S&&e.length>0;I++){const P=e.shift();P.abortController.signal.aborted?I--:d(P)}},w=(S,I)=>new Promise(((P,M)=>{const F=new Image,N=S.url,U=S.credentials;U&&U==="include"?F.crossOrigin="use-credentials":(U&&U==="same-origin"||!g.s(N))&&(F.crossOrigin="anonymous"),I.signal.addEventListener("abort",(()=>{F.src="",M(g.c())})),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,P({data:F})},F.onerror=()=>{F.onerror=F.onload=null,I.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=N}))})(Xt||(Xt={})),Xt.resetRequestQueue();class tr{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function hr(p){var e=new g.A(3);return e[0]=p[0],e[1]=p[1],e[2]=p[2],e}var Fr,zr=function(p,e,s){return p[0]=e[0]-s[0],p[1]=e[1]-s[1],p[2]=e[2]-s[2],p};Fr=new g.A(3),g.A!=Float32Array&&(Fr[0]=0,Fr[1]=0,Fr[2]=0);var Mi=function(p){var e=p[0],s=p[1];return e*e+s*s};function gi(p){const e=[];if(typeof p=="string")e.push({id:"default",url:p});else if(p&&p.length>0){const s=[];for(const{id:l,url:u}of p){const d=`${l}${u}`;s.indexOf(d)===-1&&(s.push(d),e.push({id:l,url:u}))}}return e}function nn(p,e,s){const l=p.split("?");return l[0]+=`${e}${s}`,l.join("?")}(function(){var p=new g.A(2);g.A!=Float32Array&&(p[0]=0,p[1]=0)})();class Kt{constructor(e,s,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,l){const{width:u,height:d}=e,v=!(this.size&&this.size[0]===u&&this.size[1]===d||l),{context:w}=this,{gl:S}=w;if(this.useMipmap=!!(s&&s.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[u,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||g.b(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,u,d,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:I,y:P}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||g.b(e)?S.texSubImage2D(S.TEXTURE_2D,0,I,P,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,I,P,u,d,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(e,s,l){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),l!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,l||e),this.filter=e),s!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function sn(p){const{userImage:e}=p;return!!(e&&e.render&&e.render())&&(p.data.replace(new Uint8Array(e.data.buffer)),!0)}class mr extends g.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new g.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new g.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let l=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new g.j(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new g.j(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new g.j(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,s){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||s<u[1])return!1;l=u[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const l=s.spriteData,u=l&&l.width||s.data.width,d=l&&l.height||s.data.height;return!(e[0]<0||u<e[0]||e[1]<0||d<e[1]||e[2]<0||u<e[2]||e[3]<0||d<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((s,l)=>{let u=!0;if(!this.isLoaded())for(const d of e)this.images[d]||(u=!1);this.isLoaded()||u?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})}))}_getImagesForIds(e){const s={};for(const l of e){let u=this.getImage(l);u||(this.fire(new g.k("styleimagemissing",{id:l})),u=this.getImage(l)),u?s[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:g.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],l=this.getImage(e);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},d=new g.I(u,l);this.patterns[e]={bin:u,position:d}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Kt(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const d in this.patterns)e.push(this.patterns[d].bin);const{w:s,h:l}=g.p(e),u=this.atlasImage;u.resize({width:s||1,height:l||1});for(const d in this.patterns){const{bin:v}=this.patterns[d],w=v.x+1,S=v.y+1,I=this.getImage(d).data,P=I.width,M=I.height;g.R.copy(I,u,{x:0,y:0},{x:w,y:S},{width:P,height:M}),g.R.copy(I,u,{x:0,y:M-1},{x:w,y:S-1},{width:P,height:1}),g.R.copy(I,u,{x:0,y:0},{x:w,y:S+M},{width:P,height:1}),g.R.copy(I,u,{x:P-1,y:0},{x:w-1,y:S},{width:1,height:M}),g.R.copy(I,u,{x:0,y:0},{x:w+P,y:S},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||g.w(`Image with ID: "${s}" was not found`),sn(l)&&this.updateImage(s,l)}}}const Ar=1e20;function ci(p,e,s,l,u,d,v,w,S){for(let I=e;I<e+l;I++)ti(p,s*d+I,d,u,v,w,S);for(let I=s;I<s+u;I++)ti(p,I*d+e,1,l,v,w,S)}function ti(p,e,s,l,u,d,v){d[0]=0,v[0]=-Ar,v[1]=Ar,u[0]=p[e];for(let w=1,S=0,I=0;w<l;w++){u[w]=p[e+w*s];const P=w*w;do{const M=d[S];I=(u[w]-u[M]+P-M*M)/(w-M)/2}while(I<=v[S]&&--S>-1);S++,d[S]=w,v[S]=I,v[S+1]=Ar}for(let w=0,S=0;w<l;w++){for(;v[S+1]<w;)S++;const I=d[S],P=w-I;p[e+w*s]=u[I]+P*P}}class or{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return g._(this,void 0,void 0,(function*(){const s=[];for(const d in e)for(const v of e[d])s.push(this._getAndCacheGlyphsPromise(d,v));const l=yield Promise.all(s),u={};for(const{stack:d,id:v,glyph:w}of l)u[d]||(u[d]={}),u[d][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return u}))}_getAndCacheGlyphsPromise(e,s){return g._(this,void 0,void 0,(function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[s];if(u!==void 0)return{stack:e,id:s,glyph:u};if(u=this._tinySDF(l,e,s),u)return l.glyphs[s]=u,{stack:e,id:s,glyph:u};const d=Math.floor(s/256);if(256*d>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[d])return{stack:e,id:s,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[d]){const w=or.loadGlyphRange(e,d,this.url,this.requestManager);l.requests[d]=w}const v=yield l.requests[d];for(const w in v)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=v[+w]);return l.ranges[d]=!0,{stack:e,id:s,glyph:v[s]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,s,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let d=e.tinySDF;if(!d){let w="400";/bold/i.test(s)?w="900":/medium/i.test(s)?w="500":/light/i.test(s)&&(w="200"),d=e.tinySDF=new or.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:w})}const v=d.draw(String.fromCharCode(l));return{id:l,bitmap:new g.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}or.loadGlyphRange=function(p,e,s,l){return g._(this,void 0,void 0,(function*(){const u=256*e,d=u+255,v=l.transformRequest(s.replace("{fontstack}",p).replace("{range}",`${u}-${d}`),"Glyphs"),w=yield g.l(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${d}`);const S={};for(const I of g.n(w.data))S[I.id]=I;return S}))},or.TinySDF=class{constructor({fontSize:p=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:v="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=s;const w=this.size=p+4*e,S=this._createCanvas(w),I=this.ctx=S.getContext("2d",{willReadFrequently:!0});I.font=`${v} ${d} ${p}px ${u}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(p){const e=document.createElement("canvas");return e.width=e.height=p,e}draw(p){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(p),v=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-u))),S=Math.min(this.size-this.buffer,v+Math.ceil(l)),I=w+2*this.buffer,P=S+2*this.buffer,M=Math.max(I*P,0),F=new Uint8ClampedArray(M),N={data:F,width:I,height:P,glyphWidth:w,glyphHeight:S,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(w===0||S===0)return N;const{ctx:U,buffer:$,gridInner:W,gridOuter:J}=this;U.clearRect($,$,w,S),U.fillText(p,$,$+v);const re=U.getImageData($,$,w,S);J.fill(Ar,0,M),W.fill(0,0,M);for(let q=0;q<S;q++)for(let oe=0;oe<w;oe++){const ue=re.data[4*(q*w+oe)+3]/255;if(ue===0)continue;const _e=(q+$)*I+oe+$;if(ue===1)J[_e]=0,W[_e]=Ar;else{const Ce=.5-ue;J[_e]=Ce>0?Ce*Ce:0,W[_e]=Ce<0?Ce*Ce:0}}ci(J,0,0,I,P,I,this.f,this.v,this.z),ci(W,$,$,w,S,I,this.f,this.v,this.z);for(let q=0;q<M;q++){const oe=Math.sqrt(J[q])-Math.sqrt(W[q]);F[q]=Math.round(255-255*(oe/this.radius+this.cutoff))}return N}};class et{constructor(){this.specification=g.v.light.position}possiblyEvaluate(e,s){return g.x(e.expression.evaluate(s))}interpolate(e,s,l){return{x:g.y.number(e.x,s.x,l),y:g.y.number(e.y,s.y,l),z:g.y.number(e.z,s.z,l)}}}let vt;class rt extends g.E{constructor(e){super(),vt=vt||new g.q({anchor:new g.D(g.v.light.anchor),position:new et,color:new g.D(g.v.light.color),intensity:new g.D(g.v.light.intensity)}),this._transitionable=new g.T(vt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(g.r,e,s))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l){return(!l||l.validate!==!1)&&g.t(this,e.call(g.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:g.v}))}}const de=new g.q({"sky-color":new g.D(g.v.sky["sky-color"]),"horizon-color":new g.D(g.v.sky["horizon-color"]),"fog-color":new g.D(g.v.sky["fog-color"]),"fog-ground-blend":new g.D(g.v.sky["fog-ground-blend"]),"horizon-fog-blend":new g.D(g.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new g.D(g.v.sky["sky-horizon-blend"]),"atmosphere-blend":new g.D(g.v.sky["atmosphere-blend"])});class Me extends g.E{constructor(e){super(),this._transitionable=new g.T(de),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new g.z(0))}setSky(e,s={}){if(!this._validate(g.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l={}){return(l==null?void 0:l.validate)!==!1&&g.t(this,e.call(g.u,g.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:g.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class zt{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const l=e.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,s)),this.dashEntry[l]}getDashRanges(e,s,l){const u=[];let d=e.length%2==1?-e[e.length-1]*l:0,v=e[0]*l,w=!0;u.push({left:d,right:v,isDash:w,zeroLength:e[0]===0});let S=e[0];for(let I=1;I<e.length;I++){w=!w;const P=e[I];d=S*l,S+=P,v=S*l,u.push({left:d,right:v,isDash:w,zeroLength:P===0})}return u}addRoundDash(e,s,l){const u=s/2;for(let d=-l;d<=l;d++){const v=this.width*(this.nextRow+l+d);let w=0,S=e[w];for(let I=0;I<this.width;I++){I/S.right>1&&(S=e[++w]);const P=Math.abs(I-S.left),M=Math.abs(I-S.right),F=Math.min(P,M);let N;const U=d/l*(u+1);if(S.isDash){const $=u-Math.abs(U);N=Math.sqrt(F*F+$*$)}else N=u-Math.sqrt(F*F+U*U);this.data[v+I]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const S=e[w],I=e[w+1];S.zeroLength?e.splice(w,1):I&&I.isDash===S.isDash&&(I.left=S.left,e.splice(w,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let d=0,v=e[d];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++d]);const S=Math.abs(w-v.left),I=Math.abs(w-v.right),P=Math.min(S,I);this.data[u+w]=Math.max(0,Math.min(255,(v.isDash?P:-P)+128))}}addDash(e,s){const l=s?7:0,u=2*l+1;if(this.nextRow+u>this.height)return g.w("LineAtlas out of space"),null;let d=0;for(let w=0;w<e.length;w++)d+=e[w];if(d!==0){const w=this.width/d,S=this.getDashRanges(e,this.width,w);s?this.addRoundDash(S,w,l):this.addRegularDash(S)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:d};return this.nextRow+=u,this.dirty=!0,v}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const At="maplibre_preloaded_worker_pool";class Vt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Vt.workerCount;)this.workers.push(new Worker(g.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((s=>{s.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[At]}numActive(){return Object.keys(this.active).length}}const Gt=Math.floor(ke.hardwareConcurrency/2);let qt,$t;function dr(){return qt||(qt=new Vt),qt}Vt.workerCount=g.C(globalThis)?Math.max(Math.min(Gt,3),1):1;class ri{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let u=0;u<l.length;u++){const d=new g.F(l[u],s);d.name=`Worker ${u}`,this.actors.push(d)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((s=>{s.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const l of this.actors)l.registerMessageHandler(e,s)}}function Ys(){return $t||($t=new ri(dr(),g.G),$t.registerMessageHandler("GR",((p,e,s)=>g.m(e,s)))),$t}function ls(p,e){const s=g.H();return g.J(s,s,[1,1,0]),g.K(s,s,[.5*p.width,.5*p.height,1]),g.L(s,s,p.calculatePosMatrix(e.toUnwrapped()))}function Vn(p,e,s,l,u,d){const v=(function(M,F,N){if(M)for(const U of M){const $=F[U];if($&&$.source===N&&$.type==="fill-extrusion")return!0}else for(const U in F){const $=F[U];if($.source===N&&$.type==="fill-extrusion")return!0}return!1})(u&&u.layers,e,p.id),w=d.maxPitchScaleFactor(),S=p.tilesIn(l,w,v);S.sort(us);const I=[];for(const M of S)I.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(e,s,p._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,u,d,w,ls(p.transform,M.tileID))});const P=(function(M){const F={},N={};for(const U of M){const $=U.queryResults,W=U.wrappedTileID,J=N[W]=N[W]||{};for(const re in $){const q=$[re],oe=J[re]=J[re]||{},ue=F[re]=F[re]||[];for(const _e of q)oe[_e.featureIndex]||(oe[_e.featureIndex]=!0,ue.push(_e))}}return F})(I);for(const M in P)P[M].forEach((F=>{const N=F.feature,U=p.getFeatureState(N.layer["source-layer"],N.id);N.source=N.layer.source,N.layer["source-layer"]&&(N.sourceLayer=N.layer["source-layer"]),N.state=U}));return P}function us(p,e){const s=p.tileID,l=e.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function wo(p,e,s){return g._(this,void 0,void 0,(function*(){let l=p;if(p.url?l=(yield g.h(e.transformRequest(p.url,"Source"),s)).data:yield ke.frameAsync(s),!l)return null;const u=g.M(g.e(l,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map((d=>d.id))),u}))}class we{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof g.N?new g.N(e.lng,e.lat):g.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof g.N?new g.N(e.lng,e.lat):g.N.convert(e),this}extend(e){const s=this._sw,l=this._ne;let u,d;if(e instanceof g.N)u=e,d=e;else{if(!(e instanceof we))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(we.convert(e)):this.extend(g.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(g.N.convert(e)):this;if(u=e._sw,d=e._ne,!u||!d)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(d.lng,l.lng),l.lat=Math.max(d.lat,l.lat)):(this._sw=new g.N(u.lng,u.lat),this._ne=new g.N(d.lng,d.lat)),this}getCenter(){return new g.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new g.N(this.getWest(),this.getNorth())}getSouthEast(){return new g.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=g.N.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof we?e:e&&new we(e)}static fromLngLat(e,s=0){const l=360*s/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new we(new g.N(e.lng-u,e.lat-l),new g.N(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new g.N(this._sw.lng,this._sw.lat),s=new g.N(this._ne.lng,this._ne.lat);return new we(e,e.lng>s.lng?new g.N(s.lng+360,s.lat):s)}}class ks{constructor(e,s,l){this.bounds=we.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),l=Math.floor(g.O(this.bounds.getWest())*s),u=Math.floor(g.Q(this.bounds.getNorth())*s),d=Math.ceil(g.O(this.bounds.getEast())*s),v=Math.ceil(g.Q(this.bounds.getSouth())*s);return e.x>=l&&e.x<d&&e.y>=u&&e.y<v}}class Wo extends g.E{constructor(e,s,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,g.e(this,g.M(s,["url","scheme","tileSize","promoteId"])),this._options=g.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return g._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new g.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield wo(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(g.e(this,e),e.bounds&&(this.tileBounds=new ks(e.bounds,this.minzoom,this.maxzoom)),this.fire(new g.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new g.j(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return g.e({},this._options)}loadTile(e){return g._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((d,v)=>{e.reloadPromise={resolve:d,reject:v}}))}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const d=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,d)}catch(d){if(delete e.abortController,e.aborted)return;if(d&&d.status!==404)throw d;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return g._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return g._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Jt extends g.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=g.e({type:"raster"},s),g.e(this,g.M(s,["url","scheme","tileSize"]))}load(){return g._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new g.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield wo(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(g.e(this,e),e.bounds&&(this.tileBounds=new ks(e.bounds,this.minzoom,this.maxzoom)),this.fire(new g.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new g.j(e))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return g.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return g._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield Xt.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,d=u.gl,v=l.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new Kt(u,v,d.RGBA,{useMipmap:!0}),e.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}}))}abortTile(e){return g._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return g._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class wr extends Jt{constructor(e,s,l,u){super(e,s,l,u),this.type="raster-dem",this.maxzoom=22,this._options=g.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return g._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield Xt.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const d=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const v=g.b(d)&&g.U()?d:yield this.readImageNow(d),w={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const S=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=S,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}}))}readImageNow(e){return g._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&g.V()){const s=e.width+2,l=e.height+2;try{return new g.R({width:s,height:l},yield g.W(e,-1,-1,s,l))}catch{}}return ke.getImageData(e,1)}))}_getNeighboringTiles(e){const s=e.canonical,l=Math.pow(2,s.z),u=(s.x-1+l)%l,d=s.x===0?e.wrap-1:e.wrap,v=(s.x+1+l)%l,w=s.x+1===l?e.wrap+1:e.wrap,S={};return S[new g.S(e.overscaledZ,d,s.z,u,s.y).key]={backfilled:!1},S[new g.S(e.overscaledZ,w,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(S[new g.S(e.overscaledZ,d,s.z,u,s.y-1).key]={backfilled:!1},S[new g.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},S[new g.S(e.overscaledZ,w,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<l&&(S[new g.S(e.overscaledZ,d,s.z,u,s.y+1).key]={backfilled:!1},S[new g.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},S[new g.S(e.overscaledZ,w,s.z,v,s.y+1).key]={backfilled:!1}),S}unloadTile(e){return g._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class cs extends g.E{constructor(e,s,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=s.data,this._options=g.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const d=g.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&g.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=g.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*d,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*d,extent:g.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:g.X,radius:(s.clusterRadius||50)*d,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return g._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return g._(this,void 0,void 0,(function*(){const e=g.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:l}})}_updateWorkerData(e){return g._(this,void 0,void 0,(function*(){const s=g.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(ke.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new g.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new g.k("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const d={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&g.e(d,{resourceTiming:u}),this.fire(new g.k("data",Object.assign(Object.assign({},d),{sourceDataType:"metadata"}))),this.fire(new g.k("data",Object.assign(Object.assign({},d),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new g.k("dataabort",{dataType:"source"}));this.fire(new g.j(l))}}))}loaded(){return this._pendingLoads===0}loadTile(e){return g._(this,void 0,void 0,(function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:s,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,s==="RT")}))}abortTile(e){return g._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return g._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return g.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var hs=g.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ds extends g.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}load(e){return g._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new g.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield Xt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new g.j(s))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new g.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(g.Z.fromLngLat);this.tileID=(function(u){let d=1/0,v=1/0,w=-1/0,S=-1/0;for(const F of u)d=Math.min(d,F.x),v=Math.min(v,F.y),w=Math.max(w,F.x),S=Math.max(S,F.y);const I=Math.max(w-d,S-v),P=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),M=Math.pow(2,P);return new g.a1(P,Math.floor((d+w)/2*M),Math.floor((v+S)/2*M))})(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map((u=>this.tileID.getTilePoint(u)._round()));return this._boundsArray=new g.$,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,g.X,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,g.X),this._boundsArray.emplaceBack(l[2].x,l[2].y,g.X,g.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new g.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,hs.members)),this.boundsSegments||(this.boundsSegments=g.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Kt(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,l=!0)}l&&this.fire(new g.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return g._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class bo extends ds{constructor(e,s,l,u){super(e,s,l,u),this.roundZoom=!0,this.type="video",this.options=s}load(){return g._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield g.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new g.j(s))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new g.j(new g.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,hs.members)),this.boundsSegments||(this.boundsSegments=g.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new Kt(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,l=!0)}l&&this.fire(new g.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class on extends ds{constructor(e,s,l,u){super(e,s,l,u),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some((d=>!Array.isArray(d)||d.length!==2||d.some((v=>typeof v!="number"))))||this.fire(new g.j(new g.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new g.j(new g.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new g.j(new g.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new g.j(new g.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new g.j(new g.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return g._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new g.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,hs.members)),this.boundsSegments||(this.boundsSegments=g.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Kt(s,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const d in this.tiles){const v=this.tiles[d];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,u=!0)}u&&this.fire(new g.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Xo={},So=p=>{switch(p){case"geojson":return cs;case"image":return ds;case"raster":return Jt;case"raster-dem":return wr;case"vector":return Wo;case"video":return bo;case"canvas":return on}return Xo[p]},Re="RTLPluginLoaded";class jn extends g.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ys()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((s=>{throw this.status="error",s}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return g._(this,arguments,void 0,(function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ke.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return g._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new g.k(Re))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ii=null;function Vi(){return ii||(ii=new jn),ii}class Qs{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=g.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(u,d){const v={};if(!d)return v;for(const w of u){const S=w.layerIds.map((I=>d.getLayer(I))).filter(Boolean);if(S.length!==0){w.layers=S,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map((I=>S.filter((P=>P.id===I))[0])));for(const I of S)v[I.id]=w}}return v})(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const d=this.buckets[u];if(d instanceof g.a6){if(this.hasSymbolBuckets=!0,!l)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const d=this.buckets[u];if(d instanceof g.a6&&d.hasRTLText){this.hasRTLText=!0,Vi().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const d=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new g.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Kt(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Kt(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,u,d,v,w,S,I,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:d,scale:v,tileSize:this.tileSize,pixelPosMatrix:P,transform:S,params:w,queryPadding:this.queryPadding*I},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),d=s&&s.sourceLayer?s.sourceLayer:"",v=u._geojsonTileLayer||u[d];if(!v)return;const w=g.a7(s&&s.filter),{z:S,x:I,y:P}=this.tileID.canonical,M={z:S,x:I,y:P};for(let F=0;F<v.length;F++){const N=v.feature(F);if(w.needGeometry){const W=g.a8(N,!0);if(!w.filter(new g.z(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!w.filter(new g.z(this.tileID.overscaledZ),N))continue;const U=l.getId(N,d),$=new g.a9(N,S,I,P,U);$.tile=M,e.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=g.aa(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const d=this.expirationTime-s;d?this.expirationTime=l+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const d=this.buckets[u],v=d.layers[0].sourceLayer||"_geojsonTileLayer",w=l[v],S=e[v];if(!w||!S||Object.keys(S).length===0)continue;d.update(S,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const I=s&&s.style&&s.style.getLayer(u);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ke.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ke.now()+e}setDependencies(e,s){const l={};for(const u of s)l[u]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const u=this.dependencies[l];if(u){for(const d of s)if(u[d])return!0}}return!1}}class je{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const d={value:s,timeout:void 0};if(l!==void 0&&(d.timeout=setTimeout((()=>{this.remove(e,d)}),l)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,u=s===void 0?0:this.data[l].indexOf(s),d=this.data[l][u];return this.data[l].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(d.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class Dt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},g.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==u&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const d in this.state[e][u])l[d]||(this.deletedStates[e][u][d]=null)}else for(const d in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][d]===null&&delete this.deletedStates[e][u][d]}removeFeatureState(e,s,l){if(this.deletedStates[e]===null)return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&s!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),u=g.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][s];if(d===null)return{};for(const v in d)delete u[v]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const d={};for(const v in this.stateChanges[u])this.state[u][v]||(this.state[u][v]={}),g.e(this.state[u][v],this.stateChanges[u][v]),d[v]=this.state[u][v];l[u]=d}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const d={};if(this.deletedStates[u]===null)for(const v in this.state[u])d[v]={},this.state[u][v]={};else for(const v in this.deletedStates[u]){if(this.deletedStates[u][v]===null)this.state[u][v]={};else for(const w of Object.keys(this.deletedStates[u][v]))delete this.state[u][v][w];d[v]=this.state[u][v]}l[u]=l[u]||{},g.e(l[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,s)}}class xt extends g.E{constructor(e,s,l){super(),this.id=e,this.dispatcher=l,this.on("data",(u=>this._dataHandler(u))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((u,d,v,w)=>{const S=new(So(d.type))(u,d,v,w);if(S.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${S.id}`);return S})(e,s,l,this),this._tiles={},this._cache=new je(0,(u=>this._unloadTile(u))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Dt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,l){return g._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new g.j(u,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new g.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Si).map((e=>e.key))}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&s.push(this._tiles[l]);return e?s.sort(((l,u)=>{const d=l.tileID,v=u.tileID,w=new g.P(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),S=new g.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-v.overscaledZ||S.y-w.y||S.x-w.x})).map((l=>l.tileID.key)):s.map((l=>l.tileID)).sort(Si).map((l=>l.key))}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return g._(this,void 0,void 0,(function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,e,s))}))}_tileLoaded(e,s,l){e.timeAdded=ke.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new g.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const d=s[u];if(e.neighboringTiles&&e.neighboringTiles[d]){const v=this.getTileByID(d);l(e,v),l(v,e)}}function l(u,d){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let v=d.tileID.canonical.x-u.tileID.canonical.x;const w=d.tileID.canonical.y-u.tileID.canonical.y,S=Math.pow(2,u.tileID.canonical.z),I=d.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+S)===1?v+=S:Math.abs(v-S)===1&&(v-=S)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,v,w),u.neighboringTiles&&u.neighboringTiles[I]&&(u.neighboringTiles[I].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,u){for(const d in this._tiles){let v=this._tiles[d];if(u[d]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>l)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const I=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[I.key],v&&v.hasData()&&(w=I)}let S=w;for(;S.overscaledZ>s;)if(S=S.scaledTo(S.overscaledZ-1),e[S.key]){u[w.key]=w;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const u=e.scaledTo(l),d=this._getLoadedTile(u);if(d)return d}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?g.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(d)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const u in this._tiles){const d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+s),l[d.tileID.key]=d}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,s,l,u,d,v){const w={},S={},I=Object.keys(e),P=ke.now();for(const M of I){const F=e[M],N=this._tiles[M];if(!N||N.fadeEndTime!==0&&N.fadeEndTime<=P)continue;const U=this.findLoadedParent(F,s),$=this.findLoadedSibling(F),W=U||$||null;W&&(this._addTile(W.tileID),w[W.tileID.key]=W.tileID),S[M]=F}this._retainLoadedChildren(S,u,l,e);for(const M in w)e[M]||(this._coveredTiles[M]=!0,e[M]=w[M]);if(v){const M={},F={};for(const N of d)this._tiles[N.key].hasData()?M[N.key]=N:F[N.key]=N;for(const N in F){const U=F[N].children(this._source.maxzoom);this._tiles[U[0].key]&&this._tiles[U[1].key]&&this._tiles[U[2].key]&&this._tiles[U[3].key]&&(M[U[0].key]=e[U[0].key]=U[0],M[U[1].key]=e[U[1].key]=U[1],M[U[2].key]=e[U[2].key]=U[2],M[U[3].key]=e[U[3].key]=U[3],delete F[N])}for(const N in F){const U=F[N],$=this.findLoadedParent(U,this._source.minzoom),W=this.findLoadedSibling(U),J=$||W||null;if(J){M[J.tileID.key]=e[J.tileID.key]=J.tileID;for(const re in M)M[re].isChildOf(J.tileID)&&delete M[re]}}for(const N in this._tiles)M[N]||(this._coveredTiles[N]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((P=>new g.S(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y))):(l=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter((P=>this._source.hasTile(P))))):l=[];const u=e.coveringZoomLevel(this._source),d=Math.max(u-xt.maxOverzooming,this._source.minzoom),v=Math.max(u+xt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const P={};for(const M of l)if(M.canonical.z>this._source.minzoom){const F=M.scaledTo(M.canonical.z-1);P[F.key]=F;const N=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));P[N.key]=N}l=l.concat(Object.values(P))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new g.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(l,u);an(this._source.type)&&this._updateCoveredAndRetainedTiles(S,d,v,u,l,s);for(const P in S)this._tiles[P].clearFadeHold();const I=g.ab(this._tiles,S);for(const P of I){const M=this._tiles[P];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(P)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var l;const u={},d={},v=Math.max(s-xt.maxOverzooming,this._source.minzoom),w=Math.max(s+xt.maxUnderzooming,this._source.minzoom),S={};for(const I of e){const P=this._addTile(I);u[I.key]=I,P.hasData()||s<this._source.maxzoom&&(S[I.key]=I)}this._retainLoadedChildren(S,s,w,u);for(const I of e){let P=this._tiles[I.key];if(P.hasData())continue;if(s+1>this._source.maxzoom){const F=I.children(this._source.maxzoom)[0],N=this.getTile(F);if(N&&N.hasData()){u[F.key]=F;continue}}else{const F=I.children(this._source.maxzoom);if(u[F[0].key]&&u[F[1].key]&&u[F[2].key]&&u[F[3].key])continue}let M=P.wasRequested();for(let F=I.overscaledZ-1;F>=v;--F){const N=I.scaledTo(F);if(d[N.key])break;if(d[N.key]=!0,P=this.getTile(N),!P&&M&&(P=this._addTile(N)),P){const U=P.hasData();if((U||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||M)&&(u[N.key]=N),M=P.wasRequested(),U)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const d=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(d),l)break;u=d}for(const d of s)this._loadedParentTiles[d]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,l=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=s;return s||(s=new Qs(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,l||this._source.fire(new g.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,l){const u=[],d=this.transform;if(!d)return u;const v=l?d.getCameraQueryGeometry(e):e,w=e.map((U=>d.pointCoordinate(U,this.terrain))),S=v.map((U=>d.pointCoordinate(U,this.terrain))),I=this.getIds();let P=1/0,M=1/0,F=-1/0,N=-1/0;for(const U of S)P=Math.min(P,U.x),M=Math.min(M,U.y),F=Math.max(F,U.x),N=Math.max(N,U.y);for(let U=0;U<I.length;U++){const $=this._tiles[I[U]];if($.holdingForFade())continue;const W=$.tileID,J=Math.pow(2,d.zoom-$.tileID.overscaledZ),re=s*$.queryPadding*g.X/$.tileSize/J,q=[W.getTilePoint(new g.Z(P,M)),W.getTilePoint(new g.Z(F,N))];if(q[0].x-re<g.X&&q[0].y-re<g.X&&q[1].x+re>=0&&q[1].y+re>=0){const oe=w.map((_e=>W.getTilePoint(_e))),ue=S.map((_e=>W.getTilePoint(_e)));u.push({tile:$,tileID:W,queryGeometry:oe,cameraQueryGeometry:ue,scale:J})}}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map((l=>this._tiles[l].tileID));for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(an(this._source.type)){const e=ke.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const u=this._tiles[e];u&&u.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(l,"reloading");this._cache.filter((l=>!l.hasDependency(e,s)))}}function Si(p,e){const s=Math.abs(2*p.wrap)-+(p.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return p.overscaledZ-e.overscaledZ||l-s||e.canonical.y-p.canonical.y||e.canonical.x-p.canonical.x}function an(p){return p==="raster"||p==="image"||p==="video"}xt.maxOverzooming=10,xt.maxUnderzooming=3;class Tt{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=g.ac(e,0,1);let s=1,l=this._distances[s];const u=e*this.paddedLength+this.padding;for(;l<u&&s<this._distances.length;)l=this._distances[++s];const d=s-1,v=this._distances[d],w=l-v,S=w>0?(u-v)/w:0;return this.points[d].mult(1-S).add(this.points[s].mult(S))}}function bn(p,e){let s=!0;return p==="always"||p!=="never"&&e!=="never"||(s=!1),s}class Un{constructor(e,s,l){const u=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(s/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)u.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,l,u,d){this._forEachCell(s,l,u,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(d)}insertCircle(e,s,l,u){this._forEachCell(s-u,l-u,s+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,s,l,u,d,v){this.boxCells[d].push(v)}_insertCircleCell(e,s,l,u,d,v){this.circleCells[d].push(v)}_query(e,s,l,u,d,v,w){if(l<0||e>this.width||u<0||s>this.height)return[];const S=[];if(e<=0&&s<=0&&this.width<=l&&this.height<=u){if(d)return[{key:null,x1:e,y1:s,x2:l,y2:u}];for(let I=0;I<this.boxKeys.length;I++)S.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const P=this.circles[3*I],M=this.circles[3*I+1],F=this.circles[3*I+2];S.push({key:this.circleKeys[I],x1:P-F,y1:M-F,x2:P+F,y2:M+F})}}else this._forEachCell(e,s,l,u,this._queryCell,S,{hitTest:d,overlapMode:v,seenUids:{box:{},circle:{}}},w);return S}query(e,s,l,u){return this._query(e,s,l,u,!1,null)}hitTest(e,s,l,u,d,v){return this._query(e,s,l,u,!0,d,v).length>0}hitTestCircle(e,s,l,u,d){const v=e-l,w=e+l,S=s-l,I=s+l;if(w<0||v>this.width||I<0||S>this.height)return!1;const P=[];return this._forEachCell(v,S,w,I,this._queryCellCircle,P,{hitTest:!0,overlapMode:u,circle:{x:e,y:s,radius:l},seenUids:{box:{},circle:{}}},d),P.length>0}_queryCell(e,s,l,u,d,v,w,S){const{seenUids:I,hitTest:P,overlapMode:M}=w,F=this.boxCells[d];if(F!==null){const U=this.bboxes;for(const $ of F)if(!I.box[$]){I.box[$]=!0;const W=4*$,J=this.boxKeys[$];if(e<=U[W+2]&&s<=U[W+3]&&l>=U[W+0]&&u>=U[W+1]&&(!S||S(J))&&(!P||!bn(M,J.overlapMode))&&(v.push({key:J,x1:U[W],y1:U[W+1],x2:U[W+2],y2:U[W+3]}),P))return!0}}const N=this.circleCells[d];if(N!==null){const U=this.circles;for(const $ of N)if(!I.circle[$]){I.circle[$]=!0;const W=3*$,J=this.circleKeys[$];if(this._circleAndRectCollide(U[W],U[W+1],U[W+2],e,s,l,u)&&(!S||S(J))&&(!P||!bn(M,J.overlapMode))){const re=U[W],q=U[W+1],oe=U[W+2];if(v.push({key:J,x1:re-oe,y1:q-oe,x2:re+oe,y2:q+oe}),P)return!0}}}return!1}_queryCellCircle(e,s,l,u,d,v,w,S){const{circle:I,seenUids:P,overlapMode:M}=w,F=this.boxCells[d];if(F!==null){const U=this.bboxes;for(const $ of F)if(!P.box[$]){P.box[$]=!0;const W=4*$,J=this.boxKeys[$];if(this._circleAndRectCollide(I.x,I.y,I.radius,U[W+0],U[W+1],U[W+2],U[W+3])&&(!S||S(J))&&!bn(M,J.overlapMode))return v.push(!0),!0}}const N=this.circleCells[d];if(N!==null){const U=this.circles;for(const $ of N)if(!P.circle[$]){P.circle[$]=!0;const W=3*$,J=this.circleKeys[$];if(this._circlesCollide(U[W],U[W+1],U[W+2],I.x,I.y,I.radius)&&(!S||S(J))&&!bn(M,J.overlapMode))return v.push(!0),!0}}}_forEachCell(e,s,l,u,d,v,w,S){const I=this._convertToXCellCoord(e),P=this._convertToYCellCoord(s),M=this._convertToXCellCoord(l),F=this._convertToYCellCoord(u);for(let N=I;N<=M;N++)for(let U=P;U<=F;U++)if(d.call(this,e,s,l,u,this.xCellCount*U+N,v,w,S))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,l,u,d,v){const w=u-e,S=d-s,I=l+v;return I*I>w*w+S*S}_circleAndRectCollide(e,s,l,u,d,v,w){const S=(v-u)/2,I=Math.abs(e-(u+S));if(I>S+l)return!1;const P=(w-d)/2,M=Math.abs(s-(d+P));if(M>P+l)return!1;if(I<=S||M<=P)return!0;const F=I-S,N=M-P;return F*F+N*N<=l*l}}function ln(p,e,s,l,u){const d=g.H();return e?(g.K(d,d,[1/u,1/u,1]),s||g.ad(d,d,l.angle)):g.L(d,l.labelPlaneMatrix,p),d}function zi(p,e,s,l,u){if(e){const d=g.ae(p);return g.K(d,d,[u,u,1]),s||g.ad(d,d,-l.angle),d}return l.glCoordMatrix}function K(p,e,s,l){let u;l?(u=[p,e,l(p,e),1],g.af(u,u,s)):(u=[p,e,0,1],Yt(u,u,s));const d=u[3];return{point:new g.P(u[0]/d,u[1]/d),signedDistanceFromCamera:d,isOccluded:!1}}function L(p,e){return .5+p/e*.5}function D(p,e){return p.x>=-e[0]&&p.x<=e[0]&&p.y>=-e[1]&&p.y<=e[1]}function V(p,e,s,l,u,d,v,w,S,I,P,M,F,N,U){const $=l?p.textSizeData:p.iconSizeData,W=g.ag($,s.transform.zoom),J=[256/s.width*2+1,256/s.height*2+1],re=l?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;re.clear();const q=p.lineVertexArray,oe=l?p.text.placedSymbolArray:p.icon.placedSymbolArray,ue=s.transform.width/s.transform.height;let _e=!1;for(let Ce=0;Ce<oe.length;Ce++){const Le=oe.get(Ce);if(Le.hidden||Le.writingMode===g.ah.vertical&&!_e){dt(Le.numGlyphs,re);continue}_e=!1;const Ne=K(Le.anchorX,Le.anchorY,e,U);if(!D(Ne.point,J)){dt(Le.numGlyphs,re);continue}const He=L(s.transform.cameraToCenterDistance,Ne.signedDistanceFromCamera),Ve=g.ai($,W,Le),Be=v?Ve/He:Ve*He,it={getElevation:U,labelPlaneMatrix:u,lineVertexArray:q,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:I,tileAnchorPoint:new g.P(Le.anchorX,Le.anchorY),unwrappedTileID:P,width:M,height:F,translation:N},bt=ae(it,Le,Be,!1,w,e,d,p.glyphOffsetArray,re,ue,S);_e=bt.useVertical,(bt.notEnoughRoom||_e||bt.needsFlipping&&ae(it,Le,Be,!0,w,e,d,p.glyphOffsetArray,re,ue,S).notEnoughRoom)&&dt(Le.numGlyphs,re)}l?p.text.dynamicLayoutVertexBuffer.updateData(re):p.icon.dynamicLayoutVertexBuffer.updateData(re)}function H(p,e,s,l,u,d,v,w){const S=d.glyphStartIndex+d.numGlyphs,I=d.lineStartIndex,P=d.lineStartIndex+d.lineLength,M=e.getoffsetX(d.glyphStartIndex),F=e.getoffsetX(S-1),N=Oe(p*M,s,l,u,d.segment,I,P,w,v);if(!N)return null;const U=Oe(p*F,s,l,u,d.segment,I,P,w,v);return U?w.projectionCache.anyProjectionOccluded?null:{first:N,last:U}:null}function ie(p,e,s,l){return p===g.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*l?{useVertical:!0}:(p===g.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function ae(p,e,s,l,u,d,v,w,S,I,P){const M=s/24,F=e.lineOffsetX*M,N=e.lineOffsetY*M;let U;if(e.numGlyphs>1){const $=e.glyphStartIndex+e.numGlyphs,W=e.lineStartIndex,J=e.lineStartIndex+e.lineLength,re=H(M,w,F,N,l,e,P,p);if(!re)return{notEnoughRoom:!0};const q=K(re.first.point.x,re.first.point.y,v,p.getElevation).point,oe=K(re.last.point.x,re.last.point.y,v,p.getElevation).point;if(u&&!l){const ue=ie(e.writingMode,q,oe,I);if(ue)return ue}U=[re.first];for(let ue=e.glyphStartIndex+1;ue<$-1;ue++)U.push(Oe(M*w.getoffsetX(ue),F,N,l,e.segment,W,J,p,P));U.push(re.last)}else{if(u&&!l){const W=K(p.tileAnchorPoint.x,p.tileAnchorPoint.y,d,p.getElevation).point,J=e.lineStartIndex+e.segment+1,re=new g.P(p.lineVertexArray.getx(J),p.lineVertexArray.gety(J)),q=K(re.x,re.y,d,p.getElevation),oe=q.signedDistanceFromCamera>0?q.point:(function(_e,Ce,Le,Ne,He,Ve){return he(_e,Ce,Le,1,He,Ve)})(p.tileAnchorPoint,re,W,0,d,p),ue=ie(e.writingMode,W,oe,I);if(ue)return ue}const $=Oe(M*w.getoffsetX(e.glyphStartIndex),F,N,l,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,p,P);if(!$||p.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[$]}for(const $ of U)g.aj(S,$.point,$.angle);return{}}function he(p,e,s,l,u,d){const v=p.add(p.sub(e)._unit()),w=u!==void 0?K(v.x,v.y,u,d.getElevation).point:Se(v.x,v.y,d).point,S=s.sub(w);return s.add(S._mult(l/S.mag()))}function te(p,e,s){const l=e.projectionCache;if(l.projections[p])return l.projections[p];const u=new g.P(e.lineVertexArray.getx(p),e.lineVertexArray.gety(p)),d=Se(u.x,u.y,e);if(d.signedDistanceFromCamera>0)return l.projections[p]=d.point,l.anyProjectionOccluded=l.anyProjectionOccluded||d.isOccluded,d.point;const v=p-s.direction;return(function(w,S,I,P,M){return he(w,S,I,P,void 0,M)})(s.distanceFromAnchor===0?e.tileAnchorPoint:new g.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),u,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function Se(p,e,s){const l=p+s.translation[0],u=e+s.translation[1];let d;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(d=s.projection.projectTileCoordinates(l,u,s.unwrappedTileID,s.getElevation),d.point.x=(.5*d.point.x+.5)*s.width,d.point.y=(.5*-d.point.y+.5)*s.height):(d=K(l,u,s.labelPlaneMatrix,s.getElevation),d.isOccluded=!1),d}function Pe(p,e,s){return p._unit()._perp()._mult(e*s)}function ve(p,e,s,l,u,d,v,w,S){if(w.projectionCache.offsets[p])return w.projectionCache.offsets[p];const I=s.add(e);if(p+S.direction<l||p+S.direction>=u)return w.projectionCache.offsets[p]=I,I;const P=te(p+S.direction,w,S),M=Pe(P.sub(s),v,S.direction),F=s.add(M),N=P.add(M);return w.projectionCache.offsets[p]=g.ak(d,I,F,N)||I,w.projectionCache.offsets[p]}function Oe(p,e,s,l,u,d,v,w,S){const I=l?p-e:p+e;let P=I>0?1:-1,M=0;l&&(P*=-1,M=Math.PI),P<0&&(M+=Math.PI);let F,N=P>0?d+u:d+u+1;w.projectionCache.cachedAnchorPoint?F=w.projectionCache.cachedAnchorPoint:(F=Se(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=F);let U,$,W=F,J=F,re=0,q=0;const oe=Math.abs(I),ue=[];let _e;for(;re+q<=oe;){if(N+=P,N<d||N>=v)return null;re+=q,J=W,$=U;const Ne={absOffsetX:oe,direction:P,distanceFromAnchor:re,previousVertex:J};if(W=te(N,w,Ne),s===0)ue.push(J),_e=W.sub(J);else{let He;const Ve=W.sub(J);He=Ve.mag()===0?Pe(te(N+P,w,Ne).sub(W),s,P):Pe(Ve,s,P),$||($=J.add(He)),U=ve(N,He,W,d,v,$,s,w,Ne),ue.push($),_e=U.sub($)}q=_e.mag()}const Ce=_e._mult((oe-re)/q)._add($||J),Le=M+Math.atan2(W.y-J.y,W.x-J.x);return ue.push(Ce),{point:Ce,angle:S?Le:0,path:ue}}const ot=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function dt(p,e){for(let s=0;s<p;s++){const l=e.length;e.resize(l+4),e.float32.set(ot,3*l)}}function Yt(p,e,s){const l=e[0],u=e[1];return p[0]=s[0]*l+s[4]*u+s[12],p[1]=s[1]*l+s[5]*u+s[13],p[3]=s[3]*l+s[7]*u+s[15],p}const Et=100;class Qt{constructor(e,s,l=new Un(e.width+200,e.height+200,25),u=new Un(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=l,this.ignoredGrid=u,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Et,this.screenBottomBoundary=e.height+Et,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,l,u,d,v,w,S,I,P,M){const F=e.anchorPointX+S[0],N=e.anchorPointY+S[1],U=this.projectAndGetPerspectiveRatio(u,F,N,d,P),$=l*U.perspectiveRatio;let W;if(v||w)W=this._projectCollisionBox(e,$,u,d,v,w,S,U,P,M);else{const ue=U.point.x+(M?M.x*$:0),_e=U.point.y+(M?M.y*$:0);W={allPointsOccluded:!1,box:[ue+e.x1*$,_e+e.y1*$,ue+e.x2*$,_e+e.y2*$]}}const[J,re,q,oe]=W.box;return this.mapProjection.useSpecialProjectionForSymbols&&(v?W.allPointsOccluded:this.mapProjection.isOccluded(F,N,d))||U.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(J,re,q,oe)||s!=="always"&&this.grid.hitTest(J,re,q,oe,s,I)?{box:[J,re,q,oe],placeable:!1,offscreen:!1}:{box:[J,re,q,oe],placeable:!0,offscreen:this.isOffscreen(J,re,q,oe)}}placeCollisionCircles(e,s,l,u,d,v,w,S,I,P,M,F,N,U,$,W){const J=[],re=new g.P(s.anchorX,s.anchorY),q=this.getPerspectiveRatio(v,re.x,re.y,w,W),oe=(M?d/q:d*q)/g.ap,ue={getElevation:W,labelPlaneMatrix:S,lineVertexArray:l,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:re,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:$},_e=H(oe,u,s.lineOffsetX*oe,s.lineOffsetY*oe,!1,s,!1,ue);let Ce=!1,Le=!1,Ne=!0;if(_e){const He=.5*N*q+U,Ve=new g.P(-100,-100),Be=new g.P(this.screenRightBoundary,this.screenBottomBoundary),it=new Tt,bt=_e.first,Ue=_e.last;let Ze=[];for(let Ct=bt.path.length-1;Ct>=1;Ct--)Ze.push(bt.path[Ct]);for(let Ct=1;Ct<Ue.path.length;Ct++)Ze.push(Ue.path[Ct]);const wt=2.5*He;if(I){const Ct=this.projectPathToScreenSpace(Ze,ue,I);Ze=Ct.some((Lt=>Lt.signedDistanceFromCamera<=0))?[]:Ct.map((Lt=>Lt.point))}let fr=[];if(Ze.length>0){const Ct=Ze[0].clone(),Lt=Ze[0].clone();for(let _r=1;_r<Ze.length;_r++)Ct.x=Math.min(Ct.x,Ze[_r].x),Ct.y=Math.min(Ct.y,Ze[_r].y),Lt.x=Math.max(Lt.x,Ze[_r].x),Lt.y=Math.max(Lt.y,Ze[_r].y);fr=Ct.x>=Ve.x&&Lt.x<=Be.x&&Ct.y>=Ve.y&&Lt.y<=Be.y?[Ze]:Lt.x<Ve.x||Ct.x>Be.x||Lt.y<Ve.y||Ct.y>Be.y?[]:g.al([Ze],Ve.x,Ve.y,Be.x,Be.y)}for(const Ct of fr){it.reset(Ct,.25*He);let Lt=0;Lt=it.length<=.5*He?1:Math.ceil(it.paddedLength/wt)+1;for(let _r=0;_r<Lt;_r++){const pi=_r/Math.max(Lt-1,1),pn=it.lerp(pi),yr=pn.x+Et,si=pn.y+Et;J.push(yr,si,He,0);const Cr=yr-He,qr=si-He,vi=yr+He,Jn=si+He;if(Ne=Ne&&this.isOffscreen(Cr,qr,vi,Jn),Le=Le||this.isInsideGrid(Cr,qr,vi,Jn),e!=="always"&&this.grid.hitTestCircle(yr,si,He,e,F)&&(Ce=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Ce}}}}return{circles:!P&&Ce||!Le||q<this.perspectiveRatioCutoff?[]:J,offscreen:Ne,collisionDetected:Ce}}projectPathToScreenSpace(e,s,l){return e.map((u=>K(u.x,u.y,l,s.getElevation)))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,u=1/0,d=-1/0,v=-1/0;for(const P of e){const M=new g.P(P.x+Et,P.y+Et);l=Math.min(l,M.x),u=Math.min(u,M.y),d=Math.max(d,M.x),v=Math.max(v,M.y),s.push(M)}const w=this.grid.query(l,u,d,v).concat(this.ignoredGrid.query(l,u,d,v)),S={},I={};for(const P of w){const M=P.key;if(S[M.bucketInstanceId]===void 0&&(S[M.bucketInstanceId]={}),S[M.bucketInstanceId][M.featureIndex])continue;const F=[new g.P(P.x1,P.y1),new g.P(P.x2,P.y1),new g.P(P.x2,P.y2),new g.P(P.x1,P.y2)];g.am(s,F)&&(S[M.bucketInstanceId][M.featureIndex]=!0,I[M.bucketInstanceId]===void 0&&(I[M.bucketInstanceId]=[]),I[M.bucketInstanceId].push(M.featureIndex))}return I}insertCollisionBox(e,s,l,u,d,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:d,collisionGroupID:v,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,l,u,d,v){const w=l?this.ignoredGrid:this.grid,S={bucketInstanceId:u,featureIndex:d,collisionGroupID:v,overlapMode:s};for(let I=0;I<e.length;I+=4)w.insertCircle(S,e[I],e[I+1],e[I+2])}projectAndGetPerspectiveRatio(e,s,l,u,d){let v;d?(v=[s,l,d(s,l),1],g.af(v,v,e)):(v=[s,l,0,1],Yt(v,v,e));const w=v[3];return{point:new g.P((v[0]/w+1)/2*this.transform.width+Et,(-v[1]/w+1)/2*this.transform.height+Et),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}getPerspectiveRatio(e,s,l,u,d){const v=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,u,d):K(s,l,e,d);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(e,s,l,u){return l<Et||e>=this.screenRightBoundary||u<Et||s>this.screenBottomBoundary}isInsideGrid(e,s,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=g.an([]);return g.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,l,u,d,v,w,S,I,P){let M=new g.P(1,0),F=new g.P(0,1);const N=new g.P(e.anchorPointX+w[0],e.anchorPointY+w[1]);if(v&&!d){const Ne=this.projectAndGetPerspectiveRatio(l,N.x+1,N.y,u,I).point.sub(S.point).unit(),He=Math.atan(Ne.y/Ne.x)+(Ne.x<0?Math.PI:0),Ve=Math.sin(He),Be=Math.cos(He);M=new g.P(Be,Ve),F=new g.P(-Ve,Be)}else if(!v&&d){const Ne=-this.transform.angle,He=Math.sin(Ne),Ve=Math.cos(Ne);M=new g.P(Ve,He),F=new g.P(-He,Ve)}let U=S.point,$=s;if(d){U=N;const Ne=this.transform.zoom-Math.floor(this.transform.zoom);$=Math.pow(2,-Ne),$*=this.mapProjection.getPitchedTextCorrection(this.transform,N,u),P||($*=g.ac(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}P&&(U=U.add(M.mult(P.x*$)).add(F.mult(P.y*$)));const W=e.x1*$,J=e.x2*$,re=(W+J)/2,q=e.y1*$,oe=e.y2*$,ue=(q+oe)/2,_e=[{offsetX:W,offsetY:q},{offsetX:re,offsetY:q},{offsetX:J,offsetY:q},{offsetX:J,offsetY:ue},{offsetX:J,offsetY:oe},{offsetX:re,offsetY:oe},{offsetX:W,offsetY:oe},{offsetX:W,offsetY:ue}];let Ce=[];for(const{offsetX:Ne,offsetY:He}of _e)Ce.push(new g.P(U.x+M.x*Ne+F.x*He,U.y+M.y*Ne+F.y*He));let Le=!1;if(d){const Ne=Ce.map((He=>this.projectAndGetPerspectiveRatio(l,He.x,He.y,u,I)));Le=Ne.some((He=>!He.isOccluded)),Ce=Ne.map((He=>He.point))}else Le=!0;return{box:g.ao(Ce),allPointsOccluded:!Le}}}function Mt(p,e,s){return e*(g.X/(p.tileSize*Math.pow(2,s-p.tileID.overscaledZ)))}class Hr{constructor(e,s,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Br{constructor(e,s,l,u,d){this.text=new Hr(e?e.text:null,s,l,d),this.icon=new Hr(e?e.icon:null,s,u,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ft{constructor(e,s,l){this.text=e,this.icon=s,this.skipFade=l}}class ar{constructor(){this.invProjMatrix=g.H(),this.viewportMatrix=g.H(),this.circles=[]}}class Ir{constructor(e,s,l,u,d){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=d}}class ni{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[e]}}function hi(p,e,s,l,u){const{horizontalAlign:d,verticalAlign:v}=g.au(p);return new g.P(-(d-.5)*e+l[0]*u,-(v-.5)*s+l[1]*u)}class Ai{constructor(e,s,l,u,d,v){this.transform=e.clone(),this.terrain=l,this.collisionIndex=new Qt(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new ni(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(l,u)=>s.getElevation(e,l,u):null}getBucketParts(e,s,l,u){const d=l.getBucket(s),v=l.latestFeatureIndex;if(!d||!v||s.id!==d.layerIds[0])return;const w=l.collisionBoxArray,S=d.layers[0].layout,I=d.layers[0].paint,P=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),M=l.tileSize/g.X,F=l.tileID.toUnwrapped(),N=this.transform.calculatePosMatrix(F),U=S.get("text-pitch-alignment")==="map",$=S.get("text-rotation-alignment")==="map",W=Mt(l,1,this.transform.zoom),J=this.collisionIndex.mapProjection.translatePosition(this.transform,l,I.get("text-translate"),I.get("text-translate-anchor")),re=this.collisionIndex.mapProjection.translatePosition(this.transform,l,I.get("icon-translate"),I.get("icon-translate-anchor")),q=ln(N,U,$,this.transform,W);let oe=null;if(U){const _e=zi(N,U,$,this.transform,W);oe=g.L([],this.transform.labelPlaneMatrix,_e)}this.retainedQueryData[d.bucketInstanceId]=new Ir(d.bucketInstanceId,v,d.sourceLayerIndex,d.index,l.tileID);const ue={bucket:d,layout:S,translationText:J,translationIcon:re,posMatrix:N,unwrappedTileID:F,textLabelPlaneMatrix:q,labelToScreenMatrix:oe,scale:P,textPixelRatio:M,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:g.ag(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(u)for(const _e of d.sortKeyRanges){const{sortKey:Ce,symbolInstanceStart:Le,symbolInstanceEnd:Ne}=_e;e.push({sortKey:Ce,symbolInstanceStart:Le,symbolInstanceEnd:Ne,parameters:ue})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(e,s,l,u,d,v,w,S,I,P,M,F,N,U,$,W,J,re,q){const oe=g.aq[e.textAnchor],ue=[e.textOffset0,e.textOffset1],_e=hi(oe,l,u,ue,d),Ce=this.collisionIndex.placeCollisionBox(s,F,S,I,P,w,v,W,M.predicate,q,_e);if((!re||this.collisionIndex.placeCollisionBox(re,F,S,I,P,w,v,J,M.predicate,q,_e).placeable)&&Ce.placeable){let Le;if(this.prevPlacement&&this.prevPlacement.variableOffsets[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID].text&&(Le=this.prevPlacement.variableOffsets[N.crossTileID].anchor),N.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[N.crossTileID]={textOffset:ue,width:l,height:u,anchor:oe,textBoxScale:d,prevAnchor:Le},this.markUsedJustification(U,oe,N,$),U.allowVerticalPlacement&&(this.markUsedOrientation(U,$,N),this.placedOrientations[N.crossTileID]=$),{shift:_e,placedGlyphBoxes:Ce}}}placeLayerBucketPart(e,s,l){const{bucket:u,layout:d,translationText:v,translationIcon:w,posMatrix:S,unwrappedTileID:I,textLabelPlaneMatrix:P,labelToScreenMatrix:M,textPixelRatio:F,holdingForFade:N,collisionBoxArray:U,partiallyEvaluatedTextSize:$,collisionGroup:W}=e.parameters,J=d.get("text-optional"),re=d.get("icon-optional"),q=g.ar(d,"text-overlap","text-allow-overlap"),oe=q==="always",ue=g.ar(d,"icon-overlap","icon-allow-overlap"),_e=ue==="always",Ce=d.get("text-rotation-alignment")==="map",Le=d.get("text-pitch-alignment")==="map",Ne=d.get("icon-text-fit")!=="none",He=d.get("symbol-z-order")==="viewport-y",Ve=oe&&(_e||!u.hasIconData()||re),Be=_e&&(oe||!u.hasTextData()||J);!u.collisionArrays&&U&&u.deserializeCollisionBoxes(U);const it=this._getTerrainElevationFunc(this.retainedQueryData[u.bucketInstanceId].tileID),bt=(Ue,Ze,wt)=>{var fr,Ct;if(s[Ue.crossTileID])return;if(N)return void(this.placements[Ue.crossTileID]=new Ft(!1,!1,!1));let Lt=!1,_r=!1,pi=!0,pn=null,yr={box:null,placeable:!1,offscreen:null},si={placeable:!1},Cr=null,qr=null,vi=null,Jn=0,Wi=0,Yn=0;Ze.textFeatureIndex?Jn=Ze.textFeatureIndex:Ue.useRuntimeCollisionCircles&&(Jn=Ue.featureIndex),Ze.verticalTextFeatureIndex&&(Wi=Ze.verticalTextFeatureIndex);const fo=Ze.textBox;if(fo){const Fi=Kr=>{let Dr=g.ah.horizontal;if(u.allowVerticalPlacement&&!Kr&&this.prevPlacement){const xi=this.prevPlacement.placedOrientations[Ue.crossTileID];xi&&(this.placedOrientations[Ue.crossTileID]=xi,Dr=xi,this.markUsedOrientation(u,Dr,Ue))}return Dr},mn=(Kr,Dr)=>{if(u.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&Ze.verticalTextBox){for(const xi of u.writingModes)if(xi===g.ah.vertical?(yr=Dr(),si=yr):yr=Kr(),yr&&yr.placeable)break}else yr=Kr()},Qn=Ue.textAnchorOffsetStartIndex,Mn=Ue.textAnchorOffsetEndIndex;if(Mn===Qn){const Kr=(Dr,xi)=>{const Bt=this.collisionIndex.placeCollisionBox(Dr,q,F,S,I,Le,Ce,v,W.predicate,it);return Bt&&Bt.placeable&&(this.markUsedOrientation(u,xi,Ue),this.placedOrientations[Ue.crossTileID]=xi),Bt};mn((()=>Kr(fo,g.ah.horizontal)),(()=>{const Dr=Ze.verticalTextBox;return u.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&Dr?Kr(Dr,g.ah.vertical):{box:null,offscreen:null}})),Fi(yr&&yr.placeable)}else{let Kr=g.aq[(Ct=(fr=this.prevPlacement)===null||fr===void 0?void 0:fr.variableOffsets[Ue.crossTileID])===null||Ct===void 0?void 0:Ct.anchor];const Dr=(Bt,gn,mo)=>{const es=Bt.x2-Bt.x1,Su=Bt.y2-Bt.y1,Tu=Ue.textBoxScale,Or=Ne&&ue==="never"?gn:null;let ts=null,Nl=q==="never"?1:2,ya="never";Kr&&Nl++;for(let go=0;go<Nl;go++){for(let va=Qn;va<Mn;va++){const xs=u.textAnchorOffsets.get(va);if(Kr&&xs.textAnchor!==Kr)continue;const vr=this.attemptAnchorPlacement(xs,Bt,es,Su,Tu,Ce,Le,F,S,I,W,ya,Ue,u,mo,v,w,Or,it);if(vr&&(ts=vr.placedGlyphBoxes,ts&&ts.placeable))return Lt=!0,pn=vr.shift,ts}Kr?Kr=null:ya=q}return l&&!ts&&(ts={box:this.collisionIndex.placeCollisionBox(fo,"always",F,S,I,Le,Ce,v,W.predicate,it,new g.P(0,0)).box,offscreen:!1,placeable:!1}),ts};mn((()=>Dr(fo,Ze.iconBox,g.ah.horizontal)),(()=>{const Bt=Ze.verticalTextBox;return u.allowVerticalPlacement&&(!yr||!yr.placeable)&&Ue.numVerticalGlyphVertices>0&&Bt?Dr(Bt,Ze.verticalIconBox,g.ah.vertical):{box:null,occluded:!0,offscreen:null}})),yr&&(Lt=yr.placeable,pi=yr.offscreen);const xi=Fi(yr&&yr.placeable);if(!Lt&&this.prevPlacement){const Bt=this.prevPlacement.variableOffsets[Ue.crossTileID];Bt&&(this.variableOffsets[Ue.crossTileID]=Bt,this.markUsedJustification(u,Bt.anchor,Ue,xi))}}}if(Cr=yr,Lt=Cr&&Cr.placeable,pi=Cr&&Cr.offscreen,Ue.useRuntimeCollisionCircles){const Fi=u.text.placedSymbolArray.get(Ue.centerJustifiedTextSymbolIndex),mn=g.ai(u.textSizeData,$,Fi),Qn=d.get("text-padding");qr=this.collisionIndex.placeCollisionCircles(q,Fi,u.lineVertexArray,u.glyphOffsetArray,mn,S,I,P,M,l,Le,W.predicate,Ue.collisionCircleDiameter,Qn,v,it),qr.circles.length&&qr.collisionDetected&&!l&&g.w("Collisions detected, but collision boxes are not shown"),Lt=oe||qr.circles.length>0&&!qr.collisionDetected,pi=pi&&qr.offscreen}if(Ze.iconFeatureIndex&&(Yn=Ze.iconFeatureIndex),Ze.iconBox){const Fi=mn=>this.collisionIndex.placeCollisionBox(mn,ue,F,S,I,Le,Ce,w,W.predicate,it,Ne&&pn?pn:void 0);si&&si.placeable&&Ze.verticalIconBox?(vi=Fi(Ze.verticalIconBox),_r=vi.placeable):(vi=Fi(Ze.iconBox),_r=vi.placeable),pi=pi&&vi.offscreen}const fn=J||Ue.numHorizontalGlyphVertices===0&&Ue.numVerticalGlyphVertices===0,Pn=re||Ue.numIconVertices===0;fn||Pn?Pn?fn||(_r=_r&&Lt):Lt=_r&&Lt:_r=Lt=_r&&Lt;const vs=_r&&vi.placeable;if(Lt&&Cr.placeable&&this.collisionIndex.insertCollisionBox(Cr.box,q,d.get("text-ignore-placement"),u.bucketInstanceId,si&&si.placeable&&Wi?Wi:Jn,W.ID),vs&&this.collisionIndex.insertCollisionBox(vi.box,ue,d.get("icon-ignore-placement"),u.bucketInstanceId,Yn,W.ID),qr&&Lt&&this.collisionIndex.insertCollisionCircles(qr.circles,q,d.get("text-ignore-placement"),u.bucketInstanceId,Jn,W.ID),l&&this.storeCollisionData(u.bucketInstanceId,wt,Ze,Cr,vi,qr),Ue.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ue.crossTileID]=new Ft(Lt||Ve,_r||Be,pi||u.justReloaded),s[Ue.crossTileID]=!0};if(He){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ue=u.getSortedSymbolIndexes(this.transform.angle);for(let Ze=Ue.length-1;Ze>=0;--Ze){const wt=Ue[Ze];bt(u.symbolInstances.get(wt),u.collisionArrays[wt],wt)}}else for(let Ue=e.symbolInstanceStart;Ue<e.symbolInstanceEnd;Ue++)bt(u.symbolInstances.get(Ue),u.collisionArrays[Ue],Ue);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const Ue=this.collisionCircleArrays[u.bucketInstanceId];g.as(Ue.invProjMatrix,S),Ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}storeCollisionData(e,s,l,u,d,v){if(l.textBox||l.iconBox){let w,S;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(s)?S=w.get(s):(S={text:null,icon:null},w.set(s,S)),l.textBox&&(S.text=u.box),l.iconBox&&(S.icon=d.box)}if(v){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=new ar);for(let S=0;S<v.circles.length;S+=4)w.circles.push(v.circles[S+0]),w.circles.push(v.circles[S+1]),w.circles.push(v.circles[S+2]),w.circles.push(v.collisionDetected?1:0)}}markUsedJustification(e,s,l,u){let d;d=u===g.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[g.at(s)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of v)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=d>=0&&w!==d?0:l.crossTileID)}markUsedOrientation(e,s,l){const u=s===g.ah.horizontal||s===g.ah.horizontalOnly?s:0,d=s===g.ah.vertical?s:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of v)e.text.placedSymbolArray.get(w).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(e):1,d=s?s.opacities:{},v=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const S in this.placements){const I=this.placements[S],P=d[S];P?(this.opacities[S]=new Br(P,u,I.text,I.icon),l=l||I.text!==P.text.placed||I.icon!==P.icon.placed):(this.opacities[S]=new Br(null,u,I.text,I.icon,I.skipFade),l=l||I.text||I.icon)}for(const S in d){const I=d[S];if(!this.opacities[S]){const P=new Br(I,u,!1,!1);P.isHidden()||(this.opacities[S]=P,l=l||I.text.placed||I.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const l={};for(const u of s){const d=u.getBucket(e);d&&u.latestFeatureIndex&&e.id===d.layerIds[0]&&this.updateBucketOpacities(d,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,s,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const d=e.layers[0],v=d.layout,w=new Br(null,0,!1,!1,!0),S=v.get("text-allow-overlap"),I=v.get("icon-allow-overlap"),P=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=v.get("text-rotation-alignment")==="map",F=v.get("text-pitch-alignment")==="map",N=v.get("icon-text-fit")!=="none",U=new Br(null,0,S&&(I||!e.hasIconData()||v.get("icon-optional")),I&&(S||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const $=(J,re,q)=>{for(let oe=0;oe<re/4;oe++)J.opacityVertexArray.emplaceBack(q);J.hasVisibleVertices=J.hasVisibleVertices||q!==Di},W=this.collisionBoxArrays.get(e.bucketInstanceId);for(let J=0;J<e.symbolInstances.length;J++){const re=e.symbolInstances.get(J),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:oe,crossTileID:ue}=re;let _e=this.opacities[ue];l[ue]?_e=w:_e||(_e=U,this.opacities[ue]=_e),l[ue]=!0;const Ce=re.numIconVertices>0,Le=this.placedOrientations[re.crossTileID],Ne=Le===g.ah.vertical,He=Le===g.ah.horizontal||Le===g.ah.horizontalOnly;if(q>0||oe>0){const Be=ki(_e.text);$(e.text,q,Ne?Di:Be),$(e.text,oe,He?Di:Be);const it=_e.text.isHidden();[re.rightJustifiedTextSymbolIndex,re.centerJustifiedTextSymbolIndex,re.leftJustifiedTextSymbolIndex].forEach((Ze=>{Ze>=0&&(e.text.placedSymbolArray.get(Ze).hidden=it||Ne?1:0)})),re.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(re.verticalPlacedTextSymbolIndex).hidden=it||He?1:0);const bt=this.variableOffsets[re.crossTileID];bt&&this.markUsedJustification(e,bt.anchor,re,Le);const Ue=this.placedOrientations[re.crossTileID];Ue&&(this.markUsedJustification(e,"left",re,Ue),this.markUsedOrientation(e,Ue,re))}if(Ce){const Be=ki(_e.icon),it=!(N&&re.verticalPlacedIconSymbolIndex&&Ne);re.placedIconSymbolIndex>=0&&($(e.icon,re.numIconVertices,it?Be:Di),e.icon.placedSymbolArray.get(re.placedIconSymbolIndex).hidden=_e.icon.isHidden()),re.verticalPlacedIconSymbolIndex>=0&&($(e.icon,re.numVerticalIconVertices,it?Di:Be),e.icon.placedSymbolArray.get(re.verticalPlacedIconSymbolIndex).hidden=_e.icon.isHidden())}const Ve=W&&W.has(J)?W.get(J):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Be=e.collisionArrays[J];if(Be){let it=new g.P(0,0);if(Be.textBox||Be.verticalTextBox){let bt=!0;if(P){const Ue=this.variableOffsets[ue];Ue?(it=hi(Ue.anchor,Ue.width,Ue.height,Ue.textOffset,Ue.textBoxScale),M&&it._rotate(F?this.transform.angle:-this.transform.angle)):bt=!1}if(Be.textBox||Be.verticalTextBox){let Ue;Be.textBox&&(Ue=Ne),Be.verticalTextBox&&(Ue=He),Ko(e.textCollisionBox.collisionVertexArray,_e.text.placed,!bt||Ue,Ve.text,it.x,it.y)}}if(Be.iconBox||Be.verticalIconBox){const bt=!!(!He&&Be.verticalIconBox);let Ue;Be.iconBox&&(Ue=bt),Be.verticalIconBox&&(Ue=!bt),Ko(e.iconCollisionBox.collisionVertexArray,_e.icon.placed,Ue,Ve.icon,N?it.x:0,N?it.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=J.invProjMatrix,e.placementViewportMatrix=J.viewportMatrix,e.collisionCircleArray=J.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function Ko(p,e,s,l,u,d){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-Et,w=l[1]-Et,S=l[2]-Et,I=l[3]-Et;p.emplaceBack(e?1:0,s?1:0,u||0,d||0,v,w),p.emplaceBack(e?1:0,s?1:0,u||0,d||0,S,w),p.emplaceBack(e?1:0,s?1:0,u||0,d||0,S,I),p.emplaceBack(e?1:0,s?1:0,u||0,d||0,v,I)}const kt=Math.pow(2,25),Ql=Math.pow(2,24),Ra=Math.pow(2,17),ji=Math.pow(2,16),Ti=Math.pow(2,9),ih=Math.pow(2,8),un=Math.pow(2,1);function ki(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const e=p.placed?1:0,s=Math.floor(127*p.opacity);return s*kt+e*Ql+s*Ra+e*ji+s*Ti+e*ih+s*un+e}const Di=0;function To(){return{isOccluded:(p,e,s)=>!1,getPitchedTextCorrection:(p,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(p,e,s,l){throw new Error("Not implemented.")},translatePosition:(p,e,s,l)=>(function(u,d,v,w,S=!1){if(!v[0]&&!v[1])return[0,0];const I=S?w==="map"?u.angle:0:w==="viewport"?-u.angle:0;if(I){const P=Math.sin(I),M=Math.cos(I);v=[v[0]*M-v[1]*P,v[0]*P+v[1]*M]}return[S?v[0]:Mt(d,v[0],u.zoom),S?v[1]:Mt(d,v[1],u.zoom)]})(p,e,s,l),getCircleRadiusCorrection:p=>1}}class pr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,l,u,d){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(v,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort(((w,S)=>w.sortKey-S.sortKey)));this._currentPartIndex<v.length;)if(s.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,d())return!0;return!1}}class Fa{constructor(e,s,l,u,d,v,w,S){this.placement=new Ai(e,To(),s,v,w,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(e,s,l){const u=ke.now(),d=()=>!this._forceFullPlacement&&ke.now()-u>2;for(;this._currentPlacementIndex>=0;){const v=s[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new pr(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const $n=512/g.X/2;class Wr{constructor(e,s,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let d=0;d<s.length;d++){const v=s.get(d),w=v.key,S=u.get(w);S?S.push(v):u.set(w,[v])}for(const[d,v]of u){const w={positions:v.map((S=>({x:Math.floor(S.anchorX*$n),y:Math.floor(S.anchorY*$n)}))),crossTileIDs:v.map((S=>S.crossTileID))};if(w.positions.length>128){const S=new g.av(w.positions.length,16,Uint16Array);for(const{x:I,y:P}of w.positions)S.add(I,P);S.finish(),delete w.positions,w.index=S}this._symbolsByKey[d]=w}}getScaledCoordinates(e,s){const{x:l,y:u,z:d}=this.tileID.canonical,{x:v,y:w,z:S}=s.canonical,I=$n/Math.pow(2,S-d),P=(w*g.X+e.anchorY)*I,M=u*g.X*$n;return{x:Math.floor((v*g.X+e.anchorX)*I-l*g.X*$n),y:Math.floor(P-M)}}findMatches(e,s,l){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let d=0;d<e.length;d++){const v=e.get(d);if(v.crossTileID)continue;const w=this._symbolsByKey[v.key];if(!w)continue;const S=this.getScaledCoordinates(v,s);if(w.index){const I=w.index.range(S.x-u,S.y-u,S.x+u,S.y+u).sort();for(const P of I){const M=w.crossTileIDs[P];if(!l[M]){l[M]=!0,v.crossTileID=M;break}}}else if(w.positions)for(let I=0;I<w.positions.length;I++){const P=w.positions[I],M=w.crossTileIDs[I];if(Math.abs(P.x-S.x)<=u&&Math.abs(P.y-S.y)<=u&&!l[M]){l[M]=!0,v.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class ko{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ui{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const l in this.indexes){const u=this.indexes[l],d={};for(const v in u){const w=u[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),d[w.tileID.key]=w}this.indexes[l]=d}this.lng=e}addBucket(e,s,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let d=0;d<s.symbolInstances.length;d++)s.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const d in this.indexes){const v=this.indexes[d];if(Number(d)>e.overscaledZ)for(const w in v){const S=v[w];S.tileID.isChildOf(e)&&S.findMatches(s.symbolInstances,e,u)}else{const w=v[e.scaledTo(Number(d)).key];w&&w.findMatches(s.symbolInstances,e,u)}}for(let d=0;d<s.symbolInstances.length;d++){const v=s.symbolInstances.get(d);v.crossTileID||(v.crossTileID=l.generate(),u[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Wr(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const l of s.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let s=!1;for(const l in this.indexes){const u=this.indexes[l];for(const d in u)e[u[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[d]),delete u[d],s=!0)}return s}}class Io{constructor(){this.layerIndexes={},this.crossTileIDs=new ko,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new Ui);let d=!1;const v={};u.handleWrapJump(l);for(const w of s){const S=w.getBucket(e);S&&e.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(w.tileID,S,this.crossTileIDs)&&(d=!0),v[S.bucketInstanceId]=!0)}return u.removeStaleBuckets(v)&&(d=!0),d}pruneUnusedLayers(e){const s={};e.forEach((l=>{s[l]=!0}));for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const $i=(p,e)=>g.t(p,e&&e.filter((s=>s.identifier!=="source.canvas"))),nh=g.aw();class gl extends g.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new ri(dr(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((l,u)=>this.getGlyphs(l,u))),this.dispatcher.registerMessageHandler("GI",((l,u)=>this.getImages(l,u))),this.imageManager=new mr,this.imageManager.setEventedParent(this),this.glyphManager=new or(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new zt(256,512),this.crossTileSymbolIndex=new Io,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new g.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",g.ay()),Vi().on(Re,this._rtlPluginLoaded),this.on("data",(l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const d=u.getSource();if(d&&d.vectorLayerIds)for(const v in this._layers){const w=this._layers[v];w.source===d.id&&this._validateLayer(w)}}))}loadURL(e,s={},l){this.fire(new g.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const d=this._loadStyleRequest;g.h(u,this._loadStyleRequest).then((v=>{this._loadStyleRequest=null,this._load(v.data,s,l)})).catch((v=>{this._loadStyleRequest=null,v&&!d.signal.aborted&&this.fire(new g.j(v))}))}loadJSON(e,s={},l){this.fire(new g.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ke.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,l)})).catch((()=>{}))}loadEmpty(){this.fire(new g.k("dataloading",{dataType:"style"})),this._load(nh,{validate:!1})}_load(e,s,l){var u;const d=s.transformStyle?s.transformStyle(l,e):e;if(!s.validate||!$i(this,g.u(d))){this._loaded=!0,this.stylesheet=d;for(const v in d.sources)this.addSource(v,d.sources[v],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs),this._createLayers(),this.light=new rt(this.stylesheet.light),this.sky=new Me(this.stylesheet.sky),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new g.k("data",{dataType:"style"})),this.fire(new g.k("style.load"))}}_createLayers(){const e=g.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((s=>s.id)),this._layers={},this._serializedLayers=null;for(const s of e){const l=g.aA(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(e,s=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(d,v,w,S){return g._(this,void 0,void 0,(function*(){const I=gi(d),P=w>1?"@2x":"",M={},F={};for(const{id:N,url:U}of I){const $=v.transformRequest(nn(U,P,".json"),"SpriteJSON");M[N]=g.h($,S);const W=v.transformRequest(nn(U,P,".png"),"SpriteImage");F[N]=Xt.getImage(W,S)}return yield Promise.all([...Object.values(M),...Object.values(F)]),(function(N,U){return g._(this,void 0,void 0,(function*(){const $={};for(const W in N){$[W]={};const J=ke.getImageCanvasContext((yield U[W]).data),re=(yield N[W]).data;for(const q in re){const{width:oe,height:ue,x:_e,y:Ce,sdf:Le,pixelRatio:Ne,stretchX:He,stretchY:Ve,content:Be,textFitWidth:it,textFitHeight:bt}=re[q];$[W][q]={data:null,pixelRatio:Ne,sdf:Le,stretchX:He,stretchY:Ve,content:Be,textFitWidth:it,textFitHeight:bt,spriteData:{width:oe,height:ue,x:_e,y:Ce,context:J}}}}return $}))})(M,F)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((d=>{if(this._spriteRequest=null,d)for(const v in d){this._spritesImagesIds[v]=[];const w=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter((S=>!(S in d))):[];for(const S of w)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in d[v]){const I=v==="default"?S:`${v}:${S}`;this._spritesImagesIds[v].push(I),I in this.imageManager.images?this.imageManager.updateImage(I,d[v][S],!1):this.imageManager.addImage(I,d[v][S]),s&&(this._changedImages[I]=!0)}}})).catch((d=>{this._spriteRequest=null,u=d,this.fire(new g.j(u))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new g.k("data",{dataType:"style"})),l&&l(u)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new g.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const l=e.sourceLayer;if(!l)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new g.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?g.aB(l):l);const u=[];for(const d of e)if(l[d]){const v=s?g.aB(l[d]):l[d];u.push(v)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const u=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(u.length||d.length)&&this._updateWorkerLayers(u,d);for(const v in this._updatedSources){const w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const d=this.sourceCaches[u];l[u]=d.used,d.used=!1}for(const u of this._order){const d=this._layers[u];d.recalculate(e,this._availableImages),!d.isHidden(e.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const u in l){const d=this.sourceCaches[u];!!l[u]!=!!d.used&&d.fire(new g.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new g.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var l;this._checkLoaded();const u=this.serialize();if(e=s.transformStyle?s.transformStyle(u,e):e,((l=s.validate)===null||l===void 0||l)&&$i(this,g.u(e)))return!1;(e=g.aB(e)).layers=g.az(e.layers);const d=g.aC(u,e),v=this._getOperationsToPerform(d);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const w of v.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push((()=>this.addLayer.apply(this,u.args)));break;case"removeLayer":s.push((()=>this.removeLayer.apply(this,u.args)));break;case"setPaintProperty":s.push((()=>this.setPaintProperty.apply(this,u.args)));break;case"setLayoutProperty":s.push((()=>this.setLayoutProperty.apply(this,u.args)));break;case"setFilter":s.push((()=>this.setFilter.apply(this,u.args)));break;case"addSource":s.push((()=>this.addSource.apply(this,u.args)));break;case"removeSource":s.push((()=>this.removeSource.apply(this,u.args)));break;case"setLayerZoomRange":s.push((()=>this.setLayerZoomRange.apply(this,u.args)));break;case"setLight":s.push((()=>this.setLight.apply(this,u.args)));break;case"setGeoJSONSourceData":s.push((()=>this.setGeoJSONSourceData.apply(this,u.args)));break;case"setGlyphs":s.push((()=>this.setGlyphs.apply(this,u.args)));break;case"setSprite":s.push((()=>this.setSprite.apply(this,u.args)));break;case"setSky":s.push((()=>this.setSky.apply(this,u.args)));break;case"setTerrain":s.push((()=>this.map.setTerrain.apply(this,u.args)));break;case"setTransition":s.push((()=>{}));break;default:l.push(u.command)}return{operations:s,unimplemented:l}}addImage(e,s){if(this.getImage(e))return this.fire(new g.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new g.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new g.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(g.u.source,`sources.${e}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[e]=new xt(e,s,this.dispatcher);u.style=this,u.setEventedParent(this,(()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e}))),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new g.j(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new g.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new g.j(new Error(`Layer "${u}" already exists on this map.`)));let d;if(e.type==="custom"){if($i(this,g.aD(e)))return;d=g.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=g.aB(e),e=g.e(e,{source:u})),this._validate(g.u.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;d=g.aA(e),this._validateLayer(d),d.setEventedParent(this,{layer:{id:u}})}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)this.fire(new g.j(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(v,0,u),this._layerOrderChanged=!0,this._layers[u]=d,this._removedLayers[u]&&d.source&&d.type!=="custom"){const w=this._removedLayers[u];delete this._removedLayers[u],w.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new g.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new g.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new g.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===s&&u.maxzoom===l||(s!=null&&(u.minzoom=s),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new g.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!g.aE(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(g.u.filter,`layers.${u.id}.filter`,s,null,l)||(u.filter=g.aB(s),this._updateLayer(u)))}else this.fire(new g.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return g.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,l,u={}){this._checkLoaded();const d=this.getLayer(e);d?g.aE(d.getLayoutProperty(s),l)||(d.setLayoutProperty(s,l,u),this._updateLayer(d)):this.fire(new g.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const l=this.getLayer(e);if(l)return l.getLayoutProperty(s);this.fire(new g.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,l,u={}){this._checkLoaded();const d=this.getLayer(e);d?g.aE(d.getPaintProperty(s),l)||(d.setPaintProperty(s,l,u)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new g.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const l=e.source,u=e.sourceLayer,d=this.sourceCaches[l];if(d===void 0)return void this.fire(new g.j(new Error(`The source '${l}' does not exist in the map's style.`)));const v=d.getSource().type;v==="geojson"&&u?this.fire(new g.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||u?(e.id===void 0&&this.fire(new g.j(new Error("The feature id parameter must be provided."))),d.setFeatureState(u,e.id,s)):this.fire(new g.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new g.j(new Error(`The source '${l}' does not exist in the map's style.`)));const d=u.getSource().type,v=d==="vector"?e.sourceLayer:void 0;d!=="vector"||v?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new g.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(v,e.id,s):this.fire(new g.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,l=e.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new g.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new g.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new g.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return g.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=g.aF(this.sourceCaches,(d=>d.serialize())),s=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return g.aG({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:e,layers:s,terrain:l},(d=>d!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=v=>this._layers[v].type==="fill-extrusion",l={},u=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w)){l[w]=v;for(const S of e){const I=S[w];if(I)for(const P of I)u.push(P)}}}u.sort(((v,w)=>w.intersectionZ-v.intersectionZ));const d=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w))for(let S=u.length-1;S>=0;S--){const I=u[S].feature;if(l[I.layer.id]<v)break;d.push(I),u.pop()}else for(const S of e){const I=S[w];if(I)for(const P of I)d.push(P.feature)}}return d}queryRenderedFeatures(e,s,l){s&&s.filter&&this._validate(g.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new g.j(new Error("parameters.layers must be an Array."))),[];for(const w of s.layers){const S=this._layers[w];if(!S)return this.fire(new g.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];u[S.source]=!0}}const d=[];s.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const w in this.sourceCaches)s.layers&&!u[w]||d.push(Vn(this.sourceCaches[w],this._layers,v,e,s,l));return this.placement&&d.push((function(w,S,I,P,M,F,N){const U={},$=F.queryRenderedSymbols(P),W=[];for(const J of Object.keys($).map(Number))W.push(N[J]);W.sort(us);for(const J of W){const re=J.featureIndex.lookupSymbolFeatures($[J.bucketInstanceId],S,J.bucketIndex,J.sourceLayerIndex,M.filter,M.layers,M.availableImages,w);for(const q in re){const oe=U[q]=U[q]||[],ue=re[q];ue.sort(((_e,Ce)=>{const Le=J.featureSortOrder;if(Le){const Ne=Le.indexOf(_e.featureIndex);return Le.indexOf(Ce.featureIndex)-Ne}return Ce.featureIndex-_e.featureIndex}));for(const _e of ue)oe.push(_e)}}for(const J in U)U[J].forEach((re=>{const q=re.feature,oe=I[w[J].source].getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=oe}));return U})(this._layers,v,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(e,s){s&&s.filter&&this._validate(g.u.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[e];return l?(function(u,d){const v=u.getRenderableIds().map((I=>u.getTileByID(I))),w=[],S={};for(let I=0;I<v.length;I++){const P=v[I],M=P.tileID.canonical.key;S[M]||(S[M]=!0,P.querySourceFeatures(w,d))}return w})(l,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const v in e)if(!g.aE(e[v],l[v])){u=!0;break}if(!u)return;const d={now:ke.now(),transition:g.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(d)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const v in e)if(!g.aE(e[v],l[v])){u=!0;break}if(!u)return;const d={now:ke.now(),transition:g.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(d)}_validate(e,s,l,u,d={}){return(!d||d.validate!==!1)&&$i(this,e.call(g.u,g.e({key:s,style:this.serialize(),value:l,styleSpec:g.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Vi().off(Re,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,l,u,d=!1){let v=!1,w=!1;const S={};for(const I of this._order){const P=this._layers[I];if(P.type!=="symbol")continue;if(!S[P.source]){const F=this.sourceCaches[P.source];S[P.source]=F.getRenderableIds(!0).map((N=>F.getTileByID(N))).sort(((N,U)=>U.tileID.overscaledZ-N.tileID.overscaledZ||(N.tileID.isLessThan(U.tileID)?-1:1)))}const M=this.crossTileSymbolIndex.addLayer(P,S[P.source],e.center.lng);v=v||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ke.now(),e.zoom))&&(this.pauseablePlacement=new Fa(e,this.map.terrain,this._order,d,s,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ke.now()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(const I of this._order){const P=this._layers[I];P.type==="symbol"&&this.placement.updateLayerOpacities(P,S[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ke.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return g._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,s.icons),l}))}getGlyphs(e,s){return g._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(g.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,l={},u){this._checkLoaded();const d=[{id:e,url:s}],v=[...gi(this.stylesheet.sprite),...d];this._validate(g.u.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(d,!0,u))}removeSprite(e){this._checkLoaded();const s=gi(this.stylesheet.sprite);if(s.find((l=>l.id===e))){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex((l=>l.id===e)),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new g.k("data",{dataType:"style"}))}else this.fire(new g.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return gi(this.stylesheet.sprite)}setSprite(e,s={},l){this._checkLoaded(),e&&this._validate(g.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var Is=g.Y([{name:"a_pos",type:"Int16",components:2}]);const Es={prelude:er(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:er(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:er(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:er(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:er("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:er(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:er(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:er("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:er("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:er("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:er(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:er(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:er(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:er(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:er(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:er(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:er(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:er(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:er(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:er(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:er(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:er(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:er(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:er(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:er(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:er(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:er("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:er("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:er("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:er("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function er(p,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/attribute ([\w]+) ([\w]+)/g),u=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=d?d.concat(u):u,w={};return{fragmentSource:p=p.replace(s,((S,I,P,M,F)=>(w[F]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${P} ${M} ${F};
#else
uniform ${P} ${M} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${P} ${M} ${F} = u_${F};
#endif
`))),vertexSource:e=e.replace(s,((S,I,P,M,F)=>{const N=M==="float"?"vec2":"vec4",U=F.match(/color/)?"color":N;return w[F]?I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${P} ${N} a_${F};
varying ${P} ${M} ${F};
#else
uniform ${P} ${M} u_${F};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${P} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${U}(a_${F}, u_${F}_t);
#else
    ${P} ${M} ${F} = u_${F};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${P} ${N} a_${F};
#else
uniform ${P} ${M} u_${F};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${P} ${M} ${F} = a_${F};
#else
    ${P} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${P} ${M} ${F} = unpack_mix_${U}(a_${F}, u_${F}_t);
#else
    ${P} ${M} ${F} = u_${F};
#endif
`})),staticAttributes:l,staticUniforms:v}}class Eo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,l,u,d,v,w,S,I){this.context=e;let P=this.boundPaintVertexBuffers.length!==u.length;for(let M=0;!P&&M<u.length;M++)this.boundPaintVertexBuffers[M]!==u[M]&&(P=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||P||this.boundIndexBuffer!==d||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==I?this.freshBind(s,l,u,d,v,w,S,I):(e.bindVertexArray.set(this.vao),w&&w.bind(),d&&d.dynamicDraw&&d.bind(),S&&S.bind(),I&&I.bind())}freshBind(e,s,l,u,d,v,w,S){const I=e.numAttributes,P=this.context,M=P.gl;this.vao&&this.destroy(),this.vao=P.createVertexArray(),P.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=S,s.enableAttributes(M,e);for(const F of l)F.enableAttributes(M,e);v&&v.enableAttributes(M,e),w&&w.enableAttributes(M,e),S&&S.enableAttributes(M,e),s.bind(),s.setVertexAttribPointers(M,e,d);for(const F of l)F.bind(),F.setVertexAttribPointers(M,e,d);v&&(v.bind(),v.setVertexAttribPointers(M,e,d)),u&&u.bind(),w&&(w.bind(),w.setVertexAttribPointers(M,e,d)),S&&(S.bind(),S.setVertexAttribPointers(M,e,d)),P.currentNumAttributes=I}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const eu=(p,e,s,l,u)=>({u_matrix:p,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:l?l.properties.get("fog-color"):g.aM.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:l?l.calculateFogBlendOpacity(u):0,u_horizon_color:l?l.properties.get("horizon-color"):g.aM.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1});function eo(p){const e=[];for(let s=0;s<p.length;s++){if(p[s]===null)continue;const l=p[s].split(" ");e.push(l.pop())}return e}class lr{constructor(e,s,l,u,d,v){const w=e.gl;this.program=w.createProgram();const S=eo(s.staticAttributes),I=l?l.getBinderAttributes():[],P=S.concat(I),M=Es.prelude.staticUniforms?eo(Es.prelude.staticUniforms):[],F=s.staticUniforms?eo(s.staticUniforms):[],N=l?l.getBinderUniforms():[],U=M.concat(F).concat(N),$=[];for(const _e of U)$.indexOf(_e)<0&&$.push(_e);const W=l?l.defines():[];d&&W.push("#define OVERDRAW_INSPECTOR;"),v&&W.push("#define TERRAIN3D;");const J=W.concat(Es.prelude.fragmentSource,s.fragmentSource).join(`
`),re=W.concat(Es.prelude.vertexSource,s.vertexSource).join(`
`),q=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(q,J),w.compileShader(q),!w.getShaderParameter(q,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(q)}`);w.attachShader(this.program,q);const oe=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(oe,re),w.compileShader(oe),!w.getShaderParameter(oe,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(oe)}`);w.attachShader(this.program,oe),this.attributes={};const ue={};this.numAttributes=P.length;for(let _e=0;_e<this.numAttributes;_e++)P[_e]&&(w.bindAttribLocation(this.program,_e,P[_e]),this.attributes[P[_e]]=_e);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(oe),w.deleteShader(q);for(let _e=0;_e<$.length;_e++){const Ce=$[_e];if(Ce&&!ue[Ce]){const Le=w.getUniformLocation(this.program,Ce);Le&&(ue[Ce]=Le)}}this.fixedUniforms=u(e,ue),this.terrainUniforms=((_e,Ce)=>({u_depth:new g.aH(_e,Ce.u_depth),u_terrain:new g.aH(_e,Ce.u_terrain),u_terrain_dim:new g.aI(_e,Ce.u_terrain_dim),u_terrain_matrix:new g.aJ(_e,Ce.u_terrain_matrix),u_terrain_unpack:new g.aK(_e,Ce.u_terrain_unpack),u_terrain_exaggeration:new g.aI(_e,Ce.u_terrain_exaggeration)}))(e,ue),this.binderUniforms=l?l.getUniforms(e,ue):[]}draw(e,s,l,u,d,v,w,S,I,P,M,F,N,U,$,W,J,re){const q=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(d),e.setCullFace(v),S){e.activeTexture.set(q.TEXTURE2),q.bindTexture(q.TEXTURE_2D,S.depthTexture),e.activeTexture.set(q.TEXTURE3),q.bindTexture(q.TEXTURE_2D,S.texture);for(const ue in this.terrainUniforms)this.terrainUniforms[ue].set(S[ue])}for(const ue in this.fixedUniforms)this.fixedUniforms[ue].set(w[ue]);$&&$.setUniforms(e,this.binderUniforms,N,{zoom:U});let oe=0;switch(s){case q.LINES:oe=2;break;case q.TRIANGLES:oe=3;break;case q.LINE_STRIP:oe=1}for(const ue of F.get()){const _e=ue.vaos||(ue.vaos={});(_e[I]||(_e[I]=new Eo)).bind(e,this,P,$?$.getPaintVertexBuffers():[],M,ue.vertexOffset,W,J,re),q.drawElements(s,ue.primitiveLength*oe,q.UNSIGNED_SHORT,ue.primitiveOffset*oe*2)}}}function Ba(p,e,s){const l=1/Mt(s,1,e.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),d=s.tileSize*Math.pow(2,e.transform.tileZoom)/u,v=d*(s.tileID.canonical.x+s.tileID.wrap*u),w=d*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const Jo=(p,e,s,l)=>{const u=e.style.light,d=u.properties.get("position"),v=[d.x,d.y,d.z],w=(function(){var I=new g.A(9);return g.A!=Float32Array&&(I[1]=0,I[2]=0,I[3]=0,I[5]=0,I[6]=0,I[7]=0),I[0]=1,I[4]=1,I[8]=1,I})();u.properties.get("anchor")==="viewport"&&(function(I,P){var M=Math.sin(P),F=Math.cos(P);I[0]=F,I[1]=M,I[2]=0,I[3]=-M,I[4]=F,I[5]=0,I[6]=0,I[7]=0,I[8]=1})(w,-e.transform.angle),(function(I,P,M){var F=P[0],N=P[1],U=P[2];I[0]=F*M[0]+N*M[3]+U*M[6],I[1]=F*M[1]+N*M[4]+U*M[7],I[2]=F*M[2]+N*M[5]+U*M[8]})(v,v,w);const S=u.properties.get("color");return{u_matrix:p,u_lightpos:v,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+s,u_opacity:l}},Yo=(p,e,s,l,u,d,v)=>g.e(Jo(p,e,s,l),Ba(d,e,v),{u_height_factor:-Math.pow(2,u.overscaledZ)/v.tileSize/8}),Co=p=>({u_matrix:p}),tu=(p,e,s,l)=>g.e(Co(p),Ba(s,e,l)),nc=(p,e)=>({u_matrix:p,u_world:e}),_l=(p,e,s,l,u)=>g.e(tu(p,e,s,l),{u_world:u}),yl=(p,e,s,l)=>{const u=p.transform;let d,v;if(l.paint.get("circle-pitch-alignment")==="map"){const w=Mt(s,1,u.zoom);d=!0,v=[w,w]}else d=!1,v=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(e.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:v}},Zi=(p,e,s)=>({u_matrix:p,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),Sn=(p,e,s=1)=>({u_matrix:p,u_color:e,u_overlay:0,u_overlay_scale:s}),Xr=p=>({u_matrix:p}),di=(p,e,s,l)=>({u_matrix:p,u_extrude_scale:Mt(e,1,s),u_intensity:l}),to=(p,e,s,l)=>{const u=g.H();g.aP(u,0,p.width,p.height,0,0,1);const d=p.context.gl;return{u_matrix:u,u_world:[d.drawingBufferWidth,d.drawingBufferHeight],u_image:s,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}};function Zn(p,e){const s=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new g.Z(0,l/s).toLngLat().lat,new g.Z(0,(l+1)/s).toLngLat().lat]}const vl=(p,e,s,l)=>{const u=p.transform;return{u_matrix:Oa(p,e,s,l),u_ratio:1/Mt(e,1,u.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},ru=(p,e,s,l,u)=>g.e(vl(p,e,s,u),{u_image:0,u_image_height:l}),ps=(p,e,s,l,u)=>{const d=p.transform,v=iu(e,d);return{u_matrix:Oa(p,e,s,u),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Mt(e,1,d.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},sh=(p,e,s,l,u,d)=>{const v=p.lineAtlas,w=iu(e,p.transform),S=s.layout.get("line-cap")==="round",I=v.getDash(l.from,S),P=v.getDash(l.to,S),M=I.width*u.fromScale,F=P.width*u.toScale;return g.e(vl(p,e,s,d),{u_patternscale_a:[w/M,-I.height/2],u_patternscale_b:[w/F,-P.height/2],u_sdfgamma:v.width/(256*Math.min(M,F)*p.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:P.y,u_mix:u.t})};function iu(p,e){return 1/Mt(p,1,e.tileZoom)}function Oa(p,e,s,l){return p.translatePosMatrix(l?l.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const sc=(p,e,s,l,u)=>{return{u_matrix:p,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(d=u.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:oh(u.paint.get("raster-hue-rotate"))};var d,v};function oh(p){p*=Math.PI/180;const e=Math.sin(p),s=Math.cos(p);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const Qo=(p,e,s,l,u,d,v,w,S,I,P,M,F,N)=>{const U=v.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:U.cameraToCenterDistance,u_pitch:U.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:U.width/U.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+M,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:d,u_texsize:F,u_texture:0,u_translation:P,u_pitched_scale:N}},Cs=(p,e,s,l,u,d,v,w,S,I,P,M,F,N,U)=>{const $=v.transform;return g.e(Qo(p,e,s,l,u,d,v,w,S,I,P,M,F,U),{u_gamma_scale:l?Math.cos($._pitch)*$.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},ro=(p,e,s,l,u,d,v,w,S,I,P,M,F,N)=>g.e(Cs(p,e,s,l,u,d,v,w,S,I,P,!0,M,!0,N),{u_texsize_icon:F,u_texture_icon:1}),Po=(p,e,s)=>({u_matrix:p,u_opacity:e,u_color:s}),nu=(p,e,s,l,u,d)=>g.e((function(v,w,S,I){const P=S.imageManager.getPattern(v.from.toString()),M=S.imageManager.getPattern(v.to.toString()),{width:F,height:N}=S.imageManager.getPixelSize(),U=Math.pow(2,I.tileID.overscaledZ),$=I.tileSize*Math.pow(2,S.transform.tileZoom)/U,W=$*(I.tileID.canonical.x+I.tileID.wrap*U),J=$*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[F,N],u_mix:w.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/Mt(I,1,S.transform.tileZoom),u_pixel_coord_upper:[W>>16,J>>16],u_pixel_coord_lower:[65535&W,65535&J]}})(l,d,s,u),{u_matrix:p,u_opacity:e}),su={fillExtrusion:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_lightpos:new g.aN(p,e.u_lightpos),u_lightintensity:new g.aI(p,e.u_lightintensity),u_lightcolor:new g.aN(p,e.u_lightcolor),u_vertical_gradient:new g.aI(p,e.u_vertical_gradient),u_opacity:new g.aI(p,e.u_opacity)}),fillExtrusionPattern:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_lightpos:new g.aN(p,e.u_lightpos),u_lightintensity:new g.aI(p,e.u_lightintensity),u_lightcolor:new g.aN(p,e.u_lightcolor),u_vertical_gradient:new g.aI(p,e.u_vertical_gradient),u_height_factor:new g.aI(p,e.u_height_factor),u_image:new g.aH(p,e.u_image),u_texsize:new g.aO(p,e.u_texsize),u_pixel_coord_upper:new g.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new g.aO(p,e.u_pixel_coord_lower),u_scale:new g.aN(p,e.u_scale),u_fade:new g.aI(p,e.u_fade),u_opacity:new g.aI(p,e.u_opacity)}),fill:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix)}),fillPattern:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_image:new g.aH(p,e.u_image),u_texsize:new g.aO(p,e.u_texsize),u_pixel_coord_upper:new g.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new g.aO(p,e.u_pixel_coord_lower),u_scale:new g.aN(p,e.u_scale),u_fade:new g.aI(p,e.u_fade)}),fillOutline:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_world:new g.aO(p,e.u_world)}),fillOutlinePattern:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_world:new g.aO(p,e.u_world),u_image:new g.aH(p,e.u_image),u_texsize:new g.aO(p,e.u_texsize),u_pixel_coord_upper:new g.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new g.aO(p,e.u_pixel_coord_lower),u_scale:new g.aN(p,e.u_scale),u_fade:new g.aI(p,e.u_fade)}),circle:(p,e)=>({u_camera_to_center_distance:new g.aI(p,e.u_camera_to_center_distance),u_scale_with_map:new g.aH(p,e.u_scale_with_map),u_pitch_with_map:new g.aH(p,e.u_pitch_with_map),u_extrude_scale:new g.aO(p,e.u_extrude_scale),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_matrix:new g.aJ(p,e.u_matrix)}),collisionBox:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_pixel_extrude_scale:new g.aO(p,e.u_pixel_extrude_scale)}),collisionCircle:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_inv_matrix:new g.aJ(p,e.u_inv_matrix),u_camera_to_center_distance:new g.aI(p,e.u_camera_to_center_distance),u_viewport_size:new g.aO(p,e.u_viewport_size)}),debug:(p,e)=>({u_color:new g.aL(p,e.u_color),u_matrix:new g.aJ(p,e.u_matrix),u_overlay:new g.aH(p,e.u_overlay),u_overlay_scale:new g.aI(p,e.u_overlay_scale)}),clippingMask:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix)}),heatmap:(p,e)=>({u_extrude_scale:new g.aI(p,e.u_extrude_scale),u_intensity:new g.aI(p,e.u_intensity),u_matrix:new g.aJ(p,e.u_matrix)}),heatmapTexture:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_world:new g.aO(p,e.u_world),u_image:new g.aH(p,e.u_image),u_color_ramp:new g.aH(p,e.u_color_ramp),u_opacity:new g.aI(p,e.u_opacity)}),hillshade:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_image:new g.aH(p,e.u_image),u_latrange:new g.aO(p,e.u_latrange),u_light:new g.aO(p,e.u_light),u_shadow:new g.aL(p,e.u_shadow),u_highlight:new g.aL(p,e.u_highlight),u_accent:new g.aL(p,e.u_accent)}),hillshadePrepare:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_image:new g.aH(p,e.u_image),u_dimension:new g.aO(p,e.u_dimension),u_zoom:new g.aI(p,e.u_zoom),u_unpack:new g.aK(p,e.u_unpack)}),line:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_ratio:new g.aI(p,e.u_ratio),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new g.aO(p,e.u_units_to_pixels)}),lineGradient:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_ratio:new g.aI(p,e.u_ratio),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new g.aO(p,e.u_units_to_pixels),u_image:new g.aH(p,e.u_image),u_image_height:new g.aI(p,e.u_image_height)}),linePattern:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_texsize:new g.aO(p,e.u_texsize),u_ratio:new g.aI(p,e.u_ratio),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_image:new g.aH(p,e.u_image),u_units_to_pixels:new g.aO(p,e.u_units_to_pixels),u_scale:new g.aN(p,e.u_scale),u_fade:new g.aI(p,e.u_fade)}),lineSDF:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_ratio:new g.aI(p,e.u_ratio),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new g.aO(p,e.u_units_to_pixels),u_patternscale_a:new g.aO(p,e.u_patternscale_a),u_patternscale_b:new g.aO(p,e.u_patternscale_b),u_sdfgamma:new g.aI(p,e.u_sdfgamma),u_image:new g.aH(p,e.u_image),u_tex_y_a:new g.aI(p,e.u_tex_y_a),u_tex_y_b:new g.aI(p,e.u_tex_y_b),u_mix:new g.aI(p,e.u_mix)}),raster:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_tl_parent:new g.aO(p,e.u_tl_parent),u_scale_parent:new g.aI(p,e.u_scale_parent),u_buffer_scale:new g.aI(p,e.u_buffer_scale),u_fade_t:new g.aI(p,e.u_fade_t),u_opacity:new g.aI(p,e.u_opacity),u_image0:new g.aH(p,e.u_image0),u_image1:new g.aH(p,e.u_image1),u_brightness_low:new g.aI(p,e.u_brightness_low),u_brightness_high:new g.aI(p,e.u_brightness_high),u_saturation_factor:new g.aI(p,e.u_saturation_factor),u_contrast_factor:new g.aI(p,e.u_contrast_factor),u_spin_weights:new g.aN(p,e.u_spin_weights)}),symbolIcon:(p,e)=>({u_is_size_zoom_constant:new g.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new g.aH(p,e.u_is_size_feature_constant),u_size_t:new g.aI(p,e.u_size_t),u_size:new g.aI(p,e.u_size),u_camera_to_center_distance:new g.aI(p,e.u_camera_to_center_distance),u_pitch:new g.aI(p,e.u_pitch),u_rotate_symbol:new g.aH(p,e.u_rotate_symbol),u_aspect_ratio:new g.aI(p,e.u_aspect_ratio),u_fade_change:new g.aI(p,e.u_fade_change),u_matrix:new g.aJ(p,e.u_matrix),u_label_plane_matrix:new g.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new g.aJ(p,e.u_coord_matrix),u_is_text:new g.aH(p,e.u_is_text),u_pitch_with_map:new g.aH(p,e.u_pitch_with_map),u_is_along_line:new g.aH(p,e.u_is_along_line),u_is_variable_anchor:new g.aH(p,e.u_is_variable_anchor),u_texsize:new g.aO(p,e.u_texsize),u_texture:new g.aH(p,e.u_texture),u_translation:new g.aO(p,e.u_translation),u_pitched_scale:new g.aI(p,e.u_pitched_scale)}),symbolSDF:(p,e)=>({u_is_size_zoom_constant:new g.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new g.aH(p,e.u_is_size_feature_constant),u_size_t:new g.aI(p,e.u_size_t),u_size:new g.aI(p,e.u_size),u_camera_to_center_distance:new g.aI(p,e.u_camera_to_center_distance),u_pitch:new g.aI(p,e.u_pitch),u_rotate_symbol:new g.aH(p,e.u_rotate_symbol),u_aspect_ratio:new g.aI(p,e.u_aspect_ratio),u_fade_change:new g.aI(p,e.u_fade_change),u_matrix:new g.aJ(p,e.u_matrix),u_label_plane_matrix:new g.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new g.aJ(p,e.u_coord_matrix),u_is_text:new g.aH(p,e.u_is_text),u_pitch_with_map:new g.aH(p,e.u_pitch_with_map),u_is_along_line:new g.aH(p,e.u_is_along_line),u_is_variable_anchor:new g.aH(p,e.u_is_variable_anchor),u_texsize:new g.aO(p,e.u_texsize),u_texture:new g.aH(p,e.u_texture),u_gamma_scale:new g.aI(p,e.u_gamma_scale),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_is_halo:new g.aH(p,e.u_is_halo),u_translation:new g.aO(p,e.u_translation),u_pitched_scale:new g.aI(p,e.u_pitched_scale)}),symbolTextAndIcon:(p,e)=>({u_is_size_zoom_constant:new g.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new g.aH(p,e.u_is_size_feature_constant),u_size_t:new g.aI(p,e.u_size_t),u_size:new g.aI(p,e.u_size),u_camera_to_center_distance:new g.aI(p,e.u_camera_to_center_distance),u_pitch:new g.aI(p,e.u_pitch),u_rotate_symbol:new g.aH(p,e.u_rotate_symbol),u_aspect_ratio:new g.aI(p,e.u_aspect_ratio),u_fade_change:new g.aI(p,e.u_fade_change),u_matrix:new g.aJ(p,e.u_matrix),u_label_plane_matrix:new g.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new g.aJ(p,e.u_coord_matrix),u_is_text:new g.aH(p,e.u_is_text),u_pitch_with_map:new g.aH(p,e.u_pitch_with_map),u_is_along_line:new g.aH(p,e.u_is_along_line),u_is_variable_anchor:new g.aH(p,e.u_is_variable_anchor),u_texsize:new g.aO(p,e.u_texsize),u_texsize_icon:new g.aO(p,e.u_texsize_icon),u_texture:new g.aH(p,e.u_texture),u_texture_icon:new g.aH(p,e.u_texture_icon),u_gamma_scale:new g.aI(p,e.u_gamma_scale),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_is_halo:new g.aH(p,e.u_is_halo),u_translation:new g.aO(p,e.u_translation),u_pitched_scale:new g.aI(p,e.u_pitched_scale)}),background:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_opacity:new g.aI(p,e.u_opacity),u_color:new g.aL(p,e.u_color)}),backgroundPattern:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_opacity:new g.aI(p,e.u_opacity),u_image:new g.aH(p,e.u_image),u_pattern_tl_a:new g.aO(p,e.u_pattern_tl_a),u_pattern_br_a:new g.aO(p,e.u_pattern_br_a),u_pattern_tl_b:new g.aO(p,e.u_pattern_tl_b),u_pattern_br_b:new g.aO(p,e.u_pattern_br_b),u_texsize:new g.aO(p,e.u_texsize),u_mix:new g.aI(p,e.u_mix),u_pattern_size_a:new g.aO(p,e.u_pattern_size_a),u_pattern_size_b:new g.aO(p,e.u_pattern_size_b),u_scale_a:new g.aI(p,e.u_scale_a),u_scale_b:new g.aI(p,e.u_scale_b),u_pixel_coord_upper:new g.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new g.aO(p,e.u_pixel_coord_lower),u_tile_units_to_pixels:new g.aI(p,e.u_tile_units_to_pixels)}),terrain:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_texture:new g.aH(p,e.u_texture),u_ele_delta:new g.aI(p,e.u_ele_delta),u_fog_matrix:new g.aJ(p,e.u_fog_matrix),u_fog_color:new g.aL(p,e.u_fog_color),u_fog_ground_blend:new g.aI(p,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new g.aI(p,e.u_fog_ground_blend_opacity),u_horizon_color:new g.aL(p,e.u_horizon_color),u_horizon_fog_blend:new g.aI(p,e.u_horizon_fog_blend)}),terrainDepth:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_ele_delta:new g.aI(p,e.u_ele_delta)}),terrainCoords:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_texture:new g.aH(p,e.u_texture),u_terrain_coords_id:new g.aI(p,e.u_terrain_coords_id),u_ele_delta:new g.aI(p,e.u_ele_delta)}),sky:(p,e)=>({u_sky_color:new g.aL(p,e.u_sky_color),u_horizon_color:new g.aL(p,e.u_horizon_color),u_horizon:new g.aI(p,e.u_horizon),u_sky_horizon_blend:new g.aI(p,e.u_sky_horizon_blend)})};class Tn{constructor(e,s,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Na{constructor(e,s,l,u){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=e;const d=e.gl;this.buffer=d.createBuffer(),e.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let l=0;l<this.attributes.length;l++){const u=s.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,s,l){for(let u=0;u<this.attributes.length;u++){const d=this.attributes[u],v=s.attributes[d.name];v!==void 0&&e.vertexAttribPointer(v,d.components,e[xl[d.type]],!1,this.itemSize,d.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const io=new WeakMap;function Li(p){var e;if(io.has(p))return io.get(p);{const s=(e=p.getParameter(p.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return io.set(p,s),s}}class rr{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mo extends rr{getDefault(){return g.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class oc extends rr{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ps extends rr{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class wl extends rr{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ou extends rr{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class cn extends rr{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class zo extends rr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Va extends rr{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ea extends rr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class ac extends rr{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class bl extends rr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class Sl extends rr{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class qn extends rr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class ja extends rr{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class lc extends rr{getDefault(){return g.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class uc extends rr{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Ua extends rr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class ah extends rr{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ta extends rr{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class lh extends rr{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class uh extends rr{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class cc extends rr{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class hc extends rr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class dc extends rr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Tl extends rr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class pc extends rr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class kl extends rr{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ms extends rr{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const l=this.gl;Li(l)?l.bindVertexArray(e):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class au extends rr{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class $a extends rr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class lu extends rr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Il extends rr{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class uu extends Il{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class no extends Il{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class cu extends Il{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ch{constructor(e,s,l,u,d){this.context=e,this.width=s,this.height=l;const v=e.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new uu(e,w),u)this.depthAttachment=d?new cu(e,w):new no(e,w);else if(d)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class Zr{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}Zr.Replace=[1,0],Zr.disabled=new Zr(Zr.Replace,g.aM.transparent,[!1,!1,!1,!1]),Zr.unblended=new Zr(Zr.Replace,g.aM.transparent,[!0,!0,!0,!0]),Zr.alphaBlended=new Zr([1,771],g.aM.transparent,[!0,!0,!0,!0]);class hh{constructor(e){var s,l;if(this.gl=e,this.clearColor=new Mo(this),this.clearDepth=new oc(this),this.clearStencil=new Ps(this),this.colorMask=new wl(this),this.depthMask=new ou(this),this.stencilMask=new cn(this),this.stencilFunc=new zo(this),this.stencilOp=new Va(this),this.stencilTest=new ea(this),this.depthRange=new ac(this),this.depthTest=new bl(this),this.depthFunc=new Sl(this),this.blend=new qn(this),this.blendFunc=new ja(this),this.blendColor=new lc(this),this.blendEquation=new uc(this),this.cullFace=new Ua(this),this.cullFaceSide=new ah(this),this.frontFace=new ta(this),this.program=new lh(this),this.activeTexture=new uh(this),this.viewport=new cc(this),this.bindFramebuffer=new hc(this),this.bindRenderbuffer=new dc(this),this.bindTexture=new Tl(this),this.bindVertexBuffer=new pc(this),this.bindElementBuffer=new kl(this),this.bindVertexArray=new Ms(this),this.pixelStoreUnpack=new au(this),this.pixelStoreUnpackPremultiplyAlpha=new $a(this),this.pixelStoreUnpackFlipY=new lu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Li(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new Tn(this,e,s)}createVertexBuffer(e,s,l){return new Na(this,e,s,l)}createRenderbuffer(e,s,l){const u=this.gl,d=u.createRenderbuffer();return this.bindRenderbuffer.set(d),u.renderbufferStorage(u.RENDERBUFFER,e,s,l),this.bindRenderbuffer.set(null),d}createFramebuffer(e,s,l,u){return new ch(this,e,s,l,u)}clear({color:e,depth:s,stencil:l}){const u=this.gl;let d=0;e&&(d|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(d|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(d|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(d)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){g.aE(e.blendFunction,Zr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Li(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return Li(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class jt{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}jt.ReadOnly=!1,jt.ReadWrite=!0,jt.disabled=new jt(519,jt.ReadOnly,[0,1]);const El=7680;class br{constructor(e,s,l,u,d,v){this.test=e,this.ref=s,this.mask=l,this.fail=u,this.depthFail=d,this.pass=v}}br.disabled=new br({func:519,mask:0},0,0,El,El,El);class ur{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}let Gn;function Za(p,e,s,l,u){const d=p.context,v=d.gl,w=p.useProgram("collisionBox"),S=[];let I=0,P=0;for(let J=0;J<l.length;J++){const re=l[J],q=e.getTile(re).getBucket(s);if(!q)continue;const oe=u?q.textCollisionBox:q.iconCollisionBox,ue=q.collisionCircleArray;if(ue.length>0){const _e=g.H();g.aQ(_e,q.placementInvProjMatrix,p.transform.glCoordMatrix),g.aQ(_e,_e,q.placementViewportMatrix),S.push({circleArray:ue,circleOffset:P,transform:re.posMatrix,invTransform:_e,coord:re}),I+=ue.length/4,P=I}oe&&w.draw(d,v.LINES,jt.disabled,br.disabled,p.colorModeForRenderPass(),ur.disabled,{u_matrix:re.posMatrix,u_pixel_extrude_scale:[1/(M=p.transform).width,1/M.height]},p.style.map.terrain&&p.style.map.terrain.getTerrainData(re),s.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,null,p.transform.zoom,null,null,oe.collisionVertexBuffer)}var M;if(!u||!S.length)return;const F=p.useProgram("collisionCircle"),N=new g.aR;N.resize(4*I),N._trim();let U=0;for(const J of S)for(let re=0;re<J.circleArray.length/4;re++){const q=4*re,oe=J.circleArray[q+0],ue=J.circleArray[q+1],_e=J.circleArray[q+2],Ce=J.circleArray[q+3];N.emplace(U++,oe,ue,_e,Ce,0),N.emplace(U++,oe,ue,_e,Ce,1),N.emplace(U++,oe,ue,_e,Ce,2),N.emplace(U++,oe,ue,_e,Ce,3)}(!Gn||Gn.length<2*I)&&(Gn=(function(J){const re=2*J,q=new g.aT;q.resize(re),q._trim();for(let oe=0;oe<re;oe++){const ue=6*oe;q.uint16[ue+0]=4*oe+0,q.uint16[ue+1]=4*oe+1,q.uint16[ue+2]=4*oe+2,q.uint16[ue+3]=4*oe+2,q.uint16[ue+4]=4*oe+3,q.uint16[ue+5]=4*oe+0}return q})(I));const $=d.createIndexBuffer(Gn,!0),W=d.createVertexBuffer(N,g.aS.members,!0);for(const J of S){const re=Zi(J.transform,J.invTransform,p.transform);F.draw(d,v.TRIANGLES,jt.disabled,br.disabled,p.colorModeForRenderPass(),ur.disabled,re,p.style.map.terrain&&p.style.map.terrain.getTerrainData(J.coord),s.id,W,$,g.a0.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,p.transform.zoom,null,null,null)}W.destroy(),$.destroy()}ur.disabled=new ur(!1,1029,2305),ur.backCCW=new ur(!0,1029,2305);const ra=g.an(new Float32Array(16));function Cl(p,e,s,l,u,d){const{horizontalAlign:v,verticalAlign:w}=g.au(p);return new g.P((-(v-.5)*e/u+l[0])*d,(-(w-.5)*s/u+l[1])*d)}function so(p,e,s,l,u,d){const v=e.tileAnchorPoint.add(new g.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(d);s||(w=w.rotate(-u));const S=v.add(w);return K(S.x,S.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const w=Se(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(p),S=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return p.add(l.rotate(S))}return p.add(l)}function Ao(p,e,s,l,u,d,v,w,S,I,P,M,F,N){const U=p.text.placedSymbolArray,$=p.text.dynamicLayoutVertexArray,W=p.icon.dynamicLayoutVertexArray,J={};$.clear();for(let re=0;re<U.length;re++){const q=U.get(re),oe=q.hidden||!q.crossTileID||p.allowVerticalPlacement&&!q.placedOrientation?null:l[q.crossTileID];if(oe){const ue=new g.P(q.anchorX,q.anchorY),_e={getElevation:N,width:u.width,height:u.height,labelPlaneMatrix:d,pitchWithMap:s,projection:P,tileAnchorPoint:ue,translation:M,unwrappedTileID:F},Ce=s?K(ue.x,ue.y,v,N):Se(ue.x,ue.y,_e),Le=L(u.cameraToCenterDistance,Ce.signedDistanceFromCamera);let Ne=g.ai(p.textSizeData,S,q)*Le/g.ap;s&&(Ne*=p.tilePixelRatio/w);const{width:He,height:Ve,anchor:Be,textOffset:it,textBoxScale:bt}=oe,Ue=Cl(Be,He,Ve,it,bt,Ne),Ze=P.getPitchedTextCorrection(u,ue.add(new g.P(M[0],M[1])),F),wt=so(Ce.point,_e,e,Ue,u.angle,Ze),fr=p.allowVerticalPlacement&&q.placedOrientation===g.ah.vertical?Math.PI/2:0;for(let Ct=0;Ct<q.numGlyphs;Ct++)g.aj($,wt,fr);I&&q.associatedIconIndex>=0&&(J[q.associatedIconIndex]={shiftedAnchor:wt,angle:fr})}else dt(q.numGlyphs,$)}if(I){W.clear();const re=p.icon.placedSymbolArray;for(let q=0;q<re.length;q++){const oe=re.get(q);if(oe.hidden)dt(oe.numGlyphs,W);else{const ue=J[q];if(ue)for(let _e=0;_e<oe.numGlyphs;_e++)g.aj(W,ue.shiftedAnchor,ue.angle);else dt(oe.numGlyphs,W)}}p.icon.dynamicLayoutVertexBuffer.updateData(W)}p.text.dynamicLayoutVertexBuffer.updateData($)}function hn(p,e,s){return s.iconsInText&&e?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function oo(p,e,s,l,u,d,v,w,S,I,P,M){const F=p.context,N=F.gl,U=p.transform,$=To(),W=w==="map",J=S==="map",re=w!=="viewport"&&s.layout.get("symbol-placement")!=="point",q=W&&!J&&!re,oe=!J&&re,ue=!s.layout.get("symbol-sort-key").isConstant();let _e=!1;const Ce=p.depthModeForSublayer(0,jt.ReadOnly),Le=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ne=[],He=$.getCircleRadiusCorrection(U);for(const Ve of l){const Be=e.getTile(Ve),it=Be.getBucket(s);if(!it)continue;const bt=u?it.text:it.icon;if(!bt||!bt.segments.get().length||!bt.hasVisibleVertices)continue;const Ue=bt.programConfigurations.get(s.id),Ze=u||it.sdfIcons,wt=u?it.textSizeData:it.iconSizeData,fr=J||U.pitch!==0,Ct=p.useProgram(hn(Ze,u,it),Ue),Lt=g.ag(wt,U.zoom),_r=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Ve);let pi,pn,yr,si,Cr=[0,0],qr=null;if(u)pn=Be.glyphAtlasTexture,yr=N.LINEAR,pi=Be.glyphAtlasTexture.size,it.iconsInText&&(Cr=Be.imageAtlasTexture.size,qr=Be.imageAtlasTexture,si=fr||p.options.rotating||p.options.zooming||wt.kind==="composite"||wt.kind==="camera"?N.LINEAR:N.NEAREST);else{const Bt=s.layout.get("icon-size").constantOr(0)!==1||it.iconsNeedLinear;pn=Be.imageAtlasTexture,yr=Ze||p.options.rotating||p.options.zooming||Bt||fr?N.LINEAR:N.NEAREST,pi=Be.imageAtlasTexture.size}const vi=Mt(Be,1,p.transform.zoom),Jn=oe?Ve.posMatrix:ra,Wi=ln(Jn,J,W,p.transform,vi),Yn=zi(Jn,J,W,p.transform,vi),fo=zi(Ve.posMatrix,J,W,p.transform,vi),fn=$.translatePosition(p.transform,Be,d,v),Pn=Le&&it.hasTextData(),vs=s.layout.get("icon-text-fit")!=="none"&&Pn&&it.hasIconData();if(re){const Bt=p.style.map.terrain?(mo,es)=>p.style.map.terrain.getElevation(Ve,mo,es):null,gn=s.layout.get("text-rotation-alignment")==="map";V(it,Ve.posMatrix,p,u,Wi,fo,J,I,gn,$,Ve.toUnwrapped(),U.width,U.height,fn,Bt)}const Fi=Ve.posMatrix,mn=u&&Le||vs,Qn=re||mn?ra:Wi,Mn=Yn,Kr=Ze&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Dr;Dr=Ze?it.iconsInText?ro(wt.kind,Lt,q,J,re,mn,p,Fi,Qn,Mn,fn,pi,Cr,He):Cs(wt.kind,Lt,q,J,re,mn,p,Fi,Qn,Mn,fn,u,pi,!0,He):Qo(wt.kind,Lt,q,J,re,mn,p,Fi,Qn,Mn,fn,u,pi,He);const xi={program:Ct,buffers:bt,uniformValues:Dr,atlasTexture:pn,atlasTextureIcon:qr,atlasInterpolation:yr,atlasInterpolationIcon:si,isSDF:Ze,hasHalo:Kr};if(ue&&it.canOverlap){_e=!0;const Bt=bt.segments.get();for(const gn of Bt)Ne.push({segments:new g.a0([gn]),sortKey:gn.sortKey,state:xi,terrainData:_r})}else Ne.push({segments:bt.segments,sortKey:0,state:xi,terrainData:_r})}_e&&Ne.sort(((Ve,Be)=>Ve.sortKey-Be.sortKey));for(const Ve of Ne){const Be=Ve.state;if(F.activeTexture.set(N.TEXTURE0),Be.atlasTexture.bind(Be.atlasInterpolation,N.CLAMP_TO_EDGE),Be.atlasTextureIcon&&(F.activeTexture.set(N.TEXTURE1),Be.atlasTextureIcon&&Be.atlasTextureIcon.bind(Be.atlasInterpolationIcon,N.CLAMP_TO_EDGE)),Be.isSDF){const it=Be.uniformValues;Be.hasHalo&&(it.u_is_halo=1,hu(Be.buffers,Ve.segments,s,p,Be.program,Ce,P,M,it,Ve.terrainData)),it.u_is_halo=0}hu(Be.buffers,Ve.segments,s,p,Be.program,Ce,P,M,Be.uniformValues,Ve.terrainData)}}function hu(p,e,s,l,u,d,v,w,S,I){const P=l.context;u.draw(P,P.gl.TRIANGLES,d,v,w,ur.disabled,S,I,s.id,p.layoutVertexBuffer,p.indexBuffer,e,s.paint,l.transform.zoom,p.programConfigurations.get(s.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function du(p,e,s,l){const u=p.context,d=u.gl,v=br.disabled,w=new Zr([d.ONE,d.ONE],g.aM.transparent,[!0,!0,!0,!0]),S=e.getBucket(s);if(!S)return;const I=l.key;let P=s.heatmapFbos.get(I);P||(P=ia(u,e.tileSize,e.tileSize),s.heatmapFbos.set(I,P)),u.bindFramebuffer.set(P.framebuffer),u.viewport.set([0,0,e.tileSize,e.tileSize]),u.clear({color:g.aM.transparent});const M=S.programConfigurations.get(s.id),F=p.useProgram("heatmap",M),N=p.style.map.terrain.getTerrainData(l);F.draw(u,d.TRIANGLES,jt.disabled,v,w,ur.disabled,di(l.posMatrix,e,p.transform.zoom,s.paint.get("heatmap-intensity")),N,s.id,S.layoutVertexBuffer,S.indexBuffer,S.segments,s.paint,p.transform.zoom,M)}function Do(p,e,s){const l=p.context,u=l.gl;l.setColorMode(p.colorModeForRenderPass());const d=na(l,e),v=s.key,w=e.heatmapFbos.get(v);w&&(l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,w.colorAttachment.get()),l.activeTexture.set(u.TEXTURE1),d.bind(u.LINEAR,u.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(l,u.TRIANGLES,jt.disabled,br.disabled,p.colorModeForRenderPass(),ur.disabled,to(p,e,0,1),null,e.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments,e.paint,p.transform.zoom),w.destroy(),e.heatmapFbos.delete(v))}function ia(p,e,s){var l,u;const d=p.gl,v=d.createTexture();d.bindTexture(d.TEXTURE_2D,v),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);const w=(l=p.HALF_FLOAT)!==null&&l!==void 0?l:d.UNSIGNED_BYTE,S=(u=p.RGBA16F)!==null&&u!==void 0?u:d.RGBA;d.texImage2D(d.TEXTURE_2D,0,S,e,s,0,d.RGBA,w,null);const I=p.createFramebuffer(e,s,!1,!1);return I.colorAttachment.set(v),I}function na(p,e){return e.colorRampTexture||(e.colorRampTexture=new Kt(p,e.colorRamp,p.gl.RGBA)),e.colorRampTexture}function fs(p,e,s,l,u){if(!s||!l||!l.imageAtlas)return;const d=l.imageAtlas.patternPositions;let v=d[s.to.toString()],w=d[s.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){const S=u.getPaintProperty(e);v=d[S],w=d[S]}v&&w&&p.setConstantPatternPositions(v,w)}function zs(p,e,s,l,u,d,v){const w=p.context.gl,S="fill-pattern",I=s.paint.get(S),P=I&&I.constantOr(1),M=s.getCrossfadeParameters();let F,N,U,$,W;v?(N=P&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=w.LINES):(N=P?"fillPattern":"fill",F=w.TRIANGLES);const J=I.constantOr(null);for(const re of l){const q=e.getTile(re);if(P&&!q.patternsLoaded())continue;const oe=q.getBucket(s);if(!oe)continue;const ue=oe.programConfigurations.get(s.id),_e=p.useProgram(N,ue),Ce=p.style.map.terrain&&p.style.map.terrain.getTerrainData(re);P&&(p.context.activeTexture.set(w.TEXTURE0),q.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),ue.updatePaintBuffers(M)),fs(ue,S,J,q,s);const Le=Ce?re:null,Ne=p.translatePosMatrix(Le?Le.posMatrix:re.posMatrix,q,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){$=oe.indexBuffer2,W=oe.segments2;const He=[w.drawingBufferWidth,w.drawingBufferHeight];U=N==="fillOutlinePattern"&&P?_l(Ne,p,M,q,He):nc(Ne,He)}else $=oe.indexBuffer,W=oe.segments,U=P?tu(Ne,p,M,q):Co(Ne);_e.draw(p.context,F,u,p.stencilModeForClipping(re),d,ur.disabled,U,Ce,s.id,oe.layoutVertexBuffer,$,W,s.paint,p.transform.zoom,ue)}}function Pl(p,e,s,l,u,d,v){const w=p.context,S=w.gl,I="fill-extrusion-pattern",P=s.paint.get(I),M=P.constantOr(1),F=s.getCrossfadeParameters(),N=s.paint.get("fill-extrusion-opacity"),U=P.constantOr(null);for(const $ of l){const W=e.getTile($),J=W.getBucket(s);if(!J)continue;const re=p.style.map.terrain&&p.style.map.terrain.getTerrainData($),q=J.programConfigurations.get(s.id),oe=p.useProgram(M?"fillExtrusionPattern":"fillExtrusion",q);M&&(p.context.activeTexture.set(S.TEXTURE0),W.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),q.updatePaintBuffers(F)),fs(q,I,U,W,s);const ue=p.translatePosMatrix($.posMatrix,W,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),_e=s.paint.get("fill-extrusion-vertical-gradient"),Ce=M?Yo(ue,p,_e,N,$,F,W):Jo(ue,p,_e,N);oe.draw(w,w.gl.TRIANGLES,u,d,v,ur.backCCW,Ce,re,s.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,s.paint,p.transform.zoom,q,p.style.map.terrain&&J.centroidVertexBuffer)}}function As(p,e,s,l,u,d,v){const w=p.context,S=w.gl,I=s.fbo;if(!I)return;const P=p.useProgram("hillshade"),M=p.style.map.terrain&&p.style.map.terrain.getTerrainData(e);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.colorAttachment.get()),P.draw(w,S.TRIANGLES,u,d,v,ur.disabled,((F,N,U,$)=>{const W=U.paint.get("hillshade-shadow-color"),J=U.paint.get("hillshade-highlight-color"),re=U.paint.get("hillshade-accent-color");let q=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);U.paint.get("hillshade-illumination-anchor")==="viewport"&&(q-=F.transform.angle);const oe=!F.options.moving;return{u_matrix:$?$.posMatrix:F.transform.calculatePosMatrix(N.tileID.toUnwrapped(),oe),u_image:0,u_latrange:Zn(0,N.tileID),u_light:[U.paint.get("hillshade-exaggeration"),q],u_shadow:W,u_highlight:J,u_accent:re}})(p,s,l,M?e:null),M,l.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function sa(p,e,s,l,u,d){const v=p.context,w=v.gl,S=e.dem;if(S&&S.data){const I=S.dim,P=S.stride,M=S.getPixels();if(v.activeTexture.set(w.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||p.getTileTexture(P),e.demTexture){const N=e.demTexture;N.update(M,{premultiply:!1}),N.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new Kt(v,M,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);v.activeTexture.set(w.TEXTURE0);let F=e.fbo;if(!F){const N=new Kt(v,{width:I,height:I,data:null},w.RGBA);N.bind(w.LINEAR,w.CLAMP_TO_EDGE),F=e.fbo=v.createFramebuffer(I,I,!0,!1),F.colorAttachment.set(N.texture)}v.bindFramebuffer.set(F.framebuffer),v.viewport.set([0,0,I,I]),p.useProgram("hillshadePrepare").draw(v,w.TRIANGLES,l,u,d,ur.disabled,((N,U)=>{const $=U.stride,W=g.H();return g.aP(W,0,g.X,-g.X,0,0,1),g.J(W,W,[0,-g.X,0]),{u_matrix:W,u_image:1,u_dimension:[$,$],u_zoom:N.overscaledZ,u_unpack:U.getUnpackVector()}})(e.tileID,S),null,s.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function pu(p,e,s,l,u,d){const v=l.paint.get("raster-fade-duration");if(!d&&v>0){const w=ke.now(),S=(w-p.timeAdded)/v,I=e?(w-e.timeAdded)/v:-1,P=s.getSource(),M=u.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-M)>Math.abs(p.tileID.overscaledZ-M),N=F&&p.refreshedUponExpiration?1:g.ac(F?S:1-I,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),e?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}const qa=new g.aM(1,0,0,1),Ht=new g.aM(0,1,0,1),Ga=new g.aM(0,0,1,1),fc=new g.aM(1,0,1,1),fu=new g.aM(0,1,1,1);function oa(p,e,s,l){Ml(p,0,e+s/2,p.transform.width,s,l)}function mc(p,e,s,l){Ml(p,e-s/2,0,s,p.transform.height,l)}function Ml(p,e,s,l,u,d){const v=p.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*p.pixelRatio,s*p.pixelRatio,l*p.pixelRatio,u*p.pixelRatio),v.clear({color:d}),w.disable(w.SCISSOR_TEST)}function gc(p,e,s){const l=p.context,u=l.gl,d=s.posMatrix,v=p.useProgram("debug"),w=jt.disabled,S=br.disabled,I=p.colorModeForRenderPass(),P="$debug",M=p.style.map.terrain&&p.style.map.terrain.getTerrainData(s);l.activeTexture.set(u.TEXTURE0);const F=e.getTileByID(s.key).latestRawTileData,N=Math.floor((F&&F.byteLength||0)/1024),U=e.getTile(s).tileSize,$=512/Math.min(U,512)*(s.overscaledZ/p.transform.zoom)*.5;let W=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(W+=` => ${s.overscaledZ}`),(function(J,re){J.initDebugOverlayCanvas();const q=J.debugOverlayCanvas,oe=J.context.gl,ue=J.debugOverlayCanvas.getContext("2d");ue.clearRect(0,0,q.width,q.height),ue.shadowColor="white",ue.shadowBlur=2,ue.lineWidth=1.5,ue.strokeStyle="white",ue.textBaseline="top",ue.font="bold 36px Open Sans, sans-serif",ue.fillText(re,5,5),ue.strokeText(re,5,5),J.debugOverlayTexture.update(q),J.debugOverlayTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)})(p,`${W} ${N}kB`),v.draw(l,u.TRIANGLES,w,S,Zr.alphaBlended,ur.disabled,Sn(d,g.aM.transparent,$),null,P,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),v.draw(l,u.LINE_STRIP,w,S,I,ur.disabled,Sn(d,g.aM.red),M,P,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function _c(p,e,s){const l=p.context,u=l.gl,d=p.colorModeForRenderPass(),v=new jt(u.LEQUAL,jt.ReadWrite,p.depthRangeFor3D),w=p.useProgram("terrain"),S=e.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,p.width,p.height]);for(const I of s){const P=p.renderToTexture.getTexture(I),M=e.getTerrainData(I.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,P.texture);const F=p.transform.calculatePosMatrix(I.tileID.toUnwrapped()),N=e.getMeshFrameDelta(p.transform.zoom),U=p.transform.calculateFogMatrix(I.tileID.toUnwrapped()),$=eu(F,N,U,p.style.sky,p.transform.pitch);w.draw(l,u.TRIANGLES,v,br.disabled,d,ur.backCCW,$,M,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}}class qi{constructor(e,s,l){this.vertexBuffer=e,this.indexBuffer=s,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class ao{constructor(e,s){this.context=new hh(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:g.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=xt.maxUnderzooming+xt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Io}resize(e,s,l){if(this.width=Math.floor(e*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,s=new g.aX;s.emplaceBack(0,0),s.emplaceBack(g.X,0),s.emplaceBack(0,g.X),s.emplaceBack(g.X,g.X),this.tileExtentBuffer=e.createVertexBuffer(s,Is.members),this.tileExtentSegments=g.a0.simpleSegment(0,0,4,2);const l=new g.aX;l.emplaceBack(0,0),l.emplaceBack(g.X,0),l.emplaceBack(0,g.X),l.emplaceBack(g.X,g.X),this.debugBuffer=e.createVertexBuffer(l,Is.members),this.debugSegments=g.a0.simpleSegment(0,0,4,5);const u=new g.$;u.emplaceBack(0,0,0,0),u.emplaceBack(g.X,0,g.X,0),u.emplaceBack(0,g.X,0,g.X),u.emplaceBack(g.X,g.X,g.X,g.X),this.rasterBoundsBuffer=e.createVertexBuffer(u,hs.members),this.rasterBoundsSegments=g.a0.simpleSegment(0,0,4,2);const d=new g.aX;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(d,Is.members),this.viewportSegments=g.a0.simpleSegment(0,0,4,2);const v=new g.aZ;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(v);const w=new g.aY;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);const S=this.context.gl;this.stencilClearMode=new br({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=g.H();g.aP(l,0,this.width,this.height,0,0,1),g.K(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,jt.disabled,this.stencilClearMode,Zr.disabled,ur.disabled,Xr(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const l=this.context,u=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(Zr.disabled),l.setDepthMode(jt.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of s){const w=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);d.draw(l,u.TRIANGLES,jt.disabled,new br({func:u.ALWAYS,mask:0},w,255,u.KEEP,u.KEEP,u.REPLACE),Zr.disabled,ur.disabled,Xr(v.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new br({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new br({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,l=e.sort(((v,w)=>w.overscaledZ-v.overscaledZ)),u=l[l.length-1].overscaledZ,d=l[0].overscaledZ-u+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const v={};for(let w=0;w<d;w++)v[w+u]=new br({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=d,[v,l]}return[{[u]:br.disabled},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Zr([e.CONSTANT_COLOR,e.ONE],new g.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Zr.unblended:Zr.alphaBlended}depthModeForSublayer(e,s,l){if(!this.opaquePassEnabledForLayer())return jt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new jt(l||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ke.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,d={},v={},w={};for(const S in u){const I=u[S];I.used&&I.prepare(this.context),d[S]=I.getVisibleCoordinates(),v[S]=d[S].slice().reverse(),w[S]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<l.length;S++)if(this.style._layers[l[S]].is3D()){this.opaquePassCutoff=S;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const S of l){const I=this.style._layers[S];if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const P=v[I.source];(I.type==="custom"||P.length)&&this.renderLayer(this,u[I.source],I,P)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?g.aM.black:g.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(S,I){const P=S.context,M=P.gl,F=((J,re,q)=>({u_sky_color:J.properties.get("sky-color"),u_horizon_color:J.properties.get("horizon-color"),u_horizon:(re.height/2+re.getHorizon())*q,u_sky_horizon_blend:J.properties.get("sky-horizon-blend")*re.height/2*q}))(I,S.style.map.transform,S.pixelRatio),N=new jt(M.LEQUAL,jt.ReadWrite,[0,1]),U=br.disabled,$=S.colorModeForRenderPass(),W=S.useProgram("sky");if(!I.mesh){const J=new g.aX;J.emplaceBack(-1,-1),J.emplaceBack(1,-1),J.emplaceBack(1,1),J.emplaceBack(-1,1);const re=new g.aY;re.emplaceBack(0,1,2),re.emplaceBack(0,2,3),I.mesh=new qi(P.createVertexBuffer(J,Is.members),P.createIndexBuffer(re),g.a0.simpleSegment(0,0,J.length,re.length))}W.draw(P,M.TRIANGLES,N,U,$,ur.disabled,F,void 0,"sky",I.mesh.vertexBuffer,I.mesh.indexBuffer,I.mesh.segments)})(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[l[this.currentLayer]],I=u[S.source],P=d[S.source];this._renderTileClippingMasks(S,P),this.renderLayer(this,I,S,P)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const S=this.style._layers[l[this.currentLayer]],I=u[S.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(S))continue;const P=(S.type==="symbol"?w:v)[S.source];this._renderTileClippingMasks(S,d[S.source]),this.renderLayer(this,I,S,P)}if(this.options.showTileBoundaries){const S=(function(I,P){let M=null;const F=Object.values(I._layers).flatMap((W=>W.source&&!W.isHidden(P)?[I.sourceCaches[W.source]]:[])),N=F.filter((W=>W.getSource().type==="vector")),U=F.filter((W=>W.getSource().type!=="vector")),$=W=>{(!M||M.getSource().maxzoom<W.getSource().maxzoom)&&(M=W)};return N.forEach((W=>$(W))),M||U.forEach((W=>$(W))),M})(this.style,this.transform.zoom);S&&(function(I,P,M){for(let F=0;F<M.length;F++)gc(I,P,M[F])})(this,S,S.getVisibleCoordinates())}this.options.showPadding&&(function(S){const I=S.transform.padding;oa(S,S.transform.height-(I.top||0),3,qa),oa(S,I.bottom||0,3,Ht),mc(S,I.left||0,3,Ga),mc(S,S.transform.width-(I.right||0),3,fc);const P=S.transform.centerPoint;(function(M,F,N,U){Ml(M,F-1,N-10,2,20,U),Ml(M,F-10,N-1,20,2,U)})(S,P.x,S.transform.height-P.y,fu)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!g.a_(s,l):!g.a$(s,l)),u||(u=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),u&&(g.b0(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(d,v){const w=d.context,S=w.gl,I=Zr.unblended,P=new jt(S.LEQUAL,jt.ReadWrite,[0,1]),M=v.getTerrainMesh(),F=v.sourceCache.getRenderableTiles(),N=d.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),w.clear({color:g.aM.transparent,depth:1});for(const U of F){const $=v.getTerrainData(U.tileID),W={u_matrix:d.transform.calculatePosMatrix(U.tileID.toUnwrapped()),u_ele_delta:v.getMeshFrameDelta(d.transform.zoom)};N.draw(w,S.TRIANGLES,P,br.disabled,I,ur.backCCW,W,$,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,d.width,d.height])})(this,this.style.map.terrain),(function(d,v){const w=d.context,S=w.gl,I=Zr.unblended,P=new jt(S.LEQUAL,jt.ReadWrite,[0,1]),M=v.getTerrainMesh(),F=v.getCoordsTexture(),N=v.sourceCache.getRenderableTiles(),U=d.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),w.clear({color:g.aM.transparent,depth:1}),v.coordsIndex=[];for(const $ of N){const W=v.getTerrainData($.tileID);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,F.texture);const J={u_matrix:d.transform.calculatePosMatrix($.tileID.toUnwrapped()),u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(d.transform.zoom)};U.draw(w,S.TRIANGLES,P,br.disabled,I,ur.backCCW,J,W,"terrain",M.vertexBuffer,M.indexBuffer,M.segments),v.coordsIndex.push($.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,d.width,d.height])})(this,this.style.map.terrain))}renderLayer(e,s,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(d,v,w,S,I){if(d.renderPass!=="translucent")return;const P=br.disabled,M=d.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(F,N,U,$,W,J,re,q,oe){const ue=N.transform,_e=To(),Ce=W==="map",Le=J==="map";for(const Ne of F){const He=$.getTile(Ne),Ve=He.getBucket(U);if(!Ve||!Ve.text||!Ve.text.segments.get().length)continue;const Be=g.ag(Ve.textSizeData,ue.zoom),it=Mt(He,1,N.transform.zoom),bt=ln(Ne.posMatrix,Le,Ce,N.transform,it),Ue=U.layout.get("icon-text-fit")!=="none"&&Ve.hasIconData();if(Be){const Ze=Math.pow(2,ue.zoom-He.tileID.overscaledZ),wt=N.style.map.terrain?(Ct,Lt)=>N.style.map.terrain.getElevation(Ne,Ct,Lt):null,fr=_e.translatePosition(ue,He,re,q);Ao(Ve,Ce,Le,oe,ue,bt,Ne.posMatrix,Ze,Be,Ue,_e,fr,Ne.toUnwrapped(),wt)}}})(S,d,w,v,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),I),w.paint.get("icon-opacity").constantOr(1)!==0&&oo(d,v,w,S,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),P,M),w.paint.get("text-opacity").constantOr(1)!==0&&oo(d,v,w,S,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),P,M),v.map.showCollisionBoxes&&(Za(d,v,w,S,!0),Za(d,v,w,S,!1))})(e,s,l,u,this.style.placement.variableOffsets);break;case"circle":(function(d,v,w,S){if(d.renderPass!=="translucent")return;const I=w.paint.get("circle-opacity"),P=w.paint.get("circle-stroke-width"),M=w.paint.get("circle-stroke-opacity"),F=!w.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(P.constantOr(1)===0||M.constantOr(1)===0))return;const N=d.context,U=N.gl,$=d.depthModeForSublayer(0,jt.ReadOnly),W=br.disabled,J=d.colorModeForRenderPass(),re=[];for(let q=0;q<S.length;q++){const oe=S[q],ue=v.getTile(oe),_e=ue.getBucket(w);if(!_e)continue;const Ce=_e.programConfigurations.get(w.id),Le=d.useProgram("circle",Ce),Ne=_e.layoutVertexBuffer,He=_e.indexBuffer,Ve=d.style.map.terrain&&d.style.map.terrain.getTerrainData(oe),Be={programConfiguration:Ce,program:Le,layoutVertexBuffer:Ne,indexBuffer:He,uniformValues:yl(d,oe,ue,w),terrainData:Ve};if(F){const it=_e.segments.get();for(const bt of it)re.push({segments:new g.a0([bt]),sortKey:bt.sortKey,state:Be})}else re.push({segments:_e.segments,sortKey:0,state:Be})}F&&re.sort(((q,oe)=>q.sortKey-oe.sortKey));for(const q of re){const{programConfiguration:oe,program:ue,layoutVertexBuffer:_e,indexBuffer:Ce,uniformValues:Le,terrainData:Ne}=q.state;ue.draw(N,U.TRIANGLES,$,W,J,ur.disabled,Le,Ne,w.id,_e,Ce,q.segments,w.paint,d.transform.zoom,oe)}})(e,s,l,u);break;case"heatmap":(function(d,v,w,S){if(w.paint.get("heatmap-opacity")===0)return;const I=d.context;if(d.style.map.terrain){for(const P of S){const M=v.getTile(P);v.hasRenderableParent(P)||(d.renderPass==="offscreen"?du(d,M,w,P):d.renderPass==="translucent"&&Do(d,w,P))}I.viewport.set([0,0,d.width,d.height])}else d.renderPass==="offscreen"?(function(P,M,F,N){const U=P.context,$=U.gl,W=br.disabled,J=new Zr([$.ONE,$.ONE],g.aM.transparent,[!0,!0,!0,!0]);(function(re,q,oe){const ue=re.gl;re.activeTexture.set(ue.TEXTURE1),re.viewport.set([0,0,q.width/4,q.height/4]);let _e=oe.heatmapFbos.get(g.aU);_e?(ue.bindTexture(ue.TEXTURE_2D,_e.colorAttachment.get()),re.bindFramebuffer.set(_e.framebuffer)):(_e=ia(re,q.width/4,q.height/4),oe.heatmapFbos.set(g.aU,_e))})(U,P,F),U.clear({color:g.aM.transparent});for(let re=0;re<N.length;re++){const q=N[re];if(M.hasRenderableParent(q))continue;const oe=M.getTile(q),ue=oe.getBucket(F);if(!ue)continue;const _e=ue.programConfigurations.get(F.id),Ce=P.useProgram("heatmap",_e),{zoom:Le}=P.transform;Ce.draw(U,$.TRIANGLES,jt.disabled,W,J,ur.disabled,di(q.posMatrix,oe,Le,F.paint.get("heatmap-intensity")),null,F.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,F.paint,P.transform.zoom,_e)}U.viewport.set([0,0,P.width,P.height])})(d,v,w,S):d.renderPass==="translucent"&&(function(P,M){const F=P.context,N=F.gl;F.setColorMode(P.colorModeForRenderPass());const U=M.heatmapFbos.get(g.aU);U&&(F.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,U.colorAttachment.get()),F.activeTexture.set(N.TEXTURE1),na(F,M).bind(N.LINEAR,N.CLAMP_TO_EDGE),P.useProgram("heatmapTexture").draw(F,N.TRIANGLES,jt.disabled,br.disabled,P.colorModeForRenderPass(),ur.disabled,to(P,M,0,1),null,M.id,P.viewportBuffer,P.quadTriangleIndexBuffer,P.viewportSegments,M.paint,P.transform.zoom))})(d,w)})(e,s,l,u);break;case"line":(function(d,v,w,S){if(d.renderPass!=="translucent")return;const I=w.paint.get("line-opacity"),P=w.paint.get("line-width");if(I.constantOr(1)===0||P.constantOr(1)===0)return;const M=d.depthModeForSublayer(0,jt.ReadOnly),F=d.colorModeForRenderPass(),N=w.paint.get("line-dasharray"),U=w.paint.get("line-pattern"),$=U.constantOr(1),W=w.paint.get("line-gradient"),J=w.getCrossfadeParameters(),re=$?"linePattern":N?"lineSDF":W?"lineGradient":"line",q=d.context,oe=q.gl;let ue=!0;for(const _e of S){const Ce=v.getTile(_e);if($&&!Ce.patternsLoaded())continue;const Le=Ce.getBucket(w);if(!Le)continue;const Ne=Le.programConfigurations.get(w.id),He=d.context.program.get(),Ve=d.useProgram(re,Ne),Be=ue||Ve.program!==He,it=d.style.map.terrain&&d.style.map.terrain.getTerrainData(_e),bt=U.constantOr(null);if(bt&&Ce.imageAtlas){const wt=Ce.imageAtlas,fr=wt.patternPositions[bt.to.toString()],Ct=wt.patternPositions[bt.from.toString()];fr&&Ct&&Ne.setConstantPatternPositions(fr,Ct)}const Ue=it?_e:null,Ze=$?ps(d,Ce,w,J,Ue):N?sh(d,Ce,w,N,J,Ue):W?ru(d,Ce,w,Le.lineClipsArray.length,Ue):vl(d,Ce,w,Ue);if($)q.activeTexture.set(oe.TEXTURE0),Ce.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),Ne.updatePaintBuffers(J);else if(N&&(Be||d.lineAtlas.dirty))q.activeTexture.set(oe.TEXTURE0),d.lineAtlas.bind(q);else if(W){const wt=Le.gradients[w.id];let fr=wt.texture;if(w.gradientVersion!==wt.version){let Ct=256;if(w.stepInterpolant){const Lt=v.getSource().maxzoom,_r=_e.canonical.z===Lt?Math.ceil(1<<d.transform.maxZoom-_e.canonical.z):1;Ct=g.ac(g.aV(Le.maxLineLength/g.X*1024*_r),256,q.maxTextureSize)}wt.gradient=g.aW({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Ct,image:wt.gradient||void 0,clips:Le.lineClipsArray}),wt.texture?wt.texture.update(wt.gradient):wt.texture=new Kt(q,wt.gradient,oe.RGBA),wt.version=w.gradientVersion,fr=wt.texture}q.activeTexture.set(oe.TEXTURE0),fr.bind(w.stepInterpolant?oe.NEAREST:oe.LINEAR,oe.CLAMP_TO_EDGE)}Ve.draw(q,oe.TRIANGLES,M,d.stencilModeForClipping(_e),F,ur.disabled,Ze,it,w.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,w.paint,d.transform.zoom,Ne,Le.layoutVertexBuffer2),ue=!1}})(e,s,l,u);break;case"fill":(function(d,v,w,S){const I=w.paint.get("fill-color"),P=w.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const M=d.colorModeForRenderPass(),F=w.paint.get("fill-pattern"),N=d.opaquePassEnabledForLayer()&&!F.constantOr(1)&&I.constantOr(g.aM.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===N){const U=d.depthModeForSublayer(1,d.renderPass==="opaque"?jt.ReadWrite:jt.ReadOnly);zs(d,v,w,S,U,M,!1)}if(d.renderPass==="translucent"&&w.paint.get("fill-antialias")){const U=d.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,jt.ReadOnly);zs(d,v,w,S,U,M,!0)}})(e,s,l,u);break;case"fill-extrusion":(function(d,v,w,S){const I=w.paint.get("fill-extrusion-opacity");if(I!==0&&d.renderPass==="translucent"){const P=new jt(d.context.gl.LEQUAL,jt.ReadWrite,d.depthRangeFor3D);if(I!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))Pl(d,v,w,S,P,br.disabled,Zr.disabled),Pl(d,v,w,S,P,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const M=d.colorModeForRenderPass();Pl(d,v,w,S,P,br.disabled,M)}}})(e,s,l,u);break;case"hillshade":(function(d,v,w,S){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const I=d.context,P=d.depthModeForSublayer(0,jt.ReadOnly),M=d.colorModeForRenderPass(),[F,N]=d.renderPass==="translucent"?d.stencilConfigForOverlap(S):[{},S];for(const U of N){const $=v.getTile(U);$.needsHillshadePrepare!==void 0&&$.needsHillshadePrepare&&d.renderPass==="offscreen"?sa(d,$,w,P,br.disabled,M):d.renderPass==="translucent"&&As(d,U,$,w,P,F[U.overscaledZ],M)}I.viewport.set([0,0,d.width,d.height])})(e,s,l,u);break;case"raster":(function(d,v,w,S){if(d.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!S.length)return;const I=d.context,P=I.gl,M=v.getSource(),F=d.useProgram("raster"),N=d.colorModeForRenderPass(),[U,$]=M instanceof ds?[{},S]:d.stencilConfigForOverlap(S),W=$[$.length-1].overscaledZ,J=!d.options.moving;for(const re of $){const q=d.depthModeForSublayer(re.overscaledZ-W,w.paint.get("raster-opacity")===1?jt.ReadWrite:jt.ReadOnly,P.LESS),oe=v.getTile(re);oe.registerFadeDuration(w.paint.get("raster-fade-duration"));const ue=v.findLoadedParent(re,0),_e=v.findLoadedSibling(re),Ce=pu(oe,ue||_e||null,v,w,d.transform,d.style.map.terrain);let Le,Ne;const He=w.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;I.activeTexture.set(P.TEXTURE0),oe.texture.bind(He,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),I.activeTexture.set(P.TEXTURE1),ue?(ue.texture.bind(He,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),Le=Math.pow(2,ue.tileID.overscaledZ-oe.tileID.overscaledZ),Ne=[oe.tileID.canonical.x*Le%1,oe.tileID.canonical.y*Le%1]):oe.texture.bind(He,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),oe.texture.useMipmap&&I.extTextureFilterAnisotropic&&d.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const Ve=d.style.map.terrain&&d.style.map.terrain.getTerrainData(re),Be=Ve?re:null,it=Be?Be.posMatrix:d.transform.calculatePosMatrix(re.toUnwrapped(),J),bt=sc(it,Ne||[0,0],Le||1,Ce,w);M instanceof ds?F.draw(I,P.TRIANGLES,q,br.disabled,N,ur.disabled,bt,Ve,w.id,M.boundsBuffer,d.quadTriangleIndexBuffer,M.boundsSegments):F.draw(I,P.TRIANGLES,q,U[re.overscaledZ],N,ur.disabled,bt,Ve,w.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}})(e,s,l,u);break;case"background":(function(d,v,w,S){const I=w.paint.get("background-color"),P=w.paint.get("background-opacity");if(P===0)return;const M=d.context,F=M.gl,N=d.transform,U=N.tileSize,$=w.paint.get("background-pattern");if(d.isPatternMissing($))return;const W=!$&&I.a===1&&P===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==W)return;const J=br.disabled,re=d.depthModeForSublayer(0,W==="opaque"?jt.ReadWrite:jt.ReadOnly),q=d.colorModeForRenderPass(),oe=d.useProgram($?"backgroundPattern":"background"),ue=S||N.coveringTiles({tileSize:U,terrain:d.style.map.terrain});$&&(M.activeTexture.set(F.TEXTURE0),d.imageManager.bind(d.context));const _e=w.getCrossfadeParameters();for(const Ce of ue){const Le=S?Ce.posMatrix:d.transform.calculatePosMatrix(Ce.toUnwrapped()),Ne=$?nu(Le,P,d,$,{tileID:Ce,tileSize:U},_e):Po(Le,P,I),He=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Ce);oe.draw(M,F.TRIANGLES,re,J,q,ur.disabled,Ne,He,w.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}})(e,0,l,u);break;case"custom":(function(d,v,w){const S=d.context,I=w.implementation;if(d.renderPass==="offscreen"){const P=I.prerender;P&&(d.setCustomLayerDefaults(),S.setColorMode(d.colorModeForRenderPass()),P.call(I,S.gl,d.transform.customLayerMatrix()),S.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),S.setColorMode(d.colorModeForRenderPass()),S.setStencilMode(br.disabled);const P=I.renderingMode==="3d"?new jt(d.context.gl.LEQUAL,jt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,jt.ReadOnly);S.setDepthMode(P),I.render(S.gl,d.transform.customLayerMatrix(),{farZ:d.transform.farZ,nearZ:d.transform.nearZ,fov:d.transform._fov,modelViewProjectionMatrix:d.transform.modelViewProjectionMatrix,projectionMatrix:d.transform.projectionMatrix}),S.setDirty(),d.setBaseState(),S.bindFramebuffer.set(null)}})(e,0,l)}}translatePosMatrix(e,s,l,u,d){if(!l[0]&&!l[1])return e;const v=d?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(v){const I=Math.sin(v),P=Math.cos(v);l=[l[0]*P-l[1]*I,l[0]*I+l[1]*P]}const w=[d?l[0]:Mt(s,l[0],this.transform.zoom),d?l[1]:Mt(s,l[1],this.transform.zoom),0],S=new Float32Array(16);return g.J(S,e,w),S}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!s||!l}useProgram(e,s){this.cache=this.cache||{};const l=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new lr(this.context,Es[e],s,su[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Kt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class Lo{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l){const u=Math.pow(2,l),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((w=>{const S=1/(w=g.af([],w,e))[3]/s*u;return g.b1(w,w,[S,S,1/w[3],S])})),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((w=>{const S=(function(F,N){var U=N[0],$=N[1],W=N[2],J=U*U+$*$+W*W;return J>0&&(J=1/Math.sqrt(J)),F[0]=N[0]*J,F[1]=N[1]*J,F[2]=N[2]*J,F})([],(function(F,N,U){var $=N[0],W=N[1],J=N[2],re=U[0],q=U[1],oe=U[2];return F[0]=W*oe-J*q,F[1]=J*re-$*oe,F[2]=$*q-W*re,F})([],zr([],d[w[0]],d[w[1]]),zr([],d[w[2]],d[w[1]]))),I=-((P=S)[0]*(M=d[w[1]])[0]+P[1]*M[1]+P[2]*M[2]);var P,M;return S.concat(I)}));return new Lo(d,v)}}class Ro{constructor(e,s){this.min=e,this.max=s,this.center=(function(l,u,d){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l})([],(function(l,u,d){return l[0]=u[0]+d[0],l[1]=u[1]+d[1],l[2]=u[2]+d[2],l})([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],l=hr(this.min),u=hr(this.max);for(let d=0;d<s.length;d++)l[d]=s[d]?this.min[d]:this.center[d],u[d]=s[d]?this.center[d]:this.max[d];return u[2]=this.max[2],new Ro(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<e.planes.length;u++){const d=e.planes[u];let v=0;for(let w=0;w<s.length;w++)g.b2(d,s[w])>=0&&v++;if(v===0)return 0;v!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let d=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const S=e.points[w][u]-this.min[u];d=Math.min(d,S),v=Math.max(v,S)}if(v<0||d>this.max[u]-this.min[u])return 0}return 1}}class Fo{constructor(e=0,s=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=l,this.right=u}interpolate(e,s,l){return s.top!=null&&e.top!=null&&(this.top=g.y.number(e.top,s.top,l)),s.bottom!=null&&e.bottom!=null&&(this.bottom=g.y.number(e.bottom,s.bottom,l)),s.left!=null&&e.left!=null&&(this.left=g.y.number(e.left,s.left,l)),s.right!=null&&e.right!=null&&(this.right=g.y.number(e.right,s.right,l)),this}getCenter(e,s){const l=g.ac((this.left+e-this.right)/2,0,e),u=g.ac((this.top+s-this.bottom)/2,0,s);return new g.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Fo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const zl=85.051129;class lo{constructor(e,s,l,u,d){this.tileSize=512,this._renderWorldCopies=d===void 0||!!d,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new g.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new lo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new g.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-g.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(function(){var l=new g.A(4);return g.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l})(),(function(l,u,d){var v=u[0],w=u[1],S=u[2],I=u[3],P=Math.sin(d),M=Math.cos(d);l[0]=v*M+S*P,l[1]=w*M+I*P,l[2]=v*-P+S*M,l[3]=w*-P+I*M})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=g.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,l){this._unmodified=!1,this._edgeInsets.interpolate(e,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new g.b4(0,e)];if(this._renderWorldCopies){const l=this.pointCoordinate(new g.P(0,0)),u=this.pointCoordinate(new g.P(this.width,0)),d=this.pointCoordinate(new g.P(this.width,this.height)),v=this.pointCoordinate(new g.P(0,this.height)),w=Math.floor(Math.min(l.x,u.x,d.x,v.x)),S=Math.floor(Math.max(l.x,u.x,d.x,v.x)),I=1;for(let P=w-I;P<=S+I;P++)P!==0&&s.push(new g.b4(P,e))}return s}coveringTiles(e){var s,l;let u=this.coveringZoomLevel(e);const d=u;if(e.minzoom!==void 0&&u<e.minzoom)return[];e.maxzoom!==void 0&&u>e.maxzoom&&(u=e.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),w=g.Z.fromLngLat(this.center),S=Math.pow(2,u),I=[S*v.x,S*v.y,0],P=[S*w.x,S*w.y,0],M=Lo.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,u);let F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=u);const N=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,U=q=>({aabb:new Ro([q*S,0,0],[(q+1)*S,S,0]),zoom:0,x:0,y:0,wrap:q,fullyVisible:!1}),$=[],W=[],J=u,re=e.reparseOverscaled?d:u;if(this._renderWorldCopies)for(let q=1;q<=3;q++)$.push(U(-q)),$.push(U(q));for($.push(U(0));$.length>0;){const q=$.pop(),oe=q.x,ue=q.y;let _e=q.fullyVisible;if(!_e){const Ve=q.aabb.intersects(M);if(Ve===0)continue;_e=Ve===2}const Ce=e.terrain?I:P,Le=q.aabb.distanceX(Ce),Ne=q.aabb.distanceY(Ce),He=Math.max(Math.abs(Le),Math.abs(Ne));if(q.zoom===J||He>N+(1<<J-q.zoom)-2&&q.zoom>=F){const Ve=J-q.zoom,Be=I[0]-.5-(oe<<Ve),it=I[1]-.5-(ue<<Ve);W.push({tileID:new g.S(q.zoom===J?re:q.zoom,q.wrap,q.zoom,oe,ue),distanceSq:Mi([P[0]-.5-oe,P[1]-.5-ue]),tileDistanceToCamera:Math.sqrt(Be*Be+it*it)})}else for(let Ve=0;Ve<4;Ve++){const Be=(oe<<1)+Ve%2,it=(ue<<1)+(Ve>>1),bt=q.zoom+1;let Ue=q.aabb.quadrant(Ve);if(e.terrain){const Ze=new g.S(bt,q.wrap,bt,Be,it),wt=e.terrain.getMinMaxElevation(Ze),fr=(s=wt.minElevation)!==null&&s!==void 0?s:this.elevation,Ct=(l=wt.maxElevation)!==null&&l!==void 0?l:this.elevation;Ue=new Ro([Ue.min[0],Ue.min[1],fr],[Ue.max[0],Ue.max[1],Ct])}$.push({aabb:Ue,zoom:bt,x:Be,y:it,wrap:q.wrap,fullyVisible:_e})}}return W.sort(((q,oe)=>q.distanceSq-oe.distanceSq)).map((q=>q.tileID))}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=g.ac(e.lat,-85.051129,zl);return new g.P(g.O(e.lng)*this.worldSize,g.Q(s)*this.worldSize)}unproject(e){return new g.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,u=this.pointLocation(this.centerPoint,e),d=e.getElevationForLngLatZoom(u,this.tileZoom);if(!(this.elevation-d))return;const v=l+s-d,w=Math.cos(this._pitch)*this.cameraToCenterDistance/v/g.b5(1,u.lat),S=this.scaleZoom(w/this.tileSize);this._elevation=d,this._center=u,this.zoom=S}setLocationAtPoint(e,s){const l=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(e),v=new g.Z(d.x-(l.x-u.x),d.y-(l.y-u.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return g.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const F=s.pointCoordinate(e);if(F!=null)return F}const l=[e.x,e.y,0,1],u=[e.x,e.y,1,1];g.af(l,l,this.pixelMatrixInverse),g.af(u,u,this.pixelMatrixInverse);const d=l[3],v=u[3],w=l[1]/d,S=u[1]/v,I=l[2]/d,P=u[2]/v,M=I===P?0:(0-I)/(P-I);return new g.Z(g.y.number(l[0]/d,u[0]/v,M)/this.worldSize,g.y.number(w,S,M)/this.worldSize)}coordinatePoint(e,s=0,l=this.pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,s,1];return g.af(u,u,l),new g.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new we().extend(this.pointLocation(new g.P(0,e))).extend(this.pointLocation(new g.P(this.width,e))).extend(this.pointLocation(new g.P(this.width,this.height))).extend(this.pointLocation(new g.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new we([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,zl])}calculateTileMatrix(e){const s=e.canonical,l=this.worldSize/this.zoomScale(s.z),u=s.x+Math.pow(2,s.z)*e.wrap,d=g.an(new Float64Array(16));return g.J(d,d,[u*l,s.y*l,0]),g.K(d,d,[l/g.X,l/g.X,1]),d}calculatePosMatrix(e,s=!1){const l=e.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const d=this.calculateTileMatrix(e);return g.L(d,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,d),u[l]=new Float32Array(d),u[l]}calculateFogMatrix(e){const s=e.key,l=this._fogMatrixCache;if(l[s])return l[s];const u=this.calculateTileMatrix(e);return g.L(u,this.fogMatrix,u),l[s]=new Float32Array(u),l[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=g.ac(+s,this.minZoom,this.maxZoom);const l={center:new g.N(e.lng,e.lat),zoom:s};let u=this.lngRange;if(!this._renderWorldCopies&&u===null){const q=179.9999999999;u=[-q,q]}const d=this.tileSize*this.zoomScale(l.zoom);let v=0,w=d,S=0,I=d,P=0,M=0;const{x:F,y:N}=this.size;if(this.latRange){const q=this.latRange;v=g.Q(q[1])*d,w=g.Q(q[0])*d,w-v<N&&(P=N/(w-v))}u&&(S=g.b3(g.O(u[0])*d,0,d),I=g.b3(g.O(u[1])*d,0,d),I<S&&(I+=d),I-S<F&&(M=F/(I-S)));const{x:U,y:$}=this.project.call({worldSize:d},e);let W,J;const re=Math.max(M||0,P||0);if(re){const q=new g.P(M?(I+S)/2:U,P?(w+v)/2:$);return l.center=this.unproject.call({worldSize:d},q).wrap(),l.zoom+=this.scaleZoom(re),l}if(this.latRange){const q=N/2;$-q<v&&(J=v+q),$+q>w&&(J=w-q)}if(u){const q=(S+I)/2;let oe=U;this._renderWorldCopies&&(oe=g.b3(U,q-d/2,q+d/2));const ue=F/2;oe-ue<S&&(W=S+ue),oe+ue>I&&(W=I-ue)}if(W!==void 0||J!==void 0){const q=new g.P(W??U,J??$);l.center=this.unproject.call({worldSize:d},q).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=g.b5(1,this.center.lat)*this.worldSize;let u=g.an(new Float64Array(16));g.K(u,u,[this.width/2,-this.height/2,1]),g.J(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=g.an(new Float64Array(16)),g.K(u,u,[1,-1,1]),g.J(u,u,[-1,-1,0]),g.K(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const d=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this.minElevationForCurrentTile),w=d-v*this._pixelPerMeter/Math.cos(this._pitch),S=v<0?w:d,I=Math.PI/2+this._pitch,P=this._fov*(.5+e.y/this.height),M=Math.sin(P)*S/Math.sin(g.ac(Math.PI-I-P,.01,Math.PI-.01)),F=this.getHorizon(),N=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),U=Math.sin(N)*S/Math.sin(g.ac(Math.PI-I-N,.01,Math.PI-.01)),$=Math.min(M,U);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*$+S),this.nearZ=this.height/50,u=new Float64Array(16),g.b6(u,this._fov,this.width/this.height,this.nearZ,this.farZ),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,this.projectionMatrix=g.ae(u),g.K(u,u,[1,-1,1]),g.J(u,u,[0,0,-this.cameraToCenterDistance]),g.b7(u,u,this._pitch),g.ad(u,u,this.angle),g.J(u,u,[-s,-l,0]),this.mercatorMatrix=g.K([],u,[this.worldSize,this.worldSize,this.worldSize]),g.K(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=g.L(new Float64Array(16),this.labelPlaneMatrix,u),g.J(u,u,[0,0,-this.elevation]),this.modelViewProjectionMatrix=u,this.invModelViewProjectionMatrix=g.as([],u),this.fogMatrix=new Float64Array(16),g.b6(this.fogMatrix,this._fov,this.width/this.height,d,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,g.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),g.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),g.b7(this.fogMatrix,this.fogMatrix,this._pitch),g.ad(this.fogMatrix,this.fogMatrix,this.angle),g.J(this.fogMatrix,this.fogMatrix,[-s,-l,0]),g.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),g.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=g.L(new Float64Array(16),this.labelPlaneMatrix,u);const W=this.width%2/2,J=this.height%2/2,re=Math.cos(this.angle),q=Math.sin(this.angle),oe=s-Math.round(s)+re*W+q*J,ue=l-Math.round(l)+re*J+q*W,_e=new Float64Array(u);if(g.J(_e,_e,[oe>.5?oe-1:oe,ue>.5?ue-1:ue,0]),this.alignedModelViewProjectionMatrix=_e,u=g.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new g.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return g.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new g.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let l=s.x,u=s.y,d=s.x,v=s.y;for(const w of e)l=Math.min(l,w.x),u=Math.min(u,w.y),d=Math.max(d,w.x),v=Math.max(v,w.y);return[new g.P(l,u),new g.P(d,u),new g.P(d,v),new g.P(l,v),new g.P(l,u)]}}lngLatToCameraDepth(e,s){const l=this.locationCoordinate(e),u=[l.x*this.worldSize,l.y*this.worldSize,s,1];return g.af(u,u,this.modelViewProjectionMatrix),u[2]/u[3]}}function Ha(p,e){let s,l=!1,u=null,d=null;const v=()=>{u=null,l&&(p.apply(d,s),u=setTimeout(v,e),l=!1)};return(...w)=>(l=!0,d=this,s=w,u||v(),u)}class Al{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map((u=>u.split("="))).forEach((u=>{u[0]===this._hashName&&(l=u)})),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some((l=>isNaN(l)))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const l=s.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let d=window.location.hash.replace(u,"");d.startsWith("#&")?d=d.slice(0,1)+d.slice(2):d==="#"&&(d="");let v=window.location.href.replace(/(#.+)?$/,d);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Ha(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,u),v=Math.round(s.lng*d)/d,w=Math.round(s.lat*d)/d,S=this._map.getBearing(),I=this._map.getPitch();let P="";if(P+=e?`/${v}/${w}/${l}`:`${l}/${w}/${v}`,(S||I)&&(P+="/"+Math.round(10*S)/10),I&&(P+=`/${Math.round(I)}`),this._hashName){const M=this._hashName;let F=!1;const N=window.location.hash.slice(1).split("&").map((U=>{const $=U.split("=")[0];return $===M?(F=!0,`${$}=${P}`):U})).filter((U=>U));return F||N.push(`${M}=${P}`),`#${N.join("&")}`}return`#${P}`}}const Ds={linearity:.3,easing:g.b8(0,0,.3,1)},Wa=g.e({deceleration:2500,maxSpeed:1400},Ds),Xa=g.e({deceleration:20,maxSpeed:1400},Ds),Dl=g.e({deceleration:1e3,maxSpeed:360},Ds),Ka=g.e({deceleration:1e3,maxSpeed:90},Ds);class aa{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ke.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=ke.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new g.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)s.zoom+=d.zoomDelta||0,s.bearing+=d.bearingDelta||0,s.pitch+=d.pitchDelta||0,d.panDelta&&s.pan._add(d.panDelta),d.around&&(s.around=d.around),d.pinchAround&&(s.pinchAround=d.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const d=Bo(s.pan.mag(),l,g.e({},Wa,e||{}));u.offset=s.pan.mult(d.amount/s.pan.mag()),u.center=this._map.transform.center,ms(u,d)}if(s.zoom){const d=Bo(s.zoom,l,Xa);u.zoom=this._map.transform.zoom+d.amount,ms(u,d)}if(s.bearing){const d=Bo(s.bearing,l,Dl);u.bearing=this._map.transform.bearing+g.ac(d.amount,-179,179),ms(u,d)}if(s.pitch){const d=Bo(s.pitch,l,Ka);u.pitch=this._map.transform.pitch+d.amount,ms(u,d)}if(u.zoom||u.bearing){const d=s.pinchAround===void 0?s.around:s.pinchAround;u.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),g.e(u,{noMoveStart:!0})}}function ms(p,e){(!p.duration||p.duration<e.duration)&&(p.duration=e.duration,p.easing=e.easing)}function Bo(p,e,s){const{maxSpeed:l,linearity:u,deceleration:d}=s,v=g.ac(p*u/(e/1e3),-l,l),w=Math.abs(v)/(d*u);return{easing:s.easing,duration:1e3*w,amount:v*(w/2)}}class _i extends g.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l,u={}){const d=ge.mousePos(s.getCanvas(),l),v=s.unproject(d);super(e,g.e({point:d,lngLat:v,originalEvent:l},u)),this._defaultPrevented=!1,this.target=s}}class gs extends g.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){const u=e==="touchend"?l.changedTouches:l.touches,d=ge.touchPos(s.getCanvasContainer(),u),v=d.map((S=>s.unproject(S))),w=d.reduce(((S,I,P,M)=>S.add(I.div(M.length))),new g.P(0,0));super(e,{points:d,point:w,lngLats:v,lngLat:s.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class mu extends g.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class gu{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new mu(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new _i(e.type,this._map,e))}mouseup(e){this._map.fire(new _i(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new _i(e.type,this._map,e))}dblclick(e){return this._firePreventable(new _i(e.type,this._map,e))}mouseover(e){this._map.fire(new _i(e.type,this._map,e))}mouseout(e){this._map.fire(new _i(e.type,this._map,e))}touchstart(e){return this._firePreventable(new gs(e.type,this._map,e))}touchmove(e){this._map.fire(new gs(e.type,this._map,e))}touchend(e){this._map.fire(new gs(e.type,this._map,e))}touchcancel(e){this._map.fire(new gs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new _i(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _i("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new _i(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(g.P.convert(e),this._map.terrain)}}class Gi{constructor(e,s){this._map=e,this._tr=new kn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(ge.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=ge.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const d=Math.min(u.x,l.x),v=Math.max(u.x,l.x),w=Math.min(u.y,l.y),S=Math.max(u.y,l.y);ge.setTransform(this._box,`translate(${d}px,${w}px)`),this._box.style.width=v-d+"px",this._box.style.height=S-w+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const l=this._startPos,u=s;if(this.reset(),ge.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new g.k("boxzoomend",{originalEvent:e})),{cameraAnimation:d=>d.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ge.remove(this._box),this._box=null),ge.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new g.k(e,{originalEvent:s}))}}function la(p,e){if(p.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${e.length}`);const s={};for(let l=0;l<p.length;l++)s[p[l].identifier]=e[l];return s}class _s{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=(function(u){const d=new g.P(0,0);for(const v of u)d._add(v);return d.div(u.length)})(s),this.touches=la(l,s)))}touchmove(e,s,l){if(this.aborted||!this.centroid)return;const u=la(l,s);for(const d in this.touches){const v=u[d];(!v||v.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(e,s,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class ua{constructor(e){this.singleTap=new _s(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,l){this.singleTap.touchstart(e,s,l)}touchmove(e,s,l){this.singleTap.touchmove(e,s,l)}touchend(e,s,l){const u=this.singleTap.touchend(e,s,l);if(u){const d=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(u)<30;if(d&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class uo{constructor(e){this._tr=new kn(e),this._zoomIn=new ua({numTouches:1,numTaps:2}),this._zoomOut=new ua({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,l){this._zoomIn.touchstart(e,s,l),this._zoomOut.touchstart(e,s,l)}touchmove(e,s,l){this._zoomIn.touchmove(e,s,l),this._zoomOut.touchmove(e,s,l)}touchend(e,s,l){const u=this._zoomIn.touchend(e,s,l),d=this._zoomOut.touchend(e,s,l),v=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(u)},{originalEvent:e})}):d?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(d)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ls{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=s.length?s[0]:s;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&ge.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const _u={0:1,2:2};class co{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=ge.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(s,l){const u=_u[l];return s.buttons===void 0||(s.buttons&u)!==u})(e,this._eventButton)}isValidEndEvent(e){return ge.mouseButton(e)===this._eventButton}}class yu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const Ja=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=e=>{e.preventDefault()}},Ll=({enable:p,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const l=new co({checkCorrectEvent:u=>ge.mouseButton(u)===0&&u.ctrlKey||ge.mouseButton(u)===2});return new Ls({clickTolerance:e,move:(u,d)=>({bearingDelta:(d.x-u.x)*s}),moveStateManager:l,enable:p,assignEvents:Ja})},Sr=({enable:p,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new co({checkCorrectEvent:u=>ge.mouseButton(u)===0&&u.ctrlKey||ge.mouseButton(u)===2});return new Ls({clickTolerance:e,move:(u,d)=>({pitchDelta:(d.y-u.y)*s}),moveStateManager:l,enable:p,assignEvents:Ja})};class Rs{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new g.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,l){return this._calculateTransform(e,s,l)}touchmove(e,s,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,s,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,l){this._calculateTransform(e,s,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,l){l.length>0&&(this._active=!0);const u=la(l,s),d=new g.P(0,0),v=new g.P(0,0);let w=0;for(const I in u){const P=u[I],M=this._touches[I];M&&(d._add(P),v._add(P.sub(M)),w++,u[I]=P)}if(this._touches=u,this._shouldBePrevented(w)||!v.mag())return;const S=v.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(w),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,d]=this._firstTwoTouches,v=Fs(l,s,u),w=Fs(l,s,d);if(!v||!w)return;const S=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],S,e)}touchend(e,s,l){if(!this._firstTwoTouches)return;const[u,d]=this._firstTwoTouches,v=Fs(l,s,u),w=Fs(l,s,d);v&&w||(this._active&&ge.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Fs(p,e,s){for(let l=0;l<p.length;l++)if(p[l].identifier===s)return e[l]}function Rl(p,e){return Math.log(p/e)/Math.LN2}class Ya extends Oo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Rl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Rl(this._distance,l),pinchAround:s}}}function No(p,e){return 180*p.angleWith(e)/Math.PI}class ca extends Oo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:No(this._vector,u),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,l=No(e,this._startVector);return Math.abs(l)<s}}function Bs(p){return Math.abs(p.y)>Math.abs(p.x)}class ha extends Oo{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,l){super.touchstart(e,s,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,Bs(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),d=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,d,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,d=s.mag()>=2;if(!u&&!d)return;if(!u||!d)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=e.y>0==s.y>0;return Bs(e)&&Bs(s)&&v}}const yc={panStep:100,bearingStep:15,pitchStep:10};class In{constructor(e){this._tr=new kn(e);const s=yc;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,l=0,u=0,d=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),d=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),d=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:w=>{const S=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Hn,zoom:s?Math.round(S.zoom)+s*(e.shiftKey?2:1):S.zoom,bearing:S.bearing+l*this._bearingStep,pitch:S.pitch+u*this._pitchStep,offset:[-d*this._panStep,-v*this._panStep],center:S.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hn(p){return p*(2-p)}const da=4.000244140625;class Hi{constructor(e,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new kn(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=ke.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%da==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=ge.mousePos(this._map.getCanvas(),e),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?g.N.convert(this._aroundCenter?l.center:l.unproject(s)):g.N.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>da?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&I!==0&&(I=1/I);const P=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(P*I))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,l=this._startZoom,u=this._easing;let d,v=!1;const w=ke.now()-this._lastWheelEventTime;if(this._type==="wheel"&&l&&u&&w){const S=Math.min(w/200,1),I=u(S);d=g.y.number(l,s,I),S<1?this._frameId||(this._frameId=!0):v=!0}else d=s,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:d-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=g.b9;if(this._prevEase){const l=this._prevEase,u=(ke.now()-l.start)/l.duration,d=l.easing(u+.01)-l.easing(u),v=.27/Math.sqrt(d*d+1e-4)*.01,w=Math.sqrt(.0729-v*v);s=g.b8(v,w,.25,1)}return this._prevEase={start:ke.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Os{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class vu{constructor(e){this._tr=new kn(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xu{constructor(){this._tap=new ua({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,l){if(!this._swipePoint)if(this._tapTime){const u=s[0],d=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(u)<30;d&&v?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,s,l)}touchmove(e,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=s[0],d=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(e,s,l)}touchend(e,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,s,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fl{constructor(e,s,l){this._el=e,this._mousePan=s,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vc{constructor(e,s,l){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Bl{constructor(e,s,l,u){this._el=e,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class pa{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=ge.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=s,this._container.appendChild(u);const d=document.createElement("div");d.className="maplibregl-mobile-message",d.textContent=l,this._container.appendChild(d),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ge.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new g.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const En=p=>p.zoom||p.drag||p.pitch||p.rotate;class Ye extends g.k{}function Wn(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Ol{constructor(e,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,d)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=u.type==="renderFrame"?void 0:u,w={needsRenderFrame:!1},S={},I={},P=u.touches,M=P?this._getMapTouches(P):void 0,F=M?ge.touchPos(this._map.getCanvas(),M):ge.mousePos(this._map.getCanvas(),u);for(const{handlerName:$,handler:W,allowed:J}of this._handlers){if(!W.isEnabled())continue;let re;this._blockedByActive(I,J,$)?W.reset():W[d||u.type]&&(re=W[d||u.type](u,F,M),this.mergeHandlerResult(w,S,re,$,v),re&&re.needsRenderFrame&&this._triggerRenderFrame()),(re||W.isActive())&&(I[$]=W)}const N={};for(const $ in this._previousActiveHandlers)I[$]||(N[$]=v);this._previousActiveHandlers=I,(Object.keys(N).length||Wn(w))&&(this._changes.push([w,S,N]),this._triggerRenderFrame()),(Object.keys(I).length||Wn(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=w;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new aa(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,d,v]of this._listeners)ge.addEventListener(u,d,u===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,s,l]of this._listeners)ge.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new gu(s,e));const u=s.boxZoom=new Gi(s,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const d=s.cooperativeGestures=new pa(s,e.cooperativeGestures);this._add("cooperativeGestures",d),e.cooperativeGestures&&d.enable();const v=new uo(s),w=new vu(s);s.doubleClickZoom=new Os(w,v),this._add("tapZoom",v),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const S=new xu;this._add("tapDragZoom",S);const I=s.touchPitch=new ha(s);this._add("touchPitch",I),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const P=Ll(e),M=Sr(e);s.dragRotate=new vc(e,P,M),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const F=(({enable:re,clickTolerance:q})=>{const oe=new co({checkCorrectEvent:ue=>ge.mouseButton(ue)===0&&!ue.ctrlKey});return new Ls({clickTolerance:q,move:(ue,_e)=>({around:_e,panDelta:_e.sub(ue)}),activateOnStart:!0,moveStateManager:oe,enable:re,assignEvents:Ja})})(e),N=new Rs(e,s);s.dragPan=new Fl(l,F,N),this._add("mousePan",F),this._add("touchPan",N,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const U=new ca,$=new Ya;s.touchZoomRotate=new Bl(l,$,U,S),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const W=s.scrollZoom=new Hi(s,(()=>this._triggerRenderFrame()));this._add("scrollZoom",W,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const J=s.keyboard=new In(s);this._add("keyboard",J),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new jr(s))}_add(e,s,l){this._handlers.push({handlerName:e,handler:s,allowed:l}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!En(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,l){for(const u in e)if(u!==l&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const l of e)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(e,s,l,u,d){if(!l)return;g.e(e,l);const v={handlerName:u,originalEvent:l.originalEvent||d};l.zoomDelta!==void 0&&(s.zoom=v),l.panDelta!==void 0&&(s.drag=v),l.pitchDelta!==void 0&&(s.pitch=v),l.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const e={},s={},l={};for(const[u,d,v]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new g.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),g.e(s,d),g.e(l,v);this._updateMapTransform(e,s,l),this._changes=[]}_updateMapTransform(e,s,l){const u=this._map,d=u._getTransformForUpdate(),v=u.terrain;if(!(Wn(e)||v&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:w,zoomDelta:S,bearingDelta:I,pitchDelta:P,around:M,pinchAround:F}=e;F!==void 0&&(M=F),u._stop(!0),M=M||u.transform.centerPoint;const N=d.pointLocation(w?M.sub(w):M);I&&(d.bearing+=I),P&&(d.pitch+=P),S&&(d.zoom+=S),v?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?d.center=d.pointLocation(d.centerPoint.sub(w)):d.setLocationAtPoint(N,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,d.setLocationAtPoint(N,M)):d.setLocationAtPoint(N,M),u._applyUpdatedTransform(d),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,l,!0)}_fireEvents(e,s,l){const u=En(this._eventsInProgress),d=En(e),v={};for(const M in e){const{originalEvent:F}=e[M];this._eventsInProgress[M]||(v[`${M}start`]=F),this._eventsInProgress[M]=e[M]}!u&&d&&this._fireEvent("movestart",d.originalEvent);for(const M in v)this._fireEvent(M,v[M]);d&&this._fireEvent("move",d.originalEvent);for(const M in e){const{originalEvent:F}=e[M];this._fireEvent(M,F)}const w={};let S;for(const M in this._eventsInProgress){const{handlerName:F,originalEvent:N}=this._eventsInProgress[M];this._handlersById[F].isActive()||(delete this._eventsInProgress[M],S=s[F]||N,w[`${M}end`]=S)}for(const M in w)this._fireEvent(M,w[M]);const I=En(this._eventsInProgress),P=(u||d)&&!I;if(P&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const M=this._map._getTransformForUpdate();M.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(M)}if(l&&P){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;!M||!M.essential&&ke.prefersReducedMotion?(this._map.fire(new g.k("moveend",{originalEvent:S})),F(this._map.getBearing())&&this._map.resetNorth()):(F(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new g.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Ye("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Vo extends g.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const l=Math.min((ke.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new g.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,l){return e=g.P.convert(e).mult(-1),this.panTo(this.transform.center,g.e({offset:e},s),l)}panTo(e,s,l){return this.easeTo(g.e({center:e},s),l)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,l){return this.easeTo(g.e({zoom:e},s),l)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,l){return this.easeTo(g.e({bearing:e},s),l)}resetNorth(e,s){return this.rotateTo(0,g.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(g.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=we.convert(e).adjustAntiMeridian();const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,s)}_cameraForBoxAndBearing(e,s,l,u){const d={top:0,bottom:0,right:0,left:0};if(typeof(u=g.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const Ve=u.padding;u.padding={top:Ve,bottom:Ve,right:Ve,left:Ve}}u.padding=g.e(d,u.padding);const v=this.transform,w=v.padding,S=new we(e,s),I=v.project(S.getNorthWest()),P=v.project(S.getNorthEast()),M=v.project(S.getSouthEast()),F=v.project(S.getSouthWest()),N=g.ba(-l),U=I.rotate(N),$=P.rotate(N),W=M.rotate(N),J=F.rotate(N),re=new g.P(Math.max(U.x,$.x,J.x,W.x),Math.max(U.y,$.y,J.y,W.y)),q=new g.P(Math.min(U.x,$.x,J.x,W.x),Math.min(U.y,$.y,J.y,W.y)),oe=re.sub(q),ue=(v.width-(w.left+w.right+u.padding.left+u.padding.right))/oe.x,_e=(v.height-(w.top+w.bottom+u.padding.top+u.padding.bottom))/oe.y;if(_e<0||ue<0)return void g.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ce=Math.min(v.scaleZoom(v.scale*Math.min(ue,_e)),u.maxZoom),Le=g.P.convert(u.offset),Ne=new g.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(g.ba(l)),He=Le.add(Ne).mult(v.scale/v.zoomScale(Ce));return{center:v.unproject(I.add(M).div(2).sub(He)),zoom:Ce,bearing:l}}fitBounds(e,s,l){return this._fitInternal(this.cameraForBounds(e,s),s,l)}fitScreenCoordinates(e,s,l,u,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(g.P.convert(e)),this.transform.pointLocation(g.P.convert(s)),l,u),u,d)}_fitInternal(e,s,l){return e?(delete(s=g.e(e,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(e,s){this.stop();const l=this._getTransformForUpdate();let u=!1,d=!1,v=!1;return"zoom"in e&&l.zoom!==+e.zoom&&(u=!0,l.zoom=+e.zoom),e.center!==void 0&&(l.center=g.N.convert(e.center)),"bearing"in e&&l.bearing!==+e.bearing&&(d=!0,l.bearing=+e.bearing),"pitch"in e&&l.pitch!==+e.pitch&&(v=!0,l.pitch=+e.pitch),e.padding==null||l.isPaddingEqual(e.padding)||(l.padding=e.padding),this._applyUpdatedTransform(l),this.fire(new g.k("movestart",s)).fire(new g.k("move",s)),u&&this.fire(new g.k("zoomstart",s)).fire(new g.k("zoom",s)).fire(new g.k("zoomend",s)),d&&this.fire(new g.k("rotatestart",s)).fire(new g.k("rotate",s)).fire(new g.k("rotateend",s)),v&&this.fire(new g.k("pitchstart",s)).fire(new g.k("pitch",s)).fire(new g.k("pitchend",s)),this.fire(new g.k("moveend",s))}calculateCameraOptionsFromTo(e,s,l,u=0){const d=g.Z.fromLngLat(e,s),v=g.Z.fromLngLat(l,u),w=v.x-d.x,S=v.y-d.y,I=v.z-d.z,P=Math.hypot(w,S,I);if(P===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(w,S),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/P/this.transform.tileSize),N=180*Math.atan2(w,-S)/Math.PI;let U=180*Math.acos(M/P)/Math.PI;return U=I<0?90-U:90+U,{center:v.toLngLat(),zoom:F,pitch:U,bearing:N}}easeTo(e,s){var l;this._stop(!1,e.easeId),((e=g.e({offset:[0,0],duration:500,easing:g.b9},e)).animate===!1||!e.essential&&ke.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),d=u.zoom,v=u.bearing,w=u.pitch,S=u.padding,I="bearing"in e?this._normalizeBearing(e.bearing,v):v,P="pitch"in e?+e.pitch:w,M="padding"in e?e.padding:u.padding,F=g.P.convert(e.offset);let N=u.centerPoint.add(F);const U=u.pointLocation(N),{center:$,zoom:W}=u.getConstrained(g.N.convert(e.center||U),(l=e.zoom)!==null&&l!==void 0?l:d);this._normalizeCenter($,u);const J=u.project(U),re=u.project($).sub(J),q=u.zoomScale(W-d);let oe,ue;e.around&&(oe=g.N.convert(e.around),ue=u.locationPoint(oe));const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||W!==d,this._rotating=this._rotating||v!==I,this._pitching=this._pitching||P!==w,this._padding=!u.isPaddingEqual(M),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,_e),this.terrain&&this._prepareElevation($),this._ease((Ce=>{if(this._zooming&&(u.zoom=g.y.number(d,W,Ce)),this._rotating&&(u.bearing=g.y.number(v,I,Ce)),this._pitching&&(u.pitch=g.y.number(w,P,Ce)),this._padding&&(u.interpolatePadding(S,M,Ce),N=u.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ce),oe)u.setLocationAtPoint(oe,ue);else{const Le=u.zoomScale(u.zoom-d),Ne=W>d?Math.min(2,q):Math.max(.5,q),He=Math.pow(Ne,1-Ce),Ve=u.unproject(J.add(re.mult(Ce*He)).mult(Le));u.setLocationAtPoint(u.renderWorldCopies?Ve.wrap():Ve,N)}this._applyUpdatedTransform(u),this._fireMoveEvents(s)}),(Ce=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,Ce)}),e),this}_prepareEase(e,s,l={}){this._moving=!0,s||l.moving||this.fire(new g.k("movestart",e)),this._zooming&&!l.zooming&&this.fire(new g.k("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new g.k("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new g.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(s-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=g.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),l=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<l){const u=this.calculateCameraOptionsFromTo(s.lngLat,l,e.center,e.elevation);return{pitch:u.pitch,zoom:u.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push((u=>this._elevateCameraIfInsideTerrain(u))),this.transformCameraUpdate&&s.push((u=>this.transformCameraUpdate(u))),!s.length)return;const l=e.clone();for(const u of s){const d=l.clone(),{center:v,zoom:w,pitch:S,bearing:I,elevation:P}=u(d);v&&(d.center=v),w!==void 0&&(d.zoom=w),S!==void 0&&(d.pitch=S),I!==void 0&&(d.bearing=I),P!==void 0&&(d.elevation=P),l.apply(d)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new g.k("move",e)),this._zooming&&this.fire(new g.k("zoom",e)),this._rotating&&this.fire(new g.k("rotate",e)),this._pitching&&this.fire(new g.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,u=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new g.k("zoomend",e)),u&&this.fire(new g.k("rotateend",e)),d&&this.fire(new g.k("pitchend",e)),this.fire(new g.k("moveend",e))}flyTo(e,s){var l;if(!e.essential&&ke.prefersReducedMotion){const Ze=g.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ze,s)}this.stop(),e=g.e({offset:[0,0],speed:1.2,curve:1.42,easing:g.b9},e);const u=this._getTransformForUpdate(),d=u.zoom,v=u.bearing,w=u.pitch,S=u.padding,I="bearing"in e?this._normalizeBearing(e.bearing,v):v,P="pitch"in e?+e.pitch:w,M="padding"in e?e.padding:u.padding,F=g.P.convert(e.offset);let N=u.centerPoint.add(F);const U=u.pointLocation(N),{center:$,zoom:W}=u.getConstrained(g.N.convert(e.center||U),(l=e.zoom)!==null&&l!==void 0?l:d);this._normalizeCenter($,u);const J=u.zoomScale(W-d),re=u.project(U),q=u.project($).sub(re);let oe=e.curve;const ue=Math.max(u.width,u.height),_e=ue/J,Ce=q.mag();if("minZoom"in e){const Ze=g.ac(Math.min(e.minZoom,d,W),u.minZoom,u.maxZoom),wt=ue/u.zoomScale(Ze-d);oe=Math.sqrt(wt/Ce*2)}const Le=oe*oe;function Ne(Ze){const wt=(_e*_e-ue*ue+(Ze?-1:1)*Le*Le*Ce*Ce)/(2*(Ze?_e:ue)*Le*Ce);return Math.log(Math.sqrt(wt*wt+1)-wt)}function He(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Ve(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Be=Ne(!1);let it=function(Ze){return Ve(Be)/Ve(Be+oe*Ze)},bt=function(Ze){return ue*((Ve(Be)*(He(wt=Be+oe*Ze)/Ve(wt))-He(Be))/Le)/Ce;var wt},Ue=(Ne(!0)-Be)/oe;if(Math.abs(Ce)<1e-6||!isFinite(Ue)){if(Math.abs(ue-_e)<1e-6)return this.easeTo(e,s);const Ze=_e<ue?-1:1;Ue=Math.abs(Math.log(_e/ue))/oe,bt=()=>0,it=wt=>Math.exp(Ze*oe*wt)}return e.duration="duration"in e?+e.duration:1e3*Ue/("screenSpeed"in e?+e.screenSpeed/oe:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=v!==I,this._pitching=P!==w,this._padding=!u.isPaddingEqual(M),this._prepareEase(s,!1),this.terrain&&this._prepareElevation($),this._ease((Ze=>{const wt=Ze*Ue,fr=1/it(wt);u.zoom=Ze===1?W:d+u.scaleZoom(fr),this._rotating&&(u.bearing=g.y.number(v,I,Ze)),this._pitching&&(u.pitch=g.y.number(w,P,Ze)),this._padding&&(u.interpolatePadding(S,M,Ze),N=u.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ze);const Ct=Ze===1?$:u.unproject(re.add(q.mult(bt(wt))).mult(fr));u.setLocationAtPoint(u.renderWorldCopies?Ct.wrap():Ct,N),this._applyUpdatedTransform(u),this._fireMoveEvents(s)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,s,l){l.animate===!1||l.duration===0?(e(1),s()):(this._easeStart=ke.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=g.b3(e,-180,180);const l=Math.abs(e-s);return Math.abs(e-360-s)<l&&(e-=360),Math.abs(e+360-s)<l&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const l=e.lng-s.center.lng;e.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(g.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Ri={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ys{constructor(e=Ri){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=ge.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ge.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ge.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ge.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const l=this._map._getUIString(`AttributionControl.${s}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((u=>typeof u!="string"?"":u))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const d=s[u];if(d.used||d.usedForTerrain){const v=d.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter((u=>String(u).trim())),e.sort(((u,d)=>u.length-d.length)),e=e.filter(((u,d)=>{for(let v=d+1;v<e.length;v++)if(e[v].indexOf(u)>=0)return!1;return!0}));const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Xn{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=ge.create("div","maplibregl-ctrl");const s=ge.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ge.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ut{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var wu=g.Y([{name:"a_pos3d",type:"Int16",components:3}]);class dh extends g.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const l={};for(const u of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),g.aP(u.posMatrix,0,g.X,0,g.X,0,1),this._tiles[u.key]=new Qs(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const s in this._tiles){const l=this._tiles[s];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(e.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16),g.aP(d.posMatrix,0,g.X,0,g.X,0,1),s[l]=d}else if(u.canonical.isChildOf(e.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16);const v=u.canonical.z-e.canonical.z,w=u.canonical.x-(u.canonical.x>>v<<v),S=u.canonical.y-(u.canonical.y>>v<<v),I=g.X>>v;g.aP(d.posMatrix,0,I,0,I,0,1),g.J(d.posMatrix,d.posMatrix,[-w*I,-S*I,0]),s[l]=d}else if(e.canonical.isChildOf(u.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16);const v=e.canonical.z-u.canonical.z,w=e.canonical.x-(e.canonical.x>>v<<v),S=e.canonical.y-(e.canonical.y>>v<<v),I=g.X>>v;g.aP(d.posMatrix,0,g.X,0,g.X,0,1),g.J(d.posMatrix,d.posMatrix,[w*I,S*I,0]),g.K(d.posMatrix,d.posMatrix,[1/2**v,1/2**v,0]),s[l]=d}}return s}getSourceTile(e,s){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!d||!d.dem)&&s)for(;u>=l.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(e.scaledTo(u--).key);return d}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter((s=>s.timeAdded>=e))}}class Ns{constructor(e,s,l){this.painter=e,this.sourceCache=new dh(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,l,u=g.X){var d;if(!(s>=0&&s<u&&l>=0&&l<u))return 0;const v=this.getTerrainData(e),w=(d=v.tile)===null||d===void 0?void 0:d.dem;if(!w)return 0;const S=(function(U,$,W){var J=$[0],re=$[1];return U[0]=W[0]*J+W[4]*re+W[12],U[1]=W[1]*J+W[5]*re+W[13],U})([],[s/u*g.X,l/u*g.X],v.u_terrain_matrix),I=[S[0]*w.dim,S[1]*w.dim],P=Math.floor(I[0]),M=Math.floor(I[1]),F=I[0]-P,N=I[1]-M;return w.get(P,M)*(1-F)*(1-N)+w.get(P+1,M)*F*(1-N)+w.get(P,M+1)*(1-F)*N+w.get(P+1,M+1)*F*N}getElevationForLngLatZoom(e,s){if(!g.bb(s,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(l,u%g.X,d%g.X,g.X)}getElevation(e,s,l,u=g.X){return this.getDEMElevation(e,s,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,d=new g.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Kt(u,d,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Kt(u,new g.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=g.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new Kt(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let d=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?d=e.canonical.z-u:g.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>d<<d),w=e.canonical.y-(e.canonical.y>>d<<d),S=g.bc(new Float64Array(16),[1/(g.X<<d),1/(g.X<<d),0]);g.J(S,S,[v*g.X,w*g.X,0]),this._demMatrixCache[e.key]={matrix:S,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,l=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Kt(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Kt(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,v=0;d<this._coordsTextureSize;d++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)s[v+0]=255&w,s[v+1]=255&d,s[v+2]=w>>8<<4|d>>8,s[v+3]=0;const l=new g.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new Kt(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,u=l.gl,d=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(d,w-v-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const S=s[0]+(s[2]>>4<<8),I=s[1]+((15&s[2])<<8),P=this.coordsIndex[255-s[3]],M=P&&this.sourceCache.getTileByID(P);if(!M)return null;const F=this._coordsTextureSize,N=(1<<M.tileID.canonical.z)*F;return new g.Z((M.tileID.canonical.x*F+S)/N+M.tileID.wrap,(M.tileID.canonical.y*F+I)/N,this.getElevation(M.tileID,S,I,F))}depthAtPoint(e){const s=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new g.bd,l=new g.aY,u=this.meshSize,d=g.X/u,v=u*u;for(let M=0;M<=u;M++)for(let F=0;F<=u;F++)s.emplaceBack(F*d,M*d,0);for(let M=0;M<v;M+=u+1)for(let F=0;F<u;F++)l.emplaceBack(F+M,u+F+M+1,u+F+M+2),l.emplaceBack(F+M,u+F+M+2,F+M+1);const w=s.length,S=w+2*(u+1);for(const M of[0,1])for(let F=0;F<=u;F++)for(const N of[0,1])s.emplaceBack(F*d,M*g.X,N);for(let M=0;M<2*u;M+=2)l.emplaceBack(S+M,S+M+1,S+M+3),l.emplaceBack(S+M,S+M+3,S+M+2),l.emplaceBack(w+M,w+M+3,w+M+1),l.emplaceBack(w+M,w+M+2,w+M+3);const I=s.length,P=I+2*(u+1);for(const M of[0,1])for(let F=0;F<=u;F++)for(const N of[0,1])s.emplaceBack(M*g.X,F*d,N);for(let M=0;M<2*u;M+=2)l.emplaceBack(I+M,I+M+1,I+M+3),l.emplaceBack(I+M,I+M+3,I+M+2),l.emplaceBack(P+M,P+M+3,P+M+1),l.emplaceBack(P+M,P+M+2,P+M+3);return this._mesh=new qi(e.createVertexBuffer(s,wu.members),e.createIndexBuffer(l),g.a0.simpleSegment(0,0,s.length,l.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*g.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,s){const l=g.Z.fromLngLat(e.wrap()),u=(1<<s)*g.X,d=l.x*u,v=l.y*u,w=Math.floor(d/g.X),S=Math.floor(v/g.X);return{tileID:new g.S(s,0,s,w,S),mercatorX:d,mercatorY:v}}}class Qa{constructor(e,s,l){this._context=e,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new Kt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:e,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((s=>e.id!==s)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const Kn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class el{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new Qa(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((l=>!e._layers[l].isHidden(s))),this._coordsDescendingInv={};for(const l in e.sourceCaches){this._coordsDescendingInv[l]={};const u=e.sourceCaches[l].getVisibleCoordinates();for(const d of u){const v=this.terrain.sourceCache.getTerrainCoords(d);for(const w in v)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(v[w])}}this._coordsDescendingInvStr={};for(const l of e._order){const u=e._layers[l],d=u.source;if(Kn[u.type]&&!this._coordsDescendingInvStr[d]){this._coordsDescendingInvStr[d]={};for(const v in this._coordsDescendingInv[d])this._coordsDescendingInvStr[d][v]=this._coordsDescendingInv[d][v].map((w=>w.key)).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const d=this._coordsDescendingInvStr[u][l.tileID.key];d&&d!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Kn[s]&&(this._prevType&&Kn[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!u))return!0;if(Kn[this._prevType]||Kn[s]&&u){this._prevType=s;const d=this._stacks.length-1,v=this._stacks[d]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(_c(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[d]){const I=this.pool.getObjectForId(w.rtt[d].id);if(I.stamp===w.rtt[d].stamp){this.pool.useObject(I);continue}}const S=this.pool.getOrCreateFreeObject();this.pool.useObject(S),this.pool.stampObject(S),w.rtt[d]={id:S.id,stamp:S.stamp},l.context.bindFramebuffer.set(S.fbo.framebuffer),l.context.clear({color:g.aM.transparent,stencil:0}),l.currentStencilSource=void 0;for(let I=0;I<v.length;I++){const P=l.style._layers[v[I]],M=P.source?this._coordsDescendingInv[P.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,S.fbo.width,S.fbo.height]),l._renderTileClippingMasks(P,M),l.renderLayer(l,l.style.sourceCaches[P.source],P,M),P.source&&(w.rttCoords[P.source]=this._coordsDescendingInvStr[P.source][w.tileID.key])}}return _c(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Kn[s]}return!1}}const tl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},jo=qe,ho={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ri,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:g.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Tr=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},Er={showCompass:!0,showZoom:!0,visualizePitch:!1};class po{constructor(e,s,l=!1){this.mousedown=v=>{this.startMouse(g.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),ge.mousePos(this.element,v)),ge.addEventListener(window,"mousemove",this.mousemove),ge.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,ge.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ge.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),ge.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ge.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=ge.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=e.dragRotate._mouseRotate.getClickTolerance(),d=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Ll({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:w,bearingDegreesPerPixelMoved:S=.8})=>{const I=new yu;return new Ls({clickTolerance:w,move:(P,M)=>({bearingDelta:(M.x-P.x)*S}),moveStateManager:I,enable:v,assignEvents:Tr})})({clickTolerance:u,enable:!0}),this.map=e,l&&(this.mousePitch=Sr({clickTolerance:d,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:w,pitchDegreesPerPixelMoved:S=-.5})=>{const I=new yu;return new Ls({clickTolerance:w,move:(P,M)=>({pitchDelta:(M.y-P.y)*S}),moveStateManager:I,enable:v,assignEvents:Tr})})({clickTolerance:d,enable:!0})),ge.addEventListener(s,"mousedown",this.mousedown),ge.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),ge.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),ge.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),ge.disableDrag()}moveMouse(e,s){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:d}=this.mousePitch.dragMove(e,s)||{};d&&l.setPitch(l.getPitch()+d)}}moveTouch(e,s){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:d}=this.touchPitch.dragMove(e,s)||{};d&&l.setPitch(l.getPitch()+d)}}off(){const e=this.element;ge.removeEventListener(e,"mousedown",this.mousedown),ge.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),ge.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ge.removeEventListener(window,"touchend",this.touchend),ge.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){ge.enableDrag(),ge.removeEventListener(window,"mousemove",this.mousemove),ge.removeEventListener(window,"mouseup",this.mouseup),ge.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ge.removeEventListener(window,"touchend",this.touchend)}}let gr;function Zt(p,e,s){const l=new g.N(p.lng,p.lat);if(p=new g.N(p.lng,p.lat),e){const u=new g.N(p.lng-360,p.lat),d=new g.N(p.lng+360,p.lat),v=s.locationPoint(p).distSqr(e);s.locationPoint(u).distSqr(e)<v?p=u:s.locationPoint(d).distSqr(e)<v&&(p=d)}for(;Math.abs(p.lng-s.center.lng)>180;){const u=s.locationPoint(p);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;p.lng>s.center.lng?p.lng-=360:p.lng+=360}return p.lng!==l.lng&&s.locationPoint(p).y>s.height/2-s.getHorizon()?p:l}const Cn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vs(p,e,s){const l=p.classList;for(const u in Cn)l.remove(`maplibregl-${s}-anchor-${u}`);l.add(`maplibregl-${s}-anchor-${e}`)}class yi extends g.E{constructor(e){if(super(),this._onKeyPress=s=>{const l=s.code,u=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Zt(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),ge.setTransform(this._element,`${Cn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${d}`),ke.frameAsync(new AbortController).then((()=>{this._updateOpacity(s&&s.type==="moveend")})).catch((()=>{}))},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new g.k("dragstart"))),this.fire(new g.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new g.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=g.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=ge.create("div");const s=ge.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const d=ge.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const v=ge.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const w=ge.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const J of S){const re=ge.createNS("http://www.w3.org/2000/svg","ellipse");re.setAttributeNS(null,"opacity","0.04"),re.setAttributeNS(null,"cx","10.5"),re.setAttributeNS(null,"cy","5.80029008"),re.setAttributeNS(null,"rx",J.rx),re.setAttributeNS(null,"ry",J.ry),w.appendChild(re)}const I=ge.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill",this._color);const P=ge.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),I.appendChild(P);const M=ge.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const F=ge.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(F);const N=ge.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(6.0, 7.0)"),N.setAttributeNS(null,"fill","#FFFFFF");const U=ge.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const $=ge.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#000000"),$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962");const W=ge.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),U.appendChild($),U.appendChild(W),v.appendChild(w),v.appendChild(I),v.appendChild(M),v.appendChild(N),v.appendChild(U),s.appendChild(v),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=g.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(s=>{s.preventDefault()})),this._element.addEventListener("mousedown",(s=>{s.preventDefault()})),Vs(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ge.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=g.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const u=this._map,d=u.terrain.depthAtPoint(this._pos),v=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,v)-d<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/u.transform._pixelPerMeter,S=Math.sin(u.getPitch()*Math.PI/180)*w,I=u.terrain.depthAtPoint(new g.P(this._pos.x,this._pos.y-this._offset.y)),P=u.transform.lngLatToCameraDepth(this._lngLat,v+S)-I>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&P&&this._popup.remove(),this._element.style.opacity=P?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=g.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const rl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let fa=0,ma=!1;const dn={maxWidth:100,unit:"metric"};function ga(p,e,s){const l=s&&s.maxWidth||100,u=p._container.clientHeight/2,d=p.unproject([0,u]),v=p.unproject([l,u]),w=d.distanceTo(v);if(s&&s.unit==="imperial"){const S=3.2808*w;S>5280?Qe(e,l,S/5280,p._getUIString("ScaleControl.Miles")):Qe(e,l,S,p._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Qe(e,l,w/1852,p._getUIString("ScaleControl.NauticalMiles")):w>=1e3?Qe(e,l,w/1e3,p._getUIString("ScaleControl.Kilometers")):Qe(e,l,w,p._getUIString("ScaleControl.Meters"))}function Qe(p,e,s,l){const u=(function(d){const v=Math.pow(10,`${Math.floor(d)}`.length-1);let w=d/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(S){const I=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*I)/I})(w),v*w})(s);p.style.width=e*(u/s)+"px",p.innerHTML=`${u}&nbsp;${l}`}const ft={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},_a=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function il(p){if(p){if(typeof p=="number"){const e=Math.round(Math.abs(p)/Math.SQRT2);return{center:new g.P(0,0),top:new g.P(0,p),"top-left":new g.P(e,e),"top-right":new g.P(-e,e),bottom:new g.P(0,-p),"bottom-left":new g.P(e,-e),"bottom-right":new g.P(-e,-e),left:new g.P(p,0),right:new g.P(-p,0)}}if(p instanceof g.P||Array.isArray(p)){const e=g.P.convert(p);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:g.P.convert(p.center||[0,0]),top:g.P.convert(p.top||[0,0]),"top-left":g.P.convert(p["top-left"]||[0,0]),"top-right":g.P.convert(p["top-right"]||[0,0]),bottom:g.P.convert(p.bottom||[0,0]),"bottom-left":g.P.convert(p["bottom-left"]||[0,0]),"bottom-right":g.P.convert(p["bottom-right"]||[0,0]),left:g.P.convert(p.left||[0,0]),right:g.P.convert(p.right||[0,0])}}return il(new g.P(0,0))}const bu=qe;A.AJAXError=g.bh,A.Evented=g.E,A.LngLat=g.N,A.MercatorCoordinate=g.Z,A.Point=g.P,A.addProtocol=g.bi,A.config=g.a,A.removeProtocol=g.bj,A.AttributionControl=ys,A.BoxZoomHandler=Gi,A.CanvasSource=on,A.CooperativeGesturesHandler=pa,A.DoubleClickZoomHandler=Os,A.DragPanHandler=Fl,A.DragRotateHandler=vc,A.EdgeInsets=Fo,A.FullscreenControl=class extends g.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s==null?void 0:s.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:g.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=ge.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ge.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=ge.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ge.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new g.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new g.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},A.GeoJSONSource=cs,A.GeolocateControl=class extends g.E{constructor(p){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new g.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new g.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new g.N(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),d=g.e({bearing:u},this.options.fitBoundsOptions),v=we.fromLngLat(s,l);this._map.fitBounds(v,d,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new g.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&ma)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new g.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=ge.create("button","maplibregl-ctrl-geolocate",this._container),ge.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){g.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ge.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new yi({element:this._dotElement}),this._circleElement=ge.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new yi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new g.k("trackuserlocationend")),this.fire(new g.k("userlocationlostfocus")))}))}},this.options=g.e({},rl,p)}onAdd(p){return this._map=p,this._container=ge.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return g._(this,arguments,void 0,(function*(e=!1){if(gr!==void 0&&!e)return gr;if(window.navigator.permissions===void 0)return gr=!!window.navigator.geolocation,gr;try{gr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{gr=!!window.navigator.geolocation}return gr}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ge.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,fa=0,ma=!1}_isOutOfMapMaxBounds(p){const e=this._map.getMaxBounds(),s=p.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),e=p.getSouthEast(),s=p.getNorthEast(),l=e.distanceTo(s),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return g.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new g.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":fa--,ma=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new g.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new g.k("trackuserlocationstart")),this.fire(new g.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),fa++,fa>1?(p={maximumAge:6e5,timeout:0},ma=!0):(p=this.options.positionOptions,ma=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},A.Hash=Al,A.ImageSource=ds,A.KeyboardHandler=In,A.LngLatBounds=we,A.LogoControl=Xn,A.Map=class extends Vo{constructor(p){g.bf.mark(g.bg.create);const e=Object.assign(Object.assign({},ho),p);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new lo(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ut,this._controls=[],this._mapId=g.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new g.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new g.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},tl),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Xt.addThrottleControl((()=>this.isMoving())),this._requestManager=new tr(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))).on("moveend",(()=>this._update(!1))).on("zoom",(()=>this._update(!0))).on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})).once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const l=Ha((u=>{this._trackResize&&!this._removed&&(this.resize(u),this.redraw())}),50);this._resizeObserver=new ResizeObserver((u=>{s?l(u):s=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Ol(this,e),this._hash=e.hash&&new Al(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,g.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new ys(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Xn,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(s=>{this._update(s.dataType==="style"),this.fire(new g.k(`${s.dataType}data`,s))})),this.on("dataloading",(s=>{this.fire(new g.k(`${s.dataType}dataloading`,s))})),this.on("dataabort",(s=>{this.fire(new g.k("sourcedataabort",s))}))}_getMapId(){return this._mapId}addControl(p,e){if(e===void 0&&(e=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new g.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=p.onAdd(this);this._controls.push(p);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new g.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(p);return e>-1&&this._controls.splice(e,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,e,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,e,s,l)}resize(p){var e;const s=this._containerDimensions(),l=s[0],u=s[1],d=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,d),this.painter.resize(l,u,d),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const S=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,S),this.painter.resize(l,u,S)}this.transform.resize(l,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(l,u);const v=!this._moving;return v&&(this.stop(),this.fire(new g.k("movestart",p)).fire(new g.k("move",p))),this.fire(new g.k("resize",p)),v&&this.fire(new g.k("moveend",p)),this}_getClampedPixelRatio(p,e){const{0:s,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),d=p*u,v=e*u;return Math.min(d>s?s/d:1,v>l?l/v:1)*u}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(we.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(g.N.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(g.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,e,s){if(p==="mouseenter"||p==="mouseover"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:d=>{const v=e.filter((S=>this.getLayer(S))),w=v.length!==0?this.queryRenderedFeatures(d.point,{layers:v}):[];w.length?l||(l=!0,s.call(this,new _i(p,this,d.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(p==="mouseleave"||p==="mouseout"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:v=>{const w=e.filter((S=>this.getLayer(S)));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?l=!0:l&&(l=!1,s.call(this,new _i(p,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,s.call(this,new _i(p,this,v.originalEvent)))}}}}{const l=u=>{const d=e.filter((w=>this.getLayer(w))),v=d.length!==0?this.queryRenderedFeatures(u.point,{layers:d}):[];v.length&&(u.features=v,s.call(this,u),delete u.features)};return{layers:e,listener:s,delegates:{[p]:l}}}}_saveDelegatedListener(p,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(e)}_removeDelegatedListener(p,e,s){if(!this._delegatedListeners||!this._delegatedListeners[p])return;const l=this._delegatedListeners[p];for(let u=0;u<l.length;u++){const d=l[u];if(d.listener===s&&d.layers.length===e.length&&d.layers.every((v=>e.includes(v)))){for(const v in d.delegates)this.off(v,d.delegates[v]);return void l.splice(u,1)}}}on(p,e,s){if(s===void 0)return super.on(p,e);const l=this._createDelegatedListener(p,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(p,l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(p,e,s){if(s===void 0)return super.once(p,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(p,l,s);for(const d in u.delegates){const v=u.delegates[d];u.delegates[d]=(...w)=>{this._removeDelegatedListener(p,l,s),v(...w)}}this._saveDelegatedListener(p,u);for(const d in u.delegates)this.once(d,u.delegates[d]);return this}off(p,e,s){return s===void 0?super.off(p,e):(this._removeDelegatedListener(p,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(p,e){if(!this.style)return[];let s;const l=p instanceof g.P||Array.isArray(p),u=l?p:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:p)||{},u instanceof g.P||typeof u[0]=="number")s=[g.P.convert(u)];else{const d=g.P.convert(u[0]),v=g.P.convert(u[1]);s=[d,new g.P(v.x,d.y),v,new g.P(d.x,v.y),d]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(p,e){return this.style.querySourceFeatures(p,e)}setStyle(p,e){return(e=g.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(p,e))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const e=this._locale[p];if(e==null)throw new Error(`Missing UI string '${p}'`);return e}_updateStyle(p,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(p,e)));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new gl(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,e,s):this.style.loadJSON(p,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new gl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,e){if(typeof p=="string"){const s=this._requestManager.transformRequest(p,"Style");g.h(s,new AbortController).then((l=>{this._updateDiff(l.data,e)})).catch((l=>{l&&this.fire(new g.j(l))}))}else typeof p=="object"&&this._updateDiff(p,e)}_updateDiff(p,e){try{this.style.setState(p,e)&&this._update(!0)}catch(s){g.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(p,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():g.w("There is no style added to the map.")}addSource(p,e){return this._lazyInitEmptyStyle(),this.style.addSource(p,e),this._update(!0)}isSourceLoaded(p){const e=this.style&&this.style.sourceCaches[p];if(e!==void 0)return e.loaded();this.fire(new g.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const e=this.style.sourceCaches[p.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===p.source&&g.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ns(this.painter,e,p),this.painter.renderToTexture=new el(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==p.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new g.k("terrain",{terrain:p})),this}getTerrain(){var p,e;return(e=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const e in p){const s=p[e]._tiles;for(const l in s){const u=s[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,e,s={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:d,stretchY:v,content:w,textFitWidth:S,textFitHeight:I}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||g.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new g.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:P,height:M,data:F}=e,N=e;return this.style.addImage(p,{data:new g.R({width:P,height:M},new Uint8Array(F)),pixelRatio:l,stretchX:d,stretchY:v,content:w,textFitWidth:S,textFitHeight:I,sdf:u,version:0,userImage:N}),N.onAdd&&N.onAdd(this,p),this}}{const{width:P,height:M,data:F}=ke.getImageData(e);this.style.addImage(p,{data:new g.R({width:P,height:M},F),pixelRatio:l,stretchX:d,stretchY:v,content:w,textFitWidth:S,textFitHeight:I,sdf:u,version:0})}}updateImage(p,e){const s=this.style.getImage(p);if(!s)return this.fire(new g.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||g.b(e)?ke.getImageData(e):e,{width:u,height:d,data:v}=l;if(u===void 0||d===void 0)return this.fire(new g.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||d!==s.data.height)return this.fire(new g.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||g.b(e));return s.data.replace(v,w),this.style.updateImage(p,s),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new g.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return Xt.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,e){return this._lazyInitEmptyStyle(),this.style.addLayer(p,e),this._update(!0)}moveLayer(p,e){return this.style.moveLayer(p,e),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,e,s){return this.style.setLayerZoomRange(p,e,s),this._update(!0)}setFilter(p,e,s={}){return this.style.setFilter(p,e,s),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,e,s,l={}){return this.style.setPaintProperty(p,e,s,l),this._update(!0)}getPaintProperty(p,e){return this.style.getPaintProperty(p,e)}setLayoutProperty(p,e,s,l={}){return this.style.setLayoutProperty(p,e,s,l),this._update(!0)}getLayoutProperty(p,e){return this.style.getLayoutProperty(p,e)}setGlyphs(p,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,e,s,(l=>{l||this._update(!0)})),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,e,(s=>{s||this._update(!0)})),this}setLight(p,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(p){return this._lazyInitEmptyStyle(),this.style.setSky(p),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(p,e){return this.style.setFeatureState(p,e),this._update()}removeFeatureState(p,e){return this.style.removeFeatureState(p,e),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,e=0;return this._container&&(p=this._container.clientWidth||400,e=this._container.clientHeight||300),[p,e]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const e=this._canvasContainer=ge.create("div","maplibregl-canvas-container",p);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=ge.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const u=this._controlContainer=ge.create("div","maplibregl-control-container",p),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((v=>{d[v]=ge.create("div",`maplibregl-ctrl-${v} `,u)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,e,s){this._canvas.width=Math.floor(s*p),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{e={requestedAttributes:p},l&&(e.statusMessage=l.statusMessage,e.type=l.type)}),{once:!0});const s=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!s){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new ao(s,this.transform),xr.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,d=ke.now();this.style.zoomHistory.update(u,d);const v=new g.z(u,{now:d,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=v.crossFadingFactor();w===1&&w===this._crossFadingFactor||(s=!0,this._crossFadingFactor=w),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new g.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,g.bf.mark(g.bg.load),this.fire(new g.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new g.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,g.bf.mark(g.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Xt.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ge.remove(this._canvasContainer),ge.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),g.bf.clearMetrics(),this._removed=!0,this.fire(new g.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ke.frameAsync(this._frameRequest).then((p=>{g.bf.frame(p),this._frameRequest=null,this._render(p)})).catch((()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return jo}getCameraTargetElevation(){return this.transform.elevation}},A.MapMouseEvent=_i,A.MapTouchEvent=gs,A.MapWheelEvent=mu,A.Marker=yi,A.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);e.title=l,e.setAttribute("aria-label",l)},this.options=g.e({},Er,p),this._container=ge.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),ge.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),ge.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=ge.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new po(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ge.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,e){const s=ge.create("button",p,this._container);return s.type="button",s.addEventListener("click",e),s}},A.Popup=class extends g.E{constructor(p){super(),this.remove=()=>(this._content&&ge.remove(this._content),this._container&&(ge.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new g.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ge.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ge.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Zt(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let u=this.options.anchor;const d=il(this.options.offset);if(!u){const w=this._container.offsetWidth,S=this._container.offsetHeight;let I;I=l.y+d.bottom.y<S?["top"]:l.y>this._map.transform.height-S?["bottom"]:[],l.x<w/2?I.push("left"):l.x>this._map.transform.width-w/2&&I.push("right"),u=I.length===0?"bottom":I.join("-")}let v=l.add(d[u]);this.options.subpixelPositioning||(v=v.round()),ge.setTransform(this._container,`${Cn[u]} translate(${v.x}px,${v.y}px)`),Vs(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=g.e(Object.create(ft),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new g.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=g.N.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const e=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=p;l=s.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ge.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._container&&this._container.classList.add(p),this}removeClassName(p){return this._container&&this._container.classList.remove(p),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=ge.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(_a);p&&p.focus()}},A.RasterDEMTileSource=wr,A.RasterTileSource=Jt,A.ScaleControl=class{constructor(p){this._onMove=()=>{ga(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,ga(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},dn),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=ge.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ge.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},A.ScrollZoomHandler=Hi,A.Style=gl,A.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=ge.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ge.create("button","maplibregl-ctrl-terrain",this._container),ge.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ge.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},A.TwoFingersTouchPitchHandler=ha,A.TwoFingersTouchRotateHandler=ca,A.TwoFingersTouchZoomHandler=Ya,A.TwoFingersTouchZoomRotateHandler=Bl,A.VectorTileSource=Wo,A.VideoSource=bo,A.addSourceType=(p,e)=>g._(void 0,void 0,void 0,(function*(){if(So(p))throw new Error(`A source type called "${p}" already exists.`);((s,l)=>{Xo[s]=l})(p,e)})),A.clearPrewarmedResources=function(){const p=qt;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(At),qt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},A.getMaxParallelImageRequests=function(){return g.a.MAX_PARALLEL_IMAGE_REQUESTS},A.getRTLTextPluginStatus=function(){return Vi().getRTLTextPluginStatus()},A.getVersion=function(){return bu},A.getWorkerCount=function(){return Vt.workerCount},A.getWorkerUrl=function(){return g.a.WORKER_URL},A.importScriptInWorkers=function(p){return Ys().broadcast("IS",p)},A.prewarm=function(){dr().acquire(At)},A.setMaxParallelImageRequests=function(p){g.a.MAX_PARALLEL_IMAGE_REQUESTS=p},A.setRTLTextPlugin=function(p,e){return Vi().setRTLTextPlugin(p,e)},A.setWorkerCount=function(p){Vt.workerCount=p},A.setWorkerUrl=function(p){g.a.WORKER_URL=p}}));var Ie=Z;return Ie}))})(Dd)),Dd.exports}export{Jf as L,Xf as M,Hf as R,Yf as S,Wf as _,gt as a,Up as b,mf as c,Gf as d,Kf as e,cf as g,Qf as r};
//# sourceMappingURL=maplibre-BL57sJLt.js.map
